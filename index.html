<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
  <title>PCOS Daily</title>
  <meta name="description" content="Strumento quotidiano per gestire la PCOS"/>
  <meta name="theme-color" content="#8B9E7E"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="default"/>
  <meta name="apple-mobile-web-app-title" content="PCOS Daily"/>
  <link rel="manifest" href="./manifest.json"/>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🌸</text></svg>"/>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
  <style>
    *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
    body{font-family:'DM Sans',sans-serif;background:#FBF8F4;overscroll-behavior:none}
    input[type="date"],input[type="time"]{-webkit-appearance:none}
    ::-webkit-scrollbar{display:none}
    button{-webkit-appearance:none}
    @keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
    @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.2)}}
    @keyframes ripple{0%{box-shadow:0 0 0 0 rgba(139,158,126,.4)}100%{box-shadow:0 0 0 12px rgba(139,158,126,0)}}
  </style>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
</head>
<body>
<div id="root"></div>
<script>
// PWA Service Worker registration - force update
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('./sw.js').then(function(reg){
    reg.update();
  }).catch(function(){});
}
</script>
<script type="text/babel">
const{useState,useEffect,useRef,useCallback}=React;

/* ═══════════ PCOS DAILY v2.0 — FULL ROADMAP ═══════════ */
var PCOS_THEME=localStorage.getItem("pcos_theme")||"light";
const C=PCOS_THEME==="dark"?{bg:"#1a1a2e",bgW:"#16213e",white:"#1e1e30",sage:"#8B9E7E",sageD:"#A0B893",sageL:"#4a5a40",sageP:"#2a332a",rose:"#C4918A",roseD:"#d4a19a",roseL:"#5a3a35",roseP:"#2e1f1d",amber:"#D4A574",amberL:"#4a3828",amberP:"#2e2418",plum:"#9B8BAD",plumL:"#3a3050",plumP:"#2a2238",txt:"#e8e0d8",txtM:"#b0a89e",txtL:"#7a726a",bdr:"#3a3248",berry:"#B5547A",berryL:"#3a1a28",berryP:"#2e1420",blue:"#5B9BD5"}:{bg:"#FBF8F4",bgW:"#F5EDE4",white:"#FFFFFF",sage:"#8B9E7E",sageD:"#6B7F5E",sageL:"#C5D4BC",sageP:"#E8F0E4",rose:"#C4918A",roseD:"#A67069",roseL:"#E8C5C0",roseP:"#FFF0ED",amber:"#D4A574",amberL:"#F0DCC8",amberP:"#FFF8F0",plum:"#7B6B8D",plumL:"#D8D0F0",plumP:"#F3F0FF",txt:"#3A3228",txtM:"#6B5E52",txtL:"#9B8E82",bdr:"#E8DFD6",berry:"#B5547A",berryL:"#F5D6E3",berryP:"#FFF0F6",blue:"#5B9BD5"};
const F={p:"'Playfair Display',serif",s:"'DM Sans',sans-serif"};

/* ─── i18n ─── */
var LANG_STORE=localStorage.getItem("pcos_lang")||"it";
var T={
it:{cibo:"Cibo",gym:"Gym",digiuno:"Digiuno",ciclo:"Ciclo",garmin:"Garmin",salute:"Salute",ai:"AI",
alimentazione:"Alimentazione PCOS",allenamento:"Allenamento",digiunoIF:"Digiuno Intermittente",cicloM:"Ciclo Mestruale",garminT:"Garmin Tracker",benessere:"Benessere PCOS",assistente:"Assistente PCOS",
goal:"obiettivo",peso:"Peso",sync:"Sync",medico:"Medico",esci:"Esci",
integratori:"Integratori",sonno:"Sonno",analisi:"Analisi",foto:"Foto",exp:"Export",tips:"Tips",
timer:"Timer",info:"Info",regole:"Regole",storico:"Storico",
scheda:"Scheda",upper:"Upper",lower:"Lower",core:"Core",progressi:"Progressi",
menu:"Menu",idee:"Idee",ricette:"Ricette",spesa:"Spesa",cibiDosi:"Cibi & Dosi",regoleOro:"Regole d'Oro",
dashboard:"Dashboard",pesate:"Pesate",allenamenti:"Allenamenti",giornaliero:"Giornaliero",
aggiungi:"Aggiungi",salva:"Salva",annulla:"Annulla",elimina:"Elimina",chiudi:"Chiudi",
accedi:"Accedi",registrati:"Registrati",oppure:"oppure",email:"Email",password:"Password",
accediGoogle:"Accedi con Google",nonHaiAccount:"Non hai un account? Registrati",haiAccount:"Hai gia un account? Accedi",
condividiMedico:"Condividi con il tuo medico",copiaLink:"Copia",
settInsight:"Insight Settimanale",vistaMedico:"Vista Medico",solaLettura:"Dashboard di sola lettura",
consultaMedico:"Consulta sempre il tuo medico",
chiedimi:"Chiedimi qualcosa sulla PCOS...",stoPensando:"Sto pensando...",
aggPhoto:"Aggiungi Progress Photo",confronta:"Confronta Before/After",prima:"PRIMA",dopo:"DOPO",
inserisciAnalisi:"Inserisci Analisi del Sangue",ultimoPrelievo:"Ultimo Prelievo",storicoAnalisi:"Storico Analisi",trendValori:"Trend Valori",
scaricaTutto:"Scarica TUTTO (4 file CSV)",storicoPesate:"Storico Pesate",
caricamento:"Caricamento...",linkNonValido:"Link non valido",
profiloPaz:"Profilo Paziente",ultimaPesata:"Ultima Pesata",riepilogoAtt:"Riepilogo Attivita",andamentoPeso:"Andamento Peso"},
en:{cibo:"Food",gym:"Gym",digiuno:"Fasting",ciclo:"Cycle",garmin:"Garmin",salute:"Health",ai:"AI",
alimentazione:"PCOS Nutrition",allenamento:"Workout",digiunoIF:"Intermittent Fasting",cicloM:"Menstrual Cycle",garminT:"Garmin Tracker",benessere:"PCOS Wellness",assistente:"PCOS Assistant",
goal:"goal",peso:"Weight",sync:"Sync",medico:"Doctor",esci:"Logout",
integratori:"Supplements",sonno:"Sleep",analisi:"Blood Work",foto:"Photos",exp:"Export",tips:"Tips",
timer:"Timer",info:"Info",regole:"Rules",storico:"History",
scheda:"Plan",upper:"Upper",lower:"Lower",core:"Core",progressi:"Progress",
menu:"Menu",idee:"Ideas",ricette:"Recipes",spesa:"Shopping",cibiDosi:"Foods & Doses",regoleOro:"Golden Rules",
dashboard:"Dashboard",pesate:"Weigh-ins",allenamenti:"Workouts",giornaliero:"Daily",
aggiungi:"Add",salva:"Save",annulla:"Cancel",elimina:"Delete",chiudi:"Close",
accedi:"Sign In",registrati:"Sign Up",oppure:"or",email:"Email",password:"Password",
accediGoogle:"Sign in with Google",nonHaiAccount:"Don't have an account? Sign up",haiAccount:"Already have an account? Sign in",
condividiMedico:"Share with your doctor",copiaLink:"Copy",
settInsight:"Weekly Insight",vistaMedico:"Doctor View",solaLettura:"Read-only dashboard",
consultaMedico:"Always consult your doctor",
chiedimi:"Ask me about PCOS...",stoPensando:"Thinking...",
aggPhoto:"Add Progress Photo",confronta:"Compare Before/After",prima:"BEFORE",dopo:"AFTER",
inserisciAnalisi:"Enter Blood Work",ultimoPrelievo:"Latest Blood Work",storicoAnalisi:"Blood Work History",trendValori:"Value Trends",
scaricaTutto:"Download ALL (4 CSV files)",storicoPesate:"Weight History",
caricamento:"Loading...",linkNonValido:"Invalid link",
profiloPaz:"Patient Profile",ultimaPesata:"Latest Weigh-in",riepilogoAtt:"Activity Summary",andamentoPeso:"Weight Trend"}
};
function t(key){return T[LANG_STORE]&&T[LANG_STORE][key]?T[LANG_STORE][key]:T.it[key]||key;}
function LangToggle(){
  const[lang,setLang]=useState(LANG_STORE);
  function toggle(){var n=lang==="it"?"en":"it";LANG_STORE=n;localStorage.setItem("pcos_lang",n);setLang(n);window.location.reload();}
  return(<button onClick={toggle} style={{padding:"4px 8px",borderRadius:"8px",border:"1px solid "+C.bdr,background:C.white,color:C.plum,fontSize:"9px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}}>{lang==="it"?"🇬🇧 EN":"🇮🇹 IT"}</button>);
}

/* ─── STORAGE ─── */
function LD(k,fb){try{var d=localStorage.getItem("pcos_"+k);return d?JSON.parse(d):fb;}catch(e){return fb;}}
var _syncTimer=null;var _syncUid=null;
function SV(k,d){try{localStorage.setItem("pcos_"+k,JSON.stringify(d));}catch(e){}if(_syncUid){clearTimeout(_syncTimer);_syncTimer=setTimeout(function(){syncToCloud(_syncUid).catch(function(){});},3000);}}
function todayK(){return new Date().toISOString().slice(0,10);}
function fmtD(ds){if(!ds)return"--";return new Date(ds).toLocaleDateString("it-IT",{day:"numeric",month:"short"});}

/* ─── FIREBASE ─── */
var fbApp=firebase.initializeApp({apiKey:"AIzaSyAuzIEgBPNB7IM4ySF-GHeqn8GyFtkmQak",authDomain:"pcos-daily.firebaseapp.com",projectId:"pcos-daily",storageBucket:"pcos-daily.firebasestorage.app",messagingSenderId:"182447746696",appId:"1:182447746696:web:0e30e0bd1e94a232a9793d"});
var fbAuth=firebase.auth();
var fbDb=firebase.firestore();
var googleProvider=new firebase.auth.GoogleAuthProvider();

var SYNC_KEYS=["profile","weighins","workouts","daily","fasts","gymLogs","favRecipes","bloodwork","lastPeriod","cycleLen","fast_isOn","fast_start","fast_goal","symptoms","bodyMeas","habits","suppLog","bbt","mealPlan","pcos_onboarded"];
function syncToCloud(uid){if(!uid)return Promise.resolve();var data={};SYNC_KEYS.forEach(function(k){var v=localStorage.getItem("pcos_"+k);if(v)data[k]=v;});var today=todayK();var dayKeys=["meals_","water_","supps_","sleep_"];dayKeys.forEach(function(prefix){for(var i=0;i<7;i++){var d=new Date();d.setDate(d.getDate()-i);var dk=d.toISOString().slice(0,10);var v=localStorage.getItem("pcos_"+prefix+dk);if(v)data[prefix+dk]=v;}});data.lastSync=new Date().toISOString();var p1=fbDb.collection("users").doc(uid).set(data,{merge:true});var photos=localStorage.getItem("pcos_progressPhotos");var p2=photos?fbDb.collection("users").doc(uid).collection("photos").doc("data").set({photos:photos},{merge:true}):Promise.resolve();return Promise.all([p1,p2]);}
function syncFromCloud(uid){if(!uid)return Promise.resolve();var p1=fbDb.collection("users").doc(uid).get().then(function(doc){if(!doc.exists)return;var data=doc.data();Object.keys(data).forEach(function(k){if(k==="lastSync")return;localStorage.setItem("pcos_"+k,data[k]);});});var p2=fbDb.collection("users").doc(uid).collection("photos").doc("data").get().then(function(doc){if(doc.exists&&doc.data().photos)localStorage.setItem("pcos_progressPhotos",doc.data().photos);}).catch(function(){});return Promise.all([p1,p2]);}
function generateShareLink(uid){if(!uid)return"";return window.location.origin+window.location.pathname+"?view="+uid;}
function isViewMode(){return new URLSearchParams(window.location.search).get("view");}
function getViewUid(){return new URLSearchParams(window.location.search).get("view");}

/* ─── AUTH COMPONENT ─── */
function AuthScreen({onLogin}){
  const[mode,setMode]=useState("login");
  const[email,setEmail]=useState("");
  const[pass,setPass]=useState("");
  const[error,setError]=useState("");
  const[loading,setLoading]=useState(false);
  function doEmail(){setLoading(true);setError("");var fn=mode==="login"?fbAuth.signInWithEmailAndPassword.bind(fbAuth):fbAuth.createUserWithEmailAndPassword.bind(fbAuth);fn(email,pass).then(function(r){onLogin(r.user);}).catch(function(e){setError(e.code==="auth/user-not-found"?"Account non trovato":e.code==="auth/wrong-password"?"Password errata":e.code==="auth/email-already-in-use"?"Email gia registrata":e.code==="auth/weak-password"?"Password troppo corta (min 6)":e.message);setLoading(false);});}
  function doGoogle(){setLoading(true);setError("");fbAuth.signInWithPopup(googleProvider).then(function(r){onLogin(r.user);}).catch(function(e){if(e.code==="auth/popup-blocked"||e.code==="auth/popup-closed-by-user"||e.code==="auth/cancelled-popup-request"){fbAuth.signInWithRedirect(googleProvider);return;}setError(e.code==="auth/unauthorized-domain"?"Dominio non autorizzato in Firebase. Aggiungi questo dominio nelle impostazioni Authentication.":e.message);setLoading(false);});}
  return(<div style={{minHeight:"100vh",background:"linear-gradient(180deg,"+C.sageP+","+C.bg+")",display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"}}>
    <div style={{maxWidth:"380px",width:"100%"}}>
      <div style={{textAlign:"center",marginBottom:"30px"}}><div style={{fontSize:"48px",marginBottom:"8px"}}>🌸</div><h1 style={{fontFamily:F.p,fontSize:"28px",fontWeight:"600",color:C.txt,margin:"0 0 4px"}}>PCOS Daily</h1><p style={{fontFamily:F.s,fontSize:"13px",color:C.txtL}}>Il tuo strumento quotidiano per gestire la PCOS</p></div>
      <Cd style={{padding:"24px"}}>
        <button onClick={doGoogle} disabled={loading} style={{width:"100%",padding:"13px",borderRadius:"12px",border:"1px solid "+C.bdr,background:C.white,color:C.txt,fontSize:"14px",fontFamily:F.s,fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",marginBottom:"16px"}}><svg width="18" height="18" viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/></svg>{loading?t("caricamento"):t("accediGoogle")}</button>
        <div style={{display:"flex",alignItems:"center",gap:"10px",margin:"12px 0"}}><div style={{flex:1,height:"1px",background:C.bdr}}/><span style={{fontSize:"11px",fontFamily:F.s,color:C.txtL}}>{t("oppure")}</span><div style={{flex:1,height:"1px",background:C.bdr}}/></div>
        <div style={{display:"grid",gap:"8px"}}><input type="email" placeholder={t("email")} value={email} onChange={function(e){setEmail(e.target.value);}} style={Object.assign({},iS,{padding:"12px"})}/><input type="password" placeholder={t("password")} value={pass} onChange={function(e){setPass(e.target.value);}} onKeyDown={function(e){if(e.key==="Enter")doEmail();}} style={Object.assign({},iS,{padding:"12px"})}/></div>
        {error&&<p style={{fontSize:"11px",fontFamily:F.s,color:C.rose,margin:"8px 0 0",textAlign:"center"}}>{error}</p>}
        <button onClick={doEmail} disabled={loading||!email||!pass} style={{width:"100%",padding:"13px",borderRadius:"12px",border:"none",background:!email||!pass?C.bdr:"linear-gradient(135deg,"+C.sage+","+C.sageD+")",color:!email||!pass?C.txtL:C.white,fontSize:"14px",fontFamily:F.s,fontWeight:"600",cursor:!email||!pass?"default":"pointer",marginTop:"12px"}}>{loading?t("caricamento"):mode==="login"?t("accedi"):t("registrati")}</button>
        <p style={{textAlign:"center",margin:"12px 0 0"}}><button onClick={function(){setMode(mode==="login"?"register":"login");setError("");}} style={{background:"none",border:"none",color:C.sage,fontSize:"12px",fontFamily:F.s,fontWeight:"600",cursor:"pointer",textDecoration:"underline"}}>{mode==="login"?t("nonHaiAccount"):t("haiAccount")}</button></p>
      </Cd>
      <p style={{textAlign:"center",fontSize:"10px",fontFamily:F.s,color:C.txtL,marginTop:"16px"}}>{LANG_STORE==="en"?"Your data will be synced to the cloud and accessible from any device.":"I tuoi dati saranno sincronizzati in cloud e accessibili da ogni dispositivo."}</p>
      <div style={{textAlign:"center",marginTop:"10px"}}><LangToggle/></div>
    </div>
  </div>);
}

/* ─── DOCTOR VIEW ─── */
function DoctorView({uid}){
  const[data,setData]=useState(null);
  const[loading,setLoading]=useState(true);
  useEffect(function(){fbDb.collection("users").doc(uid).get().then(function(doc){if(doc.exists){var d=doc.data();Object.keys(d).forEach(function(k){if(k!=="lastSync")localStorage.setItem("pcos_"+k,d[k]);});setData(d);}setLoading(false);}).catch(function(){setLoading(false);});},[uid]);
  if(loading)return(<div style={{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:C.bg}}><div style={{textAlign:"center"}}><div style={{fontSize:"40px",marginBottom:"10px"}}>🌸</div><p style={{fontFamily:F.s,fontSize:"14px",color:C.txtM}}>Caricamento dati paziente...</p></div></div>);
  if(!data)return(<div style={{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:C.bg}}><Cd style={{maxWidth:"400px",textAlign:"center",padding:"30px"}}><div style={{fontSize:"40px",marginBottom:"10px"}}>❌</div><h2 style={{fontFamily:F.p,fontSize:"18px",color:C.txt}}>Link non valido</h2><p style={{fontFamily:F.s,fontSize:"13px",color:C.txtM}}>Questo link di condivisione non esiste o è stato rimosso.</p></Cd></div>);
  var profile=data.profile?JSON.parse(data.profile):DEF_PROF;
  var weighins=data.weighins?JSON.parse(data.weighins):[];
  var bloods=data.bloodwork?JSON.parse(data.bloodwork):[];
  var fasts=data.fasts?JSON.parse(data.fasts):[];
  var workouts=data.workouts?JSON.parse(data.workouts):[];
  var mc=calcMacros(profile);
  var latW=weighins.length>0?weighins[weighins.length-1]:null;
  return(<div style={{minHeight:"100vh",background:"linear-gradient(180deg,"+C.bg+","+C.bgW+")"}}>
    <div style={{background:C.white,borderBottom:"1px solid "+C.bdr,padding:"14px 16px"}}><div style={{display:"flex",alignItems:"center",gap:"10px",maxWidth:"640px",margin:"0 auto"}}><span style={{fontSize:"22px"}}>🌸</span><div><h1 style={{fontFamily:F.p,fontSize:"17px",fontWeight:"600",color:C.txt,margin:0}}>PCOS Daily — Vista Medico</h1><p style={{fontSize:"10px",color:C.txtL,fontFamily:F.s,margin:0}}>Dashboard di sola lettura | {profile.name||"Paziente"}</p></div></div></div>
    <div style={{maxWidth:"640px",margin:"0 auto",padding:"18px 12px"}}>
      <Cd accent={C.sage} style={{marginBottom:"12px",background:"linear-gradient(135deg,"+C.sageP+","+C.white+")"}}><h3 style={{fontFamily:F.p,fontSize:"16px",margin:"0 0 10px",color:C.sageD}}>Profilo Paziente</h3><div style={{display:"flex",gap:"6px",flexWrap:"wrap"}}><Pill color={C.sage}>{profile.age} anni</Pill><Pill color={C.sage}>{profile.height} cm</Pill><Pill color={C.sage}>{profile.weight} kg</Pill><Pill color={C.sage}>BF {profile.bf}%</Pill><Pill color={C.amber}>Target {mc.target} kcal</Pill><Pill color={C.plum}>IF {profile.ifH}:{24-profile.ifH}</Pill></div>{profile.allergies&&profile.allergies.length>0&&<div style={{display:"flex",gap:"4px",flexWrap:"wrap",marginTop:"6px"}}>{profile.allergies.map(function(a){return <Pill key={a} color={C.rose}>🚫 {a}</Pill>;})}</div>}</Cd>
      {latW&&<Cd accent={C.sage} style={{marginBottom:"12px"}}><h4 style={{fontFamily:F.s,fontSize:"13px",fontWeight:"600",color:C.sageD,margin:"0 0 8px"}}>Ultima Pesata — {fmtD(latW.date)}</h4><div style={{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:"8px"}}>{[{l:"Peso",v:latW.weight+" kg"},{l:"Body Fat",v:latW.bf+"%"},{l:"Muscolo",v:latW.mm+"%"}].map(function(m,i){return<div key={i} style={{textAlign:"center",padding:"8px",borderRadius:"8px",background:C.bg}}><div style={{fontSize:"16px",fontWeight:"700",color:C.sage,fontFamily:F.s}}>{m.v}</div><div style={{fontSize:"9px",color:C.txtL,fontFamily:F.s}}>{m.l}</div></div>;})}</div></Cd>}
      {bloods.length>0&&<Cd accent={C.berry} style={{marginBottom:"12px"}}><h4 style={{fontFamily:F.s,fontSize:"13px",fontWeight:"600",color:C.berry,margin:"0 0 8px"}}>Ultime Analisi — {fmtD(bloods[0].date)}</h4><div style={{display:"grid",gap:"4px"}}>{Object.keys(bloods[0]).filter(function(k){return k!=="date"&&bloods[0][k];}).map(function(k){return<div key={k} style={{display:"flex",justifyContent:"space-between",padding:"6px 8px",borderRadius:"6px",background:C.bg}}><span style={{fontSize:"11px",fontFamily:F.s,color:C.txt,textTransform:"capitalize"}}>{k}</span><span style={{fontSize:"11px",fontFamily:F.s,fontWeight:"600",color:C.plum}}>{bloods[0][k]}</span></div>;})}</div></Cd>}
      <Cd accent={C.plum} style={{marginBottom:"12px"}}><h4 style={{fontFamily:F.s,fontSize:"13px",fontWeight:"600",color:C.plum,margin:"0 0 8px"}}>Riepilogo Attivita</h4><div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"8px"}}><div style={{textAlign:"center",padding:"10px",borderRadius:"8px",background:C.bg}}><div style={{fontSize:"18px",fontWeight:"700",color:C.sage,fontFamily:F.s}}>{weighins.length}</div><div style={{fontSize:"9px",color:C.txtL,fontFamily:F.s}}>Pesate</div></div><div style={{textAlign:"center",padding:"10px",borderRadius:"8px",background:C.bg}}><div style={{fontSize:"18px",fontWeight:"700",color:C.rose,fontFamily:F.s}}>{workouts.length}</div><div style={{fontSize:"9px",color:C.txtL,fontFamily:F.s}}>Allenamenti</div></div><div style={{textAlign:"center",padding:"10px",borderRadius:"8px",background:C.bg}}><div style={{fontSize:"18px",fontWeight:"700",color:C.plum,fontFamily:F.s}}>{fasts.filter(function(f){return f.completed;}).length}</div><div style={{fontSize:"9px",color:C.txtL,fontFamily:F.s}}>Digiuni</div></div></div></Cd>
      {weighins.length>2&&<Cd style={{marginBottom:"12px"}}><h4 style={{fontFamily:F.p,fontSize:"14px",margin:"0 0 10px",color:C.txt}}>Andamento Peso</h4><div style={{display:"flex",alignItems:"flex-end",gap:"3px",height:"100px"}}>{weighins.slice(-12).map(function(w,i,arr){var mn=Math.min.apply(null,arr.map(function(x){return x.weight;}))-1;var mx=Math.max.apply(null,arr.map(function(x){return x.weight;}))+1;var h=((w.weight-mn)/(mx-mn))*100;var il=i===arr.length-1;return<div key={i} style={{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:"2px"}}><span style={{fontSize:"7px",fontFamily:F.s,color:il?C.sage:C.txtL,fontWeight:il?"700":"400"}}>{w.weight}</span><div style={{width:"100%",maxWidth:"24px",height:h+"%",borderRadius:"4px 4px 2px 2px",background:il?C.sage:C.sageL}}/><span style={{fontSize:"6px",fontFamily:F.s,color:C.txtL}}>{fmtD(w.date)}</span></div>;})}</div></Cd>}
      <div style={{textAlign:"center",padding:"20px"}}><p style={{fontSize:"10px",fontFamily:F.s,color:C.txtL}}>PCOS Daily v2.5 | Dashboard di sola lettura</p></div>
    </div>
  </div>);
}
/* ─── PROFILE ─── */
var DEF_PROF={name:"",age:27,height:168,weight:77,bf:29,goalW:68,goalBf:23,ifOpen:"10:00",ifClose:"20:00",ifH:14,stepsG:10000,waterG:8,workoutsG:4,allergies:[]};
function calcMacros(p){var bmr=447.6+(9.2*p.weight)+(3.1*p.height)-(4.3*p.age);var tdee=bmr*1.5;var target=Math.round(tdee-500);var prot=Math.round(p.weight*1.5);var fat=Math.round(target*0.35/9);var carb=Math.round((target-prot*4-fat*9)/4);return{bmr:Math.round(bmr),tdee:Math.round(tdee),target:target,prot:prot,fat:fat,carb:carb};}

/* ─── SUPPLEMENTS ─── */
var DEF_SUPPS=[
  {id:"inositolo",name:"Inositolo (myo + D-chiro)",time:"Mattina",note:"Migliora insulino-resistenza"},
  {id:"vitd",name:"Vitamina D3",time:"Pranzo",note:"Spesso carente nella PCOS"},
  {id:"omega3",name:"Omega-3 (EPA/DHA)",time:"Pranzo",note:"Anti-infiammatorio"},
  {id:"magnesio",name:"Magnesio",time:"Sera",note:"Riduce stress e crampi"},
  {id:"zinco",name:"Zinco",time:"Sera",note:"Supporta ovulazione"},
  {id:"nac",name:"NAC",time:"Mattina",note:"Antiossidante, fertilita"},
];


/* ─── QUOTES ─── */
const QUOTES=[
  {q:"La PCOS non ti definisce. Tu definisci come affrontarla, ogni giorno.",t:"mindset"},
  {q:"Ogni pasto equilibrato e un piccolo atto di cura verso il tuo corpo.",t:"food"},
  {q:"La verdura prima di tutto: riduce l'insulina fino al 48%.",t:"tip"},
  {q:"Non stai seguendo una dieta. Stai costruendo un nuovo rapporto con il tuo corpo.",t:"mindset"},
  {q:"Il resistance training non ti rende grossa: ti rende forte e brucia grasso anche a riposo.",t:"gym"},
  {q:"I tuoi progressi non si misurano solo sulla bilancia. Energia, umore, ciclo: tutto conta.",t:"mindset"},
  {q:"Il te verde a digiuno riduce l'insulina. Una tazza calda e un momento per te.",t:"tip"},
  {q:"L'olio EVO non e il nemico: stabilizza la glicemia e ti sazia piu a lungo.",t:"tip"},
  {q:"Ogni passo conta. 10.000 passi non sono un obbligo, sono un regalo al tuo metabolismo.",t:"gym"},
  {q:"Non confrontarti con chi non ha la PCOS. Il tuo percorso e unico e merita rispetto.",t:"mindset"},
  {q:"Dormire bene e potente quanto allenarsi: il cortisolo alto sabota la perdita di grasso.",t:"tip"},
  {q:"Le proteine a colazione riducono la fame per tutto il giorno.",t:"food"},
  {q:"Non serve essere perfette. Serve essere costanti, con gentilezza.",t:"mindset"},
  {q:"La cannella nel porridge non e solo buona: migliora la sensibilita insulinica.",t:"tip"},
  {q:"Hip Thrust e Squat: i tuoi migliori alleati contro il grasso addominale.",t:"gym"},
  {q:"Mangiare i carboidrati per ultimi non e una regola rigida: e una strategia che funziona.",t:"food"},
  {q:"Anche nei giorni difficili, ricorda: stai facendo qualcosa per te.",t:"mindset"},
  {q:"I legumi sono proteine vegetali potenti: ceci, lenticchie, fagioli. Alternali nel menu.",t:"food"},
  {q:"Lo stress cronico alza il cortisolo e peggiora la PCOS. Prenditi 10 minuti per respirare.",t:"tip"},
  {q:"Non esistono cibi proibiti, esistono scelte consapevoli.",t:"mindset"},
  {q:"L'acqua e fondamentale: 2 litri al giorno aiutano metabolismo e sazieta.",t:"tip"},
  {q:"Muoversi non e una punizione per quello che hai mangiato. E un premio per il tuo corpo.",t:"gym"},
  {q:"La PCOS e cronica ma gestibile. Ogni giorno migliore e un investimento sul tuo futuro.",t:"mindset"},
  {q:"Il salmone e ricco di omega-3 anti-infiammatori. Prova 2-3 volte a settimana.",t:"food"},
  {q:"La tua massa muscolare e il tuo miglior alleato: piu muscoli = piu calorie bruciate a riposo.",t:"gym"},
  {q:"Ascolta il tuo corpo. Se un giorno hai piu fame, non e un fallimento: e biologia.",t:"mindset"},
  {q:"I mirtilli hanno il piu basso indice glicemico tra la frutta. Perfetti per colazione.",t:"food"},
  {q:"Il digiuno intermittente non e soffrire la fame: e dare al corpo tempo di riparare.",t:"tip"},
  {q:"Celebra ogni piccolo traguardo: 1 kg perso, un ciclo arrivato, una settimana costante.",t:"mindset"},
  {q:"Le noci e le mandorle stabilizzano la glicemia: 15-20g al giorno sono il tuo snack ideale.",t:"food"},
  {q:"Oggi e un buon giorno per prenderti cura di te.",t:"mindset"},
];
function getDailyQuote(){var d=new Date();var i=(d.getFullYear()*366+d.getMonth()*31+d.getDate())%QUOTES.length;return QUOTES[i];}


/* ─── CYCLE PHASES (see full definition below at line ~782) ─── */

/* ─── MENU 7 GIORNI ─── */
const MENU=[
  {day:"Lunedi",col:{t:"Avocado Toast + Uovo",desc:"Pane di segale tostato (40g) + 1/2 avocado (60g) + 1 uovo in camicia + semi di chia (10g) + spinacini (30g)",kcal:510,p:22,c:42,f:28},pra:{t:"Pollo & Quinoa Mediterranea",desc:"Rucola e pomodori (200g) + olio EVO (10ml) \u2192 pollo grigliato (150g) \u2192 quinoa (60g cruda) al limone",kcal:555,p:42,c:48,f:18},cen:{t:"Salmone al Forno",desc:"Crema di zucchine e porri (250g) \u2192 salmone al forno (120g) con erbe \u2192 pane integrale (25g)",kcal:360,p:32,c:18,f:16},sn:{t:"10 mandorle (15g)",kcal:90}},
  {day:"Martedi",col:{t:"Porridge Proteico",desc:"Fiocchi d'avena larghi (40g) + burro di mandorle (15g) + mirtilli (80g) + semi canapa (10g) + cannella",kcal:480,p:18,c:52,f:22},pra:{t:"Lenticchie & Riso Integrale",desc:"Broccoli al vapore (250g) + curcuma \u2192 lenticchie rosse (70g crude) in umido \u2192 riso basmati integrale (50g crudo)",kcal:540,p:28,c:72,f:10},cen:{t:"Frittata Spinaci & Zucchine",desc:"Insalata verde e finocchi (200g) + olio EVO (8ml) \u2192 frittata (2 uova) con spinaci (100g) e zucchine (80g) \u2192 pane segale (30g)",kcal:370,p:24,c:22,f:20},sn:{t:"1 kiwi (80g)",kcal:45}},
  {day:"Mercoledi",col:{t:"Colazione Salata Completa",desc:"Fette Wasa (2, ~30g) + fiocchi di latte (100g) + fesa di tacchino (40g) + carote crude (80g) + 5 noci (15g)",kcal:490,p:32,c:38,f:20},pra:{t:"Merluzzo & Patate Dolci",desc:"Insalata pomodori e sedano (200g) + olio EVO (10ml) \u2192 merluzzo al forno (150g) con olive (15g) \u2192 patate dolci (120g) al rosmarino",kcal:530,p:36,c:50,f:16},cen:{t:"Ceci in Insalata",desc:"Minestrone di verdure (300ml) \u2192 ceci (50g secchi = ~120g cotti) in insalata con cipolla rossa e prezzemolo + olio EVO (8ml)",kcal:340,p:18,c:38,f:12},sn:{t:"Bastoncini sedano + hummus (30g)",kcal:75}},
  {day:"Giovedi",col:{t:"Budino di Chia Tropicale",desc:"Semi chia (25g) in latte di cocco (150ml) + cocco rape (10g) + lamponi (80g) + pistacchi (15g) + pane segale (30g) + tacchino (30g)",kcal:520,p:22,c:44,f:28},pra:{t:"Tacchino al Limone & Farro",desc:"Valeriana e carote julienne (200g) + olio EVO (10ml) \u2192 tacchino (150g) al limone \u2192 farro integrale (55g crudo)",kcal:545,p:40,c:52,f:16},cen:{t:"Zuppa Grano Saraceno & Sgombro",desc:"Zuppa grano saraceno (40g), porri e broccoli (200g) \u2192 sgombro al forno (100g) con pomodorini (80g)",kcal:360,p:26,c:30,f:14},sn:{t:"Mela verde (150g)",kcal:75}},
  {day:"Venerdi",col:{t:"Toast Salmone & Avocado",desc:"Pane integrale tostato (40g) + salmone affumicato (50g) + 1/2 avocado (60g) + semi sesamo (5g) + rucola (20g)",kcal:500,p:24,c:34,f:30},pra:{t:"Riso Venere & Seppie",desc:"Rucola e radicchio (200g) + olio EVO (10ml) \u2192 seppie (150g) con fagioli borlotti (50g secchi) \u2192 riso venere (50g crudo)",kcal:560,p:38,c:54,f:16},cen:{t:"Orata al Cartoccio",desc:"Cavoletti di Bruxelles saltati (200g) + olio EVO (5ml) \u2192 orata al cartoccio (150g) con erbe e limone",kcal:330,p:36,c:10,f:14},sn:{t:"Yogurt greco 0% (80g) + 3 noci",kcal:95}},
  {day:"Sabato",col:{t:"Omelette Ricca di Verdure",desc:"Omelette (2 uova + 1 albume) con zucchine (80g) e peperoni (60g) + pane segale (35g) + 1/4 avocado (35g)",kcal:510,p:28,c:32,f:26},pra:{t:"Polpette Merluzzo & Orzo",desc:"Spinacini (100g), noci (10g), mela verde (80g) \u2192 polpette merluzzo (150g) su crema porri \u2192 orzo (55g crudo)",kcal:555,p:36,c:56,f:18},cen:{t:"Vellutata Cannellini al Timo",desc:"Insalata verde (150g) \u2192 vellutata fagioli cannellini (60g secchi) con cipolle e crostini segale (20g) al timo",kcal:340,p:20,c:40,f:10},sn:{t:"Cioccolato fondente 85% (10g)",kcal:55}},
  {day:"Domenica",col:{t:"Pancake Proteici",desc:"Farina d'avena (35g) + 2 albumi + 1 uovo + frutti di bosco (100g) + burro arachidi (10g) + cannella",kcal:480,p:26,c:48,f:18},pra:{t:"Pollo & Patate in Insalata",desc:"Pomodori, cetrioli e rucola (200g) + olio EVO (10ml) \u2192 petto pollo al forno (150g) \u2192 patate novelle (100g) tiepide con aceto",kcal:550,p:42,c:48,f:16},cen:{t:"Crema di Zucca & Uova Sode",desc:"Crema zucca al forno (200g) con porri e crusca d'avena (8g) \u2192 2 uova sode \u2192 insalata verde (100g)",kcal:340,p:22,c:24,f:16},sn:{t:"Fiocchi di latte (60g) + pinoli",kcal:70}},
];


/* ─── IDEE PASTI ─── */
const IDEAS={
  colazione:{intro:"Pasto PRINCIPALE (~520 kcal) ore 10:00. Rapporto 2:1 proteine:carboidrati.",items:[
    {n:"Avocado Toast Proteico",d:"Pane segale tostato (40g) + 1/2 avocado (60g) + 1 uovo in camicia + semi sesamo (5g)",i:"\u{1F951}",kcal:"~510"},
    {n:"Toast Salmone & Fiocchi di Latte",d:"Fette Wasa (2x15g) + fiocchi di latte (100g) + salmone affumicato (40g) + pomodorini (50g)",i:"\u{1F41F}",kcal:"~470"},
    {n:"Omelette Verdure",d:"2 uova + 1 albume + zucchine (80g) e peperoni (60g) + pane integrale (35g) + 1/4 avocado (35g)",i:"\u{1F373}",kcal:"~510"},
    {n:"Porridge Power",d:"Avena fiocchi larghi (40g) + burro mandorle (15g) + mirtilli (80g) + semi canapa (10g) + cannella",i:"\u{1F963}",kcal:"~480"},
    {n:"Budino di Chia",d:"Semi chia (25g) in latte cocco (150ml) + lamponi (80g) + pistacchi (15g)",i:"\u{1F965}",kcal:"~460"},
    {n:"Pancake Proteici",d:"Farina avena (35g) + 2 albumi + 1 uovo + frutti di bosco (100g) + burro arachidi (10g)",i:"\u{1F95E}",kcal:"~480"},
  ]},
  pranzo:{intro:"Pasto equilibrato (~550 kcal) ore 14:00. Ordine: VERDURA \u2192 PROTEINE \u2192 CARBO.",items:[
    {n:"Bowl Mediterranea",d:"Rucola e pomodori (200g) + olio EVO (10ml) \u2192 pollo grigliato (150g) \u2192 quinoa (60g cruda)",i:"\u{1F957}",kcal:"~555"},
    {n:"Salmone & Riso Integrale",d:"Cavolfiore al vapore (250g) \u2192 salmone al forno (130g) \u2192 riso basmati integrale (50g crudo)",i:"\u{1F41F}",kcal:"~540"},
    {n:"Polpette Merluzzo & Porri",d:"Insalata (spinacini 100g, noci 10g, mela 80g) \u2192 polpette merluzzo (150g) \u2192 orzo (55g crudo)",i:"\u{1F41F}",kcal:"~555"},
    {n:"Riso Venere & Salmone",d:"Insalata mista (200g) \u2192 riso venere (50g crudo) con salmone (80g), olive (15g), capperi",i:"\u{1F35A}",kcal:"~530"},
    {n:"Tacchino & Farro",d:"Valeriana e carote (200g) + olio EVO (10ml) \u2192 tacchino (150g) al limone \u2192 farro integrale (55g crudo)",i:"\u{1F357}",kcal:"~545"},
  ]},
  cena:{intro:"Pasto LEGGERO (~350 kcal) entro le 19:30. Proteine + verdure, pochi carboidrati.",items:[
    {n:"Orata al Cartoccio",d:"Cavoletti (200g) saltati + olio EVO (5ml) \u2192 orata al cartoccio (150g) con erbe e limone",i:"\u{1F41F}",kcal:"~330"},
    {n:"Vellutata Cannellini",d:"Insalata verde (150g) \u2192 vellutata fagioli cannellini (60g secchi) con crostini segale (20g)",i:"\u{1F372}",kcal:"~340"},
    {n:"Salmone Yogurt & Spinaci",d:"Spinacini (150g) \u2192 salmone (120g) in salsa yogurt (60g) con pinoli (8g)",i:"\u{1F41F}",kcal:"~350"},
    {n:"Frittata Leggera",d:"Insalata verde (200g) + olio EVO (5ml) \u2192 frittata (2 uova) con spinaci (100g) e funghi (80g)",i:"\u{1F373}",kcal:"~330"},
    {n:"Tonno & Crema Avocado",d:"Insalata verde (200g) \u2192 tonno fresco scottato (120g) con crema avocado (40g) e lime",i:"\u{1F41F}",kcal:"~340"},
  ]},
};

/* ─── RICETTE ─── */
const RECIPES=[
  {n:"Salmone in salsa di yogurt e spinaci",cat:"Secondo",url:"https://www.lotusflowerpcos.com/salmone-in-salsa-di-yogurt-e-spinaci/",ing:"Salmone 150g + spinacini 125g + yogurt 60g + pinoli 10g",kcal:"~360",tag:"Omega-3"},
  {n:"Polpette di ceci con salsa di capperi",cat:"Secondo",url:"https://www.lotusflowerpcos.com/polpette-ceci-salsa-capperi/",ing:"Ceci secchi 60g + 1 uovo + crusca avena + capperi",kcal:"~280",tag:"Legumi"},
  {n:"Polpette di merluzzo con arancia e porri",cat:"Secondo",url:"https://www.lotusflowerpcos.com/polpette-di-merluzzo-arancia-crema-di-porri/",ing:"Merluzzo 125g + 1 uovo + porri 200g",kcal:"~300",tag:"Omega-3"},
  {n:"Riso venere con salmone e capperi",cat:"Primo",url:"https://www.lotusflowerpcos.com/riso-venere-salmone-affumicato-olive-capperi-limone/",ing:"Riso venere 60g + salmone 50g + olive 10g",kcal:"~380",tag:"Integrale"},
  {n:"Spaghetti integrali ragu di orata",cat:"Primo",url:"https://www.lotusflowerpcos.com/spaghetti-integrali-ragu-bianco-orata/",ing:"Spaghetti integrali 60g + orata 150g + sedano",kcal:"~420",tag:"Integrale"},
  {n:"Timballini quinoa con verdure",cat:"Primo",url:"https://www.lotusflowerpcos.com/timballini-di-quinoa-con-verdurine-e-curcuma/",ing:"Quinoa 60g + verdure miste 150g + curcuma",kcal:"~350",tag:"Anti-infiamm."},
  {n:"Tonno scottato con crema di avocado",cat:"Secondo",url:"https://www.lotusflowerpcos.com/tonno-scottato-con-crema-di-avocado/",ing:"Tonno fresco 130g + avocado 50g + lime",kcal:"~340",tag:"Omega-3"},
  {n:"Risotto integrale funghi e rosmarino",cat:"Primo",url:"https://www.lotusflowerpcos.com/risotto-integrale-leggero-funghi-rosmarino/",ing:"Riso integrale 60g + funghi misti 150g",kcal:"~350",tag:"Integrale"},
  {n:"Vellutata cannellini con crostini timo",cat:"Primo",url:"https://www.lotusflowerpcos.com/vellutata-fagioli-cannellini-cipolle-crostini-al-timo/",ing:"Cannellini secchi 60g + pane segale 25g",kcal:"~310",tag:"Legumi"},
  {n:"Zuppa farro ai funghi",cat:"Primo",url:"https://www.lotusflowerpcos.com/zuppa-farro-ai-funghi/",ing:"Farro 60g + funghi misti 200g",kcal:"~320",tag:"Integrale"},
  {n:"Polpettone pollo erbe provenzali",cat:"Secondo",url:"https://www.lotusflowerpcos.com/polpettone-pollo-umido-alle-erbe-provenzali/",ing:"Petto pollo 150g + crusca avena + pomodoro 200g",kcal:"~300",tag:"Proteine"},
  {n:"Insalata cavoletti mandorle pompelmo",cat:"Contorno",url:"https://www.lotusflowerpcos.com/insalata-cavoletti-brasati-mandorle-pompelmo-rosa/",ing:"Cavoletti 175g + pompelmo rosa + mandorle 10g",kcal:"~160",tag:"Fibre"},
  {n:"Grigliata verdure con chimichurri",cat:"Contorno",url:"https://www.lotusflowerpcos.com/grigliata-verdure-invernale-salsa-chimichurri/",ing:"Radicchio + finocchio + funghi 150g",kcal:"~120",tag:"Fibre"},
];

/* ─── CIBI ─── */
const FOODS=[
  {cat:"Verdure",items:["Broccoli","Cavolfiore","Zucchine","Spinaci","Rucola","Sedano","Finocchi","Funghi","Asparagi","Peperoni"],note:"PRIMA portata. 200-250g cotte, 80-100g crude.",ico:"\u{1F96C}"},
  {cat:"Proteine",items:["Pollo/tacchino 120-150g","Pesce 120-150g","2 uova (fino 12/sett)","Fiocchi di latte 100g","Legumi 50-70g secchi","Fesa tacchino 40-60g"],note:"Seconda portata. Target ~112g/giorno.",ico:"\u{1F969}"},
  {cat:"Carboidrati",items:["Avena 35-40g","Riso integrale 50-60g","Quinoa 50-60g","Farro 50-60g","Pane segale 30-40g","Fette Wasa 2-3"],note:"ULTIMA portata, mai soli. Grammi a crudo.",ico:"\u{1F33E}"},
  {cat:"Grassi buoni",items:["Olio EVO 10-15ml/pasto","Avocado mezzo (60g)","Mandorle/noci 15-20g","Semi chia/lino 10g","Burro arachidi 10-15g"],note:"Non eliminare mai. Target ~58g/giorno.",ico:"\u{1F951}"},
  {cat:"Frutta",items:["Mirtilli 80g","Fragole/lamponi 100g","Mela verde 150g","Kiwi 1 medio","Pompelmo mezzo"],note:"Sempre INTERA, mai frullata.",ico:"\u{1F353}"},
  {cat:"Bevande",items:["Te verde 2-3 tazze","Te menta piperita","Te cannella","Camomilla","Caffe max 2/giorno"],note:"Ok anche a digiuno (senza zucchero).",ico:"\u{1F375}"},
];


/* ─── GYM ─── */
const GYM={
  upper:{t:"Upper Body",ico:"\u{1F4AA}",why:"Piu massa muscolare = metabolismo basale alto = piu calorie bruciate a riposo.",ex:[
    {n:"Lat Pulldown",s:"3x12",r:"60s",nt:"Presa larga, squeeze scapole",vid:"lat+pulldown+tutorial"},
    {n:"Chest Press manubri",s:"3x12",r:"60s",nt:"3s eccentrica",vid:"chest+press+manubri"},
    {n:"Shoulder Press",s:"3x10",r:"60s",nt:"Schiena dritta",vid:"shoulder+press+tutorial"},
    {n:"Cable Row",s:"3x12",r:"60s",nt:"Gomiti al corpo",vid:"cable+row+tutorial"},
    {n:"Curl bicipiti",s:"2x15",r:"45s",nt:"Alternati",vid:"curl+bicipiti"},
    {n:"Tricep Pushdown",s:"2x15",r:"45s",nt:"Gomiti fermi",vid:"tricep+pushdown"},
    {n:"Face Pull",s:"3x15",r:"45s",nt:"Per postura",vid:"face+pull+tutorial"},
  ]},
  lower:{t:"Lower Body",ico:"\u{1F9B5}",why:"Muscoli grandi consumano piu glicogeno. Fondamentale per grasso addominale.",ex:[
    {n:"Squat bilanciere/goblet",s:"4x10",r:"90s",nt:"Parallelo, schiena neutra",vid:"squat+donna+tutorial"},
    {n:"Hip Thrust",s:"3x12",r:"75s",nt:"Pausa in alto, squeeze",vid:"hip+thrust+donna"},
    {n:"Leg Press 45",s:"3x12",r:"75s",nt:"Piedi alti per glutei",vid:"leg+press+tutorial"},
    {n:"Affondi camminati",s:"3x10/g",r:"60s",nt:"Passo lungo",vid:"affondi+camminati"},
    {n:"Leg Curl",s:"3x12",r:"60s",nt:"Eccentrica lenta",vid:"leg+curl+tutorial"},
    {n:"Calf Raise",s:"3x15",r:"45s",nt:"Pausa 2s basso",vid:"calf+raise"},
    {n:"Abductor",s:"3x15",r:"45s",nt:"Contrazione controllata",vid:"abductor+machine"},
  ]},
  core:{t:"Core & Addome",ico:"\u{1F3AF}",why:"Core forte migliora postura e riduce cortisolo. Non si dimagrisce localmente.",ex:[
    {n:"Plank",s:"3x30-45s",r:"45s",nt:"Corpo in linea",vid:"plank+corretto"},
    {n:"Dead Bug",s:"3x10/lato",r:"45s",nt:"Schiena piatta",vid:"dead+bug+esercizio"},
    {n:"Pallof Press",s:"3x10/lato",r:"45s",nt:"Anti-rotazione",vid:"pallof+press"},
    {n:"Crunch palla svizzera",s:"3x15",r:"45s",nt:"Non tirare collo",vid:"crunch+palla+svizzera"},
    {n:"Bird Dog",s:"3x10/lato",r:"30s",nt:"Stabilita",vid:"bird+dog+esercizio"},
    {n:"Russian Twist",s:"3x12/lato",r:"45s",nt:"Controllare",vid:"russian+twist"},
    {n:"Vacuum addominale",s:"3x10s",r:"30s",nt:"Trasverso",vid:"vacuum+addominale"},
  ]},
  sched:[
    {d:"Lunedi",w:"Upper Body",i:"Moderata"},
    {d:"Martedi",w:"Camminata + Stretching",i:"Leggera"},
    {d:"Mercoledi",w:"Lower Body",i:"Mod-Alta"},
    {d:"Giovedi",w:"Riposo attivo / Yoga",i:"Bassa"},
    {d:"Venerdi",w:"Core + Upper Body",i:"Moderata"},
    {d:"Sabato",w:"Lower Body + Camminata",i:"Moderata"},
    {d:"Domenica",w:"Riposo / Passeggiata",i:"Bassa"},
  ],
};

/* ─── GARMIN DEFAULTS ─── */
var DEF_W=[{date:"2025-01-06",weight:79.2,bf:30.5,mm:25.8,bm:2.5,bw:47.0},{date:"2025-01-13",weight:78.8,bf:30.2,mm:25.9,bm:2.5,bw:47.2},{date:"2025-01-20",weight:78.5,bf:30.0,mm:26.0,bm:2.5,bw:47.5},{date:"2025-01-27",weight:78.1,bf:29.7,mm:26.1,bm:2.6,bw:47.6},{date:"2025-02-03",weight:77.8,bf:29.5,mm:26.2,bm:2.6,bw:47.8},{date:"2025-02-10",weight:77.5,bf:29.3,mm:26.3,bm:2.6,bw:48.0},{date:"2025-02-17",weight:77.2,bf:29.1,mm:26.4,bm:2.6,bw:48.1},{date:"2025-02-21",weight:77.0,bf:29.0,mm:26.5,bm:2.6,bw:48.2}];
var DEF_WO=[];var DEF_DD={steps:0,rhr:0,stress:0,bb:0,vo2:0};

/* ─── SHOPPING LIST GENERATOR ─── */
/* ─── STAGIONALITA ─── */
var SEASONAL={
  frutta:{1:["arance","mandarini","kiwi","mele","pere","pompelmo"],2:["arance","mandarini","kiwi","mele","pere","pompelmo"],3:["arance","kiwi","mele","fragole"],4:["fragole","kiwi","mele","nespole"],5:["fragole","ciliegie","nespole","albicocche"],6:["ciliegie","albicocche","pesche","melone","anguria","fragole"],7:["pesche","albicocche","melone","anguria","fichi","susine"],8:["pesche","fichi","uva","melone","anguria","susine","more"],9:["uva","fichi","pere","mele","more","lamponi"],10:["mele","pere","uva","cachi","melagrana"],11:["mele","pere","cachi","melagrana","kiwi","arance"],12:["arance","mandarini","kiwi","mele","pere","pompelmo"]},
  verdura:{1:["broccoli","cavolfiore","cavolo","finocchi","carciofi","radicchio","spinaci","zucca","porri","bietole"],2:["broccoli","cavolfiore","cavolo","finocchi","carciofi","radicchio","spinaci","porri","bietole"],3:["carciofi","asparagi","spinaci","broccoli","finocchi","radicchio","porri"],4:["asparagi","carciofi","fave","piselli","spinaci","ravanelli","rucola"],5:["asparagi","fave","piselli","zucchine","pomodori","rucola","lattuga"],6:["zucchine","pomodori","peperoni","melanzane","cetrioli","fagiolini","rucola","lattuga"],7:["zucchine","pomodori","peperoni","melanzane","cetrioli","fagiolini","rucola"],8:["zucchine","pomodori","peperoni","melanzane","cetrioli","fagiolini"],9:["zucchine","peperoni","melanzane","funghi","spinaci","zucca","radicchio"],10:["zucca","funghi","spinaci","radicchio","finocchi","cavolo","broccoli"],11:["zucca","cavolo","broccoli","cavolfiore","finocchi","radicchio","spinaci","carciofi","porri"],12:["broccoli","cavolfiore","cavolo","finocchi","carciofi","radicchio","spinaci","zucca","porri"]}
};
function getSeasonal(){var m=new Date().getMonth()+1;return{frutta:SEASONAL.frutta[m]||[],verdura:SEASONAL.verdura[m]||[]};}

/* ─── CONVERSIONE CRUDO/COTTO ─── */
var COOK_CONV=[
  {n:"Pasta",crudo:100,cotto:200,note:"Raddoppia"},
  {n:"Riso bianco",crudo:100,cotto:260,note:"x2.6"},
  {n:"Riso integrale",crudo:100,cotto:250,note:"x2.5"},
  {n:"Riso basmati",crudo:100,cotto:270,note:"x2.7"},
  {n:"Riso venere",crudo:100,cotto:240,note:"x2.4"},
  {n:"Quinoa",crudo:100,cotto:270,note:"x2.7"},
  {n:"Farro",crudo:100,cotto:250,note:"x2.5"},
  {n:"Orzo",crudo:100,cotto:250,note:"x2.5"},
  {n:"Grano saraceno",crudo:100,cotto:250,note:"x2.5"},
  {n:"Lenticchie",crudo:100,cotto:250,note:"x2.5"},
  {n:"Ceci",crudo:100,cotto:250,note:"x2.5"},
  {n:"Fagioli",crudo:100,cotto:250,note:"x2.5"},
  {n:"Cannellini",crudo:100,cotto:250,note:"x2.5"},
  {n:"Avena fiocchi",crudo:100,cotto:250,note:"Porridge x2.5"},
  {n:"Pollo petto",crudo:100,cotto:75,note:"Perde 25%"},
  {n:"Tacchino petto",crudo:100,cotto:75,note:"Perde 25%"},
  {n:"Salmone",crudo:100,cotto:80,note:"Perde 20%"},
  {n:"Merluzzo",crudo:100,cotto:75,note:"Perde 25%"},
  {n:"Orata",crudo:100,cotto:80,note:"Perde 20%"},
  {n:"Tonno fresco",crudo:100,cotto:80,note:"Perde 20%"},
  {n:"Sgombro",crudo:100,cotto:80,note:"Perde 20%"},
  {n:"Uovo sodo",crudo:60,cotto:60,note:"Invariato"},
  {n:"Verdure foglia (spinaci)",crudo:100,cotto:30,note:"Riducono molto"},
  {n:"Broccoli",crudo:100,cotto:80,note:"Perde 20%"},
  {n:"Zucchine",crudo:100,cotto:85,note:"Perde 15%"},
  {n:"Patate",crudo:100,cotto:90,note:"Perde 10%"},
  {n:"Patate dolci",crudo:100,cotto:90,note:"Perde 10%"},
  {n:"Funghi",crudo:100,cotto:60,note:"Riducono 40%"},
  {n:"Cavolfiore",crudo:100,cotto:85,note:"Perde 15%"},
  {n:"Cavoletti Bruxelles",crudo:100,cotto:85,note:"Perde 15%"},
];

/* ─── BIBLIOTECA ESERCIZI ─── */
var EXERCISE_LIB={
  upper:[
    {n:"Lat Pulldown",s:"3x12",r:"60s",nt:"Presa larga, squeeze scapole",vid:"lat+pulldown+tutorial",muscle:"Dorsali"},
    {n:"Chest Press manubri",s:"3x12",r:"60s",nt:"3s eccentrica",vid:"chest+press+manubri",muscle:"Pettorali"},
    {n:"Shoulder Press",s:"3x10",r:"60s",nt:"Schiena dritta",vid:"shoulder+press+tutorial",muscle:"Deltoidi"},
    {n:"Cable Row",s:"3x12",r:"60s",nt:"Gomiti al corpo",vid:"cable+row+tutorial",muscle:"Dorsali"},
    {n:"Curl bicipiti",s:"2x15",r:"45s",nt:"Alternati",vid:"curl+bicipiti",muscle:"Bicipiti"},
    {n:"Tricep Pushdown",s:"2x15",r:"45s",nt:"Gomiti fermi",vid:"tricep+pushdown",muscle:"Tricipiti"},
    {n:"Face Pull",s:"3x15",r:"45s",nt:"Per postura",vid:"face+pull+tutorial",muscle:"Deltoidi post."},
    {n:"Alzate laterali",s:"3x15",r:"45s",nt:"Leggere e controllate",vid:"alzate+laterali+donna",muscle:"Deltoidi"},
    {n:"Pulley basso",s:"3x12",r:"60s",nt:"Presa stretta",vid:"pulley+basso+tutorial",muscle:"Dorsali"},
    {n:"Push-up",s:"3x10-15",r:"45s",nt:"Ginocchia se necessario",vid:"push+up+donna",muscle:"Pettorali"},
    {n:"Pullover manubrio",s:"3x12",r:"60s",nt:"Panca piana, estensione ampia",vid:"pullover+manubrio",muscle:"Dorsali/Pett."},
    {n:"Rematore manubrio",s:"3x12",r:"60s",nt:"Un braccio alla volta",vid:"rematore+manubrio+donna",muscle:"Dorsali"},
  ],
  lower:[
    {n:"Squat bilanciere/goblet",s:"4x10",r:"90s",nt:"Parallelo, schiena neutra",vid:"squat+donna+tutorial",muscle:"Quadricipiti/Glutei"},
    {n:"Hip Thrust",s:"3x12",r:"75s",nt:"Pausa in alto, squeeze",vid:"hip+thrust+donna",muscle:"Glutei"},
    {n:"Leg Press 45",s:"3x12",r:"75s",nt:"Piedi alti per glutei",vid:"leg+press+tutorial",muscle:"Quadricipiti/Glutei"},
    {n:"Affondi camminati",s:"3x10/g",r:"60s",nt:"Passo lungo",vid:"affondi+camminati",muscle:"Quadricipiti/Glutei"},
    {n:"Leg Curl",s:"3x12",r:"60s",nt:"Eccentrica lenta",vid:"leg+curl+tutorial",muscle:"Femorali"},
    {n:"Calf Raise",s:"3x15",r:"45s",nt:"Pausa 2s basso",vid:"calf+raise",muscle:"Polpacci"},
    {n:"Abductor",s:"3x15",r:"45s",nt:"Contrazione controllata",vid:"abductor+machine",muscle:"Glutei/Abduttori"},
    {n:"Stacco rumeno",s:"3x10",r:"75s",nt:"Schiena neutra, senti femorali",vid:"stacco+rumeno+donna",muscle:"Femorali/Glutei"},
    {n:"Bulgarian Split Squat",s:"3x10/g",r:"60s",nt:"Piede su panca",vid:"bulgarian+split+squat",muscle:"Quadricipiti/Glutei"},
    {n:"Leg Extension",s:"3x15",r:"45s",nt:"Contrazione completa",vid:"leg+extension+tutorial",muscle:"Quadricipiti"},
    {n:"Sumo Squat",s:"3x12",r:"60s",nt:"Presa larga, punte fuori",vid:"sumo+squat+donna",muscle:"Adduttori/Glutei"},
    {n:"Step Up manubri",s:"3x10/g",r:"60s",nt:"Rialzo 40cm",vid:"step+up+manubri",muscle:"Glutei/Quad."},
  ],
  core:[
    {n:"Plank",s:"3x30-45s",r:"45s",nt:"Corpo in linea",vid:"plank+corretto",muscle:"Core totale"},
    {n:"Dead Bug",s:"3x10/lato",r:"45s",nt:"Schiena piatta",vid:"dead+bug+esercizio",muscle:"Trasverso"},
    {n:"Pallof Press",s:"3x10/lato",r:"45s",nt:"Anti-rotazione",vid:"pallof+press",muscle:"Obliqui"},
    {n:"Crunch palla svizzera",s:"3x15",r:"45s",nt:"Non tirare collo",vid:"crunch+palla+svizzera",muscle:"Retto addominale"},
    {n:"Bird Dog",s:"3x10/lato",r:"30s",nt:"Stabilita",vid:"bird+dog+esercizio",muscle:"Core/Lombare"},
    {n:"Russian Twist",s:"3x12/lato",r:"45s",nt:"Controllare",vid:"russian+twist",muscle:"Obliqui"},
    {n:"Vacuum addominale",s:"3x10s",r:"30s",nt:"Trasverso",vid:"vacuum+addominale",muscle:"Trasverso"},
    {n:"Mountain Climber lento",s:"3x15/lato",r:"45s",nt:"Controllato, no rimbalzo",vid:"mountain+climber+lento",muscle:"Core totale"},
    {n:"Side Plank",s:"3x20-30s/lato",r:"30s",nt:"Anca alta",vid:"side+plank+tutorial",muscle:"Obliqui"},
    {n:"Ab Wheel/Rollout",s:"3x8-10",r:"60s",nt:"Solo se core forte",vid:"ab+wheel+tutorial",muscle:"Retto/Trasverso"},
  ],
  cardio:[
    {n:"Corsa continua",s:"30-45min",r:"-",nt:"Zona 2 (FC 130-150). Brucia grassi.",vid:"corsa+zona+2+dimagrire",muscle:"Cardio/Gambe"},
    {n:"Interval Running",s:"20-25min",r:"60s walk",nt:"1min veloce / 1min camminata x 10-12",vid:"interval+running+beginner",muscle:"Cardio HIIT"},
    {n:"Fartlek",s:"30min",r:"-",nt:"Variazioni ritmo libere in corsa",vid:"fartlek+running",muscle:"Cardio misto"},
    {n:"Tempo Run",s:"25-30min",r:"-",nt:"Ritmo sostenibile ma sfidante",vid:"tempo+run+training",muscle:"Soglia aerobica"},
    {n:"Camminata veloce",s:"40-60min",r:"-",nt:"6-7 km/h. Brucia grassi senza cortisolo.",vid:"camminata+veloce+dimagrire",muscle:"Cardio bassa int."},
    {n:"Camminata in salita",s:"30-40min",r:"-",nt:"Tapis 10-15% inclinazione oppure outdoor",vid:"incline+walking+fat+loss",muscle:"Glutei/Cardio"},
    {n:"HIIT Bodyweight",s:"20min",r:"30s",nt:"Burpee, squat jump, mountain climber",vid:"hiit+bodyweight+donna",muscle:"Full body HIIT"},
    {n:"Yoga Flow",s:"30-45min",r:"-",nt:"Riduce cortisolo, migliora flessibilita",vid:"yoga+flow+pcos",muscle:"Flessibilita"},
    {n:"Pilates",s:"30-40min",r:"-",nt:"Core, postura, bassa intensita",vid:"pilates+per+pcos",muscle:"Core/Postura"},
  ]
};

/* ─── OPZIONI SCHEDA SETTIMANALE GYM ─── */
var GYM_DAY_OPTIONS=["Upper Body","Lower Body","Core + Addome","Upper + Core","Lower + Core","Corsa continua","Interval Running","HIIT Bodyweight","Camminata veloce","Camminata in salita","Yoga / Pilates","Riposo attivo","Riposo"];

function genShoppingList(dayIdxs){
  var cats={frutta:[],verdura:[],proteine:[],carboidrati:[],dispensa:[],latticini:[]};
  var verdMap={"rucola":"Rucola","pomodor":"Pomodori","spinac":"Spinaci","zucchin":"Zucchine","brocco":"Broccoli","cavol":"Cavolo/Cavolfiore","insalata":"Insalata mista","finocch":"Finocchi","peperoni":"Peperoni","sedano":"Sedano","porri":"Porri","fungh":"Funghi","valeriana":"Valeriana","carot":"Carote","radicchio":"Radicchio","cavolett":"Cavoletti di Bruxelles"};
  var protMap={"pollo":"Petto di pollo","salmone":"Salmone","merluzzo":"Merluzzo","tacchino":"Fesa di tacchino","uov":"Uova","tonno":"Tonno fresco","orata":"Orata","seppie":"Seppie","sgombro":"Sgombro"};
  var carbMap={"pane":"Pane integrale/segale","riso":"Riso (integrale/venere)","quinoa":"Quinoa","farro":"Farro integrale","orzo":"Orzo","avena":"Fiocchi d'avena","wasa":"Fette Wasa","patate":"Patate","grano saraceno":"Grano saraceno"};
  var fruttMap={"mirtill":"Mirtilli","lamponi":"Lamponi","fragol":"Fragole","mela":"Mele","kiwi":"Kiwi","pompelmo":"Pompelmo","frutti di bosco":"Frutti di bosco"};
  var lattMap={"yogurt":"Yogurt greco 0%","fiocchi di latte":"Fiocchi di latte","latte":"Latte (cocco/avena)"};
  function addCat(map,cat){return function(k){Object.keys(map).forEach(function(stem){if(k.includes(stem)&&cat.indexOf(map[stem])<0)cat.push(map[stem]);});};}
  dayIdxs.forEach(function(di){
    var m=MENU[di];if(!m)return;
    [m.col,m.pra,m.cen].forEach(function(meal){
      var d=(meal.desc||"").toLowerCase();
      Object.keys(verdMap).forEach(function(k){if(d.includes(k)&&cats.verdura.indexOf(verdMap[k])<0)cats.verdura.push(verdMap[k]);});
      Object.keys(protMap).forEach(function(k){if(d.includes(k)&&cats.proteine.indexOf(protMap[k])<0)cats.proteine.push(protMap[k]);});
      Object.keys(carbMap).forEach(function(k){if(d.includes(k)&&cats.carboidrati.indexOf(carbMap[k])<0)cats.carboidrati.push(carbMap[k]);});
      Object.keys(fruttMap).forEach(function(k){if(d.includes(k)&&cats.frutta.indexOf(fruttMap[k])<0)cats.frutta.push(fruttMap[k]);});
      Object.keys(lattMap).forEach(function(k){if(d.includes(k)&&cats.latticini.indexOf(lattMap[k])<0)cats.latticini.push(lattMap[k]);});
    });
  });
  cats.dispensa=["Olio EVO","Semi di chia","Semi di canapa","Semi di sesamo","Cannella","Curcuma","Mandorle","Noci","Pistacchi","Burro di mandorle"];
  return cats;
}


/* ═══════════ UI COMPONENTS ═══════════ */
function fmt(ms){if(ms<=0)return{h:"00",m:"00",s:"00"};var ts=Math.floor(ms/1000);return{h:String(Math.floor(ts/3600)).padStart(2,"0"),m:String(Math.floor((ts%3600)/60)).padStart(2,"0"),s:String(ts%60).padStart(2,"0")};}

function Cd({children,style,accent,onClick}){return(<div onClick={onClick} style={{background:C.white,borderRadius:"14px",padding:"18px",border:"1px solid "+C.bdr,borderTop:accent?"3px solid "+accent:undefined,...style}}>{children}</div>);}
function Pill({children,color}){var c=color||C.sage;return(<span style={{display:"inline-block",padding:"3px 9px",borderRadius:"20px",fontSize:"10px",fontWeight:"500",fontFamily:F.s,background:c+"18",color:c}}>{children}</span>);}
function Bar({v,mx,color}){var c=color||C.sage;return(<div style={{height:"5px",borderRadius:"3px",background:C.bdr,width:"100%",overflow:"hidden"}}><div style={{height:"100%",borderRadius:"3px",background:c,width:Math.min((v/mx)*100,100)+"%",transition:"width .8s"}}/></div>);}
function Info({bg,bdr,color,children}){return(<Cd style={{background:bg,border:"1px solid "+bdr}}><div style={{fontSize:"12px",fontFamily:F.s,color:color,margin:0,lineHeight:1.6}}>{children}</div></Cd>);}
function MacroBar({p,c,f,kcal}){var tot=p+c+f;return(<div style={{marginTop:"8px"}}><div style={{display:"flex",height:"6px",borderRadius:"3px",overflow:"hidden",gap:"2px"}}><div style={{width:((p/tot)*100)+"%",background:C.rose,borderRadius:"3px"}}/><div style={{width:((c/tot)*100)+"%",background:C.amber,borderRadius:"3px"}}/><div style={{width:((f/tot)*100)+"%",background:C.sage,borderRadius:"3px"}}/></div><div style={{display:"flex",justifyContent:"space-between",marginTop:"4px",fontSize:"10px",fontFamily:F.s,color:C.txtL}}><span style={{color:C.rose}}>P {p}g</span><span style={{color:C.amber}}>C {c}g</span><span style={{color:C.sage}}>G {f}g</span><span style={{fontWeight:"600",color:C.txt}}>{kcal} kcal</span></div></div>);}
function SubT({tabs,active,onSel}){return(<div style={{display:"flex",gap:"4px",flexWrap:"wrap",marginBottom:"18px"}}>{tabs.map(function(t){return(<button key={t.k} onClick={function(){onSel(t.k);}} style={{padding:"6px 12px",borderRadius:"10px",border:active===t.k?"none":"1px solid "+C.bdr,background:active===t.k?C.sageP:C.white,color:active===t.k?C.sageD:C.txtM,fontWeight:active===t.k?"600":"400",fontSize:"11px",fontFamily:F.s,cursor:"pointer"}}>{t.i?t.i+" ":""}{t.l}</button>);})}</div>);}
function NavTab({label,icon,active,onClick}){return(<button onClick={onClick} style={{display:"flex",alignItems:"center",gap:"5px",padding:"10px 12px",borderRadius:"50px",border:"none",cursor:"pointer",fontSize:"11px",fontWeight:active?"600":"400",fontFamily:F.s,background:active?C.sage:"transparent",color:active?C.white:C.txtM,transition:"all .3s",whiteSpace:"nowrap"}}><span style={{fontSize:"14px"}}>{icon}</span><span>{label}</span></button>);}
function SecH({title,sub}){return(<div style={{marginBottom:"20px"}}><h2 style={{fontFamily:F.p,fontSize:"24px",fontWeight:"600",color:C.txt,margin:0}}>{title}</h2><p style={{fontFamily:F.s,fontSize:"12px",color:C.txtL,marginTop:"5px"}}>{sub}</p></div>);}
var iS={width:"100%",padding:"10px",borderRadius:"10px",border:"1px solid "+C.bdr,fontFamily:F.s,fontSize:"13px",boxSizing:"border-box",background:C.white};
var lS={fontSize:"10px",fontFamily:F.s,color:C.txtM,display:"block",marginBottom:"3px",fontWeight:"500"};


/* ═══════════ WATER TRACKER ═══════════ */
function WaterTracker(){
  const[glasses,setGlasses]=useState(function(){var d=LD("water_"+todayK(),0);return d;});
  var goal=LD("profile",DEF_PROF).waterG||8;
  useEffect(function(){SV("water_"+todayK(),glasses);},[glasses]);
  var pct=Math.min(Math.round((glasses/goal)*100),100);
  return(<Cd accent={C.blue} style={{marginBottom:"12px"}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"}}><div><h4 style={{fontFamily:F.s,fontSize:"13px",fontWeight:"600",color:C.blue,margin:0}}>💧 Acqua Oggi</h4><span style={{fontSize:"10px",fontFamily:F.s,color:C.txtL}}>{glasses}/{goal} bicchieri ({glasses*250}ml)</span></div><div style={{display:"flex",gap:"6px",alignItems:"center"}}><button onClick={function(){if(glasses>0)setGlasses(glasses-1);}} style={{width:"30px",height:"30px",borderRadius:"50%",border:"1px solid "+C.bdr,background:C.white,fontSize:"16px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:C.txtM}}>−</button><span style={{fontFamily:F.s,fontSize:"22px",fontWeight:"700",color:C.blue,minWidth:"30px",textAlign:"center"}}>{glasses}</span><button onClick={function(){setGlasses(glasses+1);}} style={{width:"36px",height:"36px",borderRadius:"50%",border:"none",background:pct>=100?"linear-gradient(135deg,#4CAF50,#66BB6A)":"linear-gradient(135deg,"+C.blue+",#7BB3E0)",color:C.white,fontSize:"18px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"700",animation:pct>=100?"":"ripple 1.5s infinite"}}>+</button></div></div><Bar v={glasses} mx={goal} color={pct>=100?"#4CAF50":C.blue}/>{pct>=100&&<p style={{fontSize:"10px",fontFamily:F.s,color:"#4CAF50",marginTop:"6px",fontWeight:"600",textAlign:"center"}}>✅ Obiettivo raggiunto!</p>}</Cd>);
}

/* ═══════════ MEAL CHECKLIST ═══════════ */
function MealChecklist(){
  var dk=todayK();
  const[checks,setChecks]=useState(function(){return LD("meals_"+dk,{col:false,pra:false,cen:false,sn:false});});
  useEffect(function(){SV("meals_"+dk,checks);},[checks]);
  var done=Object.values(checks).filter(Boolean).length;
  var meals=[{k:"col",l:"Colazione",t:"10:00",c:C.amber},{k:"pra",l:"Pranzo",t:"14:00",c:C.sage},{k:"cen",l:"Cena",t:"19:30",c:C.rose},{k:"sn",l:"Snack",t:"~16:30",c:C.plum}];
  return(<Cd accent={C.sage} style={{marginBottom:"12px"}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"}}><h4 style={{fontFamily:F.s,fontSize:"13px",fontWeight:"600",color:C.sage,margin:0}}>✅ Pasti Oggi</h4><span style={{fontSize:"11px",fontFamily:F.s,fontWeight:"600",color:done===4?"#4CAF50":C.txtL}}>{done}/4</span></div><div style={{display:"flex",gap:"6px"}}>{meals.map(function(m){var ck=checks[m.k];return(<button key={m.k} onClick={function(){var u=Object.assign({},checks);u[m.k]=!u[m.k];setChecks(u);}} style={{flex:1,padding:"8px 4px",borderRadius:"10px",border:ck?"2px solid "+m.c:"1px solid "+C.bdr,background:ck?m.c+"15":C.white,cursor:"pointer",textAlign:"center",transition:"all .2s"}}><div style={{fontSize:"14px",marginBottom:"2px"}}>{ck?"✅":"⬜"}</div><div style={{fontSize:"9px",fontFamily:F.s,fontWeight:"600",color:ck?m.c:C.txtL}}>{m.l}</div><div style={{fontSize:"8px",fontFamily:F.s,color:C.txtL}}>{m.t}</div></button>);})}</div><div style={{marginTop:"8px"}}><Bar v={done} mx={4} color={done===4?"#4CAF50":C.sage}/></div></Cd>);
}

/* ═══════════ SUPPLEMENT TRACKER ═══════════ */

function SeasonalBadge(){var s=getSeasonal();var mn=["","Gen","Feb","Mar","Apr","Mag","Giu","Lug","Ago","Set","Ott","Nov","Dic"];return(<Cd accent={C.sage} style={{marginBottom:"10px",padding:"12px",background:"linear-gradient(135deg,"+C.sageP+","+C.white+")"}}><div style={{display:"flex",alignItems:"center",gap:"8px",marginBottom:"6px"}}><span style={{fontSize:"16px"}}>🌿</span><h5 style={{fontFamily:F.s,fontSize:"11px",fontWeight:"600",color:C.sageD,margin:0}}>Di stagione a {mn[new Date().getMonth()+1]}</h5></div><div style={{display:"flex",flexWrap:"wrap",gap:"3px"}}>{s.verdura.concat(s.frutta).slice(0,10).map(function(v,i){return(<span key={i} style={{fontSize:"9px",fontFamily:F.s,padding:"2px 6px",borderRadius:"6px",background:C.sage+"15",color:C.sageD}}>{v}</span>);})}</div></Cd>);}

function SuppTracker(){
  var dk=todayK();
  const[customSupps,setCustomSupps]=useState(function(){return LD("customSupps",[]);});
  var allSupps=DEF_SUPPS.concat(customSupps);
  const[supps,setSupps]=useState(function(){return LD("supps_"+dk,allSupps.map(function(s){return{id:s.id,checked:false};}));});
  const[showAdd,setShowAdd]=useState(false);
  const[newSupp,setNewSupp]=useState({name:"",time:"Mattina",note:""});
  useEffect(function(){SV("supps_"+dk,supps);},[supps]);
  function toggle(id){setSupps(supps.map(function(s){return s.id===id?{id:s.id,checked:!s.checked}:s;}));}
  function addCustom(){if(!newSupp.name.trim())return;var s={id:"custom_"+Date.now(),name:newSupp.name.trim(),time:newSupp.time,note:newSupp.note||"Personalizzato"};var u=customSupps.concat([s]);setCustomSupps(u);SV("customSupps",u);setSupps(supps.concat([{id:s.id,checked:false}]));setNewSupp({name:"",time:"Mattina",note:""});setShowAdd(false);}
  function removeCustom(id){var u=customSupps.filter(function(s){return s.id!==id;});setCustomSupps(u);SV("customSupps",u);setSupps(supps.filter(function(s){return s.id!==id;}));}
  var done=supps.filter(function(s){return s.checked;}).length;
  var byTime={Mattina:[],Pranzo:[],Sera:[]};
  allSupps.forEach(function(s){if(byTime[s.time])byTime[s.time].push(s);});
  return(<div style={{display:"grid",gap:"10px"}}><Cd accent={C.plum}><div style={{display:"flex",justifyContent:"space-between",marginBottom:"10px"}}><h4 style={{fontFamily:F.s,fontSize:"13px",fontWeight:"600",color:C.plum,margin:0}}>💊 Integratori Oggi</h4><span style={{fontSize:"11px",fontFamily:F.s,fontWeight:"600",color:done===allSupps.length?"#4CAF50":C.txtL}}>{done}/{allSupps.length}</span></div><Bar v={done} mx={allSupps.length} color={C.plum}/></Cd>
  {Object.keys(byTime).map(function(time){return(<Cd key={time}><h5 style={{fontFamily:F.s,fontSize:"11px",fontWeight:"600",color:C.txtM,margin:"0 0 8px",textTransform:"uppercase",letterSpacing:".5px"}}>{time==="Mattina"?"☀️":time==="Pranzo"?"🌤️":"🌙"} {time}</h5><div style={{display:"grid",gap:"6px"}}>{byTime[time].map(function(s){var st=supps.find(function(x){return x.id===s.id;});var ck=st?st.checked:false;var isCustom=s.id&&s.id.toString().startsWith("custom_");return(<div key={s.id} style={{display:"flex",gap:"10px",alignItems:"center",padding:"10px",borderRadius:"10px",border:ck?"2px solid "+C.plum:"1px solid "+C.bdr,background:ck?C.plumP:C.white}}><button onClick={function(){toggle(s.id);}} style={{fontSize:"16px",flexShrink:0,background:"none",border:"none",cursor:"pointer",padding:0}}>{ck?"✅":"⬜"}</button><div style={{flex:1,cursor:"pointer"}} onClick={function(){toggle(s.id);}}><div style={{fontFamily:F.s,fontSize:"12px",fontWeight:"600",color:ck?C.plum:C.txt}}>{s.name}</div><div style={{fontFamily:F.s,fontSize:"10px",color:C.txtL}}>{s.note}</div></div>{isCustom&&<button onClick={function(){removeCustom(s.id);}} style={{background:"none",border:"none",color:C.txtL,cursor:"pointer",fontSize:"14px",padding:"4px"}}>✕</button>}</div>);})}</div></Cd>);})}{/* add custom supplement */}<Cd style={{padding:"12px"}}>{!showAdd?<button onClick={function(){setShowAdd(true);}} style={{width:"100%",padding:"10px",borderRadius:"10px",border:"1px dashed "+C.plum,background:"transparent",color:C.plum,fontSize:"12px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}}>+ Aggiungi integratore personalizzato</button>:(<div style={{display:"grid",gap:"6px"}}><input value={newSupp.name} onChange={function(e){setNewSupp(Object.assign({},newSupp,{name:e.target.value}));}} placeholder="Nome (es. Berberina, Acido folico...)" style={iS}/><div style={{display:"flex",gap:"6px"}}><select value={newSupp.time} onChange={function(e){setNewSupp(Object.assign({},newSupp,{time:e.target.value}));}} style={Object.assign({},iS,{flex:1})}><option value="Mattina">Mattina</option><option value="Pranzo">Pranzo</option><option value="Sera">Sera</option></select><input value={newSupp.note} onChange={function(e){setNewSupp(Object.assign({},newSupp,{note:e.target.value}));}} placeholder="Note (opzionale)" style={Object.assign({},iS,{flex:2})}/></div><div style={{display:"flex",gap:"6px"}}><button onClick={addCustom} style={{flex:1,padding:"10px",borderRadius:"10px",border:"none",background:C.plum,color:C.white,fontSize:"12px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}}>Aggiungi</button><button onClick={function(){setShowAdd(false);}} style={{padding:"10px 16px",borderRadius:"10px",border:"1px solid "+C.bdr,background:C.white,color:C.txtM,fontSize:"12px",fontFamily:F.s,cursor:"pointer"}}>Annulla</button></div></div>)}</Cd></div>);
}


/* ═══════════ PROFILE EDITOR ═══════════ */
function ProfileEditor({profile,setProfile}){
  const[editing,setEditing]=useState(false);
  const[f,setF]=useState(Object.assign({},profile));
  var mc=calcMacros(profile);
  var allergies=["Lattosio","Glutine","Nichel","Uova","Pesce","Frutta secca","Soia"];
  function save(){var p=Object.assign({},f,{age:parseInt(f.age)||27,height:parseInt(f.height)||168,weight:parseFloat(f.weight)||77,bf:parseFloat(f.bf)||29,goalW:parseFloat(f.goalW)||68,goalBf:parseFloat(f.goalBf)||23,stepsG:parseInt(f.stepsG)||10000,waterG:parseInt(f.waterG)||8,workoutsG:parseInt(f.workoutsG)||4,ifH:parseInt(f.ifH)||14});setProfile(p);SV("profile",p);setEditing(false);}
  function toggleAllergy(a){var al=f.allergies||[];if(al.indexOf(a)>=0){setF(Object.assign({},f,{allergies:al.filter(function(x){return x!==a;})}));}else{setF(Object.assign({},f,{allergies:al.concat([a])}));}}
  if(!editing)return(
    <Cd accent={C.sage} style={{marginBottom:"16px",background:"linear-gradient(135deg,"+C.sageP+","+C.white+")"}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start"}}><div><h3 style={{fontFamily:F.p,fontSize:"16px",margin:"0 0 6px",color:C.sageD}}>Il Tuo Profilo</h3><div style={{display:"flex",gap:"6px",flexWrap:"wrap"}}>{profile.name&&<Pill color={C.berry}>{profile.name}</Pill>}<Pill color={C.sage}>{profile.age} anni</Pill><Pill color={C.sage}>{profile.height} cm</Pill><Pill color={C.sage}>{profile.weight} kg</Pill><Pill color={C.sage}>BF {profile.bf}%</Pill></div>{profile.allergies&&profile.allergies.length>0&&<div style={{display:"flex",gap:"4px",flexWrap:"wrap",marginTop:"6px"}}>{profile.allergies.map(function(a){return <Pill key={a} color={C.rose}>🚫 {a}</Pill>;})}</div>}</div><div style={{textAlign:"right"}}><div style={{fontFamily:F.s,fontSize:"22px",fontWeight:"700",color:C.sage}}>~{mc.target}</div><div style={{fontSize:"10px",fontFamily:F.s,color:C.txtL}}>kcal/giorno</div></div></div><div style={{display:"flex",gap:"10px",marginTop:"12px"}}>{[{l:"Proteine",v:mc.prot+"g",c:C.rose},{l:"Carboidrati",v:mc.carb+"g",c:C.amber},{l:"Grassi",v:mc.fat+"g",c:C.sage}].map(function(m,i){return(<div key={i} style={{flex:1,textAlign:"center",padding:"8px",borderRadius:"10px",background:C.white}}><div style={{fontSize:"14px",fontWeight:"700",color:m.c,fontFamily:F.s}}>{m.v}</div><div style={{fontSize:"9px",color:C.txtL,fontFamily:F.s}}>{m.l}</div></div>);})}</div><div style={{display:"flex",gap:"8px",marginTop:"10px"}}><div style={{flex:1,padding:"8px 10px",borderRadius:"8px",background:C.plumP}}><span style={{fontSize:"11px",fontFamily:F.s,color:C.plum,fontWeight:"500"}}>IF {profile.ifH}:{24-profile.ifH} | {profile.ifOpen}-{profile.ifClose}</span></div><button onClick={function(){setF(Object.assign({},profile));setEditing(true);}} style={{padding:"8px 14px",borderRadius:"8px",border:"none",background:C.sage,color:C.white,fontSize:"11px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}}>⚙️ Modifica</button></div></Cd>
  );
  return(
    <Cd accent={C.sage} style={{marginBottom:"16px"}}><h3 style={{fontFamily:F.p,fontSize:"16px",margin:"0 0 14px",color:C.sageD}}>⚙️ Modifica Profilo</h3><div style={{display:"grid",gap:"10px"}}>
      <div><label style={lS}>Nome</label><input value={f.name||""} onChange={function(e){setF(Object.assign({},f,{name:e.target.value}));}} placeholder="Il tuo nome" style={iS}/></div>
      <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"8px"}}><div><label style={lS}>Eta</label><input type="number" value={f.age} onChange={function(e){setF(Object.assign({},f,{age:e.target.value}));}} style={iS}/></div><div><label style={lS}>Altezza (cm)</label><input type="number" value={f.height} onChange={function(e){setF(Object.assign({},f,{height:e.target.value}));}} style={iS}/></div><div><label style={lS}>Peso (kg)</label><input type="number" step="0.1" value={f.weight} onChange={function(e){setF(Object.assign({},f,{weight:e.target.value}));}} style={iS}/></div></div>
      <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gap:"8px"}}><div><label style={lS}>BF%</label><input type="number" step="0.1" value={f.bf} onChange={function(e){setF(Object.assign({},f,{bf:e.target.value}));}} style={iS}/></div><div><label style={lS}>Obiettivo kg</label><input type="number" step="0.1" value={f.goalW} onChange={function(e){setF(Object.assign({},f,{goalW:e.target.value}));}} style={iS}/></div><div><label style={lS}>Obiettivo BF%</label><input type="number" step="0.1" value={f.goalBf} onChange={function(e){setF(Object.assign({},f,{goalBf:e.target.value}));}} style={iS}/></div><div><label style={lS}>IF ore</label><input type="number" value={f.ifH} onChange={function(e){setF(Object.assign({},f,{ifH:e.target.value}));}} style={iS}/></div></div>
      <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px"}}><div><label style={lS}>Finestra apre</label><input type="time" value={f.ifOpen} onChange={function(e){setF(Object.assign({},f,{ifOpen:e.target.value}));}} style={iS}/></div><div><label style={lS}>Finestra chiude</label><input type="time" value={f.ifClose} onChange={function(e){setF(Object.assign({},f,{ifClose:e.target.value}));}} style={iS}/></div></div>
      <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"8px"}}><div><label style={lS}>Passi/gg</label><input type="number" value={f.stepsG} onChange={function(e){setF(Object.assign({},f,{stepsG:e.target.value}));}} style={iS}/></div><div><label style={lS}>Bicchieri acqua</label><input type="number" value={f.waterG} onChange={function(e){setF(Object.assign({},f,{waterG:e.target.value}));}} style={iS}/></div><div><label style={lS}>Allenamenti/sett</label><input type="number" value={f.workoutsG} onChange={function(e){setF(Object.assign({},f,{workoutsG:e.target.value}));}} style={iS}/></div></div>
      <div><label style={lS}>🚫 Intolleranze / Allergie</label><div style={{display:"flex",gap:"4px",flexWrap:"wrap"}}>{allergies.map(function(a){var sel=(f.allergies||[]).indexOf(a)>=0;return(<button key={a} onClick={function(){toggleAllergy(a);}} style={{padding:"6px 12px",borderRadius:"10px",border:sel?"2px solid "+C.rose:"1px solid "+C.bdr,background:sel?C.roseP:C.white,color:sel?C.roseD:C.txtM,fontSize:"11px",fontFamily:F.s,fontWeight:sel?"600":"400",cursor:"pointer"}}>{sel?"🚫 ":""}{a}</button>);})}</div></div>
      <div style={{display:"flex",gap:"8px"}}><button onClick={save} style={{flex:1,padding:"12px",borderRadius:"12px",border:"none",background:C.sage,color:C.white,fontSize:"13px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}}>✅ Salva Profilo</button><button onClick={function(){setEditing(false);}} style={{padding:"12px 18px",borderRadius:"12px",border:"1px solid "+C.bdr,background:C.white,color:C.txtM,fontSize:"13px",fontFamily:F.s,cursor:"pointer"}}>Annulla</button></div>
    </div></Cd>
  );
}


/* ═══════════ FASTING TIMER + HISTORY ═══════════ */
function FastingTimer({profile}){
  const[isOn,setIsOn]=useState(function(){return LD("fast_isOn",false);});
  const[start,setStart]=useState(function(){return LD("fast_start",null);});
  const[goal,setGoal]=useState(function(){return LD("fast_goal",profile.ifH||14);});
  const[el,setEl]=useState(function(){var s=LD("fast_start",null);return s?Date.now()-s:0;});
  const[history,setHistory]=useState(function(){return LD("fasts",[]);});
  var timerRef=useRef(null);
  var gMs=goal*3600000;
  var prog=start?Math.min((el/gMs)*100,100):0;
  var done=el>=gMs;
  var t=fmt(el);var tr=fmt(Math.max(gMs-el,0));
  useEffect(function(){SV("fast_isOn",isOn);SV("fast_start",start);SV("fast_goal",goal);},[isOn,start,goal]);
  useEffect(function(){if(isOn&&start){timerRef.current=setInterval(function(){var now=Date.now();var elapsed=now-start;setEl(elapsed);if(elapsed>=gMs&&elapsed-1000<gMs)sendNotif("🎉 Digiuno completato!","Hai completato "+goal+"h di digiuno. Bravissima!");var thirtyMin=gMs-30*60000;if(elapsed>=thirtyMin&&elapsed-1000<thirtyMin)sendNotif("⏳ 30 minuti al traguardo","Mancano solo 30 minuti per completare il digiuno!");},1000);}return function(){clearInterval(timerRef.current);};},[isOn,start]);
  var goFn=function(){var now=Date.now();setStart(now);setEl(0);setIsOn(true);};
  var stopFn=function(){setIsOn(false);clearInterval(timerRef.current);};
  var completeFn=function(){setIsOn(false);clearInterval(timerRef.current);var entry={date:todayK(),goal:goal,actual:Math.round(el/3600000*10)/10,completed:el>=gMs,startTime:new Date(start).toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"})};var h=[entry].concat(history).slice(0,50);setHistory(h);SV("fasts",h);setStart(null);setEl(0);};
  var resetFn=function(){setIsOn(false);setStart(null);setEl(0);clearInterval(timerRef.current);};
  var delFast=function(idx){var h=history.slice();h.splice(idx,1);setHistory(h);SV("fasts",h);};
  var streak=0;for(var i=0;i<history.length;i++){if(history[i].completed)streak++;else break;}
  var bestStreak=0;var cur=0;history.forEach(function(h){if(h.completed){cur++;if(cur>bestStreak)bestStreak=cur;}else cur=0;});
  var totalDone=history.filter(function(h){return h.completed;}).length;
  var circ=2*Math.PI*88;var off=circ-(prog/100)*circ;
  var sL=start?new Date(start).toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"}):"--:--";
  var eL=start?new Date(start+gMs).toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"}):"--:--";
  return(<div style={{display:"grid",gap:"14px"}}>
    <Cd style={{textAlign:"center",padding:"24px 18px"}} accent={done?C.sage:C.plum}>
      <h3 style={{fontFamily:F.p,fontSize:"17px",margin:"0 0 4px",color:done?C.sage:C.txt}}>{done?"Digiuno completato! 🎉":isOn?"Digiuno in corso...":"Timer Digiuno"}</h3>
      <p style={{fontSize:"11px",fontFamily:F.s,color:C.txtL,margin:"0 0 14px"}}>{isOn?sL+" → "+eL:"Finestra alimentare: "+profile.ifOpen+" - "+profile.ifClose}</p>
      {!isOn&&!start&&(<div style={{display:"flex",justifyContent:"center",gap:"6px",marginBottom:"16px"}}>{[12,14,16,18].map(function(h){return(<button key={h} onClick={function(){setGoal(h);}} style={{padding:"7px 16px",borderRadius:"10px",fontSize:"12px",fontFamily:F.s,fontWeight:"600",cursor:"pointer",border:goal===h?"none":"1px solid "+C.bdr,background:goal===h?C.plum:C.white,color:goal===h?C.white:C.txtM}}>{h+":"+(24-h)}{h===profile.ifH?" ★":""}</button>);})}</div>)}
      <div style={{position:"relative",width:"190px",height:"190px",margin:"0 auto 14px"}}><svg width="190" height="190" style={{transform:"rotate(-90deg)"}}><circle cx="95" cy="95" r="88" fill="none" stroke={C.bdr} strokeWidth="7"/><circle cx="95" cy="95" r="88" fill="none" stroke={done?C.sage:C.plum} strokeWidth="7" strokeLinecap="round" strokeDasharray={circ} strokeDashoffset={off} style={{transition:"stroke-dashoffset 1s"}}/></svg><div style={{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"}}><div style={{fontFamily:F.s,fontSize:"30px",fontWeight:"700",color:C.txt}}>{t.h}<span style={{color:C.txtL,fontSize:"16px"}}>h </span>{t.m}<span style={{color:C.txtL,fontSize:"16px"}}>m</span></div><div style={{fontSize:"10px",fontFamily:F.s,color:C.txtL,marginTop:"3px"}}>{isOn?Math.round(prog)+"%":"Obiettivo: "+goal+"h"}</div></div></div>
      {isOn&&!done&&(<p style={{fontSize:"12px",fontFamily:F.s,color:C.plum,fontWeight:"600",margin:"0 0 12px"}}>Mancano {tr.h}h {tr.m}m {tr.s}s</p>)}
      {isOn&&(<div style={{display:"flex",gap:"4px",justifyContent:"center",marginBottom:"14px"}}>{[{l:"Digestione",h:4,c:C.amber},{l:"Chetosi",h:8,c:C.rose},{l:"Fat Burn",h:12,c:C.sage},{l:"Autofagia",h:16,c:C.plum}].map(function(ph,i){var starts=[0,4,8,12];var ac=el>=starts[i]*3600000&&el<ph.h*3600000;var dn=el>=ph.h*3600000;return(<div key={i} style={{flex:1,padding:"5px 3px",borderRadius:"8px",fontSize:"9px",fontFamily:F.s,fontWeight:"500",background:dn?ph.c+"20":ac?ph.c+"30":C.bdr+"60",color:dn||ac?ph.c:C.txtL,border:ac?"1.5px solid "+ph.c:"1.5px solid transparent"}}><div>{dn?"✓":ac?"●":"-"}</div><div style={{marginTop:"1px"}}>{ph.l}</div></div>);})}</div>)}
      <div style={{display:"flex",gap:"8px",justifyContent:"center"}}>{!isOn&&!start&&<button onClick={goFn} style={{padding:"11px 28px",borderRadius:"12px",border:"none",background:"linear-gradient(135deg,"+C.plum+","+C.rose+")",color:C.white,fontSize:"14px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}}>Inizia Digiuno</button>}{isOn&&!done&&<button onClick={stopFn} style={{padding:"9px 20px",borderRadius:"12px",border:"1.5px solid "+C.rose,background:C.roseP,color:C.roseD,fontSize:"12px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}}>Pausa</button>}{!isOn&&start&&(<><button onClick={function(){setIsOn(true);}} style={{padding:"9px 20px",borderRadius:"12px",border:"none",background:C.plum,color:C.white,fontSize:"12px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}}>Riprendi</button><button onClick={function(){completeFn();}} style={{padding:"9px 20px",borderRadius:"12px",border:"1.5px solid "+C.bdr,background:C.white,color:C.txtM,fontSize:"12px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}}>Salva & Reset</button></>)}{isOn&&done&&<button onClick={completeFn} style={{padding:"9px 20px",borderRadius:"12px",border:"none",background:C.sage,color:C.white,fontSize:"12px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}}>✅ Completa</button>}</div>
    </Cd>
    {/* STATS */}
    <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"8px"}}><Cd style={{textAlign:"center",padding:"12px"}}><div style={{fontFamily:F.s,fontSize:"22px",fontWeight:"700",color:C.sage}}>🔥 {streak}</div><div style={{fontSize:"9px",fontFamily:F.s,color:C.txtL}}>Streak attuale</div></Cd><Cd style={{textAlign:"center",padding:"12px"}}><div style={{fontFamily:F.s,fontSize:"22px",fontWeight:"700",color:C.amber}}>🏆 {bestStreak}</div><div style={{fontSize:"9px",fontFamily:F.s,color:C.txtL}}>Record streak</div></Cd><Cd style={{textAlign:"center",padding:"12px"}}><div style={{fontFamily:F.s,fontSize:"22px",fontWeight:"700",color:C.plum}}>{totalDone}</div><div style={{fontSize:"9px",fontFamily:F.s,color:C.txtL}}>Totali completati</div></Cd></div>
    {/* HISTORY */}
    {history.length>0&&<Cd><h4 style={{fontFamily:F.p,fontSize:"14px",margin:"0 0 10px",color:C.txt}}>Storico Digiuni</h4><div style={{display:"grid",gap:"6px"}}>{history.map(function(h,i){return(<div key={i} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 10px",borderRadius:"8px",background:h.completed?C.sageP:C.roseP}}><div><span style={{fontFamily:F.s,fontSize:"12px",fontWeight:"600",color:C.txt}}>{fmtD(h.date)}</span><span style={{fontFamily:F.s,fontSize:"11px",color:C.txtM,marginLeft:"8px"}}>{h.startTime}</span></div><div style={{display:"flex",gap:"6px",alignItems:"center"}}><span style={{fontSize:"11px",fontFamily:F.s,color:C.txtM}}>{h.actual}h / {h.goal}h</span><span style={{fontSize:"14px"}}>{h.completed?"✅":"❌"}</span><button onClick={function(){delFast(i);}} style={{background:"none",border:"none",color:C.txtL,cursor:"pointer",fontSize:"14px",padding:"2px 4px",marginLeft:"4px"}}>🗑</button></div></div>);})}</div></Cd>}
  </div>);
}

/* ═══════════ DAILY QUOTE ═══════════ */
function DailyQuote(){
  var dq=getDailyQuote();
  var tagColors={mindset:C.plum,food:C.sage,tip:C.amber,gym:C.rose};
  var tagLabels={mindset:"Mindset",food:"Nutrizione",tip:"Consiglio",gym:"Fitness"};
  var tc=tagColors[dq.t]||C.sage;
  return(<Cd style={{marginBottom:"16px",background:"linear-gradient(135deg,"+tc+"10,"+C.white+")",borderLeft:"4px solid "+tc}}><div style={{display:"flex",gap:"10px",alignItems:"flex-start"}}><span style={{fontSize:"22px",flexShrink:0}}>🌸</span><div style={{flex:1}}><p style={{margin:"0 0 6px",fontFamily:F.p,fontSize:"13px",fontStyle:"italic",color:C.txt,lineHeight:1.5}}>"{dq.q}"</p><Pill color={tc}>{tagLabels[dq.t]}</Pill></div></div></Cd>);
}


/* ═══════════ ALIMENTAZIONE ═══════════ */
function Alimentazione({profile,setProfile}){
  const[sub,setSub]=useState("menu");
  const[meal,setMeal]=useState("colazione");
  const[selDay,setSelDay]=useState(function(){var d=new Date().getDay();return d===0?6:d-1;});
  const[filter,setFilter]=useState("tutti");
  const[favs,setFavs]=useState(function(){return LD("favRecipes",[]);});
  const[showList,setShowList]=useState(false);
  const[listChecks,setListChecks]=useState({});
  const[lockedDays,setLockedDays]=useState({});
  const[shuffled,setShuffled]=useState(null);
  var mc=calcMacros(profile);
  var allergyMap={"Lattosio":["latte","yogurt","fiocchi di latte","burro","panna"],"Glutine":["pane","farro","orzo","avena","spaghetti","wasa","crostini","crusca"],"Nichel":["cacao","cioccolato","pomodor","lenticch","spinac","avena","ceci","fagioli"],"Uova":["uov","frittata","omelette","albumi","pancake"],"Pesce":["salmone","merluzzo","tonno","orata","sgombro","seppie","pesce"],"Frutta secca":["mandorl","noci","pistacch","arachid","pinoli","noce"],"Soia":["soia","edamame","tofu"]};
  var allergySubs={"Lattosio":"yogurt vegetale / latte cocco / tofu","Glutine":"riso integrale / quinoa / grano saraceno / patate dolci","Nichel":"zucchine / carote / mele / riso / pollo","Uova":"tofu strapazzato / semi chia+acqua","Pesce":"pollo / tacchino / legumi / tofu","Frutta secca":"semi di zucca / semi di girasole / cocco","Soia":"alternative senza soia"};
  function checkAllergens(text){if(!profile.allergies||!profile.allergies.length)return[];var found=[];var lc=(text||"").toLowerCase();profile.allergies.forEach(function(a){var keys=allergyMap[a]||[];keys.forEach(function(k){if(lc.includes(k)&&found.indexOf(a)<0)found.push(a);});});return found;}
  var filtered=filter==="tutti"?RECIPES:filter==="preferiti"?RECIPES.filter(function(r){return favs.indexOf(r.n)>=0;}):RECIPES.filter(function(r){return r.cat.toLowerCase().includes(filter);});
  function toggleFav(name){var n;if(favs.indexOf(name)>=0)n=favs.filter(function(x){return x!==name;});else n=favs.concat([name]);setFavs(n);SV("favRecipes",n);}
  function shuffleMenu(){var cols=IDEAS.colazione.items.slice();var pras=IDEAS.pranzo.items.slice();var cens=IDEAS.cena.items.slice();function sh(a){for(var i=a.length-1;i>0;i--){var j=Math.floor(Math.random()*(i+1));var t=a[i];a[i]=a[j];a[j]=t;}return a;}sh(cols);sh(pras);sh(cens);var r=[];for(var i=0;i<7;i++){if(lockedDays[i]){r.push(shuffled?shuffled[i]:MENU[i]);}else{r.push({day:MENU[i].day,col:{t:cols[i%cols.length].n,desc:cols[i%cols.length].d,kcal:parseInt(cols[i%cols.length].kcal)||520,p:22,c:42,f:24},pra:{t:pras[i%pras.length].n,desc:pras[i%pras.length].d,kcal:parseInt(pras[i%pras.length].kcal)||550,p:38,c:50,f:18},cen:{t:cens[i%cens.length].n,desc:cens[i%cens.length].d,kcal:parseInt(cens[i%cens.length].kcal)||350,p:30,c:16,f:14},sn:MENU[i].sn});}}setShuffled(r);}
  var curMenu=shuffled||MENU;
  var shopList=genShoppingList([0,1,2,3,4,5,6]);
  return(<div>
    <SecH title="Alimentazione PCOS" sub={"~"+mc.target+" kcal/giorno | IF "+profile.ifH+":"+(24-profile.ifH)+" | Dosi in grammi"}/>
    <ProfileEditor profile={profile} setProfile={setProfile}/>
    <CycleCorrelationBanner/>
    <MealChecklist/>
    <WaterTracker/>
    <SubT tabs={[{k:"menu",l:"Menu IF",i:"📅"},{k:"idee",l:"Idee Pasti",i:"💡"},{k:"ricette",l:"Ricettario",i:"👩‍🍳"},{k:"guida",l:"Cibi & Dosi",i:"📋"},{k:"spesa",l:"Spesa",i:"🛒"},{k:"regole",l:"Regole"}]} active={sub} onSel={setSub}/>
    {sub==="menu"&&(<div>
      <SeasonalBadge/><Info bg={C.plumP} bdr={C.plumL} color={C.plum}><strong>IF {profile.ifH}:{24-profile.ifH} | Finestra {profile.ifOpen}-{profile.ifClose}</strong>: colazione ore {profile.ifOpen} | cena entro {profile.ifClose}</Info>
      <div style={{display:"flex",gap:"6px",margin:"12px 0"}}><button onClick={shuffleMenu} style={{flex:1,padding:"10px",borderRadius:"10px",border:"none",background:"linear-gradient(135deg,"+C.amber+","+C.rose+")",color:C.white,fontSize:"12px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}}>🔄 Genera Menu Casuale</button>{shuffled&&<button onClick={function(){setShuffled(null);setLockedDays({});}} style={{padding:"10px 14px",borderRadius:"10px",border:"1px solid "+C.bdr,background:C.white,color:C.txtM,fontSize:"12px",fontFamily:F.s,cursor:"pointer"}}>↩️ Originale</button>}</div>
      <div style={{display:"flex",gap:"4px",margin:"10px 0"}}>{curMenu.map(function(d,i){return(<button key={i} onClick={function(){setSelDay(i);}} style={{flex:1,padding:"7px 2px",borderRadius:"10px",border:selDay===i?"none":"1px solid "+C.bdr,background:selDay===i?C.sage:C.white,color:selDay===i?C.white:C.txtM,fontWeight:"600",fontSize:"11px",fontFamily:F.s,cursor:"pointer",position:"relative"}}>{d.day.slice(0,3)}{shuffled&&lockedDays[i]&&<span style={{position:"absolute",top:"-6px",right:"-2px",fontSize:"10px"}}>🔒</span>}</button>);})}</div>
      {shuffled&&<div style={{display:"flex",justifyContent:"flex-end",marginBottom:"8px"}}><button onClick={function(){var u=Object.assign({},lockedDays);if(u[selDay])delete u[selDay];else u[selDay]=true;setLockedDays(u);}} style={{padding:"4px 10px",borderRadius:"8px",border:"1px solid "+C.bdr,background:lockedDays[selDay]?C.sageP:C.white,color:lockedDays[selDay]?C.sageD:C.txtM,fontSize:"10px",fontFamily:F.s,cursor:"pointer"}}>{lockedDays[selDay]?"🔒 Bloccato":"🔓 Blocca questo giorno"}</button></div>}
      {[{k:"col",l:"Colazione | ore "+profile.ifOpen,c:C.amber,port:"~520 kcal"},{k:"pra",l:"Pranzo | ore 14:00",c:C.sage,port:"~550 kcal"},{k:"cen",l:"Cena | ore 19:30",c:C.rose,port:"~350 kcal"}].map(function(m,i){var d=curMenu[selDay][m.k];var allergens=checkAllergens(d.desc);return(<Cd key={i} accent={m.c} style={{marginBottom:"10px"}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"6px"}}><h4 style={{fontFamily:F.s,fontSize:"13px",fontWeight:"600",color:m.c,margin:0}}>{m.l}</h4><span style={{fontSize:"10px",fontFamily:F.s,color:C.txtL}}>{m.port}</span></div><h5 style={{fontFamily:F.s,fontSize:"14px",fontWeight:"600",color:C.txt,margin:"0 0 4px"}}>{d.t}</h5><p style={{fontSize:"12px",fontFamily:F.s,color:C.txtM,margin:"0 0 4px",lineHeight:1.6}}>{d.desc}</p>{allergens.length>0&&(<div style={{padding:"6px 8px",borderRadius:"8px",background:C.roseP,border:"1px solid "+C.roseL,marginTop:"4px"}}><div style={{display:"flex",gap:"4px",flexWrap:"wrap",marginBottom:"3px"}}>{allergens.map(function(a){return <Pill key={a} color={C.rose}>⚠️ {a}</Pill>;})}</div><div style={{fontSize:"9px",fontFamily:F.s,color:C.roseD}}>{allergens.map(function(a){return "Sostituisci con: "+allergySubs[a];}).join(" | ")}</div></div>)}{d.p&&<MacroBar p={d.p} c={d.c} f={d.f} kcal={d.kcal}/>}</Cd>);})}
      <Cd style={{padding:"14px",opacity:0.7}}><div style={{display:"flex",justifyContent:"space-between"}}><span style={{fontSize:"12px",fontFamily:F.s,color:C.txtM}}>Snack (opz.): {curMenu[selDay].sn.t}</span><span style={{fontSize:"11px",fontFamily:F.s,color:C.txtL}}>{curMenu[selDay].sn.kcal} kcal</span></div></Cd>
      <Cd style={{marginTop:"10px",background:C.sageP,border:"1px solid "+C.sageL}}><div style={{display:"flex",justifyContent:"space-between"}}><span style={{fontFamily:F.s,fontSize:"13px",fontWeight:"600",color:C.sageD}}>Totale giornata</span><span style={{fontFamily:F.s,fontSize:"13px",fontWeight:"700",color:C.sageD}}>~{curMenu[selDay].col.kcal+curMenu[selDay].pra.kcal+curMenu[selDay].cen.kcal} kcal</span></div>{curMenu[selDay].col.p&&<MacroBar p={curMenu[selDay].col.p+curMenu[selDay].pra.p+curMenu[selDay].cen.p} c={curMenu[selDay].col.c+curMenu[selDay].pra.c+curMenu[selDay].cen.c} f={curMenu[selDay].col.f+curMenu[selDay].pra.f+curMenu[selDay].cen.f} kcal={curMenu[selDay].col.kcal+curMenu[selDay].pra.kcal+curMenu[selDay].cen.kcal}/>}</Cd>
    </div>)}
    {sub==="idee"&&(<div><div style={{display:"flex",gap:"5px",marginBottom:"14px"}}>{["colazione","pranzo","cena"].map(function(k){var labels={colazione:"Col ~520",pranzo:"Pra ~550",cena:"Cen ~350"};return<button key={k} onClick={function(){setMeal(k);}} style={{flex:1,padding:"9px 4px",borderRadius:"12px",border:meal===k?"none":"1px solid "+C.bdr,background:meal===k?C.rose:C.white,color:meal===k?C.white:C.txtM,fontWeight:meal===k?"600":"400",fontSize:"12px",fontFamily:F.s,cursor:"pointer"}}>{labels[k]}</button>;})}</div><Info bg={C.roseP} bdr={C.roseL} color={C.roseD}>{IDEAS[meal].intro}</Info><div style={{display:"grid",gap:"8px",marginTop:"10px"}}>{IDEAS[meal].items.map(function(it,i){return(<Cd key={i} style={{padding:"14px"}}><div style={{display:"flex",gap:"8px",alignItems:"flex-start"}}><span style={{fontSize:"20px",flexShrink:0}}>{it.i}</span><div style={{flex:1}}><div style={{display:"flex",justifyContent:"space-between",marginBottom:"2px"}}><h5 style={{margin:0,fontFamily:F.s,fontSize:"13px",fontWeight:"600",color:C.txt}}>{it.n}</h5><Pill color={C.rose}>{it.kcal}</Pill></div><p style={{margin:0,fontSize:"11px",fontFamily:F.s,color:C.txtM,lineHeight:1.5}}>{it.d}</p></div></div></Cd>);})}</div></div>)}
    {sub==="ricette"&&(<div><Info bg={C.amberL} bdr={C.amber} color={C.txt}>Ricette da <strong>lotusflowerpcos.com</strong>. Tocca ❤️ per salvare nei preferiti.</Info><div style={{display:"flex",gap:"4px",flexWrap:"wrap",margin:"10px 0"}}>{["tutti","primo","secondo","contorno","preferiti"].map(function(flt){return<button key={flt} onClick={function(){setFilter(flt);}} style={{padding:"4px 10px",borderRadius:"8px",border:filter===flt?"none":"1px solid "+C.bdr,background:filter===flt?flt==="preferiti"?C.roseP:C.sage:C.white,color:filter===flt?flt==="preferiti"?C.roseD:C.white:C.txtM,fontSize:"10px",fontFamily:F.s,fontWeight:"500",cursor:"pointer",textTransform:"capitalize"}}>{flt==="preferiti"?"❤️ Preferiti":flt}</button>;})}</div><div style={{display:"grid",gap:"8px"}}>{filtered.length===0&&<p style={{fontSize:"12px",fontFamily:F.s,color:C.txtL,textAlign:"center",padding:"20px"}}>Nessuna ricetta nei preferiti. Tocca ❤️ per aggiungerne!</p>}{filtered.map(function(r,i){var isFav=favs.indexOf(r.n)>=0;return(<Cd key={i} style={{padding:"14px"}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start"}}><a href={r.url} target="_blank" rel="noopener noreferrer" style={{textDecoration:"none",flex:1}}><h5 style={{margin:"0 0 3px",fontFamily:F.s,fontSize:"12px",fontWeight:"600",color:C.txt}}>{r.n}</h5><p style={{margin:"0 0 5px",fontSize:"10px",fontFamily:F.s,color:C.txtL}}>{r.ing}</p><div style={{display:"flex",gap:"4px"}}><Pill color={C.rose}>{r.kcal}</Pill><Pill color={C.sage}>{r.tag}</Pill></div></a><button onClick={function(){toggleFav(r.n);}} style={{background:"none",border:"none",fontSize:"18px",cursor:"pointer",padding:"4px",flexShrink:0}}>{isFav?"❤️":"🤍"}</button></div></Cd>);})}</div></div>)}
    {sub==="guida"&&(<div style={{display:"grid",gap:"10px"}}><Info bg={C.amberL} bdr={C.amber} color={C.txt}>Dosi calibrate su <strong>~{mc.target} kcal/giorno</strong>. Grammature a CRUDO.</Info>{FOODS.map(function(f,i){var accents=[C.sage,C.rose,C.amber,C.sage,C.rose,C.amber];return(<Cd key={i} accent={accents[i%6]}><h3 style={{fontFamily:F.p,fontSize:"15px",margin:"0 0 6px",color:C.txt}}>{f.ico} {f.cat}</h3><div style={{display:"flex",flexWrap:"wrap",gap:"4px",marginBottom:"8px"}}>{f.items.map(function(it,j){return<span key={j} style={{padding:"4px 9px",borderRadius:"8px",background:C.bgW,fontSize:"11px",fontFamily:F.s,color:C.txt}}>{it}</span>;})}</div><p style={{fontSize:"10px",fontFamily:F.s,color:C.txtL,margin:0,fontStyle:"italic"}}>{f.note}</p></Cd>);})}
    </div>)}
    {sub==="spesa"&&(<div style={{display:"grid",gap:"10px"}}><Info bg={C.sageP} bdr={C.sageL} color={C.sageD}>Lista della spesa generata automaticamente dal menu settimanale. Spunta quello che hai gia!</Info>{Object.keys(shopList).map(function(cat){var items=shopList[cat];if(items.length===0)return null;var icons={frutta:"🍎",verdura:"🥬",proteine:"🥩",carboidrati:"🌾",dispensa:"🏪",latticini:"🧀"};return(<Cd key={cat}><h4 style={{fontFamily:F.s,fontSize:"13px",fontWeight:"600",color:C.txt,margin:"0 0 8px",textTransform:"capitalize"}}>{icons[cat]||"📦"} {cat}</h4><div style={{display:"grid",gap:"4px"}}>{items.map(function(item,i){var ck=listChecks[cat+"_"+i];return(<button key={i} onClick={function(){var u=Object.assign({},listChecks);u[cat+"_"+i]=!ck;setListChecks(u);}} style={{display:"flex",gap:"8px",alignItems:"center",padding:"8px 10px",borderRadius:"8px",border:"none",background:ck?C.sageP:C.bg,cursor:"pointer",width:"100%",textAlign:"left"}}><span style={{fontSize:"14px"}}>{ck?"✅":"⬜"}</span><span style={{fontFamily:F.s,fontSize:"12px",color:ck?C.txtL:C.txt,textDecoration:ck?"line-through":"none",textTransform:"capitalize"}}>{item}</span></button>);})}</div></Cd>);})}</div>)}
    {sub==="regole"&&(<div style={{display:"grid",gap:"8px"}}>{[{i:"1",t:"Verdura PRIMA (200-250g)",d:"Riduce il picco glicemico fino al 48%."},{i:"2",t:"Proteine 120-150g a pasto",d:"Target giornaliero ~"+mc.prot+"g."},{i:"3",t:"Carboidrati 50-60g crudi, per ultimi",d:"Sempre integrali, mai da soli."},{i:"4",t:"Colazione ore "+profile.ifOpen+" = pasto principale",d:"~520 kcal. Riduce insulina del 53%."},{i:"5",t:"Cena leggera entro le "+profile.ifClose,d:"~350 kcal. Proteine + verdure."},{i:"6",t:"IF "+profile.ifH+":"+(24-profile.ifH)+": finestra "+profile.ifOpen+"-"+profile.ifClose,d:"Te verde e camomilla ok a digiuno."},{i:"7",t:"Grassi buoni 10-15ml olio EVO/pasto",d:"Target ~"+mc.fat+"g/giorno."},{i:"8",t:"No zuccheri nascosti",d:"Sciroppo glucosio e maltodestrine = insulino-resistenza."}].map(function(r,i){return(<Cd key={i}><div style={{display:"flex",gap:"10px"}}><span style={{width:"24px",height:"24px",borderRadius:"50%",background:C.sage,color:C.white,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",fontWeight:"700",fontFamily:F.s,flexShrink:0}}>{r.i}</span><div><h4 style={{margin:"0 0 2px",fontFamily:F.s,fontSize:"13px",fontWeight:"600",color:C.txt}}>{r.t}</h4><p style={{margin:0,fontSize:"11px",fontFamily:F.s,color:C.txtM}}>{r.d}</p></div></div></Cd>);})}
    </div>)}
  </div>);
}


/* ═══════════ ALLENAMENTO ═══════════ */
function Allenamento(){
  const[sub,setSub]=useState("sched");
  const[logs,setLogs]=useState(function(){return LD("gymLogs",{});});
  const[showLog,setShowLog]=useState(null);
  const[logForm,setLogForm]=useState({weight:"",reps:""});
  const[customSched,setCustomSched]=useState(function(){return LD("gymSched",["Upper Body","Camminata veloce","Lower Body","Riposo attivo","Core + Addome","Corsa continua","Riposo"]);});
  const[libCat,setLibCat]=useState("upper");
  const[libSearch,setLibSearch]=useState("");
  function saveLog(exName){if(!logForm.weight&&!logForm.reps)return;var k=exName.replace(/[^a-zA-Z]/g,"");var entries=logs[k]||[];var entry={date:todayK(),weight:parseFloat(logForm.weight)||0,reps:parseInt(logForm.reps)||0};entries=[entry].concat(entries).slice(0,20);var u=Object.assign({},logs);u[k]=entries;setLogs(u);SV("gymLogs",u);setShowLog(null);setLogForm({weight:"",reps:""});}
  function getLastLog(exName){var k=exName.replace(/[^a-zA-Z]/g,"");var entries=logs[k]||[];return entries.length>0?entries[0]:null;}
  function updateDay(idx,val){var u=customSched.slice();u[idx]=val;setCustomSched(u);SV("gymSched",u);}
  var DAYS=["Lunedi","Martedi","Mercoledi","Giovedi","Venerdi","Sabato","Domenica"];
  var dayColors=function(w){if(w==="Riposo"||w==="Riposo attivo")return C.txtL;if(w.includes("Corsa")||w.includes("HIIT")||w.includes("Interval"))return C.rose;if(w.includes("Camminata")||w.includes("Yoga"))return C.amber;return C.sage;};
  var allExercises=EXERCISE_LIB[libCat]||[];
  var filteredEx=libSearch.length>=2?allExercises.filter(function(e){return e.n.toLowerCase().includes(libSearch.toLowerCase())||e.muscle.toLowerCase().includes(libSearch.toLowerCase());}):allExercises;
  return(<div>
    <SecH title="Allenamento" sub="Personalizza la tua scheda settimanale"/>
    <CycleGymBanner/>
    <SubT tabs={[{k:"sched",l:"Scheda",i:"📅"},{k:"upper",l:"Upper",i:"💪"},{k:"lower",l:"Lower",i:"🦵"},{k:"core",l:"Core",i:"🎯"},{k:"library",l:"Biblioteca",i:"📚"},{k:"progress",l:"Progressi",i:"📈"}]} active={sub} onSel={setSub}/>
    {sub==="sched"&&(<div><Info bg={C.sageP} bdr={C.sageL} color={C.sageD}>Personalizza la tua settimana: scegli dal menu a tendina l'allenamento per ogni giorno. Inclusa corsa, HIIT, yoga e riposo.</Info><div style={{display:"grid",gap:"7px",marginTop:"10px"}}>{DAYS.map(function(day,i){return(<Cd key={i} style={{padding:"13px"}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"8px"}}><h4 style={{margin:0,fontFamily:F.s,fontSize:"12px",fontWeight:"600",color:C.txt,minWidth:"70px"}}>{day}</h4><select value={customSched[i]||"Riposo"} onChange={function(e){updateDay(i,e.target.value);}} style={Object.assign({},iS,{flex:1,fontSize:"11px",padding:"8px"})}>{GYM_DAY_OPTIONS.map(function(opt){return(<option key={opt} value={opt}>{opt}</option>);})}</select><Pill color={dayColors(customSched[i])}>{customSched[i].includes("Riposo")?"Bassa":customSched[i].includes("Camminata")||customSched[i].includes("Yoga")?"Leggera":"Moderata"}</Pill></div></Cd>);})}</div></div>)}
    {(sub==="upper"||sub==="lower"||sub==="core")&&(<div><Info bg={C.roseP} bdr={C.roseL} color={C.roseD}>{GYM[sub].ico} {GYM[sub].why}</Info><div style={{display:"grid",gap:"7px",marginTop:"10px"}}>{GYM[sub].ex.map(function(e,i){var lastLog=getLastLog(e.n);return(<Cd key={i} style={{padding:"13px"}}><div style={{display:"flex",justifyContent:"space-between",gap:"8px"}}><div style={{flex:1}}><div style={{display:"flex",alignItems:"center",gap:"5px",marginBottom:"2px"}}><span style={{fontFamily:F.s,fontSize:"9px",color:C.white,background:C.sage,borderRadius:"6px",padding:"2px 6px",fontWeight:"600"}}>{i+1}</span><h5 style={{margin:0,fontFamily:F.s,fontSize:"12px",fontWeight:"600",color:C.txt}}>{e.n}</h5></div><p style={{margin:0,fontSize:"10px",fontFamily:F.s,color:C.txtL,fontStyle:"italic"}}>{e.nt}</p>{lastLog&&<div style={{marginTop:"4px"}}><Pill color={C.amber}>Ultimo: {lastLog.weight}kg x{lastLog.reps} ({fmtD(lastLog.date)})</Pill></div>}</div><div style={{textAlign:"right",flexShrink:0}}><div style={{fontFamily:F.s,fontSize:"12px",fontWeight:"700",color:C.sage}}>{e.s}</div><div style={{fontFamily:F.s,fontSize:"9px",color:C.txtL}}>Rest {e.r}</div><div style={{display:"flex",gap:"4px",marginTop:"6px"}}><a href={"https://www.youtube.com/results?search_query="+e.vid} target="_blank" rel="noopener noreferrer" style={{padding:"3px 7px",borderRadius:"6px",background:C.roseP,fontSize:"9px",fontFamily:F.s,color:C.roseD,textDecoration:"none",fontWeight:"500"}}>🎬 Video</a><button onClick={function(){setShowLog(showLog===e.n?null:e.n);setLogForm({weight:"",reps:""});}} style={{padding:"3px 7px",borderRadius:"6px",border:"none",background:C.sageP,fontSize:"9px",fontFamily:F.s,color:C.sageD,cursor:"pointer",fontWeight:"500"}}>📊 Log</button></div></div></div>{showLog===e.n&&(<div style={{marginTop:"10px",padding:"10px",borderRadius:"10px",background:C.bg,display:"flex",gap:"6px",alignItems:"flex-end"}}><div style={{flex:1}}><label style={lS}>Peso (kg)</label><input type="number" step="0.5" placeholder="20" value={logForm.weight} onChange={function(ev){setLogForm(Object.assign({},logForm,{weight:ev.target.value}));}} style={Object.assign({},iS,{padding:"8px"})}/></div><div style={{flex:1}}><label style={lS}>Reps</label><input type="number" placeholder="12" value={logForm.reps} onChange={function(ev){setLogForm(Object.assign({},logForm,{reps:ev.target.value}));}} style={Object.assign({},iS,{padding:"8px"})}/></div><button onClick={function(){saveLog(e.n);}} style={{padding:"8px 12px",borderRadius:"8px",border:"none",background:C.sage,color:C.white,fontSize:"11px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}}>✓</button></div>)}</Cd>);})}</div></div>)}
    {sub==="library"&&(<div><div style={{display:"flex",gap:"4px",marginBottom:"10px"}}>{[{k:"upper",l:"💪 Upper"},{k:"lower",l:"🦵 Lower"},{k:"core",l:"🎯 Core"},{k:"cardio",l:"🏃‍♀️ Cardio/Corsa"}].map(function(c){return(<button key={c.k} onClick={function(){setLibCat(c.k);}} style={{flex:1,padding:"8px 4px",borderRadius:"10px",fontSize:"10px",fontFamily:F.s,fontWeight:"600",cursor:"pointer",border:libCat===c.k?"none":"1px solid "+C.bdr,background:libCat===c.k?C.sage:C.white,color:libCat===c.k?C.white:C.txtM}}>{c.l}</button>);})}</div><input value={libSearch} onChange={function(e){setLibSearch(e.target.value);}} placeholder="Cerca esercizio o muscolo..." style={Object.assign({},iS,{marginBottom:"10px"})}/><div style={{display:"grid",gap:"6px"}}>{filteredEx.map(function(e,i){var lastLog=getLastLog(e.n);return(<Cd key={i} style={{padding:"12px"}}><div style={{display:"flex",justifyContent:"space-between",gap:"8px"}}><div style={{flex:1}}><div style={{display:"flex",alignItems:"center",gap:"5px",marginBottom:"2px"}}><Pill color={C.plum}>{e.muscle}</Pill><h5 style={{margin:0,fontFamily:F.s,fontSize:"12px",fontWeight:"600",color:C.txt}}>{e.n}</h5></div><p style={{margin:0,fontSize:"10px",fontFamily:F.s,color:C.txtL,fontStyle:"italic"}}>{e.nt}</p>{lastLog&&<Pill color={C.amber}>Ultimo: {lastLog.weight}kg x{lastLog.reps}</Pill>}</div><div style={{textAlign:"right",flexShrink:0}}><div style={{fontFamily:F.s,fontSize:"11px",fontWeight:"700",color:C.sage}}>{e.s}</div><div style={{fontFamily:F.s,fontSize:"9px",color:C.txtL}}>Rest {e.r}</div><div style={{display:"flex",gap:"4px",marginTop:"5px"}}><a href={"https://www.youtube.com/results?search_query="+e.vid} target="_blank" rel="noopener noreferrer" style={{padding:"3px 7px",borderRadius:"6px",background:C.roseP,fontSize:"9px",fontFamily:F.s,color:C.roseD,textDecoration:"none",fontWeight:"500"}}>🎬 Video</a><button onClick={function(){setShowLog(showLog===e.n?null:e.n);setLogForm({weight:"",reps:""});}} style={{padding:"3px 7px",borderRadius:"6px",border:"none",background:C.sageP,fontSize:"9px",fontFamily:F.s,color:C.sageD,cursor:"pointer",fontWeight:"500"}}>📊 Log</button></div></div></div>{showLog===e.n&&(<div style={{marginTop:"10px",padding:"10px",borderRadius:"10px",background:C.bg,display:"flex",gap:"6px",alignItems:"flex-end"}}><div style={{flex:1}}><label style={lS}>Peso (kg)</label><input type="number" step="0.5" placeholder="20" value={logForm.weight} onChange={function(ev){setLogForm(Object.assign({},logForm,{weight:ev.target.value}));}} style={Object.assign({},iS,{padding:"8px"})}/></div><div style={{flex:1}}><label style={lS}>Reps</label><input type="number" placeholder="12" value={logForm.reps} onChange={function(ev){setLogForm(Object.assign({},logForm,{reps:ev.target.value}));}} style={Object.assign({},iS,{padding:"8px"})}/></div><button onClick={function(){saveLog(e.n);}} style={{padding:"8px 12px",borderRadius:"8px",border:"none",background:C.sage,color:C.white,fontSize:"11px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}}>✓</button></div>)}</Cd>);})}</div></div>)}
    {sub==="progress"&&(<div style={{display:"grid",gap:"10px"}}><Info bg={C.amberP} bdr={C.amberL} color={C.amber}>📈 Progressive overload: quando riesci a fare tutte le reps con buona forma, aumenta il peso del 5-10%.</Info>{Object.keys(logs).filter(function(k){return logs[k].length>1;}).map(function(k){var entries=logs[k].slice().reverse();var exName=entries[0]?k:"";var first=entries[0];var last=entries[entries.length-1];var diff=last.weight-first.weight;return(<Cd key={k}><h4 style={{fontFamily:F.s,fontSize:"13px",fontWeight:"600",color:C.txt,margin:"0 0 8px",textTransform:"capitalize"}}>{k}</h4><div style={{display:"flex",gap:"3px",alignItems:"flex-end",height:"60px",marginBottom:"6px"}}>{entries.slice(-8).map(function(e,i){var mx=Math.max.apply(null,entries.map(function(x){return x.weight||1;}));var h=((e.weight||1)/mx)*100;return(<div key={i} style={{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:"2px"}}><span style={{fontSize:"7px",fontFamily:F.s,color:C.txtL}}>{e.weight}</span><div style={{width:"100%",maxWidth:"20px",height:h+"%",borderRadius:"3px",background:i===entries.length-1?C.sage:C.sageL}}/></div>);})}</div><div style={{display:"flex",gap:"10px"}}><span style={{fontSize:"10px",fontFamily:F.s,color:C.txtL}}>Prima: {first.weight}kg x{first.reps}</span><span style={{fontSize:"10px",fontFamily:F.s,color:C.txtL}}>→</span><span style={{fontSize:"10px",fontFamily:F.s,color:diff>0?C.sage:C.txt,fontWeight:"600"}}>Ora: {last.weight}kg x{last.reps} {diff>0?"(+"+diff+"kg) 💪":""}</span></div></Cd>);})}{Object.keys(logs).filter(function(k){return logs[k].length>1;}).length===0&&<Cd style={{textAlign:"center",padding:"30px"}}><p style={{fontSize:"13px",fontFamily:F.s,color:C.txtL}}>Registra i carichi negli esercizi per vedere i tuoi progressi qui!</p></Cd>}</div>)}
  </div>);
}


/* ═══════════ DIGIUNO ═══════════ */
function Digiuno({profile}){
  const[sub,setSub]=useState("timer");
  return(<div>
    <SecH title="Digiuno Intermittente" sub={"IF "+profile.ifH+":"+(24-profile.ifH)+" | Finestra "+profile.ifOpen+"-"+profile.ifClose}/>
    <SubT tabs={[{k:"timer",l:"Timer",i:"⏱️"},{k:"info",l:"Info",i:"🔬"},{k:"rules",l:"Regole",i:"📏"}]} active={sub} onSel={setSub}/>
    {sub==="timer"&&<FastingTimer profile={profile}/>}
    {sub==="info"&&(<div style={{display:"grid",gap:"12px"}}><Cd accent={C.sage}><h3 style={{fontFamily:F.p,fontSize:"15px",margin:"0 0 8px",color:C.sage}}>Benefici</h3>{["Migliora sensibilita insulinica","Riduce infiammazione cronica","Favorisce autofagia cellulare","Con deficit ~500 kcal: ~0.5 kg/settimana"].map(function(b,i){return<div key={i} style={{display:"flex",gap:"6px",alignItems:"center",marginBottom:"5px"}}><span style={{width:"4px",height:"4px",borderRadius:"50%",background:C.sage,flexShrink:0}}/><span style={{fontSize:"12px",fontFamily:F.s,color:C.txt}}>{b}</span></div>;})}</Cd><Cd accent={C.rose}><h3 style={{fontFamily:F.p,fontSize:"15px",margin:"0 0 8px",color:C.rose}}>Attenzione nella PCOS</h3>{["NON saltare la colazione: riduce insulina del 53%","Puo innescare cicli restrizione/abbuffata","Colazione proteica piu importante del digiuno lungo"].map(function(w,i){return<div key={i} style={{display:"flex",gap:"6px",alignItems:"flex-start",marginBottom:"6px"}}><span style={{fontSize:"12px",flexShrink:0}}>⚠️</span><span style={{fontSize:"11px",fontFamily:F.s,color:C.txt,lineHeight:1.5}}>{w}</span></div>;})}</Cd></div>)}
    {sub==="rules"&&(<div style={{display:"grid",gap:"10px"}}>{[{t:"Colazione abbondante ore "+profile.ifOpen+" (~520 kcal)",d:"Pasto principale con proteine."},{t:"Pranzo ore 14:00 (~550 kcal)",d:"Equilibrato. Ordine: verdura, proteine, carbo."},{t:"Cena leggera entro "+profile.ifClose+" (~350 kcal)",d:"Proteine + verdure, pochissimi carboidrati."},{t:"Digiuno "+profile.ifClose+" → "+profile.ifOpen+" ("+profile.ifH+"h)",d:"Te verde, camomilla, acqua. Zero calorie."},{t:"Se hai fame a digiuno",d:"Un te caldo senza zucchero sazia. Il te verde riduce insulina a digiuno."}].map(function(r,i){return<Cd key={i}><h4 style={{margin:"0 0 2px",fontFamily:F.s,fontSize:"13px",fontWeight:"600",color:C.txt}}>{r.t}</h4><p style={{margin:0,fontSize:"11px",fontFamily:F.s,color:C.txtM,lineHeight:1.5}}>{r.d}</p></Cd>;})}<Cd style={{background:C.plumP,border:"1px solid "+C.plumL}}><h4 style={{margin:"0 0 6px",fontFamily:F.s,fontSize:"12px",fontWeight:"600",color:C.plum}}>La tua giornata tipo</h4>{[{t:profile.ifOpen,e:"Colazione abbondante (~520 kcal)",c:C.amber},{t:"14:00",e:"Pranzo equilibrato (~550 kcal)",c:C.sage},{t:"16:30",e:"Snack opzionale (~80 kcal)",c:C.txtM},{t:"19:30",e:"Cena leggera (~350 kcal)",c:C.rose},{t:profile.ifClose+"→"+profile.ifOpen,e:"DIGIUNO (te, acqua, camomilla)",c:C.plum}].map(function(x,i){return<div key={i} style={{display:"flex",gap:"8px",alignItems:"center",padding:"3px 0"}}><span style={{fontFamily:F.s,fontSize:"10px",fontWeight:"700",color:x.c,minWidth:"85px"}}>{x.t}</span><span style={{fontSize:"11px",fontFamily:F.s,color:C.txt}}>{x.e}</span></div>;})}</Cd></div>)}
  </div>);
}

/* ═══════════ CICLO MESTRUALE ═══════════ */
function CicloMestruale(){
  const[sub,setSub]=useState("tracker");
  const[lastPeriod,setLastPeriod]=useState(function(){return LD("lastPeriod","");});
  const[cycleLen,setCycleLen]=useState(function(){return LD("cycleLen",35);});
  const[showResult,setShowResult]=useState(false);
  var today=new Date();var lpDate=lastPeriod?new Date(lastPeriod):null;
  var dayOfCycle=lpDate?Math.floor((today-lpDate)/86400000)+1:null;
  var nextPeriod=lpDate?new Date(lpDate.getTime()+cycleLen*86400000):null;
  var daysToNext=nextPeriod?Math.max(0,Math.floor((nextPeriod-today)/86400000)):null;
  var currentPhase=null;
  if(dayOfCycle){if(dayOfCycle<=5)currentPhase=0;else if(dayOfCycle<=Math.floor(cycleLen*0.46))currentPhase=1;else if(dayOfCycle<=Math.floor(cycleLen*0.57))currentPhase=2;else currentPhase=3;}
  function formatDate(d){if(!d)return"--";return d.toLocaleDateString("it-IT",{day:"numeric",month:"short"});}
  useEffect(function(){if(lastPeriod)SV("lastPeriod",lastPeriod);SV("cycleLen",cycleLen);},[lastPeriod,cycleLen]);
  return(<div>
    <SecH title="Ciclo Mestruale" sub="Tracker, fasi e consigli PCOS-specifici"/>
    <SubT tabs={[{k:"tracker",l:"Tracker",i:"📅"},{k:"fasi",l:"Fasi",i:"🌙"},{k:"pcos",l:"PCOS & Ciclo",i:"🩺"}]} active={sub} onSel={setSub}/>
    {sub==="tracker"&&(<div style={{display:"grid",gap:"12px"}}>
      <Cd accent={C.berry}><h3 style={{fontFamily:F.p,fontSize:"15px",margin:"0 0 12px",color:C.berry}}>Inserisci i tuoi dati</h3><div style={{marginBottom:"10px"}}><label style={lS}>Primo giorno dell'ultimo ciclo</label><input type="date" value={lastPeriod} onChange={function(e){setLastPeriod(e.target.value);setShowResult(false);}} style={iS}/></div><div style={{marginBottom:"12px"}}><label style={lS}>Durata media del ciclo (giorni)</label><div style={{display:"flex",gap:"4px"}}>{[28,30,32,35,40,45].map(function(d){return(<button key={d} onClick={function(){setCycleLen(d);setShowResult(false);}} style={{flex:1,padding:"8px 4px",borderRadius:"10px",fontSize:"12px",fontFamily:F.s,fontWeight:"600",cursor:"pointer",border:cycleLen===d?"none":"1px solid "+C.bdr,background:cycleLen===d?C.berry:C.white,color:cycleLen===d?C.white:C.txtM}}>{d}</button>);})}</div><p style={{fontSize:"9px",fontFamily:F.s,color:C.txtL,margin:"4px 0 0"}}>Nella PCOS i cicli sono spesso 35-45 giorni o irregolari</p></div>{lastPeriod&&(<button onClick={function(){setShowResult(true);}} style={{width:"100%",padding:"12px",borderRadius:"12px",border:"none",background:"linear-gradient(135deg,"+C.berry+","+C.rose+")",color:C.white,fontSize:"14px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}}>Calcola</button>)}</Cd>
      {showResult&&dayOfCycle&&(<><Cd accent={CYCLE_PHASES[currentPhase].color} style={{background:CYCLE_PHASES[currentPhase].color+"08"}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"}}><div><span style={{fontSize:"28px"}}>{CYCLE_PHASES[currentPhase].icon}</span><h3 style={{fontFamily:F.p,fontSize:"18px",margin:"4px 0 0",color:C.txt}}>Fase {CYCLE_PHASES[currentPhase].name}</h3></div><div style={{textAlign:"right"}}><div style={{fontFamily:F.s,fontSize:"28px",fontWeight:"700",color:CYCLE_PHASES[currentPhase].color}}>G{dayOfCycle}</div><div style={{fontSize:"9px",fontFamily:F.s,color:C.txtL}}>del ciclo</div></div></div><Bar v={dayOfCycle} mx={cycleLen} color={CYCLE_PHASES[currentPhase].color}/><div style={{display:"flex",gap:"8px",marginTop:"10px"}}><div style={{flex:1,padding:"8px",borderRadius:"8px",background:C.white,textAlign:"center"}}><div style={{fontSize:"14px",fontWeight:"700",color:C.berry,fontFamily:F.s}}>{formatDate(nextPeriod)}</div><div style={{fontSize:"9px",color:C.txtL,fontFamily:F.s}}>Prossimo ciclo</div></div><div style={{flex:1,padding:"8px",borderRadius:"8px",background:C.white,textAlign:"center"}}><div style={{fontSize:"14px",fontWeight:"700",color:C.plum,fontFamily:F.s}}>{daysToNext}gg</div><div style={{fontSize:"9px",color:C.txtL,fontFamily:F.s}}>Mancano</div></div></div></Cd>
      <Cd><h4 style={{fontFamily:F.s,fontSize:"13px",fontWeight:"600",margin:"0 0 8px",color:CYCLE_PHASES[currentPhase].color}}>Consigli per questa fase</h4>{[{l:"Alimentazione",v:CYCLE_PHASES[currentPhase].food,ic:"🥗"},{l:"Allenamento",v:CYCLE_PHASES[currentPhase].gym,ic:"🏋️"},{l:"Note PCOS",v:CYCLE_PHASES[currentPhase].pcos,ic:"🩺"}].map(function(tip,i){return(<div key={i} style={{display:"flex",gap:"8px",marginBottom:"10px",alignItems:"flex-start"}}><span style={{fontSize:"16px",flexShrink:0}}>{tip.ic}</span><div><div style={{fontSize:"10px",fontWeight:"600",fontFamily:F.s,color:C.txt,marginBottom:"2px"}}>{tip.l}</div><div style={{fontSize:"11px",fontFamily:F.s,color:C.txtM,lineHeight:1.5}}>{tip.v}</div></div></div>);})}</Cd></>)}
    </div>)}
    {sub==="fasi"&&(<div style={{display:"grid",gap:"10px"}}>{CYCLE_PHASES.map(function(ph,i){return(<Cd key={i} accent={ph.color}><div style={{display:"flex",gap:"10px",alignItems:"center",marginBottom:"8px"}}><span style={{fontSize:"24px"}}>{ph.icon}</span><div><h3 style={{fontFamily:F.p,fontSize:"15px",margin:0,color:C.txt}}>Fase {ph.name}</h3><span style={{fontSize:"10px",fontFamily:F.s,color:C.txtL}}>{ph.days}</span></div></div><div style={{fontSize:"10px",fontFamily:F.s,color:C.txtM,marginBottom:"4px"}}><strong>Ormoni:</strong> {ph.hormones}</div><div style={{fontSize:"10px",fontFamily:F.s,color:C.txtM,marginBottom:"4px"}}><strong>Alimentazione:</strong> {ph.food}</div><div style={{fontSize:"10px",fontFamily:F.s,color:C.txtM,marginBottom:"4px"}}><strong>Allenamento:</strong> {ph.gym}</div><div style={{padding:"6px 8px",borderRadius:"8px",background:ph.color+"10",marginTop:"6px"}}><div style={{fontSize:"10px",fontFamily:F.s,color:ph.color,fontWeight:"500"}}>{ph.pcos}</div></div></Cd>);})}</div>)}
    {sub==="pcos"&&(<div style={{display:"grid",gap:"10px"}}><Info bg={C.berryP} bdr={C.berryL} color={C.berry}><strong>Nella PCOS il ciclo e spesso irregolare</strong>: oligomenorrea (cicli lunghi 35-90 giorni) o amenorrea (assenza di ciclo).</Info>{[{t:"Perche il ciclo e irregolare",d:"L'eccesso di androgeni e l'iperinsulinemia interferiscono con la maturazione dei follicoli.",ic:"🔬"},{t:"La fase luteale insufficiente",d:"Nella PCOS il corpo luteo puo produrre poco progesterone, accorciando la fase luteale.",ic:"🌙"},{t:"SPM amplificata nella PCOS",d:"Gonfiore, voglia di dolce, ansia sono piu intense. La fame emotiva colpisce 1 donna PCOS su 3.",ic:"💛"},{t:"Cosa migliora il ciclo",d:"Perdita del 5-10% del peso, esercizio regolare, alimentazione anti-infiammatoria e gestione dello stress.",ic:"🌱"},{t:"Quando preoccuparsi",d:"Assenza di ciclo per oltre 3 mesi, sanguinamento abbondante, dolore pelvico forte. Consulta il ginecologo.",ic:"🩺"}].map(function(item,i){return(<Cd key={i}><div style={{display:"flex",gap:"10px",alignItems:"flex-start"}}><span style={{fontSize:"20px",flexShrink:0}}>{item.ic}</span><div><h4 style={{margin:"0 0 3px",fontFamily:F.s,fontSize:"13px",fontWeight:"600",color:C.txt}}>{item.t}</h4><p style={{margin:0,fontSize:"11px",fontFamily:F.s,color:C.txtM,lineHeight:1.5}}>{item.d}</p></div></div></Cd>);})}</div>)}
  </div>);
}


/* ═══════════ GARMIN CSV IMPORT ═══════════ */
function parseCSV(text){var lines=text.split(/\r?\n/).filter(function(l){return l.trim();});if(lines.length<2)return[];var headers=[];var inQuote=false;var current="";for(var c=0;c<lines[0].length;c++){var ch=lines[0][c];if(ch==='"')inQuote=!inQuote;else if((ch===","||ch===";")&&!inQuote){headers.push(current.trim().toLowerCase());current="";}else current+=ch;}headers.push(current.trim().toLowerCase());var rows=[];for(var r=1;r<lines.length;r++){var vals=[];inQuote=false;current="";for(var c2=0;c2<lines[r].length;c2++){var ch2=lines[r][c2];if(ch2==='"')inQuote=!inQuote;else if((ch2===","||ch2===";")&&!inQuote){vals.push(current.trim());current="";}else current+=ch2;}vals.push(current.trim());if(vals.length>=headers.length){var obj={};headers.forEach(function(h,i){obj[h]=vals[i]||"";});rows.push(obj);}}return rows;}
function detectGarminType(rows){if(!rows||rows.length===0)return"unknown";var keys=Object.keys(rows[0]).join(" ").toLowerCase();if(keys.includes("weight")&&(keys.includes("bmi")||keys.includes("fat")||keys.includes("body")))return"weight";if(keys.includes("activity")&&(keys.includes("calories")||keys.includes("distance")||keys.includes("time")))return"activities";if(keys.includes("peso")&&(keys.includes("imc")||keys.includes("grasso")))return"weight_it";if(keys.includes("attivit")&&(keys.includes("calorie")||keys.includes("distanza")))return"activities_it";return"unknown";}
function parseGarminWeight(rows,type){var isIT=type==="weight_it";return rows.map(function(r){var dateRaw=r.date||r.data||r.day||r.giorno||Object.values(r)[0]||"";var d=dateRaw.replace(/\//g,"-");if(d.match(/^\d{2}-\d{2}-\d{4}$/))d=d.split("-").reverse().join("-");var wRaw=r.weight||r.peso||r[Object.keys(r).find(function(k){return k.toLowerCase().includes("weight")||k.toLowerCase().includes("peso");})]||"0";var w=parseFloat(String(wRaw).replace(",","."));if(isNaN(w)||w<30||w>300)return null;var bfRaw=r["fat %"]||r["body fat"]||r["% grasso"]||r["fat"]||r[Object.keys(r).find(function(k){return k.toLowerCase().includes("fat")||k.toLowerCase().includes("grasso");})]||"0";var bf=parseFloat(String(bfRaw).replace(",",".").replace("%",""));if(isNaN(bf))bf=0;var mmRaw=r["muscle mass"]||r["massa muscolare"]||r[Object.keys(r).find(function(k){return k.toLowerCase().includes("muscle")||k.toLowerCase().includes("muscol");})]||"0";var mm=parseFloat(String(mmRaw).replace(",",".").replace("%",""));if(isNaN(mm))mm=0;var bmRaw=r["bone mass"]||r["massa ossea"]||r[Object.keys(r).find(function(k){return k.toLowerCase().includes("bone")||k.toLowerCase().includes("oss");})]||"0";var bm=parseFloat(String(bmRaw).replace(",","."));if(isNaN(bm))bm=0;var bwRaw=r["body water"]||r["acqua corporea"]||r[Object.keys(r).find(function(k){return k.toLowerCase().includes("water")||k.toLowerCase().includes("acqua");})]||"0";var bw=parseFloat(String(bwRaw).replace(",",".").replace("%",""));if(isNaN(bw))bw=0;if(!d||d.length<8)return null;return{date:d.slice(0,10),weight:w,bf:bf,mm:mm,bm:bm,bw:bw};}).filter(Boolean);}
function parseGarminActivities(rows,type){var typeMap={"running":"Cardio","cycling":"Cardio","swimming":"Cardio","walking":"Camminata","hiking":"Camminata","strength":"Strength","yoga":"Yoga","hiit":"HIIT","corsa":"Cardio","ciclismo":"Cardio","nuoto":"Cardio","camminata":"Camminata","escursionismo":"Camminata","forza":"Strength"};return rows.map(function(r){var dateRaw=r.date||r.data||Object.values(r)[0]||"";var d=dateRaw.replace(/\//g,"-");if(d.match(/^\d{2}-\d{2}-\d{4}$/))d=d.split("-").reverse().join("-");var actType=r["activity type"]||r["tipo attività"]||r["tipo di attività"]||r.type||r.tipo||r[Object.keys(r).find(function(k){return k.toLowerCase().includes("type")||k.toLowerCase().includes("tipo");})]||"";var mapped=typeMap[actType.toLowerCase()]||"Strength";var durRaw=r.time||r.duration||r.durata||r.tempo||r[Object.keys(r).find(function(k){return k.toLowerCase().includes("time")||k.toLowerCase().includes("durat")||k.toLowerCase().includes("tempo");})]||"0";var dur=0;if(String(durRaw).includes(":")){var parts=String(durRaw).split(":");dur=parseInt(parts[0])*60+(parseInt(parts[1])||0);}else{dur=parseInt(durRaw)||0;}if(dur>600)dur=Math.round(dur/60);var calRaw=r.calories||r.calorie||r[Object.keys(r).find(function(k){return k.toLowerCase().includes("calor");})]||"0";var cal=parseInt(String(calRaw).replace(",","").replace(".",""))||0;var hrRaw=r["avg hr"]||r["avg heart rate"]||r["fc media"]||r[Object.keys(r).find(function(k){return k.toLowerCase().includes("heart")||k.toLowerCase().includes("hr")||k.toLowerCase().includes("fc");})]||"0";var hr=parseInt(hrRaw)||0;if(!d||d.length<8||dur<=0)return null;return{date:d.slice(0,10),type:mapped,duration:dur,calories:cal,hr:hr};}).filter(Boolean);}
function GarminImport(props){
  var weighins=props.weighins,setWeighins=props.setWeighins,workouts=props.workouts,setWorkouts=props.setWorkouts;
  var _s1=useState(null),result=_s1[0],setResult=_s1[1];
  var _s2=useState(""),status=_s2[0],setStatus=_s2[1];
  var _s3=useState(null),preview=_s3[0],setPreview=_s3[1];
  function handleFile(e){
    var file=e.target.files[0];if(!file)return;
    setStatus(LANG_STORE==="en"?"Reading file...":"Lettura file...");setResult(null);setPreview(null);
    var reader=new FileReader();
    reader.onload=function(ev){
      var text=ev.target.result;var rows=parseCSV(text);
      if(rows.length===0){setStatus(LANG_STORE==="en"?"Error: empty or invalid CSV":"Errore: CSV vuoto o non valido");return;}
      var type=detectGarminType(rows);
      if(type==="weight"||type==="weight_it"){
        var parsed=parseGarminWeight(rows,type);
        if(parsed.length===0){setStatus(LANG_STORE==="en"?"No valid weight data found":"Nessun dato peso valido trovato");return;}
        setPreview({type:"weight",data:parsed,total:rows.length});
        setStatus(LANG_STORE==="en"?parsed.length+" weight entries ready to import":parsed.length+" pesate pronte per l'importazione");
      }else if(type==="activities"||type==="activities_it"){
        var parsed2=parseGarminActivities(rows,type);
        if(parsed2.length===0){setStatus(LANG_STORE==="en"?"No valid activity data found":"Nessun dato attivita valido trovato");return;}
        setPreview({type:"activities",data:parsed2,total:rows.length});
        setStatus(LANG_STORE==="en"?parsed2.length+" activities ready to import":parsed2.length+" attivita pronte per l'importazione");
      }else{
        var parsed3=parseGarminWeight(rows,"weight");
        if(parsed3.length>0){setPreview({type:"weight",data:parsed3,total:rows.length});setStatus(LANG_STORE==="en"?parsed3.length+" weight entries detected":parsed3.length+" pesate rilevate");return;}
        var parsed4=parseGarminActivities(rows,"activities");
        if(parsed4.length>0){setPreview({type:"activities",data:parsed4,total:rows.length});setStatus(LANG_STORE==="en"?parsed4.length+" activities detected":parsed4.length+" attivita rilevate");return;}
        setStatus(LANG_STORE==="en"?"Could not recognize Garmin CSV format. Try exporting from Garmin Connect > Reports.":"Formato CSV non riconosciuto. Prova a esportare da Garmin Connect > Report.");
      }
    };reader.readAsText(file);
  }
  function doImport(){
    if(!preview)return;
    if(preview.type==="weight"){
      var existDates={};weighins.forEach(function(w){existDates[w.date]=true;});
      var newOnes=preview.data.filter(function(w){return!existDates[w.date];});
      var merged=weighins.concat(newOnes).sort(function(a,b){return a.date.localeCompare(b.date);});
      setWeighins(merged);SV("weighins",merged);
      setResult({added:newOnes.length,skipped:preview.data.length-newOnes.length,type:"weight"});
    }else{
      var existKeys={};workouts.forEach(function(w){existKeys[w.date+"_"+w.type+"_"+w.duration]=true;});
      var newW=preview.data.filter(function(w){return!existKeys[w.date+"_"+w.type+"_"+w.duration];});
      var merged2=workouts.concat(newW).sort(function(a,b){return b.date.localeCompare(a.date);});
      setWorkouts(merged2);SV("workouts",merged2);
      setResult({added:newW.length,skipped:preview.data.length-newW.length,type:"activities"});
    }
    setPreview(null);setStatus("");
  }
  var guideSteps=LANG_STORE==="en"?[
    {i:"1️⃣",t:"Open Garmin Connect",d:"Go to connect.garmin.com or open the Garmin Connect app"},
    {i:"2️⃣",t:"Navigate to Reports",d:"For weight: Health Stats → Weight. For activities: Activities → All Activities"},
    {i:"3️⃣",t:"Export CSV",d:"Click the export/download icon (⬇️) and select CSV format"},
    {i:"4️⃣",t:"Upload here",d:"Upload the CSV file below and confirm the import"}
  ]:[
    {i:"1️⃣",t:"Apri Garmin Connect",d:"Vai su connect.garmin.com o apri l'app Garmin Connect"},
    {i:"2️⃣",t:"Vai ai Report",d:"Per il peso: Statistiche Salute → Peso. Per le attivita: Attivita → Tutte le Attivita"},
    {i:"3️⃣",t:"Esporta CSV",d:"Clicca l'icona esporta/scarica (⬇️) e seleziona formato CSV"},
    {i:"4️⃣",t:"Carica qui",d:"Carica il file CSV qui sotto e conferma l'importazione"}
  ];
  return React.createElement("div",{style:{display:"grid",gap:"10px"}},
    React.createElement(Cd,{style:{background:"linear-gradient(135deg,"+C.sageP+","+C.white+")"}},
      React.createElement("h4",{style:{fontFamily:F.p,fontSize:"15px",color:C.sageD,margin:"0 0 6px"}},LANG_STORE==="en"?"📥 Import from Garmin Connect":"📥 Importa da Garmin Connect"),
      React.createElement("p",{style:{fontSize:"10px",fontFamily:F.s,color:C.txtM,margin:"0 0 12px",lineHeight:1.6}},LANG_STORE==="en"?"Export your data from Garmin Connect as CSV, then upload it here. Weight, body composition and activities will be imported automatically.":"Esporta i tuoi dati da Garmin Connect come CSV, poi caricali qui. Peso, composizione corporea e attivita verranno importati automaticamente."),
      React.createElement("div",{style:{display:"grid",gap:"8px"}},guideSteps.map(function(s,i){return React.createElement("div",{key:i,style:{display:"flex",gap:"10px",alignItems:"flex-start",padding:"8px 10px",borderRadius:"10px",background:C.white}},
        React.createElement("span",{style:{fontSize:"16px",flexShrink:0}},s.i),
        React.createElement("div",null,React.createElement("p",{style:{fontSize:"11px",fontFamily:F.s,fontWeight:"600",color:C.txt,margin:0}},s.t),React.createElement("p",{style:{fontSize:"10px",fontFamily:F.s,color:C.txtL,margin:"2px 0 0"}},s.d))
      );}))
    ),
    React.createElement(Cd,null,
      React.createElement("h5",{style:{fontFamily:F.s,fontSize:"12px",fontWeight:"600",color:C.plum,margin:"0 0 10px"}},LANG_STORE==="en"?"📂 Upload CSV File":"📂 Carica File CSV"),
      React.createElement("label",{style:{display:"block",padding:"20px",borderRadius:"12px",border:"2px dashed "+C.sageL,background:C.sageP,textAlign:"center",cursor:"pointer",transition:"all .2s"}},
        React.createElement("input",{type:"file",accept:".csv,.txt",onChange:handleFile,style:{display:"none"}}),
        React.createElement("span",{style:{fontSize:"28px",display:"block",marginBottom:"6px"}},"📄"),
        React.createElement("p",{style:{fontSize:"12px",fontFamily:F.s,fontWeight:"600",color:C.sageD,margin:0}},LANG_STORE==="en"?"Tap to select CSV file":"Tocca per selezionare il file CSV"),
        React.createElement("p",{style:{fontSize:"9px",fontFamily:F.s,color:C.txtL,margin:"4px 0 0"}},LANG_STORE==="en"?"Supports: Weight, Body Composition, Activities":"Supporta: Peso, Composizione Corporea, Attivita")
      ),
      status&&React.createElement("p",{style:{fontSize:"11px",fontFamily:F.s,color:C.sageD,margin:"10px 0 0",textAlign:"center",fontWeight:"600"}},status)
    ),
    preview&&React.createElement(Cd,{accent:C.sage},
      React.createElement("h5",{style:{fontFamily:F.s,fontSize:"12px",fontWeight:"600",color:C.sageD,margin:"0 0 8px"}},LANG_STORE==="en"?"📋 Preview":"📋 Anteprima"),
      React.createElement("div",{style:{maxHeight:"200px",overflow:"auto",marginBottom:"10px"}},
        preview.type==="weight"?React.createElement("table",{style:{width:"100%",fontSize:"10px",fontFamily:F.s,borderCollapse:"collapse"}},
          React.createElement("thead",null,React.createElement("tr",null,
            [LANG_STORE==="en"?"Date":"Data","Peso","BF%","MM%","Ossa","Acqua%"].map(function(h,i){return React.createElement("th",{key:i,style:{padding:"4px 6px",textAlign:"left",borderBottom:"1px solid "+C.bdr,color:C.txtL,fontWeight:"600"}},h);})
          )),
          React.createElement("tbody",null,preview.data.slice(0,10).map(function(r,i){return React.createElement("tr",{key:i},
            React.createElement("td",{style:{padding:"3px 6px",borderBottom:"1px solid "+C.bg}},r.date),
            React.createElement("td",{style:{padding:"3px 6px",borderBottom:"1px solid "+C.bg,fontWeight:"600",color:C.sage}},r.weight+"kg"),
            React.createElement("td",{style:{padding:"3px 6px",borderBottom:"1px solid "+C.bg}},r.bf||"-"),
            React.createElement("td",{style:{padding:"3px 6px",borderBottom:"1px solid "+C.bg}},r.mm||"-"),
            React.createElement("td",{style:{padding:"3px 6px",borderBottom:"1px solid "+C.bg}},r.bm||"-"),
            React.createElement("td",{style:{padding:"3px 6px",borderBottom:"1px solid "+C.bg}},r.bw||"-")
          );}))
        ):React.createElement("table",{style:{width:"100%",fontSize:"10px",fontFamily:F.s,borderCollapse:"collapse"}},
          React.createElement("thead",null,React.createElement("tr",null,
            [LANG_STORE==="en"?"Date":"Data",LANG_STORE==="en"?"Type":"Tipo","Min","Kcal","FC"].map(function(h,i){return React.createElement("th",{key:i,style:{padding:"4px 6px",textAlign:"left",borderBottom:"1px solid "+C.bdr,color:C.txtL,fontWeight:"600"}},h);})
          )),
          React.createElement("tbody",null,preview.data.slice(0,10).map(function(r,i){return React.createElement("tr",{key:i},
            React.createElement("td",{style:{padding:"3px 6px",borderBottom:"1px solid "+C.bg}},r.date),
            React.createElement("td",{style:{padding:"3px 6px",borderBottom:"1px solid "+C.bg}},React.createElement(Pill,{color:C.sage},r.type)),
            React.createElement("td",{style:{padding:"3px 6px",borderBottom:"1px solid "+C.bg}},r.duration),
            React.createElement("td",{style:{padding:"3px 6px",borderBottom:"1px solid "+C.bg}},r.calories||"-"),
            React.createElement("td",{style:{padding:"3px 6px",borderBottom:"1px solid "+C.bg}},r.hr||"-")
          );}))
        )
      ),
      preview.data.length>10&&React.createElement("p",{style:{fontSize:"9px",fontFamily:F.s,color:C.txtL,textAlign:"center"}},"+"+(preview.data.length-10)+(LANG_STORE==="en"?" more entries...":" altre voci...")),
      React.createElement("button",{onClick:doImport,style:{width:"100%",padding:"12px",borderRadius:"12px",border:"none",background:"linear-gradient(135deg,"+C.sage+","+C.sageD+")",color:C.white,fontSize:"13px",fontFamily:F.s,fontWeight:"700",cursor:"pointer"}},"✅ "+(LANG_STORE==="en"?"Import "+preview.data.length+" entries":"Importa "+preview.data.length+" voci"))
    ),
    result&&React.createElement(Cd,{style:{background:C.sageP,border:"1px solid "+C.sageL}},
      React.createElement("div",{style:{textAlign:"center"}},
        React.createElement("span",{style:{fontSize:"32px"}},"🎉"),
        React.createElement("h4",{style:{fontFamily:F.p,fontSize:"15px",color:C.sageD,margin:"6px 0 4px"}},LANG_STORE==="en"?"Import Complete!":"Importazione Completata!"),
        React.createElement("p",{style:{fontSize:"11px",fontFamily:F.s,color:C.txtM,margin:0}},
          (LANG_STORE==="en"?"Added: ":"Aggiunti: ")+result.added+(LANG_STORE==="en"?" new | Skipped: ":" nuovi | Saltati: ")+result.skipped+(LANG_STORE==="en"?" duplicates":" duplicati")
        ),
        React.createElement("p",{style:{fontSize:"10px",fontFamily:F.s,color:C.sageD,margin:"6px 0 0"}},result.type==="weight"?(LANG_STORE==="en"?"Check the Weight tab for your updated data":"Controlla il tab Pesate per i dati aggiornati"):(LANG_STORE==="en"?"Check the Workouts tab for your updated data":"Controlla il tab Allenamenti per i dati aggiornati"))
      )
    ),
    React.createElement(Cd,{style:{background:C.amberP,border:"1px solid "+C.amberL}},
      React.createElement("p",{style:{fontSize:"10px",fontFamily:F.s,color:C.amber,margin:0,lineHeight:1.6}},
        LANG_STORE==="en"?"💡 Tip: You can import multiple CSV files. Duplicate entries (same date) are automatically skipped. For best results, export from Garmin Connect web (connect.garmin.com) rather than the mobile app.":"💡 Suggerimento: Puoi importare piu file CSV. Le voci duplicate (stessa data) vengono saltate automaticamente. Per risultati migliori, esporta da Garmin Connect web (connect.garmin.com) piuttosto che dall'app mobile."
      )
    )
  );
}
/* ═══════════ GARMIN TRACKER ═══════════ */
function GarminSection({profile}){
  const[sub,setSub]=useState("dash");
  const[weighins,setWeighins]=useState(function(){return LD("weighins",DEF_W);});
  const[workouts,setWorkouts]=useState(function(){return LD("workouts",DEF_WO);});
  const[daily,setDaily]=useState(function(){return LD("daily",DEF_DD);});
  const[showAW,setShowAW]=useState(false);
  const[showAT,setShowAT]=useState(false);
  const[wF,setWF]=useState({date:todayK(),weight:"",bf:"",mm:"",bm:"",bw:""});
  const[tF,setTF]=useState({date:todayK(),type:"Strength",duration:"",calories:"",hr:""});
  const[dF,setDF]=useState(Object.assign({},daily));
  const[em,setEM]=useState(false);
  const[chartMode,setChartMode]=useState("weight");
  var lat=weighins.length>0?weighins[weighins.length-1]:null;
  var bmi=lat?(lat.weight/(profile.height/100*profile.height/100)).toFixed(1):"--";
  var last8=weighins.slice(-8);
  function addW(){if(!wF.weight)return;var e={date:wF.date,weight:parseFloat(wF.weight),bf:parseFloat(wF.bf)||0,mm:parseFloat(wF.mm)||0,bm:parseFloat(wF.bm)||0,bw:parseFloat(wF.bw)||0};var u=weighins.concat([e]).sort(function(a,b){return a.date.localeCompare(b.date);});setWeighins(u);SV("weighins",u);setWF({date:todayK(),weight:"",bf:"",mm:"",bm:"",bw:""});setShowAW(false);}
  function delW(i){var u=weighins.filter(function(_,j){return j!==i;});setWeighins(u);SV("weighins",u);}
  function addT(){if(!tF.duration)return;var e={date:tF.date,type:tF.type,duration:parseInt(tF.duration)||0,calories:parseInt(tF.calories)||0,hr:parseInt(tF.hr)||0};var u=workouts.concat([e]).sort(function(a,b){return b.date.localeCompare(a.date);});setWorkouts(u);SV("workouts",u);setTF({date:todayK(),type:"Strength",duration:"",calories:"",hr:""});setShowAT(false);}
  function delT(i){var u=workouts.filter(function(_,j){return j!==i;});setWorkouts(u);SV("workouts",u);}
  function savD(){var d={steps:parseInt(dF.steps)||0,rhr:parseInt(dF.rhr)||0,stress:parseInt(dF.stress)||0,bb:parseInt(dF.bb)||0,vo2:parseInt(dF.vo2)||0};setDaily(d);SV("daily",d);setEM(false);}
  var tcMap={Strength:C.sage,Camminata:C.amber,Yoga:C.plum,Cardio:C.rose,HIIT:C.berry,Riposo:C.txtL};
  function chartData(mode){var d=weighins.slice(-12);return d.map(function(w){if(mode==="weight")return{v:w.weight,label:fmtD(w.date)};if(mode==="bf")return{v:w.bf,label:fmtD(w.date)};if(mode==="mm")return{v:w.mm,label:fmtD(w.date)};if(mode==="bw")return{v:w.bw,label:fmtD(w.date)};return{v:0,label:""};});}
  var cd=chartData(chartMode);
  var chartColors={weight:C.sage,bf:C.rose,mm:C.amber,bw:C.blue};
  return(<div>
    <SecH title="Garmin Tracker" sub="Forerunner 570 + Index S2 | Inserimento manuale"/>
    <SubT tabs={[{k:"dash",l:"Dashboard",i:"📊"},{k:"charts",l:"Grafici",i:"📈"},{k:"peso",l:"Pesate",i:"⚖️"},{k:"workout",l:"Allenamenti",i:"⌚"},{k:"daily",l:"Oggi",i:"❤️"},{k:"import",l:LANG_STORE==="en"?"Import":"Importa",i:"📥"}]} active={sub} onSel={setSub}/>
    {sub==="dash"&&(<div style={{display:"grid",gap:"10px"}}>
      <Cd accent={C.sage} style={{background:"linear-gradient(135deg,"+C.sageP+","+C.white+")"}}><h3 style={{fontFamily:F.p,fontSize:"15px",margin:"0 0 10px",color:C.sageD}}>Stato Attuale</h3><div style={{display:"grid",gap:"8px",gridTemplateColumns:"1fr 1fr 1fr"}}>{[{l:"Peso",v:lat?lat.weight+" kg":"--",c:C.sage},{l:"BMI",v:bmi,c:C.amber},{l:"Body Fat",v:lat?lat.bf+"%":"--",c:C.rose}].map(function(m,i){return(<div key={i} style={{textAlign:"center",padding:"10px 4px",borderRadius:"10px",background:C.white}}><div style={{fontFamily:F.s,fontSize:"18px",fontWeight:"700",color:m.c}}>{m.v}</div><div style={{fontSize:"9px",color:C.txtL,fontFamily:F.s}}>{m.l}</div></div>);})}</div><div style={{display:"grid",gap:"8px",gridTemplateColumns:"1fr 1fr 1fr",marginTop:"8px"}}>{[{l:"Muscolo",v:lat?lat.mm+"%":"--",c:C.sage},{l:"Ossa",v:lat?lat.bm+" kg":"--",c:C.amber},{l:"Acqua",v:lat?lat.bw+"%":"--",c:C.blue}].map(function(m,i){return(<div key={i} style={{textAlign:"center",padding:"10px 4px",borderRadius:"10px",background:C.white}}><div style={{fontFamily:F.s,fontSize:"16px",fontWeight:"700",color:m.c}}>{m.v}</div><div style={{fontSize:"9px",color:C.txtL,fontFamily:F.s}}>{m.l}</div></div>);})}</div></Cd>
      <div style={{display:"grid",gap:"8px",gridTemplateColumns:"1fr 1fr"}}>{[{l:"Passi",v:daily.steps?daily.steps.toLocaleString():"—",s:"/"+profile.stepsG.toLocaleString(),c:C.sage,b:true,bv:daily.steps||0,bm:profile.stepsG},{l:"FC Riposo",v:daily.rhr?daily.rhr+" bpm":"—",c:C.rose},{l:"Body Battery",v:daily.bb?daily.bb+"%":"—",c:C.sage,b:true,bv:daily.bb||0,bm:100},{l:"Stress",v:daily.stress?String(daily.stress):"—",s:daily.stress<30?"Basso":daily.stress<60?"Medio":"Alto",c:C.amber}].map(function(m,i){return(<Cd key={i} style={{padding:"12px"}}><span style={{fontSize:"9px",fontFamily:F.s,color:C.txtL,textTransform:"uppercase"}}>{m.l}</span><div style={{fontFamily:F.s,fontSize:"18px",fontWeight:"700",color:m.c||C.txt}}>{m.v}</div>{m.s&&<div style={{fontSize:"9px",fontFamily:F.s,color:C.txtL}}>{m.s}</div>}{m.b&&<div style={{marginTop:"5px"}}><Bar v={m.bv} mx={m.bm} color={m.c||C.sage}/></div>}</Cd>);})}</div>
      <Cd><h4 style={{fontFamily:F.p,fontSize:"14px",margin:"0 0 10px",color:C.txt}}>Andamento Peso (Ob: ~{profile.goalW} kg)</h4><div style={{display:"flex",alignItems:"flex-end",gap:"3px",height:"100px"}}>{last8.map(function(w,i){var mn=Math.min.apply(null,last8.map(function(x){return x.weight;}))-1;var mx=Math.max.apply(null,last8.map(function(x){return x.weight;}))+1;var h=((w.weight-mn)/(mx-mn))*100;var il=i===last8.length-1;return(<div key={i} style={{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:"2px"}}><span style={{fontSize:"8px",fontFamily:F.s,color:il?C.sage:C.txtL,fontWeight:il?"700":"400"}}>{w.weight}</span><div style={{width:"100%",maxWidth:"26px",height:h+"%",borderRadius:"5px 5px 2px 2px",background:il?C.sage:C.sageL}}/><span style={{fontSize:"7px",fontFamily:F.s,color:C.txtL}}>{fmtD(w.date)}</span></div>);})}</div></Cd>
    </div>)}
    {sub==="charts"&&(<div style={{display:"grid",gap:"10px"}}>
      <div style={{display:"flex",gap:"4px"}}>{[{k:"weight",l:"Peso"},{k:"bf",l:"Body Fat %"},{k:"mm",l:"Muscolo %"},{k:"bw",l:"Acqua %"}].map(function(m){return(<button key={m.k} onClick={function(){setChartMode(m.k);}} style={{flex:1,padding:"8px 4px",borderRadius:"10px",border:chartMode===m.k?"none":"1px solid "+C.bdr,background:chartMode===m.k?chartColors[m.k]:C.white,color:chartMode===m.k?C.white:C.txtM,fontSize:"10px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}}>{m.l}</button>);})}</div>
      <Cd><h4 style={{fontFamily:F.p,fontSize:"14px",margin:"0 0 12px",color:C.txt}}>📈 {chartMode==="weight"?"Peso":chartMode==="bf"?"Body Fat %":chartMode==="mm"?"Massa Muscolare %":"Acqua %"}</h4>{cd.length>1?(<div style={{position:"relative",height:"140px",display:"flex",alignItems:"flex-end",gap:"4px"}}>{cd.map(function(pt,i){var vals=cd.map(function(x){return x.v;});var mn=Math.min.apply(null,vals)-1;var mx=Math.max.apply(null,vals)+1;var h=((pt.v-mn)/(mx-mn))*100;var il=i===cd.length-1;return(<div key={i} style={{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:"2px",height:"100%",justifyContent:"flex-end"}}><span style={{fontSize:"8px",fontFamily:F.s,color:il?chartColors[chartMode]:C.txtL,fontWeight:il?"700":"400"}}>{pt.v}</span><div style={{width:"100%",maxWidth:"30px",height:h+"%",borderRadius:"5px 5px 2px 2px",background:il?chartColors[chartMode]:chartColors[chartMode]+"60",transition:"height .5s"}}/><span style={{fontSize:"7px",fontFamily:F.s,color:C.txtL}}>{pt.label}</span></div>);})}</div>):(<p style={{fontSize:"12px",fontFamily:F.s,color:C.txtL,textAlign:"center",padding:"20px"}}>Inserisci almeno 2 pesate per vedere il grafico</p>)}</Cd>
      {cd.length>1&&<Cd style={{background:C.sageP,border:"1px solid "+C.sageL}}><div style={{display:"flex",justifyContent:"space-between"}}><span style={{fontSize:"11px",fontFamily:F.s,color:C.sageD}}>Prima: {cd[0].v} | Ora: {cd[cd.length-1].v}</span><span style={{fontSize:"11px",fontFamily:F.s,fontWeight:"700",color:cd[cd.length-1].v<cd[0].v?C.sage:C.rose}}>{chartMode==="weight"||chartMode==="bf"?(cd[cd.length-1].v<cd[0].v?"↓":"↑"):(cd[cd.length-1].v>cd[0].v?"↑":"↓")} {Math.abs(cd[cd.length-1].v-cd[0].v).toFixed(1)}</span></div></Cd>}
    </div>)}
    {sub==="peso"&&(<div style={{display:"grid",gap:"10px"}}>
      <button onClick={function(){setShowAW(!showAW);}} style={{width:"100%",padding:"12px",borderRadius:"12px",border:"none",background:showAW?C.roseP:"linear-gradient(135deg,"+C.sage+","+C.sageD+")",color:showAW?C.roseD:C.white,fontSize:"13px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}}>{showAW?"✕ Chiudi":"➕ Nuova Pesata"}</button>
      {showAW&&(<Cd accent={C.sage}><h4 style={{fontFamily:F.s,fontSize:"13px",fontWeight:"600",margin:"0 0 10px",color:C.sageD}}>Registra pesata dalla bilancia Garmin</h4><div style={{display:"grid",gap:"8px"}}><div><label style={lS}>Data</label><input type="date" value={wF.date} onChange={function(e){setWF(Object.assign({},wF,{date:e.target.value}));}} style={iS}/></div><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px"}}><div><label style={lS}>Peso (kg) *</label><input type="number" step="0.1" placeholder="77.0" value={wF.weight} onChange={function(e){setWF(Object.assign({},wF,{weight:e.target.value}));}} style={iS}/></div><div><label style={lS}>Body Fat %</label><input type="number" step="0.1" placeholder="29.0" value={wF.bf} onChange={function(e){setWF(Object.assign({},wF,{bf:e.target.value}));}} style={iS}/></div></div><div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"8px"}}><div><label style={lS}>Muscolo %</label><input type="number" step="0.1" value={wF.mm} onChange={function(e){setWF(Object.assign({},wF,{mm:e.target.value}));}} style={iS}/></div><div><label style={lS}>Ossa kg</label><input type="number" step="0.1" value={wF.bm} onChange={function(e){setWF(Object.assign({},wF,{bm:e.target.value}));}} style={iS}/></div><div><label style={lS}>Acqua %</label><input type="number" step="0.1" value={wF.bw} onChange={function(e){setWF(Object.assign({},wF,{bw:e.target.value}));}} style={iS}/></div></div><button onClick={addW} style={{width:"100%",padding:"11px",borderRadius:"12px",border:"none",background:C.sage,color:C.white,fontSize:"13px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}}>Salva Pesata</button></div></Cd>)}
      <Cd><h4 style={{fontFamily:F.p,fontSize:"14px",margin:"0 0 10px",color:C.txt}}>Storico Pesate ({weighins.length})</h4>{weighins.length===0&&<p style={{fontSize:"12px",fontFamily:F.s,color:C.txtL}}>Nessuna pesata</p>}<div style={{display:"grid",gap:"6px"}}>{weighins.slice().reverse().map(function(w,i){var ri=weighins.length-1-i;return(<div key={i} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 12px",borderRadius:"10px",background:i===0?C.sageP:C.bg}}><div><span style={{fontFamily:F.s,fontSize:"12px",fontWeight:"600",color:C.txt}}>{fmtD(w.date)}</span><span style={{fontFamily:F.s,fontSize:"12px",color:C.txtM,marginLeft:"8px"}}>{w.weight} kg</span></div><div style={{display:"flex",gap:"6px",alignItems:"center"}}>{w.bf>0&&<Pill color={C.rose}>BF {w.bf}%</Pill>}{w.mm>0&&<Pill color={C.sage}>MM {w.mm}%</Pill>}<button onClick={function(){delW(ri);}} style={{background:"none",border:"none",color:C.txtL,cursor:"pointer",fontSize:"14px",padding:"2px 4px"}}>✕</button></div></div>);})}</div></Cd>
    </div>)}
    {sub==="workout"&&(<div style={{display:"grid",gap:"10px"}}>
      <button onClick={function(){setShowAT(!showAT);}} style={{width:"100%",padding:"12px",borderRadius:"12px",border:"none",background:showAT?C.roseP:"linear-gradient(135deg,"+C.rose+","+C.roseD+")",color:showAT?C.roseD:C.white,fontSize:"13px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}}>{showAT?"✕ Chiudi":"➕ Registra Allenamento"}</button>
      {showAT&&(<Cd accent={C.rose}><div style={{display:"grid",gap:"8px"}}><div><label style={lS}>Data</label><input type="date" value={tF.date} onChange={function(e){setTF(Object.assign({},tF,{date:e.target.value}));}} style={iS}/></div><div><label style={lS}>Tipo</label><div style={{display:"flex",gap:"4px",flexWrap:"wrap"}}>{["Strength","Camminata","Yoga","Cardio","HIIT","Riposo"].map(function(t){return<button key={t} onClick={function(){setTF(Object.assign({},tF,{type:t}));}} style={{padding:"7px 12px",borderRadius:"10px",border:tF.type===t?"none":"1px solid "+C.bdr,background:tF.type===t?C.rose:C.white,color:tF.type===t?C.white:C.txtM,fontSize:"11px",fontFamily:F.s,fontWeight:"500",cursor:"pointer"}}>{t}</button>;})}</div></div><div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"8px"}}><div><label style={lS}>Durata (min) *</label><input type="number" placeholder="55" value={tF.duration} onChange={function(e){setTF(Object.assign({},tF,{duration:e.target.value}));}} style={iS}/></div><div><label style={lS}>Calorie</label><input type="number" placeholder="380" value={tF.calories} onChange={function(e){setTF(Object.assign({},tF,{calories:e.target.value}));}} style={iS}/></div><div><label style={lS}>FC media</label><input type="number" placeholder="128" value={tF.hr} onChange={function(e){setTF(Object.assign({},tF,{hr:e.target.value}));}} style={iS}/></div></div><button onClick={addT} style={{width:"100%",padding:"11px",borderRadius:"12px",border:"none",background:C.rose,color:C.white,fontSize:"13px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}}>Salva</button></div></Cd>)}
      {workouts.length===0&&<Info bg={C.roseP} bdr={C.roseL} color={C.roseD}>Nessun allenamento registrato.</Info>}
      <div style={{display:"grid",gap:"6px"}}>{workouts.slice(0,14).map(function(w,i){return(<Cd key={i} style={{padding:"13px"}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}><div><div style={{display:"flex",gap:"6px",alignItems:"center",marginBottom:"2px"}}><span style={{fontFamily:F.s,fontSize:"12px",fontWeight:"600",color:C.txt}}>{fmtD(w.date)}</span><Pill color={tcMap[w.type]||C.sage}>{w.type}</Pill></div><div style={{display:"flex",gap:"10px"}}>{w.duration>0&&<span style={{fontSize:"11px",fontFamily:F.s,color:C.txtM}}>{w.duration} min</span>}{w.calories>0&&<span style={{fontSize:"11px",fontFamily:F.s,color:C.txtM}}>{w.calories} kcal</span>}{w.hr>0&&<span style={{fontSize:"11px",fontFamily:F.s,color:C.txtM}}>FC {w.hr}</span>}</div></div><button onClick={function(){delT(i);}} style={{background:"none",border:"none",color:C.txtL,cursor:"pointer",fontSize:"14px"}}> ✕</button></div></Cd>);})}</div>
    </div>)}
    {sub==="daily"&&(<div style={{display:"grid",gap:"10px"}}>
      <Info bg={C.sageP} bdr={C.sageL} color={C.sageD}>Inserisci i dati di <strong>oggi</strong> dal tuo Garmin Connect.</Info>
      <Cd accent={C.sage}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"}}><h4 style={{fontFamily:F.s,fontSize:"14px",fontWeight:"600",margin:0,color:C.txt}}>Dati Giornalieri</h4>{!em&&<button onClick={function(){setDF(Object.assign({},daily));setEM(true);}} style={{padding:"6px 14px",borderRadius:"10px",border:"none",background:C.sage,color:C.white,fontSize:"11px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}}>Modifica</button>}</div>
      {!em?(<div style={{display:"grid",gap:"8px",gridTemplateColumns:"1fr 1fr"}}>{[{l:"Passi",v:daily.steps?daily.steps.toLocaleString():"—",ic:"🚶",c:C.sage},{l:"FC Riposo",v:daily.rhr?daily.rhr+" bpm":"—",ic:"❤️",c:C.rose},{l:"Stress",v:daily.stress?String(daily.stress):"—",ic:"🧠",c:C.amber},{l:"Body Battery",v:daily.bb?daily.bb+"%":"—",ic:"🔋",c:C.sage},{l:"VO2 Max",v:daily.vo2?String(daily.vo2):"—",ic:"🫁",c:C.plum}].map(function(m,i){return(<div key={i} style={{display:"flex",gap:"8px",alignItems:"center",padding:"10px",borderRadius:"10px",background:C.bg}}><span style={{fontSize:"18px"}}>{m.ic}</span><div><div style={{fontSize:"15px",fontWeight:"700",color:m.c,fontFamily:F.s}}>{m.v}</div><div style={{fontSize:"9px",color:C.txtL,fontFamily:F.s}}>{m.l}</div></div></div>);})}</div>):(<div style={{display:"grid",gap:"8px"}}><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px"}}><div><label style={lS}>Passi</label><input type="number" value={dF.steps} onChange={function(e){setDF(Object.assign({},dF,{steps:e.target.value}));}} style={iS}/></div><div><label style={lS}>FC Riposo</label><input type="number" value={dF.rhr} onChange={function(e){setDF(Object.assign({},dF,{rhr:e.target.value}));}} style={iS}/></div></div><div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"8px"}}><div><label style={lS}>Stress</label><input type="number" value={dF.stress} onChange={function(e){setDF(Object.assign({},dF,{stress:e.target.value}));}} style={iS}/></div><div><label style={lS}>Body Battery %</label><input type="number" value={dF.bb} onChange={function(e){setDF(Object.assign({},dF,{bb:e.target.value}));}} style={iS}/></div><div><label style={lS}>VO2 Max</label><input type="number" value={dF.vo2} onChange={function(e){setDF(Object.assign({},dF,{vo2:e.target.value}));}} style={iS}/></div></div><div style={{display:"flex",gap:"8px"}}><button onClick={savD} style={{flex:1,padding:"11px",borderRadius:"12px",border:"none",background:C.sage,color:C.white,fontSize:"13px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}}>Salva</button><button onClick={function(){setEM(false);}} style={{padding:"11px 16px",borderRadius:"12px",border:"1px solid "+C.bdr,background:C.white,color:C.txtM,fontSize:"13px",fontFamily:F.s,cursor:"pointer"}}>Annulla</button></div></div>)}</Cd>
    </div>)}
    {sub==="import"&&(<GarminImport weighins={weighins} setWeighins={setWeighins} workouts={workouts} setWorkouts={setWorkouts}/>)}
  </div>);
}




/* ═══════════ NOTIFICHE BROWSER ═══════════ */
function requestNotifPerm(){if("Notification" in window&&Notification.permission==="default")Notification.requestPermission();}
function sendNotif(title,body){if("Notification" in window&&Notification.permission==="granted")new Notification(title,{body:body,icon:"data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🌸</text></svg>"});}

/* ═══════════ PROGRESS PHOTOS ═══════════ */
function ProgressPhotos(){
  const[photos,setPhotos]=useState(function(){return LD("progressPhotos",[]);});
  const[compare,setCompare]=useState(false);
  const[sliderPos,setSliderPos]=useState(50);
  const[selA,setSelA]=useState(0);
  const[selB,setSelB]=useState(null);
  var fileRef=useRef(null);
  function addPhoto(e){var file=e.target.files[0];if(!file)return;var reader=new FileReader();reader.onload=function(ev){var img=new Image();img.onload=function(){var MAX=400;var w=img.width;var h=img.height;if(w>h){if(w>MAX){h=h*(MAX/w);w=MAX;}}else{if(h>MAX){w=w*(MAX/h);h=MAX;}}var canvas=document.createElement("canvas");canvas.width=w;canvas.height=h;var ctx=canvas.getContext("2d");ctx.drawImage(img,0,0,w,h);var compressed=canvas.toDataURL("image/jpeg",0.35);var entry={date:todayK(),data:compressed,note:""};var u=[entry].concat(photos).slice(0,20);setPhotos(u);SV("progressPhotos",u);};img.src=ev.target.result;};reader.readAsDataURL(file);}
  function delPhoto(i){var u=photos.filter(function(_,j){return j!==i;});setPhotos(u);SV("progressPhotos",u);}
  useEffect(function(){if(photos.length>=2&&selB===null)setSelB(photos.length-1);},[photos]);
  return(<div style={{display:"grid",gap:"12px"}}>
    <input ref={fileRef} type="file" accept="image/*" capture="environment" onChange={addPhoto} style={{display:"none"}}/>
    <button onClick={function(){fileRef.current.click();}} style={{width:"100%",padding:"14px",borderRadius:"12px",border:"2px dashed "+C.sage,background:C.sageP,color:C.sageD,fontSize:"13px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}}>📸 {t("aggPhoto")}</button>
    {photos.length>=2&&(<div><button onClick={function(){setCompare(!compare);}} style={{width:"100%",padding:"10px",borderRadius:"10px",border:"none",background:compare?C.roseP:"linear-gradient(135deg,"+C.plum+","+C.rose+")",color:compare?C.roseD:C.white,fontSize:"12px",fontFamily:F.s,fontWeight:"600",cursor:"pointer",marginBottom:"10px"}}>{compare?"✕ "+t("chiudi"):"🔀 "+t("confronta")}</button>
    {compare&&(<Cd accent={C.plum}><div style={{display:"flex",gap:"6px",marginBottom:"10px"}}><div style={{flex:1}}><label style={lS}>Prima</label><select value={selA} onChange={function(e){setSelA(parseInt(e.target.value));}} style={Object.assign({},iS,{fontSize:"11px"})}>{photos.map(function(p,i){return<option key={i} value={i}>{fmtD(p.date)}</option>;})}</select></div><div style={{flex:1}}><label style={lS}>Dopo</label><select value={selB||0} onChange={function(e){setSelB(parseInt(e.target.value));}} style={Object.assign({},iS,{fontSize:"11px"})}>{photos.map(function(p,i){return<option key={i} value={i}>{fmtD(p.date)}</option>;})}</select></div></div>
    <div style={{position:"relative",width:"100%",height:"300px",borderRadius:"12px",overflow:"hidden",touchAction:"none"}} onPointerMove={function(e){var rect=e.currentTarget.getBoundingClientRect();var x=Math.max(0,Math.min(100,((e.clientX-rect.left)/rect.width)*100));setSliderPos(x);}} onTouchMove={function(e){var rect=e.currentTarget.getBoundingClientRect();var t=e.touches[0];var x=Math.max(0,Math.min(100,((t.clientX-rect.left)/rect.width)*100));setSliderPos(x);}}>
      <img src={photos[selB||0].data} style={{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover"}}/>
      <div style={{position:"absolute",top:0,left:0,width:sliderPos+"%",height:"100%",overflow:"hidden"}}><img src={photos[selA].data} style={{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover",minWidth:100/sliderPos*100+"%"}}/></div>
      <div style={{position:"absolute",top:0,left:sliderPos+"%",width:"3px",height:"100%",background:C.white,boxShadow:"0 0 8px rgba(0,0,0,.5)",transform:"translateX(-50%)",zIndex:2}}><div style={{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-50%)",width:"30px",height:"30px",borderRadius:"50%",background:C.white,boxShadow:"0 2px 8px rgba(0,0,0,.3)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px"}}>↔</div></div>
      <div style={{position:"absolute",top:"8px",left:"8px",padding:"3px 8px",borderRadius:"6px",background:"rgba(0,0,0,.6)",color:C.white,fontSize:"9px",fontFamily:F.s,zIndex:3}}>{t("prima")} — {fmtD(photos[selA].date)}</div>
      <div style={{position:"absolute",top:"8px",right:"8px",padding:"3px 8px",borderRadius:"6px",background:"rgba(0,0,0,.6)",color:C.white,fontSize:"9px",fontFamily:F.s,zIndex:3}}>{t("dopo")} — {fmtD(photos[selB||0].date)}</div>
    </div></Cd>)}</div>)}
    {photos.length===0&&<Info bg={C.plumP} bdr={C.plumL} color={C.plum}>Scatta una foto al mese per vedere i tuoi progressi nel tempo! Le foto restano solo sul tuo dispositivo.</Info>}
    <div style={{display:"grid",gap:"8px",gridTemplateColumns:"repeat(3,1fr)"}}>{photos.map(function(p,i){return(<div key={i} style={{position:"relative",borderRadius:"10px",overflow:"hidden",aspectRatio:"3/4"}}><img src={p.data} style={{width:"100%",height:"100%",objectFit:"cover"}}/><div style={{position:"absolute",bottom:0,left:0,right:0,background:"linear-gradient(transparent,rgba(0,0,0,.7))",padding:"4px 6px"}}><span style={{fontSize:"9px",fontFamily:F.s,color:C.white}}>{fmtD(p.date)}</span></div><button onClick={function(){delPhoto(i);}} style={{position:"absolute",top:"4px",right:"4px",width:"20px",height:"20px",borderRadius:"50%",border:"none",background:"rgba(0,0,0,.5)",color:C.white,fontSize:"11px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"}}>✕</button></div>);})}</div>
  </div>);
}

/* ═══════════ CYCLE CORRELATION ═══════════ */
var CYCLE_PHASES=[{name:LANG_STORE==="en"?"Menstrual":"Mestruale",icon:"\ud83c\udf39",color:"#e57373",days:LANG_STORE==="en"?"Days 1-5":"Giorni 1-5",hormones:LANG_STORE==="en"?"Estrogen and progesterone low":"Estrogeni e progesterone bassi",symptoms:LANG_STORE==="en"?"Cramps, fatigue, bloating, headache":"Crampi, stanchezza, gonfiore, mal di testa",gym:LANG_STORE==="en"?"Rest and gentle movement. Yoga, stretching, light walks.":"Riposo e movimento dolce. Yoga, stretching, camminate leggere.",food:LANG_STORE==="en"?"Iron-rich foods: spinach, lentils, lean red meat. Ginger for cramps. Dark chocolate 85% for magnesium.":"Cibi ricchi di ferro: spinaci, lenticchie, carne rossa magra. Zenzero per crampi. Cioccolato fondente 85% per magnesio.",pcos:LANG_STORE==="en"?"Energy is low, that's normal. Prioritize rest and avoid intense training. Warm, comforting foods help.":"L'energia e bassa, e normale. Dai priorita al riposo ed evita allenamenti intensi. Cibi caldi e confortanti aiutano."},{name:LANG_STORE==="en"?"Follicular":"Follicolare",icon:"\ud83c\udf31",color:"#81c784",days:LANG_STORE==="en"?"Days 6-13":"Giorni 6-13",hormones:LANG_STORE==="en"?"Estrogen rising, energy increasing":"Estrogeni in crescita, energia in aumento",symptoms:LANG_STORE==="en"?"High energy, positive mood, better skin":"Energia alta, umore positivo, pelle migliore",gym:LANG_STORE==="en"?"Peak performance! Heavy lifts, HIIT, progressive overload.":"Massima performance! Carichi pesanti, HIIT, sovraccarico progressivo.",food:LANG_STORE==="en"?"Protein to support follicles. Cruciferous vegetables (broccoli, cauliflower). Whole grains for energy.":"Proteine per supportare i follicoli. Verdure crucifere (broccoli, cavolfiore). Cereali integrali per energia.",pcos:LANG_STORE==="en"?"Estrogen rises, energy is high. Best time for challenging workouts and trying new recipes!":"L'estrogeno sale, l'energia e alta. Momento migliore per allenamenti sfidanti e nuove ricette!"},{name:LANG_STORE==="en"?"Ovulatory":"Ovulatoria",icon:"\u2728",color:"#ffb74d",days:LANG_STORE==="en"?"Days 14-16":"Giorni 14-16",hormones:LANG_STORE==="en"?"Estrogen and LH peak":"Picco di estrogeni e LH",symptoms:LANG_STORE==="en"?"Peak energy, high libido, glowing skin":"Massima energia, libido alta, pelle luminosa",gym:LANG_STORE==="en"?"Maximum strength and energy. Try for personal records.":"Forza ed energia al massimo. Prova per record personali.",food:LANG_STORE==="en"?"Fiber to metabolize excess estrogen. Zinc (pumpkin seeds). Omega-3 (salmon). Reduce salt.":"Fibre per metabolizzare estrogeni in eccesso. Zinco (semi di zucca). Omega-3 (salmone). Riduci sale.",pcos:LANG_STORE==="en"?"Fertility window. If tracking ovulation, BBT rises slightly. Include anti-inflammatory foods.":"Finestra di fertilita. Se monitori l'ovulazione, la BBT sale leggermente. Includi cibi anti-infiammatori."},{name:LANG_STORE==="en"?"Luteal":"Luteale",icon:"\ud83c\udf19",color:"#9575cd",days:LANG_STORE==="en"?"Days 17-28":"Giorni 17-28",hormones:LANG_STORE==="en"?"Progesterone high, then pre-menstrual drop":"Progesterone alto, poi calo pre-mestruale",symptoms:LANG_STORE==="en"?"PMS, bloating, sugar cravings, anxiety, water retention":"SPM, gonfiore, voglia di dolce, ansia, ritenzione idrica",gym:LANG_STORE==="en"?"Lower intensity. Pilates, moderate strength, steady walks.":"Intensita ridotta. Pilates, forza moderata, camminate costanti.",food:LANG_STORE==="en"?"Complex carbs for serotonin. Magnesium. Cinnamon. Dark chocolate for sweet cravings.":"Carboidrati complessi per serotonina. Magnesio. Cannella. Cioccolato fondente per voglia di dolce.",pcos:LANG_STORE==="en"?"PMS cravings are normal with PCOS. Prepare healthy snacks in advance. Magnesium and B6 help.":"Le voglie premestruali sono normali con la PCOS. Prepara snack sani in anticipo. Magnesio e B6 aiutano."}];
function getCyclePhaseNow(){
  var lp=LD("lastPeriod","");var cl=LD("cycleLen",35);
  if(!lp)return null;
  var d=Math.floor((new Date()-new Date(lp))/86400000)+1;
  if(d<=5)return{phase:0,day:d};
  if(d<=Math.floor(cl*0.46))return{phase:1,day:d};
  if(d<=Math.floor(cl*0.57))return{phase:2,day:d};
  return{phase:3,day:d};
}
var CYCLE_FOOD_TIPS=[
  ["Ferro: spinaci, lenticchie, carne rossa magra. Zenzero per crampi. Cioccolato fondente 85% per magnesio.","Cibi caldi e confortanti. Evita caffeina (peggiora i crampi). Te allo zenzero."],
  ["Proteine per supportare follicoli. Verdure crucifere (broccoli, cavolfiore). Cereali integrali per energia.","Fase ideale per provare nuove ricette! Energia alta = cucina creativa."],
  ["Fibre per metabolizzare estrogeni in eccesso. Zinco (semi di zucca). Omega-3 (salmone).","Riduci sale e cibi gonfianti. Focus su anti-infiammatori."],
  ["Carboidrati complessi per serotonina. Magnesio. Cannella. Cioccolato fondente per voglia di dolce.","La fame pre-mestruale e normale nella PCOS. Prepara snack sani in anticipo."]
];
var CYCLE_GYM_TIPS=[
  ["Yoga dolce, stretching, camminate leggere. Max 30 min. Ascolta il corpo.","Se ti senti bene, una sessione leggera va bene. Ma zero sensi di colpa se riposi."],
  ["MASSIMA intensita! Aumenta carichi, prova record personali. Forza e resistenza al top.","Approfitta di questa finestra per progressive overload. Gli estrogeni proteggono i muscoli."],
  ["Energia al massimo. HIIT, circuit training, carichi pesanti. Vai all-out!","Finestra breve (2-3 giorni): sfruttala per gli allenamenti piu intensi della settimana."],
  ["Prima meta: ancora buona energia, intensita moderata. Seconda meta: riduci, preferisci pilates e camminate.","Se ti senti gonfia, non pesarti. La ritenzione idrica maschera i progressi reali."]
];

function CycleCorrelationBanner(){
  var cp=getCyclePhaseNow();
  if(!cp)return null;
  var ph=CYCLE_PHASES[cp.phase];
  return(<Cd style={{marginBottom:"12px",background:ph.color+"08",border:"1px solid "+ph.color+"30"}}><div style={{display:"flex",gap:"8px",alignItems:"center",marginBottom:"6px"}}><span style={{fontSize:"20px"}}>{ph.icon}</span><div><span style={{fontFamily:F.s,fontSize:"12px",fontWeight:"600",color:ph.color}}>Fase {ph.name} (G{cp.day})</span></div></div><div style={{fontSize:"11px",fontFamily:F.s,color:C.txtM,lineHeight:1.5}}>{CYCLE_FOOD_TIPS[cp.phase][0]}</div></Cd>);
}
function CycleGymBanner(){
  var cp=getCyclePhaseNow();
  if(!cp)return null;
  var ph=CYCLE_PHASES[cp.phase];
  return(<Cd style={{marginBottom:"12px",background:ph.color+"08",border:"1px solid "+ph.color+"30"}}><div style={{display:"flex",gap:"8px",alignItems:"center",marginBottom:"6px"}}><span style={{fontSize:"20px"}}>{ph.icon}</span><span style={{fontFamily:F.s,fontSize:"12px",fontWeight:"600",color:ph.color}}>Fase {ph.name} — Allenamento</span></div><div style={{fontSize:"11px",fontFamily:F.s,color:C.txtM,lineHeight:1.5}}>{CYCLE_GYM_TIPS[cp.phase][0]}</div><div style={{fontSize:"10px",fontFamily:F.s,color:ph.color,marginTop:"4px",fontStyle:"italic"}}>{CYCLE_GYM_TIPS[cp.phase][1]}</div></Cd>);
}

/* ═══════════ WEEKLY INSIGHT ═══════════ */
function WeeklyInsight({profile}){
  var today=new Date();var dow=today.getDay();
  var mc=calcMacros(profile);
  var weighins=LD("weighins",DEF_W);
  var fasts=LD("fasts",[]);
  var workouts=LD("workouts",DEF_WO);
  var last=weighins.length>0?weighins[weighins.length-1]:null;
  var prev=weighins.length>1?weighins[weighins.length-2]:null;
  var weightDiff=last&&prev?(last.weight-prev.weight).toFixed(1):null;
  var bfDiff=last&&prev&&last.bf&&prev.bf?(last.bf-prev.bf).toFixed(1):null;
  var fastsThisWeek=fasts.filter(function(f){var fd=new Date(f.date);return(today-fd)<7*86400000;});
  var fastsDone=fastsThisWeek.filter(function(f){return f.completed;}).length;
  var workoutsThisWeek=workouts.filter(function(w){var wd=new Date(w.date);return(today-wd)<7*86400000;});
  var cp=getCyclePhaseNow();
  var msgs=[];
  if(weightDiff&&weightDiff<0)msgs.push("💪 Hai perso "+Math.abs(weightDiff)+"kg dall'ultima pesata!");
  else if(weightDiff&&weightDiff>0)msgs.push("📊 +"+weightDiff+"kg — potrebbe essere ritenzione idrica"+(cp&&cp.phase===3?" (fase luteale!)":"")+". Non mollare.");
  if(fastsDone>=5)msgs.push("🔥 "+fastsDone+" digiuni completati questa settimana! Streak fantastica.");
  else if(fastsDone>=3)msgs.push("⏳ "+fastsDone+" digiuni completati. Buon ritmo, punta a 5+!");
  if(workoutsThisWeek.length>=4)msgs.push("🏋️ "+workoutsThisWeek.length+" allenamenti! Stai costruendo massa muscolare.");
  else if(workoutsThisWeek.length>=2)msgs.push("🏋️ "+workoutsThisWeek.length+" allenamenti. Prova ad aggiungerne uno in piu!");
  if(last&&last.weight>profile.goalW){var remaining=(last.weight-profile.goalW).toFixed(1);var weeks=Math.round(remaining/0.5);msgs.push("🎯 Ti mancano ~"+remaining+"kg al tuo obiettivo. A 0.5kg/sett = ~"+weeks+" settimane.");}
  if(cp)msgs.push(CYCLE_PHASES[cp.phase].icon+" Sei in fase "+CYCLE_PHASES[cp.phase].name+": "+CYCLE_PHASES[cp.phase].gym.split(".")[0]+".");
  if(msgs.length===0)msgs.push("🌸 Questa settimana e un foglio bianco. Inizia col piede giusto!");
  return(<Cd accent={C.sage} style={{marginBottom:"16px",background:"linear-gradient(135deg,"+C.sageP+","+C.white+")"}}><div style={{display:"flex",gap:"8px",alignItems:"center",marginBottom:"10px"}}><span style={{fontSize:"20px"}}>📋</span><h4 style={{fontFamily:F.p,fontSize:"14px",fontWeight:"600",color:C.sageD,margin:0}}>Insight Settimanale</h4></div><div style={{display:"grid",gap:"6px"}}>{msgs.map(function(m,i){return(<div key={i} style={{fontSize:"12px",fontFamily:F.s,color:C.txt,lineHeight:1.5,padding:"6px 8px",borderRadius:"8px",background:C.white}}>{m}</div>);})}</div></Cd>);
}

/* ═══════════ EXPORT CSV ═══════════ */
function ExportData(){
  function exportCSV(name,headers,rows){var csv=headers.join(";")+"\n";rows.forEach(function(r){csv+=r.join(";")+"\n";});var blob=new Blob(["\uFEFF"+csv],{type:"text/csv;charset=utf-8;"});var url=URL.createObjectURL(blob);var a=document.createElement("a");a.href=url;a.download=name+".csv";a.click();URL.revokeObjectURL(url);}
  function expWeight(){var w=LD("weighins",DEF_W);exportCSV("pcos_pesate",["Data","Peso_kg","BodyFat_%","Muscolo_%","Ossa_kg","Acqua_%"],w.map(function(r){return[r.date,r.weight,r.bf,r.mm,r.bm,r.bw];}));}
  function expWorkouts(){var w=LD("workouts",[]);exportCSV("pcos_allenamenti",["Data","Tipo","Durata_min","Calorie","FC_media"],w.map(function(r){return[r.date,r.type,r.duration,r.calories,r.hr];}));}
  function expFasts(){var f=LD("fasts",[]);exportCSV("pcos_digiuni",["Data","Obiettivo_h","Effettivo_h","Completato","Inizio"],f.map(function(r){return[r.date,r.goal,r.actual,r.completed?"Si":"No",r.startTime||""];}));}
  function expGym(){var logs=LD("gymLogs",{});var rows=[];Object.keys(logs).forEach(function(k){logs[k].forEach(function(e){rows.push([e.date,k,e.weight,e.reps]);});});exportCSV("pcos_carichi",["Data","Esercizio","Peso_kg","Reps"],rows);}
  function expAll(){expWeight();setTimeout(expWorkouts,500);setTimeout(expFasts,1000);setTimeout(expGym,1500);}
  return(<div style={{display:"grid",gap:"10px"}}>
    <Info bg={C.sageP} bdr={C.sageL} color={C.sageD}>📁 Esporta i tuoi dati in formato CSV per condividerli con il tuo nutrizionista, endocrinologo o ginecologo.</Info>
    {[{l:"📊 Storico Pesate",d:"Peso, BF%, muscolo, ossa, acqua",fn:expWeight,c:C.sage},
    {l:"🏋️ Allenamenti",d:"Tipo, durata, calorie, FC media",fn:expWorkouts,c:C.rose},
    {l:"⏳ Digiuni",d:"Obiettivo, effettivo, completamento",fn:expFasts,c:C.plum},
    {l:"💪 Carichi Palestra",d:"Esercizio, peso, reps per data",fn:expGym,c:C.amber}
    ].map(function(ex,i){return(<button key={i} onClick={ex.fn} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"14px",borderRadius:"12px",border:"1px solid "+C.bdr,background:C.white,cursor:"pointer",textAlign:"left"}}><div><div style={{fontFamily:F.s,fontSize:"13px",fontWeight:"600",color:C.txt}}>{ex.l}</div><div style={{fontFamily:F.s,fontSize:"10px",color:C.txtL}}>{ex.d}</div></div><span style={{padding:"6px 12px",borderRadius:"8px",background:ex.c,color:C.white,fontSize:"11px",fontFamily:F.s,fontWeight:"600"}}>CSV ↓</span></button>);})}
    <button onClick={expAll} style={{width:"100%",padding:"14px",borderRadius:"12px",border:"none",background:"linear-gradient(135deg,"+C.sage+","+C.plum+")",color:C.white,fontSize:"14px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}}>📦 Scarica TUTTO (4 file CSV)</button>
  </div>);
}

/* ═══════════ MEDICAL DASHBOARD ═══════════ */
function MedicalDashboard(){
  const[bloods,setBloods]=useState(function(){return LD("bloodwork",[]);});
  const[showAdd,setShowAdd]=useState(false);
  const[form,setForm]=useState({date:todayK(),insulina:"",homaIR:"",testosterone:"",dheas:"",tsh:"",vitD:"",ferritina:"",glicemia:""});
  var markers=[
    {k:"insulina",l:"Insulina basale",u:"μU/mL",range:"2-25",ideal:"<10",warn:"Nella PCOS spesso elevata. <10 = ottimo"},
    {k:"homaIR",l:"HOMA-IR",u:"",range:"0.5-2.5",ideal:"<1.5",warn:"Indice di insulino-resistenza. >2.5 = resistenza"},
    {k:"testosterone",l:"Testosterone totale",u:"ng/dL",range:"15-70",ideal:"<50",warn:"Spesso elevato nella PCOS. Causa acne e irsutismo"},
    {k:"dheas",l:"DHEA-S",u:"μg/dL",range:"35-430",ideal:"<300",warn:"Androgeno surrenalico. Elevato nel 25% delle PCOS"},
    {k:"tsh",l:"TSH",u:"μUI/mL",range:"0.4-4.0",ideal:"1-2.5",warn:"Tiroide. Nella PCOS controllare sempre la funzione tiroidea"},
    {k:"vitD",l:"Vitamina D",u:"ng/mL",range:"30-100",ideal:">40",warn:"Carente nell'80% delle PCOS. Target 40-60"},
    {k:"ferritina",l:"Ferritina",u:"ng/mL",range:"12-150",ideal:">30",warn:"Depositi di ferro. Controllare se ciclo abbondante"},
    {k:"glicemia",l:"Glicemia a digiuno",u:"mg/dL",range:"70-100",ideal:"<90",warn:"Pre-diabete se 100-125. Diabete se >126"},
  ];
  function addBlood(){var entry={date:form.date};markers.forEach(function(m){if(form[m.k])entry[m.k]=parseFloat(form[m.k]);});var u=[entry].concat(bloods).slice(0,20);setBloods(u);SV("bloodwork",u);setShowAdd(false);setForm({date:todayK(),insulina:"",homaIR:"",testosterone:"",dheas:"",tsh:"",vitD:"",ferritina:"",glicemia:""});}
  function delBlood(i){var u=bloods.filter(function(_,j){return j!==i;});setBloods(u);SV("bloodwork",u);}
  var latest=bloods.length>0?bloods[0]:null;
  return(<div style={{display:"grid",gap:"12px"}}>
    <Info bg={C.berryP} bdr={C.berryL} color={C.berry}><strong>Dashboard Medica PCOS.</strong> Inserisci i valori delle tue analisi del sangue per monitorare l'andamento nel tempo. Porta questi dati al tuo medico.</Info>
    <button onClick={function(){setShowAdd(!showAdd);}} style={{width:"100%",padding:"12px",borderRadius:"12px",border:"none",background:showAdd?C.roseP:"linear-gradient(135deg,"+C.berry+","+C.rose+")",color:showAdd?C.roseD:C.white,fontSize:"13px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}}>{showAdd?"✕ Chiudi":"🩸 Inserisci Analisi del Sangue"}</button>
    {showAdd&&(<Cd accent={C.berry}><div style={{display:"grid",gap:"8px"}}><div><label style={lS}>Data analisi</label><input type="date" value={form.date} onChange={function(e){setForm(Object.assign({},form,{date:e.target.value}));}} style={iS}/></div><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px"}}>{markers.map(function(m){return(<div key={m.k}><label style={lS}>{m.l} ({m.u||m.range})</label><input type="number" step="0.1" placeholder={m.ideal} value={form[m.k]} onChange={function(e){var u=Object.assign({},form);u[m.k]=e.target.value;setForm(u);}} style={iS}/></div>);})}</div><button onClick={addBlood} style={{width:"100%",padding:"11px",borderRadius:"12px",border:"none",background:C.berry,color:C.white,fontSize:"13px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}}>Salva Analisi</button></div></Cd>)}
    {latest&&(<Cd accent={C.plum}><h4 style={{fontFamily:F.p,fontSize:"14px",margin:"0 0 10px",color:C.txt}}>Ultimo Prelievo — {fmtD(latest.date)}</h4><div style={{display:"grid",gap:"6px"}}>{markers.map(function(m){var v=latest[m.k];if(!v)return null;var numV=parseFloat(v);var idealParts=m.ideal.replace(/[<>]/g,"").trim();var idealNum=parseFloat(idealParts);var isGood=m.ideal.startsWith("<")?numV<idealNum:m.ideal.startsWith(">")?numV>idealNum:numV>=idealNum*0.8&&numV<=idealNum*1.2;return(<div key={m.k} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px",borderRadius:"8px",background:isGood?C.sageP:C.roseP}}><div><div style={{fontFamily:F.s,fontSize:"12px",fontWeight:"600",color:C.txt}}>{m.l}</div><div style={{fontFamily:F.s,fontSize:"9px",color:C.txtL}}>Range: {m.range} | Ideale: {m.ideal}</div></div><div style={{textAlign:"right"}}><div style={{fontFamily:F.s,fontSize:"16px",fontWeight:"700",color:isGood?C.sage:C.rose}}>{v} <span style={{fontSize:"10px",fontWeight:"400"}}>{m.u}</span></div><span style={{fontSize:"10px"}}>{isGood?"✅":"⚠️"}</span></div></div>);})}</div></Cd>)}
    {bloods.length>1&&(<Cd><h4 style={{fontFamily:F.p,fontSize:"14px",margin:"0 0 10px",color:C.txt}}>📈 Trend Valori</h4>{markers.filter(function(m){return bloods.filter(function(b){return b[m.k];}).length>1;}).slice(0,4).map(function(m){var vals=bloods.filter(function(b){return b[m.k];}).slice(0,8).reverse();return(<div key={m.k} style={{marginBottom:"12px"}}><span style={{fontSize:"11px",fontFamily:F.s,fontWeight:"600",color:C.txt}}>{m.l}</span><div style={{display:"flex",alignItems:"flex-end",gap:"3px",height:"50px",marginTop:"4px"}}>{vals.map(function(v,i){var allV=vals.map(function(x){return x[m.k];});var mn=Math.min.apply(null,allV)-1;var mx=Math.max.apply(null,allV)+1;var h=((v[m.k]-mn)/(mx-mn))*100;var il=i===vals.length-1;return(<div key={i} style={{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:"1px"}}><span style={{fontSize:"7px",fontFamily:F.s,color:il?C.plum:C.txtL}}>{v[m.k]}</span><div style={{width:"100%",maxWidth:"20px",height:Math.max(h,5)+"%",borderRadius:"3px",background:il?C.plum:C.plumL}}/></div>);})}</div></div>);})}</Cd>)}
    {bloods.length>0&&(<Cd><h4 style={{fontFamily:F.p,fontSize:"13px",margin:"0 0 8px",color:C.txt}}>Storico Analisi</h4><div style={{display:"grid",gap:"4px"}}>{bloods.map(function(b,i){var count=markers.filter(function(m){return b[m.k];}).length;return(<div key={i} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 10px",borderRadius:"8px",background:C.bg}}><span style={{fontSize:"12px",fontFamily:F.s,fontWeight:"600",color:C.txt}}>{fmtD(b.date)}</span><div style={{display:"flex",gap:"6px",alignItems:"center"}}><Pill color={C.plum}>{count} valori</Pill><button onClick={function(){delBlood(i);}} style={{background:"none",border:"none",color:C.txtL,cursor:"pointer",fontSize:"12px"}}>✕</button></div></div>);})}</div></Cd>)}
  </div>);
}


/* PHASE 6: SMART TRACKING */
var SYMPTOMS_DEF=[
{k:"acne",l:"Acne",i:"\ud83d\udd34",lEN:"Acne"},
{k:"bloat",l:"Gonfiore",i:"\ud83e\udee7",lEN:"Bloating"},
{k:"hairloss",l:"Caduta capelli",i:"\ud83d\udc87\u200d\u2640\ufe0f",lEN:"Hair Loss"},
{k:"energy",l:"Energia",i:"\u26a1",lEN:"Energy"},
{k:"mood",l:"Umore",i:"\ud83d\ude0a",lEN:"Mood"},
{k:"cravings",l:"Voglie",i:"\ud83c\udf6b",lEN:"Cravings"},
{k:"headache",l:"Mal di testa",i:"\ud83e\udd15",lEN:"Headache"},
{k:"sleep_q",l:"Qualita sonno",i:"\ud83d\ude34",lEN:"Sleep Quality"},
{k:"anxiety",l:"Ansia",i:"\ud83d\ude30",lEN:"Anxiety"},
{k:"pain",l:"Dolore pelvico",i:"\ud83e\ude79",lEN:"Pelvic Pain"}
];var HABIT_DEFS=[
{k:"water_ok",l:"Acqua 2L+",i:"\ud83d\udca7",lEN:"Water 2L+"},
{k:"workout_ok",l:"Allenamento",i:"\ud83c\udfcb\ufe0f",lEN:"Workout"},
{k:"sleep_ok",l:"Sonno 7h+",i:"\ud83c\udf19",lEN:"Sleep 7h+"},
{k:"if_ok",l:"IF completato",i:"\u23f3",lEN:"IF done"},
{k:"vegs_ok",l:"Verdure",i:"\ud83e\udd66",lEN:"Veggies"},
{k:"supps_ok",l:"Integratori",i:"\ud83d\udc8a",lEN:"Supplements"},
{k:"steps_ok",l:"8000+ passi",i:"\ud83d\udc5f",lEN:"8000+ steps"},
{k:"nosugar_ok",l:"No zuccheri",i:"\ud83d\udeab",lEN:"No sugar"}
];
var DAILY_CHALLENGES=[
"Cammina 20 min dopo pranzo per abbassare la glicemia","Aggiungi semi di zucca al pranzo (zinco!)","Bevi 3 tazze di te verde oggi","Inizia il pasto con verdure crude abbondanti","Prova 5 min di box breathing prima di dormire","Sostituisci il latte vaccino con latte di mandorla oggi","Fai 10 min di stretching appena sveglia","Prepara snack PCOS-friendly: mandorle + cioccolato fondente","Bevi acqua appena sveglia, prima del caffe","Prova mindful eating senza telefono","Aggiungi cannella allo yogurt (migliora insulino-sensibilita)","Vai a letto 30 min prima stasera","Fai una camminata nella natura di 15 min","Prepara hummus fatto in casa","Prova colazione salata oggi","Scrivi 3 cose per cui sei grata - riduce cortisolo","Sostituisci gallette riso con pane di segale","Aggiungi avocado a un pasto oggi","Prendi le scale tutto il giorno","Prepara un'insalata con 5+ ingredienti"
];
function getDailyChallenge(){var day=Math.floor(Date.now()/86400000);return DAILY_CHALLENGES[day%DAILY_CHALLENGES.length];}
function SymptomTracker(){
  var _s1=useState(function(){return LD("symptoms",[]);}),log=_s1[0],setLog=_s1[1];
  var _s2=useState(function(){var ex=log.find(function(e){return e.date===todayK();});return ex?ex.vals:{};}),today=_s2[0],setToday=_s2[1];
  function rate(k,v){var u=Object.assign({},today);u[k]=v;setToday(u);var entry={date:todayK(),vals:u};var nl=log.filter(function(e){return e.date!==todayK();}).concat([entry]);nl.sort(function(a,b){return b.date.localeCompare(a.date);});setLog(nl);SV("symptoms",nl);}
  var last7=log.slice(0,7).reverse();
  return React.createElement("div",{style:{display:"grid",gap:"10px"}},
    React.createElement(Cd,null,
      React.createElement("h5",{style:{fontFamily:F.s,fontSize:"12px",fontWeight:"600",margin:"0 0 10px",color:C.plum}},LANG_STORE==="en"?"Today's Symptoms":"Sintomi di Oggi"," \u2014 ",fmtD(todayK())),
      SYMPTOMS_DEF.map(function(s){return React.createElement("div",{key:s.k,style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"}},
        React.createElement("span",{style:{fontSize:"14px",width:"22px"}},s.i),
        React.createElement("span",{style:{fontSize:"11px",fontFamily:F.s,flex:1,color:C.txt}},LANG_STORE==="en"?s.lEN:s.l),
        React.createElement("div",{style:{display:"flex",gap:"3px"}},[1,2,3,4,5].map(function(v){return React.createElement("button",{key:v,onClick:function(){rate(s.k,v);},style:{width:"26px",height:"26px",borderRadius:"50%",border:"1.5px solid "+(today[s.k]>=v?C.plum:C.bdr),background:today[s.k]>=v?"linear-gradient(135deg,"+C.plum+","+C.rose+")":C.white,color:today[s.k]>=v?C.white:C.txtL,fontSize:"10px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}},""+v);}))
      );})
    ),
    last7.length>1&&React.createElement(Cd,null,
      React.createElement("h5",{style:{fontFamily:F.s,fontSize:"11px",fontWeight:"600",margin:"0 0 8px",color:C.sageD}},LANG_STORE==="en"?"7-Day Trend":"Trend 7 Giorni"),
      SYMPTOMS_DEF.slice(0,5).map(function(s){return React.createElement("div",{key:s.k,style:{display:"flex",alignItems:"center",gap:"6px",marginBottom:"4px"}},
        React.createElement("span",{style:{fontSize:"11px",width:"20px"}},s.i),
        React.createElement("div",{style:{flex:1,display:"flex",gap:"2px"}},last7.map(function(d,i){var v=d.vals[s.k]||0;var colors=["#e8e8e8",C.sageP,C.sage,C.plumL,C.plum,C.rose];return React.createElement("div",{key:i,style:{flex:1,height:"14px",borderRadius:"3px",background:colors[v],transition:"all .3s"},title:fmtD(d.date)+": "+v+"/5"});}))
      );})
    )
  );
}
function BodyMeasurements(){
  var _s1=useState(function(){return LD("bodyMeas",[]);}),data=_s1[0],setData=_s1[1];
  var _s2=useState({waist:"",hips:"",thigh:"",arm:""}),form=_s2[0],setForm=_s2[1];
  function save(){if(!form.waist)return;var entry=Object.assign({date:todayK()},form);var u=[entry].concat(data.filter(function(e){return e.date!==todayK();})).slice(0,100);setData(u);SV("bodyMeas",u);setForm({waist:"",hips:"",arm:"",thigh:""});}
  var latest=data[0];var whr=latest&&latest.waist&&latest.hips?(parseFloat(latest.waist)/parseFloat(latest.hips)).toFixed(2):null;
  var whrRisk=whr?(parseFloat(whr)>0.85?"\u26a0\ufe0f "+(LANG_STORE==="en"?"High risk":"Rischio alto"):"\u2705 "+(LANG_STORE==="en"?"Normal":"Normale")):null;
  return React.createElement("div",{style:{display:"grid",gap:"10px"}},
    React.createElement(Cd,null,
      React.createElement("h5",{style:{fontFamily:F.s,fontSize:"12px",fontWeight:"600",margin:"0 0 8px",color:C.plum}},LANG_STORE==="en"?"Add Measurements (cm)":"Aggiungi Misure (cm)"),
      React.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"6px"}},
        React.createElement("div",null,React.createElement("label",{style:lS},LANG_STORE==="en"?"Waist":"Vita"),React.createElement("input",{type:"number",value:form.waist,onChange:function(e){setForm(Object.assign({},form,{waist:e.target.value}));},placeholder:"cm",style:iS})),
        React.createElement("div",null,React.createElement("label",{style:lS},LANG_STORE==="en"?"Hips":"Fianchi"),React.createElement("input",{type:"number",value:form.hips,onChange:function(e){setForm(Object.assign({},form,{hips:e.target.value}));},placeholder:"cm",style:iS})),
        React.createElement("div",null,React.createElement("label",{style:lS},LANG_STORE==="en"?"Thigh":"Coscia"),React.createElement("input",{type:"number",value:form.thigh,onChange:function(e){setForm(Object.assign({},form,{thigh:e.target.value}));},placeholder:"cm",style:iS})),
        React.createElement("div",null,React.createElement("label",{style:lS},LANG_STORE==="en"?"Arm":"Braccio"),React.createElement("input",{type:"number",value:form.arm,onChange:function(e){setForm(Object.assign({},form,{arm:e.target.value}));},placeholder:"cm",style:iS}))
      ),
      React.createElement("button",{onClick:save,disabled:!form.waist,style:{padding:"10px",borderRadius:"10px",border:"none",background:!form.waist?C.bdr:"linear-gradient(135deg,"+C.sage+","+C.sageD+")",color:C.white,fontSize:"12px",fontFamily:F.s,fontWeight:"600",cursor:"pointer",marginTop:"4px"}},LANG_STORE==="en"?"Save":"Salva")
    ),
    whr&&React.createElement(Cd,{style:{background:"linear-gradient(135deg,"+C.plumP+","+C.roseP+")"}},
      React.createElement("h5",{style:{fontFamily:F.s,fontSize:"11px",fontWeight:"600",margin:"0 0 4px",color:C.plum}},LANG_STORE==="en"?"Waist/Hip Ratio":"Rapporto Vita/Fianchi"),
      React.createElement("div",{style:{display:"flex",alignItems:"baseline",gap:"8px"}},React.createElement("span",{style:{fontSize:"22px",fontFamily:F.p,fontWeight:"700",color:C.plum}},whr),React.createElement("span",{style:{fontSize:"11px",fontFamily:F.s,color:C.txtM}},whrRisk)),
      React.createElement("p",{style:{fontSize:"9px",fontFamily:F.s,color:C.txtL,margin:"4px 0 0"}},LANG_STORE==="en"?"WHR > 0.85 = higher insulin resistance risk":"WHR > 0.85 = rischio maggiore insulino-resistenza")
    ),
    data.length>0&&React.createElement(Cd,null,
      React.createElement("h5",{style:{fontFamily:F.s,fontSize:"11px",fontWeight:"600",margin:"0 0 6px",color:C.sageD}},LANG_STORE==="en"?"History":"Storico"),
      data.slice(0,8).map(function(e,i){return React.createElement("div",{key:i,style:{display:"flex",justifyContent:"space-between",padding:"4px 0",borderBottom:"1px solid "+C.bdr,fontSize:"10px",fontFamily:F.s}},React.createElement("span",{style:{color:C.txtM}},fmtD(e.date)),React.createElement("span",null,(LANG_STORE==="en"?"W":"V")+":"+e.waist+" | "+(LANG_STORE==="en"?"H":"F")+":"+(e.hips||"-")+" | "+(LANG_STORE==="en"?"T":"C")+":"+(e.thigh||"-")));})
    )
  );
}
function HabitStreaks(){
  var _s1=useState(function(){return LD("habits",{});}),habits=_s1[0],setHabits=_s1[1];
  var dk=todayK();var todayH=habits[dk]||{};
  function toggleHabit(k){var u=Object.assign({},habits);var td=Object.assign({},todayH);td[k]=!td[k];u[dk]=td;setHabits(u);SV("habits",u);}
  function getStreak(k){var streak=0;var d=new Date();for(var i=0;i<365;i++){var key=d.toISOString().slice(0,10);if(habits[key]&&habits[key][k])streak++;else if(i>0)break;d.setDate(d.getDate()-1);}return streak;}
  function getBestStreak(k){var best=0,cur=0;var d=new Date();for(var i=0;i<365;i++){var key=d.toISOString().slice(0,10);if(habits[key]&&habits[key][k]){cur++;if(cur>best)best=cur;}else cur=0;d.setDate(d.getDate()-1);}return best;}
  var totalToday=HABIT_DEFS.filter(function(h){return todayH[h.k];}).length;
  return React.createElement("div",{style:{display:"grid",gap:"10px"}},
    React.createElement(Cd,{style:{background:"linear-gradient(135deg,"+C.sageP+","+C.plumP+")"}},
      React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},
        React.createElement("div",null,React.createElement("h5",{style:{fontFamily:F.s,fontSize:"12px",fontWeight:"600",margin:0,color:C.sageD}},LANG_STORE==="en"?"Today":"Oggi"),React.createElement("p",{style:{fontSize:"10px",fontFamily:F.s,color:C.txtM,margin:"2px 0 0"}},totalToday+"/"+HABIT_DEFS.length+" "+(LANG_STORE==="en"?"completed":"completate"))),
        React.createElement("div",{style:{width:"50px",height:"50px",borderRadius:"50%",background:"conic-gradient("+C.sage+" "+(totalToday/HABIT_DEFS.length*360)+"deg, "+C.bdr+" 0deg)",display:"flex",alignItems:"center",justifyContent:"center"}},React.createElement("div",{style:{width:"38px",height:"38px",borderRadius:"50%",background:C.white,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"13px",fontWeight:"700",fontFamily:F.s,color:C.sageD}},Math.round(totalToday/HABIT_DEFS.length*100)+"%"))
      )
    ),
    HABIT_DEFS.map(function(h){var streak=getStreak(h.k);var best=getBestStreak(h.k);var done=todayH[h.k];
      return React.createElement(Cd,{key:h.k,onClick:function(){toggleHabit(h.k);},style:{cursor:"pointer",border:"1.5px solid "+(done?C.sage:C.bdr),background:done?C.sageP:C.white,transition:"all .2s"}},
        React.createElement("div",{style:{display:"flex",alignItems:"center",gap:"10px"}},
          React.createElement("span",{style:{fontSize:"20px"}},h.i),
          React.createElement("div",{style:{flex:1}},
            React.createElement("span",{style:{fontSize:"12px",fontFamily:F.s,fontWeight:"600",color:done?C.sageD:C.txt}},LANG_STORE==="en"?h.lEN:h.l),
            React.createElement("div",{style:{display:"flex",gap:"10px",marginTop:"2px"}},
              React.createElement("span",{style:{fontSize:"9px",fontFamily:F.s,color:C.txtL}},"\ud83d\udd25 "+streak+" "+(LANG_STORE==="en"?"days":"gg")),
              React.createElement("span",{style:{fontSize:"9px",fontFamily:F.s,color:C.txtL}},"\ud83c\udfc6 "+(LANG_STORE==="en"?"best":"record")+": "+best)
            )
          ),
          React.createElement("div",{style:{width:"28px",height:"28px",borderRadius:"50%",border:"2px solid "+(done?C.sage:C.bdr),background:done?C.sage:C.white,display:"flex",alignItems:"center",justifyContent:"center"}},done&&React.createElement("span",{style:{color:C.white,fontSize:"14px"}},"\u2713"))
        )
      );
    })
  );
}
function SmartTracking(){
  var _s=useState("symptoms"),sub=_s[0],setSub=_s[1];
  return React.createElement("div",null,
    React.createElement(SecH,{title:LANG_STORE==="en"?"Smart Tracking":"Tracking Avanzato",sub:LANG_STORE==="en"?"Symptoms, body, habits":"Sintomi, corpo, abitudini"}),
    React.createElement(SubT,{tabs:[{k:"symptoms",l:LANG_STORE==="en"?"Symptoms":"Sintomi",i:"\ud83d\udccb"},{k:"body",l:LANG_STORE==="en"?"Body":"Corpo",i:"\ud83d\udccf"},{k:"habits",l:LANG_STORE==="en"?"Habits":"Abitudini",i:"\ud83d\udd25"}],active:sub,onSel:setSub}),
    sub==="symptoms"&&React.createElement(SymptomTracker,null),
    sub==="body"&&React.createElement(BodyMeasurements,null),
    sub==="habits"&&React.createElement(HabitStreaks,null)
  );
}
/* PHASE 7: MEAL INTELLIGENCE */
var PCOS_MEALS={follicular:{breakfast:[{n:"Uova strapazzate + avocado + pane di segale",p:28,c:30,f:22,gl:"\ud83d\udfe2"},{n:"Porridge avena + frutti di bosco + mandorle",p:15,c:42,f:18,gl:"\ud83d\udfe2"},{n:"Pancake grano saraceno + burro arachidi",p:18,c:38,f:16,gl:"\ud83d\udfe1"},{n:"Smoothie: spinaci + proteine + avocado",p:25,c:15,f:20,gl:"\ud83d\udfe2"}],lunch:[{n:"Quinoa + ceci + verdure grigliate + feta",p:22,c:40,f:18,gl:"\ud83d\udfe2"},{n:"Salmone al forno + broccoli + riso integrale",p:35,c:38,f:16,gl:"\ud83d\udfe2"},{n:"Lenticchie + spinaci + avocado + uovo",p:28,c:32,f:22,gl:"\ud83d\udfe2"},{n:"Pollo griglia + insalata mista + farro",p:38,c:35,f:12,gl:"\ud83d\udfe2"}],dinner:[{n:"Merluzzo + zucchine grigliate + patata dolce",p:32,c:28,f:10,gl:"\ud83d\udfe2"},{n:"Frittata 3 uova + spinaci + funghi",p:26,c:8,f:20,gl:"\ud83d\udfe2"},{n:"Tacchino + cavolfiore arrosto + hummus",p:34,c:18,f:14,gl:"\ud83d\udfe2"},{n:"Zuppa lenticchie + verdure + crostino integrale",p:20,c:35,f:8,gl:"\ud83d\udfe2"}],snack:[{n:"Mandorle 30g + cioccolato fondente 85%",p:8,c:12,f:18,gl:"\ud83d\udfe2"},{n:"Hummus + bastoncini sedano e carota",p:6,c:12,f:8,gl:"\ud83d\udfe2"},{n:"Yogurt greco intero + noci + cannella",p:12,c:10,f:14,gl:"\ud83d\udfe1"},{n:"Mela + burro di mandorle",p:4,c:18,f:10,gl:"\ud83d\udfe1"}]}};
PCOS_MEALS.luteal=JSON.parse(JSON.stringify(PCOS_MEALS.follicular));
PCOS_MEALS.luteal.breakfast.push({n:"Toast integrale + avocado + salmone affumicato",p:22,c:28,f:18,gl:"\ud83d\udfe2"});
PCOS_MEALS.luteal.dinner.push({n:"Pasta integrale + ragu lenticchie + parmigiano",p:24,c:45,f:12,gl:"\ud83d\udfe1"});
PCOS_MEALS.ovulatory=PCOS_MEALS.follicular;
PCOS_MEALS.menstrual=JSON.parse(JSON.stringify(PCOS_MEALS.follicular));
PCOS_MEALS.menstrual.lunch.push({n:"Stufato di manzo + spinaci + lenticchie (ferro!)",p:35,c:28,f:14,gl:"\ud83d\udfe2"});
function MealPlanner(props){
  var profile=props.profile;
  var _s=useState(function(){return LD("mealPlan",null);}),plan=_s[0],setPlan=_s[1];
  var cp=getCyclePhaseNow();var phase=cp?cp.phase:"follicular";var meals=PCOS_MEALS[phase]||PCOS_MEALS.follicular;
  function pick(arr){return arr[Math.floor(Math.random()*arr.length)];}
  function generate(){var week=[];for(var i=0;i<7;i++){var d=new Date();d.setDate(d.getDate()+i);week.push({date:d.toISOString().slice(0,10),b:pick(meals.breakfast),l:pick(meals.lunch),d:pick(meals.dinner),s:pick(meals.snack)});}setPlan(week);SV("mealPlan",week);}
  var DI=["Dom","Lun","Mar","Mer","Gio","Ven","Sab"],DE=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
  return React.createElement("div",{style:{display:"grid",gap:"10px"}},
    React.createElement(Cd,{style:{background:"linear-gradient(135deg,"+C.sageP+","+C.plumP+")",textAlign:"center"}},
      React.createElement("p",{style:{fontSize:"10px",fontFamily:F.s,color:C.txtM,margin:"0 0 6px"}},(LANG_STORE==="en"?"Cycle phase":"Fase ciclo")+": ",React.createElement("strong",null,phase)),
      React.createElement("button",{onClick:generate,style:{padding:"12px 24px",borderRadius:"12px",border:"none",background:"linear-gradient(135deg,"+C.sage+","+C.sageD+")",color:C.white,fontSize:"13px",fontFamily:F.s,fontWeight:"700",cursor:"pointer"}},LANG_STORE==="en"?"\ud83d\udd04 Generate Weekly Plan":"\ud83d\udd04 Genera Piano Settimanale")
    ),
    plan&&plan.map(function(day,i){var dd=new Date(day.date);var dn=LANG_STORE==="en"?DE[dd.getDay()]:DI[dd.getDay()];
      return React.createElement(Cd,{key:i},
        React.createElement("h5",{style:{fontFamily:F.s,fontSize:"11px",fontWeight:"700",color:C.plum,margin:"0 0 6px"}},dn+" "+fmtD(day.date)),
        [{k:"b",l:LANG_STORE==="en"?"Breakfast":"Colazione",ic:"\ud83c\udf05"},{k:"l",l:LANG_STORE==="en"?"Lunch":"Pranzo",ic:"\u2600\ufe0f"},{k:"d",l:LANG_STORE==="en"?"Dinner":"Cena",ic:"\ud83c\udf19"},{k:"s",l:"Snack",ic:"\ud83c\udf4e"}].map(function(m){var ml=day[m.k];return React.createElement("div",{key:m.k,style:{display:"flex",gap:"6px",marginBottom:"4px",alignItems:"flex-start"}},React.createElement("span",{style:{fontSize:"12px"}},m.ic),React.createElement("div",{style:{flex:1}},React.createElement("span",{style:{fontSize:"11px",fontFamily:F.s,fontWeight:"600",color:C.txt}},ml.n),React.createElement("div",{style:{fontSize:"9px",fontFamily:F.s,color:C.txtL,marginTop:"1px"}},"P:"+ml.p+"g C:"+ml.c+"g F:"+ml.f+"g | GL:"+ml.gl)));})
      );
    })
  );
}
var GL_DB=[{n:"Riso bianco",gi:73,c:28},{n:"Riso integrale",gi:50,c:23},{n:"Pasta bianca",gi:55,c:25},{n:"Pasta integrale",gi:42,c:26},{n:"Pane bianco",gi:75,c:49},{n:"Pane segale integrale",gi:41,c:46},{n:"Quinoa",gi:35,c:21},{n:"Farro",gi:40,c:27},{n:"Avena fiocchi",gi:42,c:12},{n:"Grano saraceno",gi:34,c:20},{n:"Patata",gi:78,c:17},{n:"Patata dolce",gi:44,c:20},{n:"Lenticchie",gi:25,c:20},{n:"Ceci",gi:28,c:27},{n:"Fagioli",gi:24,c:22},{n:"Mela",gi:36,c:14},{n:"Banana",gi:51,c:23},{n:"Frutti di bosco",gi:25,c:12},{n:"Gallette riso",gi:87,c:81},{n:"Cioccolato fond. 85%",gi:23,c:46},{n:"Miele",gi:61,c:82},{n:"Zucchero",gi:65,c:100}];
function GLCalculator(){
  var _s1=useState([]),items=_s1[0],setItems=_s1[1];
  var _s2=useState(""),search=_s2[0],setSearch=_s2[1];
  var filtered=search.length>=2?GL_DB.filter(function(f){return f.n.toLowerCase().includes(search.toLowerCase());}):[];
  function addItem(food){setItems(items.concat([{food:food,grams:100}]));setSearch("");}
  function setGrams(i,g){var u=items.slice();u[i]=Object.assign({},u[i],{grams:parseInt(g)||0});setItems(u);}
  function removeItem(i){setItems(items.filter(function(_,j){return j!==i;}));}
  var totalGL=items.reduce(function(sum,it){return sum+(it.food.gi*it.food.c*it.grams/100/100);},0);
  var glColor=totalGL<10?C.sage:totalGL<20?C.plum:C.rose;
  var glLabel=totalGL<10?(LANG_STORE==="en"?"Low - Excellent for PCOS":"Basso - Ottimo per PCOS"):totalGL<20?(LANG_STORE==="en"?"Medium - OK with protein":"Medio - OK con proteine"):(LANG_STORE==="en"?"High - Add fiber!":"Alto - Aggiungi fibra!");
  return React.createElement("div",{style:{display:"grid",gap:"10px"}},
    React.createElement(Cd,null,
      React.createElement("h5",{style:{fontFamily:F.s,fontSize:"12px",fontWeight:"600",margin:"0 0 8px",color:C.plum}},LANG_STORE==="en"?"Glycemic Load Calculator":"Calcolatore Carico Glicemico"),
      React.createElement("input",{value:search,onChange:function(e){setSearch(e.target.value);},placeholder:LANG_STORE==="en"?"Search food...":"Cerca alimento...",style:Object.assign({},iS,{marginBottom:"6px"})}),
      filtered.length>0&&React.createElement("div",{style:{maxHeight:"120px",overflowY:"auto",border:"1px solid "+C.bdr,borderRadius:"8px"}},filtered.map(function(f,i){return React.createElement("div",{key:i,onClick:function(){addItem(f);},style:{padding:"6px 10px",cursor:"pointer",fontSize:"11px",fontFamily:F.s,borderBottom:"1px solid "+C.bdr,display:"flex",justifyContent:"space-between"}},React.createElement("span",null,f.n),React.createElement("span",{style:{color:f.gi<40?C.sage:f.gi<60?C.plum:C.rose}},"IG: "+f.gi));})),
      items.map(function(it,i){return React.createElement("div",{key:i,style:{display:"flex",gap:"6px",alignItems:"center",marginTop:"6px"}},React.createElement("span",{style:{flex:1,fontSize:"11px",fontFamily:F.s}},it.food.n),React.createElement("input",{type:"number",value:it.grams,onChange:function(e){setGrams(i,e.target.value);},style:Object.assign({},iS,{width:"60px",padding:"4px 6px",fontSize:"11px"})}),React.createElement("span",{style:{fontSize:"10px",color:C.txtL}},"g"),React.createElement("button",{onClick:function(){removeItem(i);},style:{border:"none",background:"none",color:C.rose,cursor:"pointer",fontSize:"14px"}},"\u2715"));})
    ),
    items.length>0&&React.createElement(Cd,{style:{background:totalGL<10?C.sageP:totalGL<20?C.plumP:C.roseP,textAlign:"center"}},
      React.createElement("p",{style:{fontSize:"10px",fontFamily:F.s,color:C.txtM,margin:0}},LANG_STORE==="en"?"Total Glycemic Load":"Carico Glicemico Totale"),
      React.createElement("p",{style:{fontSize:"28px",fontFamily:F.p,fontWeight:"700",color:glColor,margin:"4px 0"}},totalGL.toFixed(1)),
      React.createElement("p",{style:{fontSize:"10px",fontFamily:F.s,color:glColor,margin:0}},glLabel)
    )
  );
}
/* ═══════ PHASE 12: ADVANCED NUTRITION ═══════ */
/* GI DATABASE - 200+ foods */
var GI_DB=[
{n:"Avena integrale",gi:55,gl:13,cat:"cereali",pcos:true},{n:"Quinoa",gi:53,gl:13,cat:"cereali",pcos:true},{n:"Farro",gi:45,gl:15,cat:"cereali",pcos:true},{n:"Riso basmati",gi:58,gl:22,cat:"cereali",pcos:true},{n:"Riso integrale",gi:50,gl:16,cat:"cereali",pcos:true},{n:"Riso bianco",gi:73,gl:30,cat:"cereali",pcos:false},{n:"Pasta integrale",gi:42,gl:17,cat:"cereali",pcos:true},{n:"Pasta bianca",gi:49,gl:24,cat:"cereali",pcos:false},{n:"Pane integrale",gi:51,gl:15,cat:"cereali",pcos:true},{n:"Pane bianco",gi:75,gl:35,cat:"cereali",pcos:false},{n:"Orzo",gi:28,gl:10,cat:"cereali",pcos:true},{n:"Bulgur",gi:48,gl:12,cat:"cereali",pcos:true},{n:"Cous cous integrale",gi:45,gl:14,cat:"cereali",pcos:true},{n:"Segale (pane)",gi:50,gl:14,cat:"cereali",pcos:true},{n:"Amaranto",gi:35,gl:10,cat:"cereali",pcos:true},{n:"Grano saraceno",gi:54,gl:16,cat:"cereali",pcos:true},{n:"Miglio",gi:71,gl:25,cat:"cereali",pcos:false},
{n:"Lenticchie",gi:29,gl:5,cat:"legumi",pcos:true},{n:"Ceci",gi:28,gl:8,cat:"legumi",pcos:true},{n:"Fagioli neri",gi:30,gl:7,cat:"legumi",pcos:true},{n:"Fagioli borlotti",gi:35,gl:9,cat:"legumi",pcos:true},{n:"Piselli",gi:48,gl:3,cat:"legumi",pcos:true},{n:"Edamame",gi:18,gl:1,cat:"legumi",pcos:true},{n:"Fave",gi:40,gl:6,cat:"legumi",pcos:true},{n:"Lupini",gi:15,gl:1,cat:"legumi",pcos:true},{n:"Soia",gi:16,gl:1,cat:"legumi",pcos:true},{n:"Fagioli cannellini",gi:31,gl:7,cat:"legumi",pcos:true},
{n:"Mela",gi:36,gl:5,cat:"frutta",pcos:true},{n:"Pera",gi:38,gl:4,cat:"frutta",pcos:true},{n:"Arancia",gi:43,gl:5,cat:"frutta",pcos:true},{n:"Fragole",gi:25,gl:1,cat:"frutta",pcos:true},{n:"Mirtilli",gi:25,gl:4,cat:"frutta",pcos:true},{n:"Lamponi",gi:25,gl:1,cat:"frutta",pcos:true},{n:"Pompelmo",gi:25,gl:3,cat:"frutta",pcos:true},{n:"Ciliegie",gi:22,gl:3,cat:"frutta",pcos:true},{n:"Kiwi",gi:50,gl:5,cat:"frutta",pcos:true},{n:"Prugne",gi:39,gl:5,cat:"frutta",pcos:true},{n:"Pesche",gi:42,gl:5,cat:"frutta",pcos:true},{n:"Albicocche",gi:34,gl:3,cat:"frutta",pcos:true},{n:"Avocado",gi:15,gl:1,cat:"frutta",pcos:true},{n:"Banana matura",gi:62,gl:14,cat:"frutta",pcos:false},{n:"Anguria",gi:76,gl:4,cat:"frutta",pcos:false},{n:"Melone",gi:65,gl:4,cat:"frutta",pcos:false},{n:"Uva",gi:59,gl:11,cat:"frutta",pcos:false},{n:"Ananas",gi:59,gl:7,cat:"frutta",pcos:false},{n:"Mango",gi:56,gl:8,cat:"frutta",pcos:false},{n:"Datteri",gi:42,gl:18,cat:"frutta",pcos:false},{n:"Fichi freschi",gi:35,gl:4,cat:"frutta",pcos:true},{n:"Melograno",gi:35,gl:5,cat:"frutta",pcos:true},{n:"Cocco",gi:45,gl:4,cat:"frutta",pcos:true},
{n:"Broccoli",gi:10,gl:1,cat:"verdure",pcos:true},{n:"Spinaci",gi:15,gl:1,cat:"verdure",pcos:true},{n:"Zucchine",gi:15,gl:1,cat:"verdure",pcos:true},{n:"Cavolfiore",gi:15,gl:1,cat:"verdure",pcos:true},{n:"Cavolo",gi:10,gl:1,cat:"verdure",pcos:true},{n:"Asparagi",gi:15,gl:1,cat:"verdure",pcos:true},{n:"Peperoni",gi:15,gl:1,cat:"verdure",pcos:true},{n:"Pomodori",gi:15,gl:1,cat:"verdure",pcos:true},{n:"Cetrioli",gi:15,gl:1,cat:"verdure",pcos:true},{n:"Lattuga",gi:15,gl:1,cat:"verdure",pcos:true},{n:"Sedano",gi:15,gl:1,cat:"verdure",pcos:true},{n:"Finocchio",gi:15,gl:1,cat:"verdure",pcos:true},{n:"Melanzane",gi:15,gl:1,cat:"verdure",pcos:true},{n:"Carciofi",gi:15,gl:2,cat:"verdure",pcos:true},{n:"Funghi",gi:15,gl:1,cat:"verdure",pcos:true},{n:"Cipolla",gi:10,gl:1,cat:"verdure",pcos:true},{n:"Aglio",gi:10,gl:1,cat:"verdure",pcos:true},{n:"Rucola",gi:15,gl:1,cat:"verdure",pcos:true},{n:"Carote",gi:39,gl:2,cat:"verdure",pcos:true},{n:"Barbabietola",gi:64,gl:5,cat:"verdure",pcos:false},{n:"Patate bollite",gi:78,gl:15,cat:"verdure",pcos:false},{n:"Patate dolci",gi:63,gl:11,cat:"verdure",pcos:false},{n:"Zucca",gi:75,gl:3,cat:"verdure",pcos:false},
{n:"Pollo",gi:0,gl:0,cat:"proteine",pcos:true},{n:"Tacchino",gi:0,gl:0,cat:"proteine",pcos:true},{n:"Salmone",gi:0,gl:0,cat:"proteine",pcos:true},{n:"Sgombro",gi:0,gl:0,cat:"proteine",pcos:true},{n:"Sardine",gi:0,gl:0,cat:"proteine",pcos:true},{n:"Tonno fresco",gi:0,gl:0,cat:"proteine",pcos:true},{n:"Uova",gi:0,gl:0,cat:"proteine",pcos:true},{n:"Merluzzo",gi:0,gl:0,cat:"proteine",pcos:true},{n:"Manzo magro",gi:0,gl:0,cat:"proteine",pcos:true},{n:"Tofu",gi:15,gl:1,cat:"proteine",pcos:true},{n:"Tempeh",gi:15,gl:1,cat:"proteine",pcos:true},{n:"Gamberi",gi:0,gl:0,cat:"proteine",pcos:true},{n:"Yogurt greco",gi:11,gl:3,cat:"proteine",pcos:true},{n:"Ricotta",gi:27,gl:2,cat:"proteine",pcos:true},{n:"Parmigiano",gi:0,gl:0,cat:"proteine",pcos:true},{n:"Feta",gi:0,gl:0,cat:"proteine",pcos:true},
{n:"Mandorle",gi:15,gl:1,cat:"frutta secca",pcos:true},{n:"Noci",gi:15,gl:1,cat:"frutta secca",pcos:true},{n:"Nocciole",gi:15,gl:1,cat:"frutta secca",pcos:true},{n:"Semi di zucca",gi:10,gl:1,cat:"frutta secca",pcos:true},{n:"Semi di lino",gi:0,gl:0,cat:"frutta secca",pcos:true},{n:"Semi di chia",gi:1,gl:0,cat:"frutta secca",pcos:true},{n:"Pistacchi",gi:15,gl:2,cat:"frutta secca",pcos:true},{n:"Anacardi",gi:22,gl:3,cat:"frutta secca",pcos:true},{n:"Tahina",gi:10,gl:1,cat:"frutta secca",pcos:true},{n:"Burro di arachidi",gi:14,gl:1,cat:"frutta secca",pcos:true},
{n:"Olio EVO",gi:0,gl:0,cat:"grassi",pcos:true},{n:"Olio di cocco",gi:0,gl:0,cat:"grassi",pcos:true},{n:"Burro",gi:0,gl:0,cat:"grassi",pcos:false},{n:"Cioccolato fondente 85%",gi:23,gl:5,cat:"altro",pcos:true},{n:"Miele",gi:61,gl:12,cat:"altro",pcos:false},{n:"Zucchero bianco",gi:65,gl:65,cat:"altro",pcos:false},{n:"Sciroppo d'acero",gi:54,gl:10,cat:"altro",pcos:false},{n:"Cannella",gi:5,gl:0,cat:"spezie",pcos:true},{n:"Curcuma",gi:5,gl:0,cat:"spezie",pcos:true},{n:"Zenzero",gi:5,gl:0,cat:"spezie",pcos:true},{n:"Latte mandorla",gi:25,gl:1,cat:"bevande",pcos:true},{n:"Latte vaccino intero",gi:27,gl:3,cat:"bevande",pcos:false},{n:"Latte avena",gi:69,gl:8,cat:"bevande",pcos:false},{n:"The verde",gi:0,gl:0,cat:"bevande",pcos:true},{n:"Caffe senza zucchero",gi:0,gl:0,cat:"bevande",pcos:true},{n:"Succo d'arancia",gi:50,gl:12,cat:"bevande",pcos:false},{n:"Crackers integrali",gi:55,gl:12,cat:"altro",pcos:true},{n:"Gallette di riso",gi:82,gl:17,cat:"altro",pcos:false},{n:"Corn flakes",gi:81,gl:21,cat:"altro",pcos:false},{n:"Muesli senza zucchero",gi:49,gl:10,cat:"altro",pcos:true}
];
var GI_CATS=[{k:"tutti",l:"Tutti"},{k:"cereali",l:"Cereali"},{k:"legumi",l:"Legumi"},{k:"frutta",l:"Frutta"},{k:"verdure",l:"Verdure"},{k:"proteine",l:"Proteine"},{k:"frutta secca",l:"Frutta Secca"},{k:"grassi",l:"Grassi"},{k:"altro",l:"Altro"}];
function GIDatabase(){
  var _s1=useState(""),q=_s1[0],setQ=_s1[1];
  var _s2=useState("tutti"),cat=_s2[0],setCat=_s2[1];
  var _s3=useState(false),onlyPcos=_s3[0],setOnlyPcos=_s3[1];
  var filtered=GI_DB.filter(function(f){return(cat==="tutti"||f.cat===cat)&&(!onlyPcos||f.pcos)&&(!q||f.n.toLowerCase().includes(q.toLowerCase()));}).sort(function(a,b){return a.gi-b.gi;});
  function giColor(gi){return gi<=55?C.sage:gi<=69?C.amber:C.rose;}
  return React.createElement("div",{style:{display:"grid",gap:"10px"}},
    React.createElement(Cd,null,
      React.createElement("h5",{style:{fontFamily:F.s,fontSize:"12px",fontWeight:"600",color:C.plum,margin:"0 0 8px"}},(LANG_STORE==="en"?"\ud83d\udcda GI Database (":"📚 Database IG (")+GI_DB.length+(LANG_STORE==="en"?" foods)":" alimenti)")),
      React.createElement("input",{value:q,onChange:function(e){setQ(e.target.value);},placeholder:LANG_STORE==="en"?"Search food...":"Cerca alimento...",style:Object.assign({},iS,{marginBottom:"8px"})}),
      React.createElement("div",{style:{display:"flex",gap:"4px",flexWrap:"wrap",marginBottom:"8px"}},GI_CATS.map(function(c){return React.createElement("button",{key:c.k,onClick:function(){setCat(c.k);},style:{padding:"4px 10px",borderRadius:"14px",border:cat===c.k?"none":"1px solid "+C.bdr,background:cat===c.k?C.plum:C.white,color:cat===c.k?C.white:C.txtM,fontSize:"9px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}},c.l);})),
      React.createElement("button",{onClick:function(){setOnlyPcos(!onlyPcos);},style:{padding:"6px 12px",borderRadius:"10px",border:"1.5px solid "+(onlyPcos?C.sage:C.bdr),background:onlyPcos?C.sageP:C.white,color:onlyPcos?C.sageD:C.txtM,fontSize:"10px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}},onlyPcos?"\u2705 Solo PCOS-friendly":"\ud83d\udd18 "+(LANG_STORE==="en"?"Show PCOS only":"Solo PCOS-friendly"))
    ),
    React.createElement("div",{style:{display:"grid",gap:"4px"}},filtered.slice(0,50).map(function(f,i){return React.createElement("div",{key:i,style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 12px",borderRadius:"10px",background:C.white,border:"1px solid "+C.bg}},
      React.createElement("div",{style:{display:"flex",alignItems:"center",gap:"8px"}},
        React.createElement("span",{style:{width:"8px",height:"8px",borderRadius:"50%",background:f.pcos?C.sage:C.rose,flexShrink:0}},null),
        React.createElement("div",null,React.createElement("p",{style:{fontSize:"11px",fontFamily:F.s,fontWeight:"600",color:C.txt,margin:0}},f.n),React.createElement("p",{style:{fontSize:"8px",fontFamily:F.s,color:C.txtL,margin:0}},f.cat))
      ),
      React.createElement("div",{style:{display:"flex",gap:"8px",alignItems:"center"}},
        React.createElement("div",{style:{textAlign:"center"}},React.createElement("p",{style:{fontSize:"13px",fontFamily:F.s,fontWeight:"700",color:giColor(f.gi),margin:0}},f.gi),React.createElement("p",{style:{fontSize:"7px",color:C.txtL,margin:0}},"IG")),
        React.createElement("div",{style:{textAlign:"center"}},React.createElement("p",{style:{fontSize:"13px",fontFamily:F.s,fontWeight:"700",color:C.txtM,margin:0}},f.gl),React.createElement("p",{style:{fontSize:"7px",color:C.txtL,margin:0}},"GL"))
      )
    );})),
    filtered.length>50&&React.createElement("p",{style:{fontSize:"9px",fontFamily:F.s,color:C.txtL,textAlign:"center"}},"+"+(filtered.length-50)+(LANG_STORE==="en"?" more...results. Refine your search.":" altri risultati. Affina la ricerca."))
  );
}
/* SHOPPING LIST */
function ShoppingList(props){
  var _s1=useState(function(){return LD("shoppingList",[]);}),list=_s1[0],setList=_s1[1];
  var _s2=useState(""),input=_s2[0],setInput=_s2[1];
  var _s3=useState("altro"),selCat=_s3[0],setSelCat=_s3[1];
  var SHOP_CATS=[{k:"frutta",l:"\ud83c\udf4e Frutta",c:C.sage},{k:"verdura",l:"\ud83e\udd66 Verdura",c:C.sage},{k:"proteine",l:"\ud83e\udd69 Proteine",c:C.rose},{k:"cereali",l:"\ud83c\udf3e Cereali",c:C.amber},{k:"latticini",l:"\ud83e\uddc0 Latticini",c:C.plum},{k:"spezie",l:"\ud83e\uddc2 Spezie",c:C.amber},{k:"altro",l:"\ud83d\uded2 Altro",c:C.txtM}];
  function addItem(){if(!input.trim())return;var item={name:input.trim(),cat:selCat,done:false,id:Date.now()};var u=list.concat([item]);setList(u);SV("shoppingList",u);setInput("");}
  function toggleItem(id){var u=list.map(function(i){return i.id===id?Object.assign({},i,{done:!i.done}):i;});setList(u);SV("shoppingList",u);}
  function removeItem(id){var u=list.filter(function(i){return i.id!==id;});setList(u);SV("shoppingList",u);}
  function clearDone(){var u=list.filter(function(i){return!i.done;});setList(u);SV("shoppingList",u);}
  function genFromPlan(){var plan=LD("weekMealPlan",null);if(!plan){alert(LANG_STORE==="en"?"Generate a meal plan first!":"Genera prima un piano pasti!");return;}var items=[];var exists={};Object.values(plan).forEach(function(day){["colazione","pranzo","cena","spuntino"].forEach(function(meal){if(day[meal]&&day[meal].ing){day[meal].ing.forEach(function(ig){if(!exists[ig]){exists[ig]=true;items.push({name:ig,cat:"altro",done:false,id:Date.now()+Math.random()*1000});}});}});});if(items.length>0){var u=list.concat(items);setList(u);SV("shoppingList",u);}else{alert(LANG_STORE==="en"?"No ingredients found in meal plan":"Nessun ingrediente trovato nel piano pasti");}}
  var grouped={};SHOP_CATS.forEach(function(c){grouped[c.k]=list.filter(function(i){return i.cat===c.k;});});
  var doneCount=list.filter(function(i){return i.done;}).length;
  return React.createElement("div",{style:{display:"grid",gap:"10px"}},
    React.createElement(Cd,null,
      React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"}},
        React.createElement("h5",{style:{fontFamily:F.s,fontSize:"12px",fontWeight:"600",color:C.plum,margin:0}},LANG_STORE==="en"?"\ud83d\uded2 Shopping List":"\ud83d\uded2 Lista Spesa"),
        list.length>0&&React.createElement("span",{style:{fontSize:"10px",fontFamily:F.s,color:C.sageD,fontWeight:"600"}},doneCount+"/"+list.length)
      ),
      React.createElement("div",{style:{display:"flex",gap:"4px",marginBottom:"8px",flexWrap:"wrap"}},
        React.createElement("button",{onClick:genFromPlan,style:{padding:"6px 12px",borderRadius:"10px",border:"none",background:"linear-gradient(135deg,"+C.sage+","+C.sageD+")",color:C.white,fontSize:"10px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}},LANG_STORE==="en"?"\ud83d\udcc5 From Meal Plan":"\ud83d\udcc5 Da Piano Pasti"),
        doneCount>0&&React.createElement("button",{onClick:clearDone,style:{padding:"6px 12px",borderRadius:"10px",border:"1px solid "+C.bdr,background:C.white,color:C.txtM,fontSize:"10px",fontFamily:F.s,cursor:"pointer"}},"\ud83d\uddd1 "+(LANG_STORE==="en"?"Clear done":"Rimuovi fatti"))
      ),
      React.createElement("div",{style:{display:"flex",gap:"4px",marginBottom:"6px"}},
        React.createElement("input",{value:input,onChange:function(e){setInput(e.target.value);},placeholder:LANG_STORE==="en"?"Add item...":"Aggiungi...",style:Object.assign({},iS,{flex:1}),onKeyDown:function(e){if(e.key==="Enter")addItem();}}),
        React.createElement("select",{value:selCat,onChange:function(e){setSelCat(e.target.value);},style:Object.assign({},iS,{width:"auto",fontSize:"10px"})},SHOP_CATS.map(function(c){return React.createElement("option",{key:c.k,value:c.k},c.l);})),
        React.createElement("button",{onClick:addItem,style:{padding:"8px 14px",borderRadius:"10px",border:"none",background:C.sage,color:C.white,fontSize:"12px",cursor:"pointer"}},"+")
      )
    ),
    SHOP_CATS.map(function(cat){var items=grouped[cat.k];if(!items||items.length===0)return null;return React.createElement(Cd,{key:cat.k,style:{padding:"10px 12px"}},
      React.createElement("h6",{style:{fontFamily:F.s,fontSize:"11px",fontWeight:"600",color:cat.c,margin:"0 0 6px"}},cat.l),
      React.createElement("div",{style:{display:"grid",gap:"3px"}},items.map(function(item){return React.createElement("div",{key:item.id,style:{display:"flex",alignItems:"center",gap:"8px",padding:"6px 0"}},
        React.createElement("button",{onClick:function(){toggleItem(item.id);},style:{width:"20px",height:"20px",borderRadius:"6px",border:"2px solid "+(item.done?C.sage:C.bdr),background:item.done?C.sage:"transparent",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"10px",color:C.white,flexShrink:0}},item.done?"\u2713":""),
        React.createElement("span",{style:{fontSize:"11px",fontFamily:F.s,color:item.done?C.txtL:C.txt,textDecoration:item.done?"line-through":"none",flex:1}},item.name),
        React.createElement("button",{onClick:function(){removeItem(item.id);},style:{background:"none",border:"none",color:C.txtL,cursor:"pointer",fontSize:"12px",padding:"2px"}},"\u2715")
      );}))
    );})
  );
}
/* RESTAURANT GUIDE */
var REST_GUIDE=[
{cuisine:LANG_STORE==="en"?"Italian":"Italiana",icon:"\ud83c\uddf2\ud83c\uddf9",good:[LANG_STORE==="en"?"Grilled fish/meat with vegetables":"Pesce/carne alla griglia con verdure",LANG_STORE==="en"?"Whole wheat pasta with legume sauce":"Pasta integrale con sugo di legumi",LANG_STORE==="en"?"Caprese salad (without bread)":"Insalata caprese (senza pane)",LANG_STORE==="en"?"Minestrone or lentil soup":"Minestrone o zuppa di lenticchie",LANG_STORE==="en"?"Grilled vegetables":"Verdure grigliate"],bad:[LANG_STORE==="en"?"White bread/focaccia":"Pane bianco/focaccia",LANG_STORE==="en"?"Risotto (high GI)":"Risotto (alto IG)",LANG_STORE==="en"?"Fried foods":"Fritti",LANG_STORE==="en"?"Desserts/tiramisu":"Dolci/tiramisu"]},
{cuisine:LANG_STORE==="en"?"Japanese":"Giapponese",icon:"\ud83c\uddef\ud83c\uddf5",good:[LANG_STORE==="en"?"Sashimi (raw fish)":"Sashimi (pesce crudo)",LANG_STORE==="en"?"Edamame":"Edamame",LANG_STORE==="en"?"Grilled yakitori":"Yakitori alla griglia",LANG_STORE==="en"?"Miso soup":"Zuppa di miso",LANG_STORE==="en"?"Seaweed salad":"Insalata di alghe"],bad:[LANG_STORE==="en"?"White rice (large portions)":"Riso bianco (grandi porzioni)",LANG_STORE==="en"?"Tempura (fried)":"Tempura (fritto)",LANG_STORE==="en"?"Sweet sauces/teriyaki":"Salse dolci/teriyaki"]},
{cuisine:LANG_STORE==="en"?"Mexican":"Messicana",icon:"\ud83c\uddf2\ud83c\uddfd",good:[LANG_STORE==="en"?"Fajitas (no tortilla, extra veggies)":"Fajitas (senza tortilla, extra verdure)",LANG_STORE==="en"?"Guacamole with veggies":"Guacamole con verdure",LANG_STORE==="en"?"Black bean bowl":"Bowl di fagioli neri",LANG_STORE==="en"?"Grilled chicken/fish tacos (1-2)":"Tacos pollo/pesce alla griglia (1-2)"],bad:[LANG_STORE==="en"?"Nachos with cheese":"Nachos con formaggio",LANG_STORE==="en"?"Burritos (large tortilla)":"Burritos (tortilla grande)",LANG_STORE==="en"?"Sour cream/heavy cheese":"Panna acida/formaggio abbondante"]},
{cuisine:LANG_STORE==="en"?"Fast Food":"Fast Food",icon:"\ud83c\udf54",good:[LANG_STORE==="en"?"Grilled chicken salad":"Insalata con pollo grigliato",LANG_STORE==="en"?"Burger without bun + salad":"Hamburger senza pane + insalata",LANG_STORE==="en"?"Grilled chicken wrap":"Wrap con pollo grigliato"],bad:[LANG_STORE==="en"?"Fries":"Patatine fritte",LANG_STORE==="en"?"Sugary drinks/milkshakes":"Bibite zuccherate/frappè",LANG_STORE==="en"?"Fried chicken/nuggets":"Pollo fritto/nuggets",LANG_STORE==="en"?"Large portions of white bread":"Grandi porzioni di pane bianco"]},
{cuisine:LANG_STORE==="en"?"Pizza":"Pizza",icon:"\ud83c\udf55",good:[LANG_STORE==="en"?"Whole wheat or cauliflower crust":"Base integrale o di cavolfiore",LANG_STORE==="en"?"Veggie toppings (no extra cheese)":"Condimenti verdure (no formaggio extra)",LANG_STORE==="en"?"Pair with a side salad":"Accompagna con insalata"],bad:[LANG_STORE==="en"?"Stuffed crust":"Bordo ripieno",LANG_STORE==="en"?"Extra mozzarella/4 formaggi":"Extra mozzarella/4 formaggi",LANG_STORE==="en"?"Garlic bread":"Pane all'aglio"]},
{cuisine:LANG_STORE==="en"?"Chinese":"Cinese",icon:"\ud83c\udde8\ud83c\uddf3",good:[LANG_STORE==="en"?"Steamed fish/shrimp":"Pesce/gamberi al vapore",LANG_STORE==="en"?"Stir-fried vegetables":"Verdure saltate",LANG_STORE==="en"?"Wonton or hot and sour soup":"Zuppa wonton o agrodolce",LANG_STORE==="en"?"Tofu dishes":"Piatti con tofu"],bad:[LANG_STORE==="en"?"Fried rice/noodles":"Riso/noodle fritti",LANG_STORE==="en"?"Sweet and sour dishes":"Piatti agrodolci zuccherati",LANG_STORE==="en"?"Spring rolls (fried)":"Involtini primavera (fritti)"]}
];
function RestaurantGuide(){
  var _s=useState(null),open=_s[0],setOpen=_s[1];
  return React.createElement("div",{style:{display:"grid",gap:"10px"}},
    React.createElement(Cd,null,React.createElement("h5",{style:{fontFamily:F.s,fontSize:"12px",fontWeight:"600",color:C.plum,margin:"0 0 4px"}},LANG_STORE==="en"?"\ud83c\udf7d\ufe0f Restaurant PCOS Guide":"\ud83c\udf7d\ufe0f Guida Ristorante PCOS"),React.createElement("p",{style:{fontSize:"10px",fontFamily:F.s,color:C.txtL,margin:0}},LANG_STORE==="en"?"What to order and avoid by cuisine":"Cosa ordinare e cosa evitare per tipo di cucina")),
    REST_GUIDE.map(function(r,i){return React.createElement(Cd,{key:i,onClick:function(){setOpen(open===i?null:i);},style:{cursor:"pointer"}},
      React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},
        React.createElement("div",{style:{display:"flex",alignItems:"center",gap:"10px"}},React.createElement("span",{style:{fontSize:"24px"}},r.icon),React.createElement("h5",{style:{fontFamily:F.s,fontSize:"13px",fontWeight:"600",color:C.txt,margin:0}},r.cuisine)),
        React.createElement("span",{style:{fontSize:"12px",color:C.txtL}},open===i?"\u25b2":"\u25bc")
      ),
      open===i&&React.createElement("div",{style:{marginTop:"10px",display:"grid",gap:"8px"}},
        React.createElement("div",null,React.createElement("p",{style:{fontSize:"10px",fontFamily:F.s,fontWeight:"700",color:C.sage,margin:"0 0 4px"}},"\u2705 "+(LANG_STORE==="en"?"Order":"Ordina")),r.good.map(function(g,j){return React.createElement("p",{key:j,style:{fontSize:"10px",fontFamily:F.s,color:C.txt,margin:"2px 0",paddingLeft:"12px"}},"• "+g);})),
        React.createElement("div",null,React.createElement("p",{style:{fontSize:"10px",fontFamily:F.s,fontWeight:"700",color:C.rose,margin:"0 0 4px"}},"\u274c "+(LANG_STORE==="en"?"Avoid":"Evita")),r.bad.map(function(b,j){return React.createElement("p",{key:j,style:{fontSize:"10px",fontFamily:F.s,color:C.txt,margin:"2px 0",paddingLeft:"12px"}},"• "+b);}))
      )
    );})
  );
}
/* MEAL DIARY */
function MealDiary(){
  var _s1=useState(function(){return LD("mealDiary",[]);}),entries=_s1[0],setEntries=_s1[1];
  var _s2=useState({date:todayK(),meal:"pranzo",note:"",rating:3}),form=_s2[0],setForm=_s2[1];
  function addEntry(){if(!form.note.trim())return;var e=Object.assign({},form,{id:Date.now()});var u=[e].concat(entries);setEntries(u);SV("mealDiary",u);setForm({date:todayK(),meal:"pranzo",note:"",rating:3});}
  function delEntry(id){var u=entries.filter(function(e){return e.id!==id;});setEntries(u);SV("mealDiary",u);}
  var mealIcons={colazione:"\ud83c\udf73",pranzo:"\ud83c\udf5d",cena:"\ud83e\udd57",spuntino:"\ud83c\udf4e"};
  return React.createElement("div",{style:{display:"grid",gap:"10px"}},
    React.createElement(Cd,null,
      React.createElement("h5",{style:{fontFamily:F.s,fontSize:"12px",fontWeight:"600",color:C.plum,margin:"0 0 8px"}},LANG_STORE==="en"?"\ud83d\udcf8 Meal Diary":"\ud83d\udcf8 Diario Pasti"),
      React.createElement("div",{style:{display:"grid",gap:"6px"}},
        React.createElement("div",{style:{display:"flex",gap:"6px"}},
          React.createElement("input",{type:"date",value:form.date,onChange:function(e){setForm(Object.assign({},form,{date:e.target.value}));},style:Object.assign({},iS,{flex:1})}),
          React.createElement("div",{style:{display:"flex",gap:"3px"}},["colazione","pranzo","cena","spuntino"].map(function(m){return React.createElement("button",{key:m,onClick:function(){setForm(Object.assign({},form,{meal:m}));},style:{padding:"6px 8px",borderRadius:"8px",border:form.meal===m?"none":"1px solid "+C.bdr,background:form.meal===m?C.plum:C.white,color:form.meal===m?C.white:C.txtM,fontSize:"12px",cursor:"pointer"}},mealIcons[m]);}))
        ),
        React.createElement("textarea",{value:form.note,onChange:function(e){setForm(Object.assign({},form,{note:e.target.value}));},placeholder:LANG_STORE==="en"?"What did you eat? Notes...":"Cosa hai mangiato? Note...",style:Object.assign({},iS,{height:"60px",resize:"none"})}),
        React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},
          React.createElement("div",{style:{display:"flex",gap:"2px"}},["1","2","3","4","5"].map(function(r){return React.createElement("button",{key:r,onClick:function(){setForm(Object.assign({},form,{rating:parseInt(r)}));},style:{background:"none",border:"none",fontSize:"18px",cursor:"pointer",opacity:parseInt(r)<=form.rating?1:0.3}},"\u2b50");})),
          React.createElement("button",{onClick:addEntry,style:{padding:"8px 16px",borderRadius:"10px",border:"none",background:C.sage,color:C.white,fontSize:"11px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}},LANG_STORE==="en"?"+ Add":"+ Aggiungi")
        )
      )
    ),
    entries.slice(0,20).map(function(e,i){return React.createElement(Cd,{key:e.id,style:{padding:"10px 12px"}},
      React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"}},
        React.createElement("div",{style:{flex:1}},
          React.createElement("div",{style:{display:"flex",gap:"6px",alignItems:"center",marginBottom:"4px"}},
            React.createElement("span",{style:{fontSize:"14px"}},mealIcons[e.meal]||"\ud83c\udf7d"),
            React.createElement("span",{style:{fontSize:"10px",fontFamily:F.s,fontWeight:"600",color:C.txt}},fmtD(e.date)),
            React.createElement("span",{style:{fontSize:"10px",color:C.txtL}},"\u2b50".repeat(e.rating))
          ),
          React.createElement("p",{style:{fontSize:"10px",fontFamily:F.s,color:C.txtM,margin:0,lineHeight:1.5}},e.note)
        ),
        React.createElement("button",{onClick:function(){delEntry(e.id);},style:{background:"none",border:"none",color:C.txtL,cursor:"pointer",fontSize:"12px"}},"\u2715")
      )
    );})
  );
}
/* FOOD SCANNER - Open Food Facts API */
var PCOS_BAD_INGR=["sugar","glucose","fructose","corn syrup","maltodextrin","dextrose","sucrose","aspartame","palm oil","margarine","hydrogenated","zucchero","glucosio","fruttosio","sciroppo","maltodestrina","destrosio","saccarosio","aspartame","olio di palma","margarina","idrogenato"];
var PCOS_GOOD_INGR=["oat","quinoa","lentil","chickpea","almond","walnut","flaxseed","chia","turmeric","cinnamon","ginger","avena","quinoa","lenticch","ceci","mandorl","noce","lino","chia","curcuma","cannella","zenzero","omega","inositol","magnesio"];
function FoodScanner(){
  var _s1=useState(""),barcode=_s1[0],setBarcode=_s1[1];
  var _s2=useState(null),product=_s2[0],setProduct=_s2[1];
  var _s3=useState(false),loading=_s3[0],setLoading=_s3[1];
  var _s4=useState(""),err=_s4[0],setErr=_s4[1];
  function scan(){if(!barcode||barcode.length<8)return;setLoading(true);setErr("");setProduct(null);fetch("https://world.openfoodfacts.org/api/v0/product/"+barcode+".json").then(function(r){return r.json();}).then(function(data){setLoading(false);if(data.status===1){setProduct(data.product);}else{setErr(LANG_STORE==="en"?"Product not found":"Prodotto non trovato");}}).catch(function(){setLoading(false);setErr(LANG_STORE==="en"?"Connection error":"Errore di connessione");});}
  function analyzePCOS(p){if(!p)return null;var ingr=(p.ingredients_text||"").toLowerCase();var bad=PCOS_BAD_INGR.filter(function(b){return ingr.includes(b);});var good=PCOS_GOOD_INGR.filter(function(g){return ingr.includes(g);});var ns=p.nutriscore_grade||"";var sugar100=p.nutriments&&p.nutriments.sugars_100g?p.nutriments.sugars_100g:null;var score=0;if(good.length>0)score+=good.length;if(bad.length>0)score-=bad.length;if(sugar100&&sugar100>15)score-=2;else if(sugar100&&sugar100<5)score+=1;if(ns==="a"||ns==="b")score+=1;if(ns==="d"||ns==="e")score-=1;var verdict=score>=1?"good":score<=-1?"bad":"neutral";return{bad:bad,good:good,sugar100:sugar100,verdict:verdict,ns:ns};}
  var analysis=product?analyzePCOS(product):null;
  var verdictColors={good:C.sage,neutral:C.amber,bad:C.rose};
  var verdictLabels={good:LANG_STORE==="en"?"\u2705 PCOS-Friendly":"\u2705 PCOS-Friendly",neutral:LANG_STORE==="en"?"\u26a0\ufe0f Check carefully":"\u26a0\ufe0f Da valutare",bad:LANG_STORE==="en"?"\u274c Not recommended":"\u274c Sconsigliato"};
  return React.createElement("div",{style:{display:"grid",gap:"10px"}},
    React.createElement(Cd,null,
      React.createElement("h5",{style:{fontFamily:F.s,fontSize:"12px",fontWeight:"600",margin:"0 0 8px",color:C.plum}},LANG_STORE==="en"?"\ud83d\udcf7 Food Scanner":"\ud83d\udcf7 Scanner Alimenti"),
      React.createElement("p",{style:{fontSize:"10px",fontFamily:F.s,color:C.txtL,margin:"0 0 8px"}},LANG_STORE==="en"?"Enter barcode to check if PCOS-friendly":"Inserisci il barcode per verificare se e PCOS-friendly"),
      React.createElement("div",{style:{display:"flex",gap:"6px"}},
        React.createElement("input",{type:"text",inputMode:"numeric",value:barcode,onChange:function(e){setBarcode(e.target.value);},placeholder:LANG_STORE==="en"?"Barcode number...":"Numero barcode...",style:Object.assign({},iS,{flex:1}),onKeyDown:function(e){if(e.key==="Enter")scan();}}),
        React.createElement("button",{onClick:scan,disabled:loading||barcode.length<8,style:{padding:"10px 16px",borderRadius:"10px",border:"none",background:loading||barcode.length<8?C.bdr:"linear-gradient(135deg,"+C.sage+","+C.sageD+")",color:C.white,fontSize:"12px",fontFamily:F.s,fontWeight:"600",cursor:"pointer",whiteSpace:"nowrap"}},loading?"\u23f3":"\ud83d\udd0d "+(LANG_STORE==="en"?"Scan":"Cerca"))
      ),
      err&&React.createElement("p",{style:{fontSize:"10px",fontFamily:F.s,color:C.rose,margin:"6px 0 0"}},err)
    ),
    product&&analysis&&React.createElement(Cd,{style:{borderLeft:"4px solid "+verdictColors[analysis.verdict]}},
      React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"8px"}},
        React.createElement("div",null,
          React.createElement("h5",{style:{fontFamily:F.s,fontSize:"13px",fontWeight:"600",color:C.txt,margin:0}},product.product_name||"--"),
          React.createElement("p",{style:{fontSize:"9px",fontFamily:F.s,color:C.txtL,margin:"2px 0 0"}},product.brands||"")
        ),
        analysis.ns&&React.createElement("span",{style:{padding:"2px 8px",borderRadius:"12px",background:analysis.ns==="a"||analysis.ns==="b"?C.sageP:analysis.ns==="d"||analysis.ns==="e"?C.roseP:C.amberP,fontSize:"11px",fontWeight:"700",textTransform:"uppercase",color:analysis.ns==="a"||analysis.ns==="b"?C.sageD:analysis.ns==="d"||analysis.ns==="e"?C.rose:C.amber}},"Nutri-Score "+analysis.ns)
      ),
      React.createElement("div",{style:{padding:"8px 12px",borderRadius:"8px",background:verdictColors[analysis.verdict]+"15",marginBottom:"8px"}},
        React.createElement("p",{style:{fontSize:"13px",fontFamily:F.s,fontWeight:"700",color:verdictColors[analysis.verdict],margin:0}},verdictLabels[analysis.verdict])
      ),
      product.nutriments&&React.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gap:"4px",marginBottom:"8px"}},
        [{l:LANG_STORE==="en"?"Kcal":"Kcal",v:product.nutriments["energy-kcal_100g"]},{l:LANG_STORE==="en"?"Sugar":"Zuccheri",v:product.nutriments.sugars_100g,u:"g"},{l:LANG_STORE==="en"?"Protein":"Proteine",v:product.nutriments.proteins_100g,u:"g"},{l:LANG_STORE==="en"?"Fat":"Grassi",v:product.nutriments.fat_100g,u:"g"}].map(function(n,i){return React.createElement("div",{key:i,style:{textAlign:"center",padding:"6px",borderRadius:"6px",background:C.bg}},React.createElement("p",{style:{fontSize:"13px",fontFamily:F.s,fontWeight:"700",color:C.txt,margin:0}},n.v!=null?n.v+(n.u||""):"--"),React.createElement("p",{style:{fontSize:"8px",fontFamily:F.s,color:C.txtL,margin:0}},n.l+"/100g"));})
      ),
      analysis.bad.length>0&&React.createElement("div",{style:{marginBottom:"4px"}},React.createElement("p",{style:{fontSize:"9px",fontFamily:F.s,color:C.rose,margin:0}},"\u26a0\ufe0f "+(LANG_STORE==="en"?"Contains":"Contiene")+": "+analysis.bad.join(", "))),
      analysis.good.length>0&&React.createElement("div",null,React.createElement("p",{style:{fontSize:"9px",fontFamily:F.s,color:C.sage,margin:0}},"\u2705 "+(LANG_STORE==="en"?"Good ingredients":"Ingredienti buoni")+": "+analysis.good.join(", ")))
    )
  );
}
/* COSA CUCINO? - Ingredient-based recipe finder */
var PCOS_RECIPES=[
{n:"Bowl Proteica Quinoa",ing:["quinoa","uova","spinaci","avocado"],cal:420,p:28,c:35,f:22,steps:LANG_STORE==="en"?"Cook quinoa 15min. Sauté spinach. Top with egg and avocado.":"Cuoci quinoa 15min. Salta spinaci. Completa con uovo e avocado.",tags:["lunch","dinner"]},
{n:"Frittata Verdure",ing:["uova","zucchine","spinaci","cipolla"],cal:320,p:24,c:8,f:22,steps:LANG_STORE==="en"?"Sauté vegetables. Pour beaten eggs. Cook 8min covered.":"Salta le verdure. Versa uova sbattute. Cuoci 8min con coperchio.",tags:["lunch","dinner"]},
{n:"Overnight Oats PCOS",ing:["avena","latte mandorla","frutti di bosco","mandorle","cannella"],cal:380,p:14,c:42,f:18,steps:LANG_STORE==="en"?"Mix oats+milk+cinnamon. Refrigerate overnight. Top with berries and almonds.":"Mescola avena+latte+cannella. Frigo tutta la notte. Completa con frutti di bosco e mandorle.",tags:["breakfast"]},
{n:"Salmone + Broccoli",ing:["salmone","broccoli","limone","olio evo"],cal:450,p:38,c:12,f:28,steps:LANG_STORE==="en"?"Bake salmon 18min at 200°C. Steam broccoli. Drizzle with lemon and EVO.":"Cuoci salmone 18min a 200°C. Cuoci broccoli a vapore. Condisci con limone e olio EVO.",tags:["lunch","dinner"]},
{n:"Hummus + Verdure Crude",ing:["ceci","tahina","limone","sedano","carote"],cal:280,p:12,c:28,f:14,steps:LANG_STORE==="en"?"Blend chickpeas+tahini+lemon. Serve with raw veggie sticks.":"Frulla ceci+tahina+limone. Servi con bastoncini di verdure crude.",tags:["snack"]},
{n:"Insalata Lenticchie Power",ing:["lenticchie","pomodori","cetrioli","feta","olio evo"],cal:380,p:22,c:35,f:16,steps:LANG_STORE==="en"?"Cook lentils 20min. Mix with chopped veggies, feta, EVO.":"Cuoci lenticchie 20min. Mescola con verdure tagliate, feta, olio EVO.",tags:["lunch"]},
{n:"Smoothie Anti-Infiammatorio",ing:["spinaci","avocado","frutti di bosco","latte mandorla","zenzero"],cal:280,p:8,c:22,f:18,steps:LANG_STORE==="en"?"Blend all ingredients. Add ice. Enjoy!":"Frulla tutto. Aggiungi ghiaccio. Enjoy!",tags:["breakfast","snack"]},
{n:"Pollo Grigliato + Farro",ing:["pollo","farro","zucchine","pomodori"],cal:480,p:42,c:38,f:14,steps:LANG_STORE==="en"?"Grill chicken. Cook farro 25min. Sauté zucchini and tomatoes.":"Griglia il pollo. Cuoci farro 25min. Salta zucchine e pomodori.",tags:["lunch","dinner"]},
{n:"Yogurt Greco Bowl",ing:["yogurt greco","noci","frutti di bosco","cannella","miele"],cal:320,p:18,c:28,f:16,steps:LANG_STORE==="en"?"Combine yogurt with toppings. Drizzle minimal honey.":"Combina yogurt con toppings. Poco miele.",tags:["breakfast","snack"]},
{n:"Zuppa Lenticchie + Curcuma",ing:["lenticchie","carote","cipolla","curcuma","olio evo"],cal:340,p:20,c:38,f:10,steps:LANG_STORE==="en"?"Sauté onion+carrots. Add lentils+water+turmeric. Simmer 25min.":"Soffriggi cipolla+carote. Aggiungi lenticchie+acqua+curcuma. Cuoci 25min.",tags:["lunch","dinner"]},
{n:"Toast Avocado + Uovo",ing:["pane di segale","avocado","uova","semi di zucca"],cal:400,p:20,c:30,f:24,steps:LANG_STORE==="en"?"Toast bread. Mash avocado on top. Add poached egg and seeds.":"Tosta il pane. Schiaccia avocado sopra. Aggiungi uovo in camicia e semi.",tags:["breakfast"]},
{n:"Pasta Integrale Ceci",ing:["pasta integrale","ceci","pomodori","rosmarino","olio evo"],cal:440,p:18,c:52,f:14,steps:LANG_STORE==="en"?"Cook pasta. Sauté chickpeas with tomato and rosemary. Mix.":"Cuoci pasta. Salta ceci con pomodoro e rosmarino. Mescola.",tags:["lunch","dinner"]}
];
function CosaCucino(){
  var _s1=useState([]),myIng=_s1[0],setMyIng=_s1[1];
  var _s2=useState(""),input=_s2[0],setInput=_s2[1];
  var ALL_ING=[];PCOS_RECIPES.forEach(function(r){r.ing.forEach(function(i){if(ALL_ING.indexOf(i)===-1)ALL_ING.push(i);});});ALL_ING.sort();
  var suggestions=input.length>=2?ALL_ING.filter(function(i){return i.includes(input.toLowerCase())&&myIng.indexOf(i)===-1;}):[];
  function addIng(i){setMyIng(myIng.concat([i]));setInput("");}
  function removeIng(i){setMyIng(myIng.filter(function(x){return x!==i;}));}
  var matches=myIng.length>0?PCOS_RECIPES.map(function(r){var matched=r.ing.filter(function(i){return myIng.indexOf(i)!==-1;}).length;return{recipe:r,matched:matched,total:r.ing.length,pct:Math.round(matched/r.ing.length*100)};}).filter(function(m){return m.matched>0;}).sort(function(a,b){return b.pct-a.pct;}):[];
  return React.createElement("div",{style:{display:"grid",gap:"10px"}},
    React.createElement(Cd,null,
      React.createElement("h5",{style:{fontFamily:F.s,fontSize:"12px",fontWeight:"600",margin:"0 0 8px",color:C.plum}},LANG_STORE==="en"?"\ud83e\uddd1\u200d\ud83c\udf73 What Can I Cook?":"\ud83e\uddd1\u200d\ud83c\udf73 Cosa Cucino?"),
      React.createElement("p",{style:{fontSize:"10px",fontFamily:F.s,color:C.txtL,margin:"0 0 8px"}},LANG_STORE==="en"?"Add ingredients you have, get PCOS-friendly recipes":"Aggiungi gli ingredienti che hai, ricevi ricette PCOS-friendly"),
      React.createElement("div",{style:{display:"flex",gap:"6px"}},
        React.createElement("input",{value:input,onChange:function(e){setInput(e.target.value);},placeholder:LANG_STORE==="en"?"Type an ingredient...":"Scrivi un ingrediente...",style:Object.assign({},iS,{flex:1})}),
        input.length>=2&&suggestions.length===0&&React.createElement("button",{onClick:function(){addIng(input.toLowerCase());setInput("");},style:{padding:"8px 12px",borderRadius:"8px",border:"none",background:C.sage,color:C.white,fontSize:"11px",fontFamily:F.s,cursor:"pointer",whiteSpace:"nowrap"}},"+")
      ),
      suggestions.length>0&&React.createElement("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px",marginTop:"6px"}},suggestions.slice(0,8).map(function(s){return React.createElement("button",{key:s,onClick:function(){addIng(s);},style:{padding:"4px 10px",borderRadius:"16px",border:"1px solid "+C.sageL,background:C.sageP,color:C.sageD,fontSize:"10px",fontFamily:F.s,cursor:"pointer"}},"+"+s);})),
      myIng.length>0&&React.createElement("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px",marginTop:"8px"}},myIng.map(function(i){return React.createElement("span",{key:i,onClick:function(){removeIng(i);},style:{padding:"4px 10px",borderRadius:"16px",background:C.plumP,color:C.plum,fontSize:"10px",fontFamily:F.s,cursor:"pointer",border:"1px solid "+C.plumL}},i+" \u2715");}))
    ),
    matches.length>0&&matches.map(function(m,i){return React.createElement(Cd,{key:i,style:{borderLeft:"3px solid "+(m.pct>=80?C.sage:m.pct>=50?C.amber:C.bdr)}},
      React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"6px"}},
        React.createElement("h5",{style:{fontFamily:F.s,fontSize:"12px",fontWeight:"600",color:C.txt,margin:0}},m.recipe.n),
        React.createElement("span",{style:{padding:"2px 8px",borderRadius:"10px",background:m.pct>=80?C.sageP:m.pct>=50?C.amberP:C.bg,fontSize:"10px",fontFamily:F.s,fontWeight:"600",color:m.pct>=80?C.sageD:m.pct>=50?C.amber:C.txtL}},m.matched+"/"+m.total+" ("+m.pct+"%)")
      ),
      React.createElement("div",{style:{display:"flex",gap:"8px",marginBottom:"6px",fontSize:"9px",fontFamily:F.s,color:C.txtL}},
        React.createElement("span",null,m.recipe.cal+" kcal"),
        React.createElement("span",null,"P:"+m.recipe.p+"g"),
        React.createElement("span",null,"C:"+m.recipe.c+"g"),
        React.createElement("span",null,"F:"+m.recipe.f+"g")
      ),
      React.createElement("p",{style:{fontSize:"10px",fontFamily:F.s,color:C.txtM,margin:"0 0 4px",lineHeight:1.5}},m.recipe.steps),
      React.createElement("div",{style:{display:"flex",flexWrap:"wrap",gap:"3px"}},m.recipe.ing.map(function(ig){var have=myIng.indexOf(ig)!==-1;return React.createElement("span",{key:ig,style:{padding:"2px 6px",borderRadius:"8px",fontSize:"9px",fontFamily:F.s,background:have?C.sageP:C.roseP,color:have?C.sageD:C.rose}},ig);}))
    );})
  );
}


/* ═══════════ SEASONAL GUIDE ═══════════ */
function SeasonalGuide(){
  var s=getSeasonal();
  var monthNames=["","Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"];
  var curMonth=monthNames[new Date().getMonth()+1];
  return React.createElement("div",{style:{display:"grid",gap:"10px"}},
    React.createElement(Info,{bg:C.sageP,bdr:C.sageL,color:C.sageD},React.createElement("strong",null,"🌿 Frutta e verdura di stagione — "+curMonth)," Scegli prodotti di stagione per massimo contenuto di nutrienti e minor impatto ambientale."),
    React.createElement(Cd,{accent:C.sage},
      React.createElement("h5",{style:{fontFamily:F.s,fontSize:"12px",fontWeight:"600",color:C.sage,margin:"0 0 8px"}},"🥬 Verdura di stagione"),
      React.createElement("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px"}},s.verdura.map(function(v,i){return React.createElement(Pill,{key:i,color:C.sage},v);}))
    ),
    React.createElement(Cd,{accent:C.amber},
      React.createElement("h5",{style:{fontFamily:F.s,fontSize:"12px",fontWeight:"600",color:C.amber,margin:"0 0 8px"}},"🍎 Frutta di stagione"),
      React.createElement("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px"}},s.frutta.map(function(v,i){return React.createElement(Pill,{key:i,color:C.amber},v);}))
    ),
    React.createElement(Cd,null,
      React.createElement("p",{style:{fontSize:"11px",fontFamily:F.s,color:C.txtM,lineHeight:1.6,margin:0}},"💡 ",React.createElement("strong",null,"Nella PCOS")," preferisci frutta a basso indice glicemico: frutti di bosco, mele, kiwi, pere, pompelmo. Limita banane mature, uva, fichi e datteri.")
    )
  );
}

/* ═══════════ COOK CONVERTER ═══════════ */
function CookConverter(){
  var _s=useState(""),search=_s[0],setSearch=_s[1];
  var _s2=useState(100),grams=_s2[0],setGrams=_s2[1];
  var _s3=useState("crudo"),mode=_s3[0],setMode=_s3[1];
  var filtered=search.length>=2?COOK_CONV.filter(function(f){return f.n.toLowerCase().includes(search.toLowerCase());}):COOK_CONV;
  function convert(item,g){if(mode==="crudo"){return Math.round(g*(item.cotto/item.crudo));}else{return Math.round(g*(item.crudo/item.cotto));}}
  return React.createElement("div",{style:{display:"grid",gap:"10px"}},
    React.createElement(Info,{bg:C.amberP,bdr:C.amberL,color:C.amber},React.createElement("strong",null,"Convertitore Crudo ⇄ Cotto")," — Inserisci i grammi e scopri l'equivalente. Le dosi nel menu sono sempre a CRUDO."),
    React.createElement(Cd,null,
      React.createElement("div",{style:{display:"flex",gap:"6px",marginBottom:"8px"}},
        React.createElement("button",{onClick:function(){setMode("crudo");},style:{flex:1,padding:"8px",borderRadius:"10px",border:mode==="crudo"?"none":"1px solid "+C.bdr,background:mode==="crudo"?C.sage:C.white,color:mode==="crudo"?C.white:C.txtM,fontSize:"11px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}},"Crudo → Cotto"),
        React.createElement("button",{onClick:function(){setMode("cotto");},style:{flex:1,padding:"8px",borderRadius:"10px",border:mode==="cotto"?"none":"1px solid "+C.bdr,background:mode==="cotto"?C.amber:C.white,color:mode==="cotto"?C.white:C.txtM,fontSize:"11px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}},"Cotto → Crudo")
      ),
      React.createElement("div",{style:{display:"flex",gap:"6px",marginBottom:"8px"}},
        React.createElement("input",{value:search,onChange:function(e){setSearch(e.target.value);},placeholder:"Cerca alimento (es. riso, pasta, pollo...)",style:Object.assign({},iS,{flex:2})}),
        React.createElement("input",{type:"number",value:grams,onChange:function(e){setGrams(parseInt(e.target.value)||0);},style:Object.assign({},iS,{flex:1,textAlign:"center"})}),
        React.createElement("span",{style:{fontSize:"11px",fontFamily:F.s,color:C.txtL,alignSelf:"center"}},"g")
      )
    ),
    React.createElement("div",{style:{display:"grid",gap:"5px"}},filtered.slice(0,15).map(function(item,i){
      var result=convert(item,grams);
      return React.createElement(Cd,{key:i,style:{padding:"12px"}},
        React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},
          React.createElement("div",null,
            React.createElement("span",{style:{fontFamily:F.s,fontSize:"13px",fontWeight:"600",color:C.txt}},item.n),
            React.createElement("span",{style:{fontFamily:F.s,fontSize:"9px",color:C.txtL,marginLeft:"6px"}},item.note)
          ),
          React.createElement("div",{style:{textAlign:"right"}},
            React.createElement("div",{style:{fontFamily:F.s,fontSize:"14px",fontWeight:"700",color:mode==="crudo"?C.sage:C.amber}},grams+"g "+mode+" = "+result+"g "+(mode==="crudo"?"cotto":"crudo"))
          )
        )
      );
    }))
  );
}

function MealIntelligence(props){
  var _s=useState("planner"),sub=_s[0],setSub=_s[1];
  return React.createElement("div",null,
    React.createElement(SubT,{tabs:[{k:"planner",l:LANG_STORE==="en"?"Plan":"Piano",i:"\ud83d\udcc5"},{k:"gl",l:"GL",i:"\ud83d\udcca"},{k:"scanner",l:"Scan",i:"\ud83d\udcf7"},{k:"cucino",l:LANG_STORE==="en"?"Cook":"Cucino",i:"\ud83e\uddd1\u200d\ud83c\udf73"},{k:"convert",l:"⚖️",i:"⚖️"},{k:"season",l:LANG_STORE==="en"?"Season":"Stagione",i:"🌿"},{k:"gi",l:"IG DB",i:"\ud83d\udcda"},{k:"spesa",l:LANG_STORE==="en"?"Shop":"Spesa",i:"\ud83d\uded2"},{k:"risto",l:LANG_STORE==="en"?"Eat Out":"Fuori",i:"\ud83c\udf7d"},{k:"diario",l:LANG_STORE==="en"?"Diary":"Diario",i:"\ud83d\udcf8"}],active:sub,onSel:setSub}),
    sub==="planner"&&React.createElement(MealPlanner,{profile:props.profile}),
    sub==="gl"&&React.createElement(GLCalculator,null),
    sub==="scanner"&&React.createElement(FoodScanner,null),
    sub==="cucino"&&React.createElement(CosaCucino,null),
    sub==="convert"&&React.createElement(CookConverter,null),
    sub==="season"&&React.createElement(SeasonalGuide,null),
    sub==="gi"&&React.createElement(GIDatabase,null),
    sub==="spesa"&&React.createElement(ShoppingList,null),
    sub==="risto"&&React.createElement(RestaurantGuide,null),
    sub==="diario"&&React.createElement(MealDiary,null)
  );
}
/* PHASE 8: HEALTH INTELLIGENCE */
var SUPP_DEFS=[{k:"inositol",n:"Myo-Inositolo",dose:"2-4g",when:LANG_STORE==="en"?"Away from meals":"Lontano dai pasti",i:"\ud83d\udc8a"},{k:"vitd",n:"Vitamina D",dose:"2000-4000 UI",when:LANG_STORE==="en"?"With fat meal":"Con pasto grasso",i:"\u2600\ufe0f"},{k:"omega3",n:"Omega-3",dose:"1-2g EPA+DHA",when:LANG_STORE==="en"?"With meals":"Ai pasti",i:"\ud83d\udc1f"},{k:"magnesium",n:"Magnesio",dose:"300-400mg",when:LANG_STORE==="en"?"Before bed":"Prima di dormire",i:"\ud83c\udf19"},{k:"zinc",n:"Zinco",dose:"15-30mg",when:LANG_STORE==="en"?"With meals":"Ai pasti",i:"\ud83d\udd2c"},{k:"nac",n:"NAC",dose:"600-1800mg",when:LANG_STORE==="en"?"Away from meals":"Lontano dai pasti",i:"\ud83e\uddea"},{k:"folate",n:"Acido Folico",dose:"400-800mcg",when:LANG_STORE==="en"?"Anytime":"Qualsiasi momento",i:"\ud83e\uddec"}];
function SuppReminders(){
  var _s=useState(function(){return LD("suppLog",{});}),log=_s[0],setLog=_s[1];
  var dk=todayK();var todayLog=log[dk]||{};
  function toggle(k){var u=Object.assign({},log);var td=Object.assign({},todayLog);td[k]=!td[k];u[dk]=td;setLog(u);SV("suppLog",u);}
  function adherence(k){var taken=0,total=0;for(var i=0;i<30;i++){var d=new Date();d.setDate(d.getDate()-i);var key=d.toISOString().slice(0,10);total++;if(log[key]&&log[key][k])taken++;}return total>0?Math.round(taken/total*100):0;}
  var totalToday=SUPP_DEFS.filter(function(s){return todayLog[s.k];}).length;
  return React.createElement("div",{style:{display:"grid",gap:"8px"}},
    React.createElement(Cd,{style:{background:"linear-gradient(135deg,"+C.plumP+","+C.roseP+")",textAlign:"center"}},
      React.createElement("p",{style:{fontSize:"20px",fontFamily:F.p,fontWeight:"700",color:C.plum,margin:0}},totalToday+"/"+SUPP_DEFS.length),
      React.createElement("p",{style:{fontSize:"10px",fontFamily:F.s,color:C.txtM,margin:0}},LANG_STORE==="en"?"taken today":"presi oggi")
    ),
    SUPP_DEFS.map(function(s){var done=todayLog[s.k];var adh=adherence(s.k);
      return React.createElement(Cd,{key:s.k,onClick:function(){toggle(s.k);},style:{cursor:"pointer",border:"1.5px solid "+(done?C.plum:C.bdr),background:done?C.plumP:C.white}},
        React.createElement("div",{style:{display:"flex",alignItems:"center",gap:"8px"}},
          React.createElement("span",{style:{fontSize:"18px"}},s.i),
          React.createElement("div",{style:{flex:1}},
            React.createElement("div",{style:{fontSize:"12px",fontFamily:F.s,fontWeight:"600",color:done?C.plum:C.txt}},s.n),
            React.createElement("div",{style:{fontSize:"9px",fontFamily:F.s,color:C.txtL}},s.dose+" \u2014 "+s.when),
            React.createElement("div",{style:{marginTop:"3px",height:"4px",borderRadius:"2px",background:C.bdr,overflow:"hidden"}},React.createElement("div",{style:{height:"100%",width:adh+"%",borderRadius:"2px",background:adh>80?C.sage:adh>50?C.plum:C.rose}})),
            React.createElement("span",{style:{fontSize:"8px",fontFamily:F.s,color:C.txtL}},(LANG_STORE==="en"?"30d adherence":"aderenza 30gg")+": "+adh+"%")
          ),
          React.createElement("div",{style:{width:"28px",height:"28px",borderRadius:"50%",border:"2px solid "+(done?C.plum:C.bdr),background:done?C.plum:C.white,display:"flex",alignItems:"center",justifyContent:"center"}},done&&React.createElement("span",{style:{color:C.white,fontSize:"14px"}},"\u2713"))
        )
      );
    })
  );
}
function BBTTracker(){
  var _s1=useState(function(){return LD("bbt",[]);}),data=_s1[0],setData=_s1[1];
  var _s2=useState(""),temp=_s2[0],setTemp=_s2[1];
  function save(){if(!temp)return;var entry={date:todayK(),temp:parseFloat(temp)};var u=[entry].concat(data.filter(function(e){return e.date!==todayK();})).slice(0,90);u.sort(function(a,b){return a.date.localeCompare(b.date);});setData(u);SV("bbt",u);setTemp("");}
  var last30=data.slice(-30);
  var mn=last30.length>0?Math.min.apply(null,last30.map(function(d){return d.temp;}))-0.1:35.8;
  var mx=last30.length>0?Math.max.apply(null,last30.map(function(d){return d.temp;}))+0.1:37.2;
  return React.createElement("div",{style:{display:"grid",gap:"10px"}},
    React.createElement(Cd,null,
      React.createElement("h5",{style:{fontFamily:F.s,fontSize:"12px",fontWeight:"600",margin:"0 0 8px",color:C.plum}},LANG_STORE==="en"?"Basal Body Temperature":"Temperatura Basale"),
      React.createElement("div",{style:{display:"flex",gap:"6px"}},
        React.createElement("input",{type:"number",step:"0.1",value:temp,onChange:function(e){setTemp(e.target.value);},placeholder:"36.5",style:Object.assign({},iS,{flex:1})}),
        React.createElement("button",{onClick:save,disabled:!temp,style:{padding:"8px 16px",borderRadius:"8px",border:"none",background:!temp?C.bdr:C.plum,color:C.white,fontSize:"12px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}},LANG_STORE==="en"?"Save":"Salva")
      ),
      React.createElement("p",{style:{fontSize:"9px",fontFamily:F.s,color:C.txtL,margin:"4px 0 0"}},LANG_STORE==="en"?"Measure every morning before getting up":"Misura ogni mattina prima di alzarti")
    ),
    last30.length>3&&React.createElement(Cd,null,
      React.createElement("h5",{style:{fontFamily:F.s,fontSize:"11px",fontWeight:"600",margin:"0 0 4px",color:C.sageD}},LANG_STORE==="en"?"30-Day Chart":"Grafico 30 Giorni"),
      React.createElement("svg",{viewBox:"0 0 "+Math.max(last30.length*12,100)+" 80",style:{width:"100%",height:"80px"}},
        React.createElement("line",{x1:"0",y1:"40",x2:last30.length*12,y2:"40",stroke:C.roseL,strokeWidth:"0.5",strokeDasharray:"3"}),
        last30.map(function(d,i){var y=80-((d.temp-mn)/(mx-mn))*70-5;var x=i*12+6;return React.createElement("g",{key:i},React.createElement("circle",{cx:x,cy:y,r:2.5,fill:d.temp>36.7?C.rose:C.sage}),React.createElement("text",{x:x,y:78,fontSize:"5",textAnchor:"middle",fill:C.txtL},d.date.slice(8)));}),
        React.createElement("polyline",{fill:"none",stroke:C.plum,strokeWidth:"1",points:last30.map(function(d,i){var y=80-((d.temp-mn)/(mx-mn))*70-5;return(i*12+6)+","+y;}).join(" ")})
      ),
      React.createElement("p",{style:{fontSize:"8px",fontFamily:F.s,color:C.txtL,textAlign:"center",margin:"2px 0 0"}},LANG_STORE==="en"?"Rise above 36.7C may indicate ovulation":"Rialzo sopra 36.7C puo indicare ovulazione")
    )
  );
}
function CorrelationEngine(){
  var symptoms=LD("symptoms",[]),habits=LD("habits",{});
  var insights=[];
  if(symptoms.length>=7){
    var goodSleep=symptoms.filter(function(s){return s.vals.sleep_q>=4;});
    var badSleep=symptoms.filter(function(s){return s.vals.sleep_q&&s.vals.sleep_q<=2;});
    if(goodSleep.length>0&&badSleep.length>0){var gb=goodSleep.reduce(function(s,e){return s+(e.vals.bloat||3);},0)/goodSleep.length;var bb=badSleep.reduce(function(s,e){return s+(e.vals.bloat||3);},0)/badSleep.length;if(bb>gb+0.5)insights.push({i:"\ud83d\ude34",t:LANG_STORE==="en"?"When you sleep well, bloating decreases by ~"+Math.round((bb-gb)/bb*100)+"%":"Quando dormi bene, il gonfiore diminuisce del ~"+Math.round((bb-gb)/bb*100)+"%",c:C.sage});}
    var goodE=symptoms.filter(function(s){return s.vals.energy>=4;});var lowE=symptoms.filter(function(s){return s.vals.energy&&s.vals.energy<=2;});
    if(goodE.length>=2)insights.push({i:"\u26a1",t:LANG_STORE==="en"?"High energy on "+goodE.length+"/"+symptoms.length+" days - great!":"Energia alta in "+goodE.length+"/"+symptoms.length+" giorni - ottimo!",c:C.sage});
    if(lowE.length>symptoms.length/2)insights.push({i:"\ud83d\udd0b",t:LANG_STORE==="en"?"Low energy most days. Check sleep, iron, IF timing.":"Energia bassa. Controlla sonno, ferro e timing IF.",c:C.rose});
  }
  var hDays=Object.keys(habits);
  if(hDays.length>=7){var wDays=hDays.filter(function(d){return habits[d].workout_ok;}).length;if(wDays>=4)insights.push({i:"\ud83c\udfcb\ufe0f",t:LANG_STORE==="en"?"Worked out "+wDays+"/"+hDays.length+" days - consistency is key!":"Allenata "+wDays+"/"+hDays.length+" giorni - la costanza e fondamentale!",c:C.sage});var waterD=hDays.filter(function(d){return habits[d].water_ok;}).length;if(waterD<hDays.length/2)insights.push({i:"\ud83d\udca7",t:LANG_STORE==="en"?"Water below target most days. Aim 2L+":"Idratazione sotto target. Punta a 2L+",c:C.plum});}
  if(insights.length===0)insights.push({i:"\ud83d\udcca",t:LANG_STORE==="en"?"Track for 7+ days to unlock insights!":"Traccia per 7+ giorni per sbloccare insight!",c:C.plum});
  return React.createElement("div",{style:{display:"grid",gap:"8px"}},
    React.createElement(SecH,{title:LANG_STORE==="en"?"Smart Correlations":"Correlazioni Intelligenti",sub:LANG_STORE==="en"?"Patterns in YOUR data":"Pattern nei TUOI dati"}),
    insights.map(function(ins,i){return React.createElement(Cd,{key:i,style:{borderLeft:"3px solid "+ins.c}},React.createElement("div",{style:{display:"flex",gap:"8px",alignItems:"flex-start"}},React.createElement("span",{style:{fontSize:"18px"}},ins.i),React.createElement("p",{style:{fontSize:"11px",fontFamily:F.s,color:C.txt,margin:0,lineHeight:1.5}},ins.t)));})
  );
}
/* PHASE 9: DASHBOARD & UX */
function HomeDashboard(props){
  var profile=props.profile,setTab=props.setTab;
  var cp=getCyclePhaseNow();var weighins=LD("weighins",[]);var habits=LD("habits",{});
  var todayH=habits[todayK()]||{};var habitsOk=HABIT_DEFS.filter(function(h){return todayH[h.k];}).length;
  var symptoms=LD("symptoms",[]);var todaySym=symptoms.find(function(s){return s.date===todayK();});
  var challenge=getDailyChallenge();var latestW=weighins.length>0?weighins[weighins.length-1]:null;
  var diff=latestW&&profile.goalW?(latestW.weight-profile.goalW).toFixed(1):null;
  var fastOn=LD("fast_isOn",false);var bodyMeas=LD("bodyMeas",[]);var latestM=bodyMeas.length>0?bodyMeas[0]:null;
  return React.createElement("div",{style:{display:"grid",gap:"10px"}},
    React.createElement("div",{style:{textAlign:"center",padding:"4px 0"}},
      React.createElement("h3",{style:{fontFamily:F.p,fontSize:"18px",color:C.plum,margin:0}},(LANG_STORE==="en"?"Welcome back":"Bentornata")+(profile.name?", "+profile.name:"")+"! \ud83d\udc4b"),
      React.createElement("p",{style:{fontSize:"10px",fontFamily:F.s,color:C.txtM,margin:"4px 0 0"}},fmtD(todayK())+(cp?" \u2014 "+CYCLE_PHASES[cp.phase].name+" ("+(LANG_STORE==="en"?"day":"g")+cp.day+")":""))
    ),
    React.createElement(Cd,{style:{background:"linear-gradient(135deg,"+C.plumP+","+C.roseP+")"}},
      React.createElement("div",{style:{display:"flex",alignItems:"center",gap:"10px"}},
        React.createElement("span",{style:{fontSize:"22px"}},"\ud83c\udfaf"),
        React.createElement("div",null,React.createElement("p",{style:{fontSize:"11px",fontFamily:F.s,fontWeight:"600",color:C.plum,margin:0}},LANG_STORE==="en"?"Daily Challenge":"Sfida del Giorno"),React.createElement("p",{style:{fontSize:"11px",fontFamily:F.s,color:C.txt,margin:"2px 0 0"}},challenge))
      )
    ),
    React.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px"}},
      React.createElement(Cd,{onClick:function(){setTab("garmin");},style:{cursor:"pointer",textAlign:"center"}},React.createElement("p",{style:{fontSize:"22px",fontFamily:F.p,fontWeight:"700",color:C.sageD,margin:0}},latestW?latestW.weight+"kg":"--"),React.createElement("p",{style:{fontSize:"9px",fontFamily:F.s,color:C.txtL,margin:"2px 0 0"}},(LANG_STORE==="en"?"Weight":"Peso")+(diff?" ("+diff+"kg)":""))),
      React.createElement(Cd,{onClick:function(){setTab("track");},style:{cursor:"pointer",textAlign:"center"}},React.createElement("p",{style:{fontSize:"22px",fontFamily:F.p,fontWeight:"700",color:C.sage,margin:0}},habitsOk+"/"+HABIT_DEFS.length),React.createElement("p",{style:{fontSize:"9px",fontFamily:F.s,color:C.txtL,margin:"2px 0 0"}},LANG_STORE==="en"?"Habits":"Abitudini")),
      React.createElement(Cd,{onClick:function(){setTab("digiuno");},style:{cursor:"pointer",textAlign:"center"}},React.createElement("p",{style:{fontSize:"22px",margin:0}},fastOn?"\u23f3":"\u2705"),React.createElement("p",{style:{fontSize:"9px",fontFamily:F.s,color:C.txtL,margin:"2px 0 0"}},"IF "+profile.ifH+":"+(24-profile.ifH))),
      React.createElement(Cd,{onClick:function(){setTab("ciclo");},style:{cursor:"pointer",textAlign:"center"}},React.createElement("p",{style:{fontSize:"22px",margin:0}},cp?CYCLE_PHASES[cp.phase].icon:"\ud83e\ude78"),React.createElement("p",{style:{fontSize:"9px",fontFamily:F.s,color:C.txtL,margin:"2px 0 0"}},cp?CYCLE_PHASES[cp.phase].name:(LANG_STORE==="en"?"Cycle":"Ciclo")))
    ),
    latestM&&React.createElement(Cd,null,React.createElement("div",{style:{display:"flex",justifyContent:"space-around",textAlign:"center"}},
      React.createElement("div",null,React.createElement("p",{style:{fontSize:"14px",fontFamily:F.p,fontWeight:"700",color:C.plum,margin:0}},latestM.waist),React.createElement("p",{style:{fontSize:"8px",fontFamily:F.s,color:C.txtL,margin:0}},LANG_STORE==="en"?"Waist":"Vita")),
      React.createElement("div",null,React.createElement("p",{style:{fontSize:"14px",fontFamily:F.p,fontWeight:"700",color:C.plum,margin:0}},latestM.hips||"-"),React.createElement("p",{style:{fontSize:"8px",fontFamily:F.s,color:C.txtL,margin:0}},LANG_STORE==="en"?"Hips":"Fianchi")),
      latestM.waist&&latestM.hips&&React.createElement("div",null,React.createElement("p",{style:{fontSize:"14px",fontFamily:F.p,fontWeight:"700",color:parseFloat(latestM.waist)/parseFloat(latestM.hips)>0.85?C.rose:C.sage,margin:0}},(parseFloat(latestM.waist)/parseFloat(latestM.hips)).toFixed(2)),React.createElement("p",{style:{fontSize:"8px",fontFamily:F.s,color:C.txtL,margin:0}},"WHR"))
    )),
    React.createElement(CorrelationEngine,null)
  );
}
/* PHASE 9: DARK MODE */
var THEME_STORE=localStorage.getItem("pcos_theme")||"light";
function ThemeToggle(){
  var _s=useState(THEME_STORE),theme=_s[0],setTheme=_s[1];
  function toggle(){var n=theme==="light"?"dark":"light";localStorage.setItem("pcos_theme",n);window.location.reload();}
  return React.createElement("button",{onClick:toggle,style:{padding:"4px 8px",borderRadius:"8px",border:"1px solid "+C.bdr,background:C.white,color:C.plum,fontSize:"9px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}},theme==="light"?"\ud83c\udf19":"\u2600\ufe0f");
}
/* PHASE 10: SHARE CARD */
function ShareCard(props){
  var profile=props.profile;
  var _s=useState(false),show=_s[0],setShow=_s[1];
  var weighins=LD("weighins",[]);var habits=LD("habits",{});
  var w1=weighins.length>0?weighins[weighins.length-1]:null;var w4=weighins.length>=4?weighins[Math.max(0,weighins.length-5)]:null;
  var diff=w1&&w4?(w1.weight-w4.weight).toFixed(1):null;
  var habitDays=Object.keys(habits).length;var workoutDays=Object.keys(habits).filter(function(d){return habits[d].workout_ok;}).length;
  return React.createElement("div",{style:{display:"grid",gap:"8px",marginTop:"16px"}},
    React.createElement("button",{onClick:function(){setShow(!show);},style:{padding:"12px",borderRadius:"12px",border:"none",background:"linear-gradient(135deg,"+C.plum+","+C.rose+")",color:C.white,fontSize:"13px",fontFamily:F.s,fontWeight:"700",cursor:"pointer"}},LANG_STORE==="en"?"\ud83d\udcf1 Generate Progress Card":"\ud83d\udcf1 Genera Card Progressi"),
    show&&React.createElement("div",{style:{background:"linear-gradient(135deg,#f8f4f0,#f0e8f4)",borderRadius:"16px",padding:"20px",textAlign:"center",border:"2px solid "+C.plumL}},
      React.createElement("h3",{style:{fontFamily:F.p,fontSize:"16px",color:C.plum,margin:"0 0 4px"}},"PCOS Daily"),
      React.createElement("p",{style:{fontSize:"9px",fontFamily:F.s,color:C.txtL,margin:"0 0 12px"}},LANG_STORE==="en"?"My progress this month":"I miei progressi questo mese"),
      React.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px",marginBottom:"12px"}},
        React.createElement("div",{style:{background:C.white,borderRadius:"10px",padding:"10px"}},React.createElement("p",{style:{fontSize:"18px",fontFamily:F.p,fontWeight:"700",color:C.sageD,margin:0}},w1?w1.weight+"kg":"--"),React.createElement("p",{style:{fontSize:"8px",fontFamily:F.s,color:C.txtL,margin:0}},LANG_STORE==="en"?"Current":"Attuale")),
        React.createElement("div",{style:{background:C.white,borderRadius:"10px",padding:"10px"}},React.createElement("p",{style:{fontSize:"18px",fontFamily:F.p,fontWeight:"700",color:diff&&parseFloat(diff)>0?C.rose:C.sage,margin:0}},diff?diff+"kg":"--"),React.createElement("p",{style:{fontSize:"8px",fontFamily:F.s,color:C.txtL,margin:0}},LANG_STORE==="en"?"Change":"Variazione")),
        React.createElement("div",{style:{background:C.white,borderRadius:"10px",padding:"10px"}},React.createElement("p",{style:{fontSize:"18px",fontFamily:F.p,fontWeight:"700",color:C.plum,margin:0}},workoutDays),React.createElement("p",{style:{fontSize:"8px",fontFamily:F.s,color:C.txtL,margin:0}},LANG_STORE==="en"?"Workouts":"Allenamenti")),
        React.createElement("div",{style:{background:C.white,borderRadius:"10px",padding:"10px"}},React.createElement("p",{style:{fontSize:"18px",fontFamily:F.p,fontWeight:"700",color:C.sage,margin:0}},habitDays),React.createElement("p",{style:{fontSize:"8px",fontFamily:F.s,color:C.txtL,margin:0}},LANG_STORE==="en"?"Tracked days":"Giorni tracciati"))
      ),
      React.createElement("p",{style:{fontSize:"8px",fontFamily:F.s,color:C.txtL,margin:0}},"lotusflowerpcos.com \u00b7 #PCOSDaily #PCOSWarrior")
    ),
    show&&React.createElement("p",{style:{fontSize:"9px",fontFamily:F.s,color:C.txtL,textAlign:"center"}},LANG_STORE==="en"?"Screenshot and share on Instagram!":"Fai screenshot e condividi su Instagram!")
  );
}

/* ═══════ PHASE 11: STRESS & CORTISOL ═══════ */
function BreathingTimer(){
  var _s1=useState(false),active=_s1[0],setActive=_s1[1];
  var _s2=useState("inhale"),phase=_s2[0],setPhase=_s2[1];
  var _s3=useState(0),secs=_s3[0],setSecs=_s3[1];
  var _s4=useState(0),rounds=_s4[0],setRounds=_s4[1];
  var _s5=useState("478"),mode=_s5[0],setMode=_s5[1];
  var patterns={"478":{inhale:4,hold:7,exhale:8,name:"4-7-8 Relax"},"box":{inhale:4,hold:4,exhale:4,holdOut:4,name:"Box Breathing"},"coherence":{inhale:5,exhale:5,name:LANG_STORE==="en"?"Cardiac Coherence":"Coerenza Cardiaca"}};
  var pat=patterns[mode];
  useEffect(function(){if(!active)return;var timer=setInterval(function(){setSecs(function(s){var nextS=s+1;var totalCycle=(pat.inhale||0)+(pat.hold||0)+(pat.exhale||0)+(pat.holdOut||0);if(nextS>=totalCycle){setRounds(function(r){return r+1;});return 0;}if(nextS<pat.inhale)setPhase("inhale");else if(nextS<pat.inhale+(pat.hold||0))setPhase("hold");else if(nextS<pat.inhale+(pat.hold||0)+pat.exhale)setPhase("exhale");else setPhase("holdOut");return nextS;});},1000);return function(){clearInterval(timer);};},[active,mode]);
  function start(){setActive(true);setSecs(0);setRounds(0);setPhase("inhale");}
  function stop(){setActive(false);}
  var phaseLabels={inhale:LANG_STORE==="en"?"Inhale":"Inspira",hold:LANG_STORE==="en"?"Hold":"Trattieni",exhale:LANG_STORE==="en"?"Exhale":"Espira",holdOut:LANG_STORE==="en"?"Hold":"Trattieni"};
  var phaseColors={inhale:C.sage,hold:C.amber,exhale:C.plum,holdOut:C.amber};
  var totalCycle=(pat.inhale||0)+(pat.hold||0)+(pat.exhale||0)+(pat.holdOut||0);
  var progress=active?(secs/totalCycle)*100:0;
  return React.createElement(Cd,{style:{textAlign:"center"}},
    React.createElement("h5",{style:{fontFamily:F.s,fontSize:"12px",fontWeight:"600",color:C.plum,margin:"0 0 8px"}},LANG_STORE==="en"?"\ud83c\udf2c\ufe0f Breathing Exercise":"\ud83c\udf2c\ufe0f Esercizio Respirazione"),
    React.createElement("p",{style:{fontSize:"9px",fontFamily:F.s,color:C.txtL,margin:"0 0 10px"}},LANG_STORE==="en"?"Lower cortisol = lower androgens = better PCOS management":"Meno cortisolo = meno androgeni = migliore gestione PCOS"),
    React.createElement("div",{style:{display:"flex",gap:"4px",justifyContent:"center",marginBottom:"12px"}},Object.keys(patterns).map(function(k){return React.createElement("button",{key:k,onClick:function(){setMode(k);if(active){stop();start();}},style:{padding:"6px 12px",borderRadius:"10px",border:mode===k?"none":"1px solid "+C.bdr,background:mode===k?C.plum:C.white,color:mode===k?C.white:C.txtM,fontSize:"10px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}},patterns[k].name);})),
    React.createElement("div",{style:{width:"120px",height:"120px",borderRadius:"50%",margin:"0 auto 12px",background:"conic-gradient("+phaseColors[phase]+" "+progress+"%, "+C.bg+" "+progress+"%)",display:"flex",alignItems:"center",justifyContent:"center",transition:"all .3s"}},
      React.createElement("div",{style:{width:"100px",height:"100px",borderRadius:"50%",background:C.white,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"}},
        active?React.createElement(React.Fragment,null,
          React.createElement("p",{style:{fontSize:"16px",fontFamily:F.s,fontWeight:"700",color:phaseColors[phase],margin:0}},phaseLabels[phase]),
          React.createElement("p",{style:{fontSize:"10px",fontFamily:F.s,color:C.txtL,margin:"2px 0 0"}},LANG_STORE==="en"?"Round ":"Ciclo "+rounds)
        ):React.createElement("p",{style:{fontSize:"12px",fontFamily:F.s,color:C.txtM,margin:0}},pat.name)
      )
    ),
    React.createElement("button",{onClick:active?stop:start,style:{padding:"10px 24px",borderRadius:"12px",border:"none",background:active?C.rose:"linear-gradient(135deg,"+C.plum+","+C.sage+")",color:C.white,fontSize:"12px",fontFamily:F.s,fontWeight:"700",cursor:"pointer"}},active?(LANG_STORE==="en"?"Stop":"Stop"):(LANG_STORE==="en"?"Start Breathing":"Inizia"))
  );
}
function SleepTracker(){
  var _s1=useState(function(){return LD("sleepLog",[]);}),log=_s1[0],setLog=_s1[1];
  var _s2=useState({date:todayK(),hours:"",quality:3,bedtime:"23:00",waketime:"07:00"}),form=_s2[0],setForm=_s2[1];
  function addSleep(){if(!form.hours)return;var e=Object.assign({},form,{hours:parseFloat(form.hours)});var u=[e].concat(log.filter(function(l){return l.date!==form.date;}));setLog(u);SV("sleepLog",u);setForm({date:todayK(),hours:"",quality:3,bedtime:"23:00",waketime:"07:00"});}
  var avg7=log.length>0?(log.slice(0,7).reduce(function(a,b){return a+b.hours;},0)/Math.min(log.length,7)).toFixed(1):"--";
  var avgQ=log.length>0?(log.slice(0,7).reduce(function(a,b){return a+b.quality;},0)/Math.min(log.length,7)).toFixed(1):"--";
  return React.createElement(Cd,null,
    React.createElement("h5",{style:{fontFamily:F.s,fontSize:"12px",fontWeight:"600",color:C.plum,margin:"0 0 6px"}},LANG_STORE==="en"?"\ud83d\ude34 Sleep Tracker":"😴 Tracker Sonno"),
    React.createElement("p",{style:{fontSize:"9px",fontFamily:F.s,color:C.txtL,margin:"0 0 10px"}},LANG_STORE==="en"?"<7h sleep raises cortisol and insulin resistance":"<7h di sonno alza cortisolo e insulino-resistenza"),
    React.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"6px",marginBottom:"8px"}},
      React.createElement("div",{style:{textAlign:"center",padding:"8px",borderRadius:"8px",background:C.sageP}},React.createElement("p",{style:{fontSize:"16px",fontFamily:F.p,fontWeight:"700",color:parseFloat(avg7)>=7?C.sage:C.rose,margin:0}},avg7+"h"),React.createElement("p",{style:{fontSize:"8px",color:C.txtL,margin:0}},LANG_STORE==="en"?"7d avg":"Media 7gg")),
      React.createElement("div",{style:{textAlign:"center",padding:"8px",borderRadius:"8px",background:C.plumP}},React.createElement("p",{style:{fontSize:"16px",fontFamily:F.p,fontWeight:"700",color:C.plum,margin:0}},avgQ+"/5"),React.createElement("p",{style:{fontSize:"8px",color:C.txtL,margin:0}},LANG_STORE==="en"?"Quality":"Qualita"))
    ),
    React.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"6px",marginBottom:"6px"}},
      React.createElement("div",null,React.createElement("label",{style:lS},LANG_STORE==="en"?"Hours":"Ore"),React.createElement("input",{type:"number",step:"0.5",value:form.hours,onChange:function(e){setForm(Object.assign({},form,{hours:e.target.value}));},placeholder:"7.5",style:iS})),
      React.createElement("div",null,React.createElement("label",{style:lS},LANG_STORE==="en"?"Bed":"Letto"),React.createElement("input",{type:"time",value:form.bedtime,onChange:function(e){setForm(Object.assign({},form,{bedtime:e.target.value}));},style:iS})),
      React.createElement("div",null,React.createElement("label",{style:lS},LANG_STORE==="en"?"Wake":"Sveglia"),React.createElement("input",{type:"time",value:form.waketime,onChange:function(e){setForm(Object.assign({},form,{waketime:e.target.value}));},style:iS}))
    ),
    React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},
      React.createElement("div",{style:{display:"flex",gap:"2px"}},["1","2","3","4","5"].map(function(r){return React.createElement("button",{key:r,onClick:function(){setForm(Object.assign({},form,{quality:parseInt(r)}));},style:{background:"none",border:"none",fontSize:"16px",cursor:"pointer",opacity:parseInt(r)<=form.quality?1:0.25}},"\ud83c\udf19");})),
      React.createElement("button",{onClick:addSleep,style:{padding:"8px 16px",borderRadius:"10px",border:"none",background:C.plum,color:C.white,fontSize:"11px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}},LANG_STORE==="en"?"Save":"Salva")
    )
  );
}
function AntiInflamScore(){
  var habits=LD("habits",{});var todayH=habits[todayK()]||{};
  var sleepLog=LD("sleepLog",[]);var todaySleep=sleepLog.find(function(s){return s.date===todayK();});
  var water=LD("water_"+todayK(),0);var waterG=LD("profile",{waterG:8}).waterG||8;
  var suppLog=LD("suppLog",{});var todaySupp=suppLog[todayK()]||{};
  var symptoms=LD("symptoms",[]);var todaySym=symptoms.find(function(s){return s.date===todayK();});
  var scores=[];
  scores.push({name:LANG_STORE==="en"?"Water":"Acqua",val:Math.min(water/waterG*100,100),icon:"\ud83d\udca7"});
  scores.push({name:LANG_STORE==="en"?"Sleep":"Sonno",val:todaySleep?Math.min(todaySleep.hours/7.5*100,100):0,icon:"\ud83d\ude34"});
  scores.push({name:LANG_STORE==="en"?"Workout":"Allenamento",val:todayH.workout_ok?100:0,icon:"\ud83c\udfcb\ufe0f"});
  scores.push({name:LANG_STORE==="en"?"Habits":"Abitudini",val:HABIT_DEFS.length>0?(HABIT_DEFS.filter(function(h){return todayH[h.k];}).length/HABIT_DEFS.length*100):0,icon:"\u2705"});
  var suppCount=SUPP_DEFS.length>0?Object.keys(todaySupp).filter(function(k){return todaySupp[k];}).length:0;
  scores.push({name:LANG_STORE==="en"?"Supplements":"Integratori",val:SUPP_DEFS.length>0?(suppCount/SUPP_DEFS.length*100):0,icon:"\ud83d\udc8a"});
  var stressVal=todaySym&&todaySym.vals?todaySym.vals.stress||0:0;
  scores.push({name:LANG_STORE==="en"?"Low Stress":"Poco Stress",val:stressVal>0?Math.max(0,(5-stressVal)/4*100):50,icon:"\ud83e\udde0"});
  var total=Math.round(scores.reduce(function(a,b){return a+b.val;},0)/scores.length);
  var tColor=total>=70?C.sage:total>=40?C.amber:C.rose;
  var tLabel=total>=70?(LANG_STORE==="en"?"Excellent! Low inflammation":"Eccellente! Bassa infiammazione"):total>=40?(LANG_STORE==="en"?"Good, room to improve":"Buono, margini di miglioramento"):(LANG_STORE==="en"?"Focus on anti-inflammatory habits today":"Concentrati su abitudini anti-infiammatorie oggi");
  return React.createElement(Cd,{style:{borderLeft:"4px solid "+tColor}},
    React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"}},
      React.createElement("h5",{style:{fontFamily:F.s,fontSize:"12px",fontWeight:"600",color:C.plum,margin:0}},LANG_STORE==="en"?"\ud83d\udfe2 Anti-Inflammatory Score":"\ud83d\udfe2 Punteggio Anti-Infiammatorio"),
      React.createElement("div",{style:{width:"44px",height:"44px",borderRadius:"50%",background:"conic-gradient("+tColor+" "+total+"%, "+C.bg+" "+total+"%)",display:"flex",alignItems:"center",justifyContent:"center"}},
        React.createElement("div",{style:{width:"36px",height:"36px",borderRadius:"50%",background:C.white,display:"flex",alignItems:"center",justifyContent:"center"}},
          React.createElement("span",{style:{fontSize:"13px",fontFamily:F.s,fontWeight:"700",color:tColor}},total)
        )
      )
    ),
    React.createElement("p",{style:{fontSize:"10px",fontFamily:F.s,color:tColor,margin:"0 0 8px",fontWeight:"600"}},tLabel),
    React.createElement("div",{style:{display:"grid",gap:"4px"}},scores.map(function(s,i){return React.createElement("div",{key:i,style:{display:"flex",alignItems:"center",gap:"8px"}},
      React.createElement("span",{style:{fontSize:"12px",width:"18px",textAlign:"center"}},s.icon),
      React.createElement("span",{style:{fontSize:"9px",fontFamily:F.s,color:C.txtM,width:"70px"}},s.name),
      React.createElement("div",{style:{flex:1,height:"6px",borderRadius:"3px",background:C.bg}},React.createElement("div",{style:{width:s.val+"%",height:"100%",borderRadius:"3px",background:s.val>=70?C.sage:s.val>=40?C.amber:C.rose,transition:"width .5s"}})),
      React.createElement("span",{style:{fontSize:"9px",fontFamily:F.s,fontWeight:"600",color:s.val>=70?C.sage:s.val>=40?C.amber:C.rose,width:"28px",textAlign:"right"}},Math.round(s.val)+"%")
    );}))
  );
}
/* MONTHLY PDF REPORT */
function MonthlyReport(props){
  var profile=props.profile;
  var _s=useState(false),generating=_s[0],setGenerating=_s[1];
  function generate(){
    setGenerating(true);
    var weighins=LD("weighins",[]);var symptoms=LD("symptoms",[]);var habits=LD("habits",{});var bodyMeas=LD("bodyMeas",[]);var fasts=LD("fasts",[]);var workouts=LD("workouts",[]);var suppLog=LD("suppLog",{});var bloodwork=LD("bloodwork",[]);
    var now=new Date();var monthName=now.toLocaleDateString(LANG_STORE==="en"?"en-US":"it-IT",{month:"long",year:"numeric"});
    var last30w=weighins.filter(function(w){var d=new Date(w.date);return(now-d)<30*86400000;});
    var firstW=last30w.length>0?last30w[0].weight:null;var lastW=last30w.length>0?last30w[last30w.length-1].weight:null;
    var wChange=firstW&&lastW?(lastW-firstW).toFixed(1):null;
    var habitDays=Object.keys(habits);var last30h=habitDays.filter(function(d){return(now-new Date(d))<30*86400000;});
    var habitStats=HABIT_DEFS.map(function(h){var done=last30h.filter(function(d){return habits[d]&&habits[d][h.k];}).length;return{name:LANG_STORE==="en"?h.lEN:h.l,done:done,total:last30h.length,pct:last30h.length>0?Math.round(done/last30h.length*100):0};});
    var workoutCount=workouts.filter(function(w){return(now-new Date(w.date))<30*86400000;}).length;
    var fastCount=fasts.filter(function(f){return(now-new Date(f.date))<30*86400000;}).length;
    var symptomAvgs={};if(symptoms.length>0){var last30s=symptoms.filter(function(s){return(now-new Date(s.date))<30*86400000;});SYMPTOMS_DEF.forEach(function(sd){var vals=last30s.filter(function(s){return s.vals[sd.k];}).map(function(s){return s.vals[sd.k];});symptomAvgs[sd.k]={name:LANG_STORE==="en"?sd.lEN:sd.l,avg:vals.length>0?(vals.reduce(function(a,b){return a+b;},0)/vals.length).toFixed(1):"--",icon:sd.i};});}
    var suppStats=SUPP_DEFS.map(function(s){var taken=0;var total=0;for(var i=0;i<30;i++){var d=new Date();d.setDate(d.getDate()-i);var key=d.toISOString().slice(0,10);total++;if(suppLog[key]&&suppLog[key][s.k])taken++;}return{name:s.n,pct:total>0?Math.round(taken/total*100):0};});
    var latestMeas=bodyMeas.length>0?bodyMeas[0]:null;
    var html='<!DOCTYPE html><html><head><meta charset="utf-8"><title>PCOS Daily - '+(LANG_STORE==="en"?"Monthly Report":"Report Mensile")+'</title><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:system-ui,sans-serif;padding:32px;max-width:800px;margin:0 auto;color:#3a3228;font-size:13px}h1{font-size:22px;color:#7B6B8D;margin-bottom:4px}h2{font-size:15px;color:#8B9E7E;margin:20px 0 8px;border-bottom:2px solid #E8F0E4;padding-bottom:4px}h3{font-size:13px;color:#7B6B8D;margin:12px 0 6px}.card{background:#faf8f4;border:1px solid #E8DFD6;border-radius:10px;padding:14px;margin-bottom:10px}.grid2{display:grid;grid-template-columns:1fr 1fr;gap:8px}.grid3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px}.stat{text-align:center;padding:10px;background:white;border-radius:8px}.stat-val{font-size:20px;font-weight:700}.stat-lbl{font-size:9px;color:#9B8E82;margin-top:2px}.bar{height:8px;border-radius:4px;background:#E8DFD6;margin-top:4px}.bar-fill{height:100%;border-radius:4px}.green{color:#6B7F5E}.rose{color:#C4918A}.plum{color:#7B6B8D}table{width:100%;border-collapse:collapse;font-size:11px}td,th{padding:6px 8px;border-bottom:1px solid #E8DFD6;text-align:left}th{background:#f3f0ff;color:#7B6B8D;font-weight:600}.footer{text-align:center;margin-top:24px;font-size:9px;color:#9B8E82}@media print{body{padding:16px}}</style></head><body>';
    html+='<h1>PCOS Daily \u2014 '+(LANG_STORE==="en"?"Monthly Report":"Report Mensile")+'</h1>';
    html+='<p style="color:#9B8E82;margin-bottom:16px">'+monthName+' | '+(profile.name||"Utente")+'</p>';
    html+='<h2>\u2696\ufe0f '+(LANG_STORE==="en"?"Weight & Body":"Peso & Corpo")+'</h2><div class="grid3">';
    html+='<div class="stat"><div class="stat-val green">'+(lastW||"--")+'kg</div><div class="stat-lbl">'+(LANG_STORE==="en"?"Current":"Attuale")+'</div></div>';
    html+='<div class="stat"><div class="stat-val '+(wChange&&parseFloat(wChange)<0?"green":"rose")+'">'+(wChange?wChange:"--")+'kg</div><div class="stat-lbl">'+(LANG_STORE==="en"?"Change":"Variazione")+'</div></div>';
    html+='<div class="stat"><div class="stat-val plum">'+(latestMeas&&latestMeas.waist&&latestMeas.hips?(parseFloat(latestMeas.waist)/parseFloat(latestMeas.hips)).toFixed(2):"--")+'</div><div class="stat-lbl">WHR</div></div></div>';
    if(latestMeas){html+='<div class="card"><strong>'+(LANG_STORE==="en"?"Latest Measurements":"Ultime Misure")+':</strong> '+(LANG_STORE==="en"?"Waist":"Vita")+': '+latestMeas.waist+'cm | '+(LANG_STORE==="en"?"Hips":"Fianchi")+': '+(latestMeas.hips||"-")+'cm | '+(LANG_STORE==="en"?"Thigh":"Coscia")+': '+(latestMeas.thigh||"-")+'cm</div>';}
    html+='<h2>\ud83c\udfaf '+(LANG_STORE==="en"?"Activity":"Attivita")+'</h2><div class="grid3">';
    html+='<div class="stat"><div class="stat-val green">'+workoutCount+'</div><div class="stat-lbl">'+(LANG_STORE==="en"?"Workouts":"Allenamenti")+'</div></div>';
    html+='<div class="stat"><div class="stat-val plum">'+fastCount+'</div><div class="stat-lbl">'+(LANG_STORE==="en"?"Fasts completed":"Digiuni completati")+'</div></div>';
    html+='<div class="stat"><div class="stat-val green">'+last30h.length+'</div><div class="stat-lbl">'+(LANG_STORE==="en"?"Days tracked":"Giorni tracciati")+'</div></div></div>';
    html+='<h2>\ud83d\udd25 '+(LANG_STORE==="en"?"Habit Adherence":"Aderenza Abitudini")+'</h2><table><tr><th>'+(LANG_STORE==="en"?"Habit":"Abitudine")+'</th><th>'+(LANG_STORE==="en"?"Days":"Giorni")+'</th><th>%</th></tr>';
    habitStats.forEach(function(h){html+='<tr><td>'+h.name+'</td><td>'+h.done+'/'+h.total+'</td><td><strong style="color:'+(h.pct>=70?"#6B7F5E":h.pct>=40?"#D4A574":"#C4918A")+'">'+h.pct+'%</strong></td></tr>';});
    html+='</table>';
    html+='<h2>\ud83d\udcca '+(LANG_STORE==="en"?"Symptoms (30d avg)":"Sintomi (media 30gg)")+'</h2><div class="grid2">';
    Object.keys(symptomAvgs).forEach(function(k){var s=symptomAvgs[k];html+='<div class="card">'+s.icon+' '+s.name+': <strong>'+s.avg+'</strong>/5</div>';});
    html+='</div>';
    html+='<h2>\ud83d\udc8a '+(LANG_STORE==="en"?"Supplement Adherence":"Aderenza Integratori")+'</h2><table><tr><th>'+(LANG_STORE==="en"?"Supplement":"Integratore")+'</th><th>'+(LANG_STORE==="en"?"Adherence":"Aderenza")+'</th></tr>';
    suppStats.forEach(function(s){html+='<tr><td>'+s.name+'</td><td><strong style="color:'+(s.pct>=70?"#6B7F5E":s.pct>=40?"#D4A574":"#C4918A")+'">'+s.pct+'%</strong></td></tr>';});
    html+='</table>';
    if(bloodwork.length>0){html+='<h2>\ud83e\ude78 '+(LANG_STORE==="en"?"Latest Blood Work":"Ultime Analisi")+'</h2><table><tr><th>'+(LANG_STORE==="en"?"Test":"Esame")+'</th><th>'+(LANG_STORE==="en"?"Value":"Valore")+'</th><th>'+(LANG_STORE==="en"?"Date":"Data")+'</th></tr>';var latest=bloodwork[0];if(latest&&latest.tests){latest.tests.forEach(function(t){html+='<tr><td>'+t.name+'</td><td><strong>'+t.value+' '+t.unit+'</strong></td><td>'+latest.date+'</td></tr>';});}html+='</table>';}
    html+='<div class="footer"><p>PCOS Daily v5.1 | lotusflowerpcos.com | '+(LANG_STORE==="en"?"Generated":"Generato")+' '+new Date().toLocaleDateString()+'</p><p style="margin-top:4px">'+(LANG_STORE==="en"?"This report is for informational purposes. Always consult your doctor.":"Questo report e a scopo informativo. Consulta sempre il tuo medico.")+'</p></div></body></html>';
    var w=window.open("","_blank");w.document.write(html);w.document.close();w.print();
    setGenerating(false);
  }
  return React.createElement(Cd,{style:{textAlign:"center",marginTop:"12px"}},
    React.createElement("h5",{style:{fontFamily:F.s,fontSize:"12px",fontWeight:"600",color:C.plum,margin:"0 0 6px"}},LANG_STORE==="en"?"\ud83d\udcc4 Monthly Report":"\ud83d\udcc4 Report Mensile"),
    React.createElement("p",{style:{fontSize:"10px",fontFamily:F.s,color:C.txtL,margin:"0 0 10px"}},LANG_STORE==="en"?"Generate a printable PDF report with weight, symptoms, habits, supplements and blood work":"Genera un report stampabile con peso, sintomi, abitudini, integratori e analisi del sangue"),
    React.createElement("button",{onClick:generate,disabled:generating,style:{padding:"12px 24px",borderRadius:"12px",border:"none",background:generating?C.bdr:"linear-gradient(135deg,"+C.plum+","+C.rose+")",color:C.white,fontSize:"13px",fontFamily:F.s,fontWeight:"700",cursor:"pointer"}},generating?"\u23f3...":(LANG_STORE==="en"?"\ud83d\udda8\ufe0f Generate & Print":"\ud83d\udda8\ufe0f Genera e Stampa"))
  );
}

/* ONBOARDING WIZARD */
function OnboardingWizard(props){
  var setProfile=props.setProfile;
  var _s1=useState(0),step=_s1[0],setStep=_s1[1];
  var _s2=useState({name:"",age:27,height:168,weight:77,goalW:68,bf:29,goalBf:23,ifH:14,ifOpen:"10:00",ifClose:"20:00",stepsG:10000,waterG:8,workoutsG:4,allergies:[],pcosType:"classic",fitnessLevel:"beginner"}),form=_s2[0],setForm=_s2[1];
  function upd(k,v){var u=Object.assign({},form);u[k]=v;setForm(u);}
  function finish(){var prof=Object.assign({},form);SV("profile",prof);SV("pcos_onboarded",true);props.setProfile(prof);if(_syncUid){syncToCloud(_syncUid).then(function(){window.location.reload();}).catch(function(){window.location.reload();});}else{window.location.reload();}}
  var ALLERGY_OPTS=["Lattosio","Glutine","Frutta secca","Uova","Soia","Pesce"];
  function toggleAllergy(a){var u=form.allergies.slice();var i=u.indexOf(a);if(i===-1)u.push(a);else u.splice(i,1);upd("allergies",u);}
  var steps=[
    function(){return React.createElement("div",{style:{textAlign:"center"}},
      React.createElement("span",{style:{fontSize:"48px"}},"\ud83c\udf38"),
      React.createElement("h2",{style:{fontFamily:F.p,fontSize:"22px",color:C.plum,margin:"12px 0 6px"}},LANG_STORE==="en"?"Welcome to PCOS Daily!":"Benvenuta in PCOS Daily!"),
      React.createElement("p",{style:{fontSize:"12px",fontFamily:F.s,color:C.txtM,lineHeight:1.6,margin:"0 0 16px"}},LANG_STORE==="en"?"Let's set up your profile in a few steps to personalize your experience.":"Configuriamo il tuo profilo in pochi passi per personalizzare la tua esperienza."),
      React.createElement("div",null,React.createElement("label",{style:lS},LANG_STORE==="en"?"Your name":"Il tuo nome"),React.createElement("input",{value:form.name,onChange:function(e){upd("name",e.target.value);},placeholder:"Andrea",style:iS}))
    );},
    function(){return React.createElement("div",null,
      React.createElement("h3",{style:{fontFamily:F.p,fontSize:"16px",color:C.plum,margin:"0 0 12px"}},LANG_STORE==="en"?"\ud83d\udccf Body Data":"\ud83d\udccf Dati Corpo"),
      React.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px"}},
        React.createElement("div",null,React.createElement("label",{style:lS},LANG_STORE==="en"?"Age":"Eta"),React.createElement("input",{type:"number",value:form.age,onChange:function(e){upd("age",parseInt(e.target.value)||27);},style:iS})),
        React.createElement("div",null,React.createElement("label",{style:lS},LANG_STORE==="en"?"Height (cm)":"Altezza (cm)"),React.createElement("input",{type:"number",value:form.height,onChange:function(e){upd("height",parseInt(e.target.value)||168);},style:iS})),
        React.createElement("div",null,React.createElement("label",{style:lS},LANG_STORE==="en"?"Current weight (kg)":"Peso attuale (kg)"),React.createElement("input",{type:"number",step:"0.1",value:form.weight,onChange:function(e){upd("weight",parseFloat(e.target.value)||77);},style:iS})),
        React.createElement("div",null,React.createElement("label",{style:lS},LANG_STORE==="en"?"Goal weight (kg)":"Peso obiettivo (kg)"),React.createElement("input",{type:"number",step:"0.1",value:form.goalW,onChange:function(e){upd("goalW",parseFloat(e.target.value)||68);},style:iS})),
        React.createElement("div",null,React.createElement("label",{style:lS},LANG_STORE==="en"?"Body fat %":"% Grasso"),React.createElement("input",{type:"number",value:form.bf,onChange:function(e){upd("bf",parseInt(e.target.value)||29);},style:iS})),
        React.createElement("div",null,React.createElement("label",{style:lS},LANG_STORE==="en"?"Goal body fat %":"% Grasso obiettivo"),React.createElement("input",{type:"number",value:form.goalBf,onChange:function(e){upd("goalBf",parseInt(e.target.value)||23);},style:iS}))
      )
    );},
    function(){return React.createElement("div",null,
      React.createElement("h3",{style:{fontFamily:F.p,fontSize:"16px",color:C.plum,margin:"0 0 12px"}},LANG_STORE==="en"?"\u23f3 Intermittent Fasting":"\u23f3 Digiuno Intermittente"),
      React.createElement("p",{style:{fontSize:"11px",fontFamily:F.s,color:C.txtM,margin:"0 0 12px"}},LANG_STORE==="en"?"Set your fasting window. 14:10 or 16:8 are recommended for PCOS.":"Imposta la tua finestra di digiuno. 14:10 o 16:8 sono raccomandate per la PCOS."),
      React.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"8px"}},
        React.createElement("div",null,React.createElement("label",{style:lS},LANG_STORE==="en"?"Fasting hours":"Ore digiuno"),React.createElement("input",{type:"number",value:form.ifH,onChange:function(e){var v=parseInt(e.target.value)||14;upd("ifH",v);},style:iS})),
        React.createElement("div",null,React.createElement("label",{style:lS},LANG_STORE==="en"?"Eating starts":"Inizio pasti"),React.createElement("input",{type:"time",value:form.ifOpen,onChange:function(e){upd("ifOpen",e.target.value);},style:iS})),
        React.createElement("div",null,React.createElement("label",{style:lS},LANG_STORE==="en"?"Eating ends":"Fine pasti"),React.createElement("input",{type:"time",value:form.ifClose,onChange:function(e){upd("ifClose",e.target.value);},style:iS}))
      ),
      React.createElement("div",{style:{display:"flex",gap:"6px",marginTop:"12px",flexWrap:"wrap"}},
        [{l:"14:10",h:14,o:"10:00",c:"20:00"},{l:"16:8",h:16,o:"12:00",c:"20:00"},{l:"18:6",h:18,o:"12:00",c:"18:00"}].map(function(preset){return React.createElement("button",{key:preset.l,onClick:function(){upd("ifH",preset.h);upd("ifOpen",preset.o);upd("ifClose",preset.c);},style:{padding:"8px 14px",borderRadius:"10px",border:"1.5px solid "+(form.ifH===preset.h?C.sage:C.bdr),background:form.ifH===preset.h?C.sageP:C.white,color:form.ifH===preset.h?C.sageD:C.txtM,fontSize:"12px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}},preset.l);})
      )
    );},
    function(){return React.createElement("div",null,
      React.createElement("h3",{style:{fontFamily:F.p,fontSize:"16px",color:C.plum,margin:"0 0 12px"}},LANG_STORE==="en"?"\ud83c\udfcb\ufe0f Goals & Fitness":"\ud83c\udfcb\ufe0f Obiettivi & Fitness"),
      React.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px",marginBottom:"12px"}},
        React.createElement("div",null,React.createElement("label",{style:lS},LANG_STORE==="en"?"Daily steps goal":"Obiettivo passi"),React.createElement("input",{type:"number",step:"1000",value:form.stepsG,onChange:function(e){upd("stepsG",parseInt(e.target.value)||10000);},style:iS})),
        React.createElement("div",null,React.createElement("label",{style:lS},LANG_STORE==="en"?"Workouts/week":"Allenamenti/sett."),React.createElement("input",{type:"number",value:form.workoutsG,onChange:function(e){upd("workoutsG",parseInt(e.target.value)||4);},style:iS}))
      ),
      React.createElement("label",{style:lS},LANG_STORE==="en"?"Allergies/Intolerances":"Allergie/Intolleranze"),
      React.createElement("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px"}},ALLERGY_OPTS.map(function(a){var sel=form.allergies.indexOf(a)!==-1;return React.createElement("button",{key:a,onClick:function(){toggleAllergy(a);},style:{padding:"6px 12px",borderRadius:"16px",border:"1.5px solid "+(sel?C.rose:C.bdr),background:sel?C.roseP:C.white,color:sel?C.rose:C.txtM,fontSize:"11px",fontFamily:F.s,cursor:"pointer"}},a);}))
    );},
    function(){var mc=calcMacros(form);return React.createElement("div",{style:{textAlign:"center"}},
      React.createElement("span",{style:{fontSize:"48px"}},"\u2705"),
      React.createElement("h2",{style:{fontFamily:F.p,fontSize:"20px",color:C.sage,margin:"12px 0 6px"}},LANG_STORE==="en"?"You're all set!":"Tutto pronto!"),
      React.createElement("p",{style:{fontSize:"11px",fontFamily:F.s,color:C.txtM,margin:"0 0 16px"}},LANG_STORE==="en"?"Here's your personalized plan:":"Ecco il tuo piano personalizzato:"),
      React.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px",textAlign:"center"}},
        React.createElement(Cd,null,React.createElement("p",{style:{fontSize:"20px",fontFamily:F.p,fontWeight:"700",color:C.sage,margin:0}},"~"+mc.target),React.createElement("p",{style:{fontSize:"9px",color:C.txtL,margin:0}},"kcal/"+( LANG_STORE==="en"?"day":"giorno"))),
        React.createElement(Cd,null,React.createElement("p",{style:{fontSize:"20px",fontFamily:F.p,fontWeight:"700",color:C.plum,margin:0}},mc.prot+"g"),React.createElement("p",{style:{fontSize:"9px",color:C.txtL,margin:0}},LANG_STORE==="en"?"Protein":"Proteine")),
        React.createElement(Cd,null,React.createElement("p",{style:{fontSize:"20px",fontFamily:F.p,fontWeight:"700",color:C.amber,margin:0}},mc.carb+"g"),React.createElement("p",{style:{fontSize:"9px",color:C.txtL,margin:0}},"Carb")),
        React.createElement(Cd,null,React.createElement("p",{style:{fontSize:"20px",fontFamily:F.p,fontWeight:"700",color:C.rose,margin:0}},mc.fat+"g"),React.createElement("p",{style:{fontSize:"9px",color:C.txtL,margin:0}},LANG_STORE==="en"?"Fat":"Grassi"))
      ),
      React.createElement("p",{style:{fontSize:"10px",fontFamily:F.s,color:C.txtM,margin:"12px 0 0"}},LANG_STORE==="en"?"IF "+form.ifH+":"+(24-form.ifH)+" | Eating "+form.ifOpen+"-"+form.ifClose:"IF "+form.ifH+":"+(24-form.ifH)+" | Pasti "+form.ifOpen+"-"+form.ifClose)
    );}
  ];
  var totalSteps=steps.length;
  return React.createElement("div",{style:{minHeight:"100vh",background:"linear-gradient(180deg,"+C.bg+","+C.bgW+")",display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"}},
    React.createElement("div",{style:{maxWidth:"440px",width:"100%"}},
      React.createElement("div",{style:{display:"flex",gap:"4px",marginBottom:"16px"}},Array.from({length:totalSteps}).map(function(_,i){return React.createElement("div",{key:i,style:{flex:1,height:"4px",borderRadius:"2px",background:i<=step?C.plum:C.bdr,transition:"all .3s"}});})),
      React.createElement(Cd,{style:{padding:"24px"}},steps[step]()),
      React.createElement("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"12px"}},
        step>0?React.createElement("button",{onClick:function(){setStep(step-1);},style:{padding:"10px 20px",borderRadius:"10px",border:"1px solid "+C.bdr,background:C.white,color:C.txtM,fontSize:"12px",fontFamily:F.s,cursor:"pointer"}},"\u2190 "+(LANG_STORE==="en"?"Back":"Indietro")):React.createElement("div",null),
        step<totalSteps-1?React.createElement("button",{onClick:function(){setStep(step+1);},style:{padding:"10px 20px",borderRadius:"10px",border:"none",background:"linear-gradient(135deg,"+C.sage+","+C.sageD+")",color:C.white,fontSize:"12px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}},(LANG_STORE==="en"?"Next":"Avanti")+" \u2192"):React.createElement("button",{onClick:finish,style:{padding:"10px 24px",borderRadius:"10px",border:"none",background:"linear-gradient(135deg,"+C.plum+","+C.rose+")",color:C.white,fontSize:"13px",fontFamily:F.s,fontWeight:"700",cursor:"pointer"}},LANG_STORE==="en"?"\ud83c\udf38 Start!":"\ud83c\udf38 Inizia!")
      )
    )
  );
}

/* ═══════ PHASE 13: CYCLE ADAPTATION ═══════ */
var CYCLE_WORKOUTS=[
{phase:0,name:LANG_STORE==="en"?"Menstrual":"Mestruale",workouts:[
  {type:LANG_STORE==="en"?"Light Walk":"Camminata Leggera",dur:"20-30 min",desc:LANG_STORE==="en"?"Gentle movement to reduce cramps. Keep heart rate low.":"Movimento dolce per ridurre i crampi. Mantieni FC bassa.",icon:"\ud83d\udeb6\u200d\u2640\ufe0f",intensity:1},
  {type:"Yoga Restaurativo",dur:"20-30 min",desc:LANG_STORE==="en"?"Child's pose, cat-cow, supine twist. Releases tension in lower back and pelvis.":"Posizione del bambino, gatto-mucca, torsione supina. Rilascia tensione in zona lombare e bacino.",icon:"\ud83e\uddd8\u200d\u2640\ufe0f",intensity:1},
  {type:LANG_STORE==="en"?"Stretching":"Stretching",dur:"15-20 min",desc:LANG_STORE==="en"?"Full body gentle stretching. Focus on hips and lower back.":"Stretching dolce full body. Focus su anche e zona lombare.",icon:"\ud83e\udd38\u200d\u2640\ufe0f",intensity:1}
]},
{phase:1,name:LANG_STORE==="en"?"Follicular":"Follicolare",workouts:[
  {type:LANG_STORE==="en"?"Strength Training":"Allenamento Forza",dur:"40-50 min",desc:LANG_STORE==="en"?"Estrogen rises → best time for heavy lifts! Compound movements: squat, deadlift, hip thrust, rows.":"L'estrogeno sale → momento migliore per carichi pesanti! Movimenti composti: squat, stacco, hip thrust, rematore.",icon:"\ud83c\udfcb\ufe0f\u200d\u2640\ufe0f",intensity:4},
  {type:"HIIT",dur:"25-30 min",desc:LANG_STORE==="en"?"High intensity intervals. Your body recovers faster now. Tabata or circuit training.":"Intervalli ad alta intensita. Il corpo recupera piu velocemente. Tabata o circuit training.",icon:"\u26a1",intensity:5},
  {type:LANG_STORE==="en"?"Power Walk + Incline":"Camminata Potenza + Pendenza",dur:"40 min",desc:LANG_STORE==="en"?"Brisk walk with incline intervals. Great for abdominal fat burning.":"Camminata veloce con intervalli di pendenza. Ottimo per bruciare grasso addominale.",icon:"\u26f0\ufe0f",intensity:3}
]},
{phase:2,name:LANG_STORE==="en"?"Ovulatory":"Ovulatoria",workouts:[
  {type:LANG_STORE==="en"?"Peak Strength":"Forza Massima",dur:"45 min",desc:LANG_STORE==="en"?"Estrogen peaks → maximum strength! PR attempts. Heavy compound lifts with lower reps.":"Picco estrogeni → forza massima! Tentativi di PR. Sollevamenti pesanti composti con basse ripetizioni.",icon:"\ud83d\udcaa",intensity:5},
  {type:LANG_STORE==="en"?"Cardio Intervals":"Intervalli Cardio",dur:"30 min",desc:LANG_STORE==="en"?"Sprint intervals or cycling HIIT. Energy is at its peak.":"Intervalli di sprint o ciclismo HIIT. L'energia e al massimo.",icon:"\ud83c\udfc3\u200d\u2640\ufe0f",intensity:4},
  {type:LANG_STORE==="en"?"Group Class":"Classe di Gruppo",dur:"45-60 min",desc:LANG_STORE==="en"?"Social energy is high. Dance, boxing, spinning are great choices.":"Energia sociale alta. Danza, boxe, spinning sono ottime scelte.",icon:"\ud83d\udc83",intensity:4}
]},
{phase:3,name:LANG_STORE==="en"?"Luteal":"Luteale",workouts:[
  {type:LANG_STORE==="en"?"Moderate Strength":"Forza Moderata",dur:"35-40 min",desc:LANG_STORE==="en"?"Lower weights, higher reps. Focus on form. Progesterone rises → body temp higher.":"Pesi piu bassi, piu ripetizioni. Focus sulla forma. Il progesterone sale → temp. corporea piu alta.",icon:"\ud83c\udfcb\ufe0f",intensity:3},
  {type:"Pilates",dur:"30-40 min",desc:LANG_STORE==="en"?"Core strengthening without high cortisol. Excellent for deep abdominal muscles.":"Rinforzo core senza alzare il cortisolo. Eccellente per muscoli addominali profondi.",icon:"\ud83e\uddd8",intensity:2},
  {type:LANG_STORE==="en"?"Steady Walk":"Camminata Costante",dur:"40-50 min",desc:LANG_STORE==="en"?"Zone 2 cardio. Burns fat without spiking cortisol. Post-meal walks are ideal.":"Cardio zona 2. Brucia grasso senza alzare il cortisolo. Camminate post-pasto sono ideali.",icon:"\ud83d\udeb6\u200d\u2640\ufe0f",intensity:2},
  {type:"Yoga Flow",dur:"30 min",desc:LANG_STORE==="en"?"Vinyasa or yin yoga. Helps with PMS symptoms and water retention.":"Vinyasa o yin yoga. Aiuta con sintomi premestruali e ritenzione idrica.",icon:"\ud83e\uddd8\u200d\u2640\ufe0f",intensity:2}
]}
];
function CycleWorkoutSuggestions(){
  var cp=getCyclePhaseNow();
  var phaseIdx=cp?cp.phase:1;
  var phaseData=CYCLE_WORKOUTS[phaseIdx];
  var intensityBars=function(n){return Array.from({length:5}).map(function(_,i){return React.createElement("div",{key:i,style:{width:"8px",height:10+i*3+"px",borderRadius:"2px",background:i<n?C.sage:C.bg}});});};
  return React.createElement("div",{style:{display:"grid",gap:"10px",marginTop:"12px"}},
    React.createElement(Cd,{style:{background:"linear-gradient(135deg,"+(cp?CYCLE_PHASES[phaseIdx].color+"20":C.sageP)+","+C.white+")"}},
      React.createElement("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"6px"}},
        React.createElement("span",{style:{fontSize:"24px"}},cp?CYCLE_PHASES[phaseIdx].icon:"\ud83c\udf38"),
        React.createElement("div",null,
          React.createElement("h5",{style:{fontFamily:F.s,fontSize:"13px",fontWeight:"600",color:C.plum,margin:0}},LANG_STORE==="en"?"Workout for your cycle phase":"Allenamento per la tua fase del ciclo"),
          React.createElement("p",{style:{fontSize:"10px",fontFamily:F.s,color:C.txtM,margin:"2px 0 0"}},phaseData.name+(cp?" — "+(LANG_STORE==="en"?"Day ":"Giorno ")+cp.day:""))
        )
      )
    ),
    phaseData.workouts.map(function(w,i){return React.createElement(Cd,{key:i},
      React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"}},
        React.createElement("div",{style:{flex:1}},
          React.createElement("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"4px"}},
            React.createElement("span",{style:{fontSize:"18px"}},w.icon),
            React.createElement("h6",{style:{fontFamily:F.s,fontSize:"12px",fontWeight:"600",color:C.txt,margin:0}},w.type),
            React.createElement(Pill,{color:C.sage},w.dur)
          ),
          React.createElement("p",{style:{fontSize:"10px",fontFamily:F.s,color:C.txtM,margin:"4px 0 0",lineHeight:1.5}},w.desc)
        ),
        React.createElement("div",{style:{display:"flex",alignItems:"flex-end",gap:"2px",marginLeft:"8px"}},intensityBars(w.intensity))
      )
    );})
  );
}
/* CYCLE PREDICTION */
function CyclePrediction(){
  var mc=LD("menstrualCycles",[]);
  if(mc.length<2)return React.createElement(Cd,{style:{marginTop:"10px"}},
    React.createElement("h5",{style:{fontFamily:F.s,fontSize:"12px",fontWeight:"600",color:C.plum,margin:"0 0 6px"}},LANG_STORE==="en"?"\ud83d\udd2e Cycle Prediction":"\ud83d\udd2e Predizione Ciclo"),
    React.createElement("p",{style:{fontSize:"10px",fontFamily:F.s,color:C.txtL}},LANG_STORE==="en"?"Log at least 2 cycles to enable predictions":"Registra almeno 2 cicli per abilitare le predizioni")
  );
  var sorted=mc.slice().sort(function(a,b){return a.start.localeCompare(b.start);});
  var lengths=[];for(var i=1;i<sorted.length;i++){var d1=new Date(sorted[i-1].start);var d2=new Date(sorted[i].start);var diff=Math.round((d2-d1)/86400000);if(diff>15&&diff<60)lengths.push(diff);}
  if(lengths.length===0)return null;
  var avg=Math.round(lengths.reduce(function(a,b){return a+b;},0)/lengths.length);
  var lastStart=new Date(sorted[sorted.length-1].start);
  var nextPredicted=new Date(lastStart);nextPredicted.setDate(nextPredicted.getDate()+avg);
  var ovulDay=new Date(lastStart);ovulDay.setDate(ovulDay.getDate()+avg-14);
  var daysUntil=Math.round((nextPredicted-new Date())/86400000);
  var daysUntilOvul=Math.round((ovulDay-new Date())/86400000);
  var minL=Math.min.apply(null,lengths);var maxL=Math.max.apply(null,lengths);
  return React.createElement(Cd,{style:{marginTop:"10px",borderLeft:"4px solid "+C.rose}},
    React.createElement("h5",{style:{fontFamily:F.s,fontSize:"12px",fontWeight:"600",color:C.plum,margin:"0 0 8px"}},LANG_STORE==="en"?"\ud83d\udd2e Cycle Prediction":"\ud83d\udd2e Predizione Ciclo"),
    React.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"8px",marginBottom:"8px"}},
      React.createElement("div",{style:{textAlign:"center",padding:"8px",borderRadius:"8px",background:C.roseP}},React.createElement("p",{style:{fontSize:"14px",fontFamily:F.p,fontWeight:"700",color:C.rose,margin:0}},avg+(LANG_STORE==="en"?"d":"gg")),React.createElement("p",{style:{fontSize:"8px",color:C.txtL,margin:0}},LANG_STORE==="en"?"Avg length":"Durata media")),
      React.createElement("div",{style:{textAlign:"center",padding:"8px",borderRadius:"8px",background:C.roseP}},React.createElement("p",{style:{fontSize:"14px",fontFamily:F.p,fontWeight:"700",color:daysUntil<=3?C.rose:C.txt,margin:0}},daysUntil<=0?(LANG_STORE==="en"?"Today!":"Oggi!"):daysUntil+(LANG_STORE==="en"?"d":"gg")),React.createElement("p",{style:{fontSize:"8px",color:C.txtL,margin:0}},LANG_STORE==="en"?"Next period":"Prossimo ciclo")),
      React.createElement("div",{style:{textAlign:"center",padding:"8px",borderRadius:"8px",background:C.amberP}},React.createElement("p",{style:{fontSize:"14px",fontFamily:F.p,fontWeight:"700",color:C.amber,margin:0}},daysUntilOvul<=0?(LANG_STORE==="en"?"Passed":"Passata"):daysUntilOvul+(LANG_STORE==="en"?"d":"gg")),React.createElement("p",{style:{fontSize:"8px",color:C.txtL,margin:0}},LANG_STORE==="en"?"Ovulation":"Ovulazione"))
    ),
    React.createElement("div",{style:{fontSize:"9px",fontFamily:F.s,color:C.txtL}},
      React.createElement("p",{style:{margin:"2px 0"}},(LANG_STORE==="en"?"Next period: ~":"Prossimo ciclo: ~")+nextPredicted.toLocaleDateString()),
      React.createElement("p",{style:{margin:"2px 0"}},(LANG_STORE==="en"?"Cycle range: ":"Range ciclo: ")+minL+"-"+maxL+(LANG_STORE==="en"?" days | Based on ":" giorni | Basato su ")+lengths.length+(LANG_STORE==="en"?" cycles":" cicli")),
      React.createElement("p",{style:{margin:"4px 0 0",fontStyle:"italic",color:C.txtL}},LANG_STORE==="en"?"⚠️ PCOS cycles can be irregular. This is an estimate.":"⚠️ I cicli PCOS possono essere irregolari. Questa e una stima.")
    )
  );
}
/* SKIN & HAIR DIARY */
function SkinHairDiary(){
  var _s1=useState(function(){return LD("skinDiary",[]);}),log=_s1[0],setLog=_s1[1];
  var AREAS=[{k:"face_acne",l:LANG_STORE==="en"?"Face Acne":"Acne Viso",i:"\ud83d\ude36"},{k:"chin_acne",l:LANG_STORE==="en"?"Chin/Jaw Acne":"Acne Mento/Mandibola",i:"\ud83e\uddd4\u200d\u2640\ufe0f"},{k:"back_acne",l:LANG_STORE==="en"?"Back Acne":"Acne Schiena",i:"\ud83d\uded7"},{k:"hair_fall",l:LANG_STORE==="en"?"Hair Loss":"Caduta Capelli",i:"\ud83d\udc87\u200d\u2640\ufe0f"},{k:"hirsutism",l:LANG_STORE==="en"?"Excess Hair":"Irsutismo",i:"\ud83e\uddf4"},{k:"oily_skin",l:LANG_STORE==="en"?"Oily Skin":"Pelle Grassa",i:"\ud83d\udca7"},{k:"dry_skin",l:LANG_STORE==="en"?"Dry Skin":"Pelle Secca",i:"\ud83c\udf35"}];
  var _s2=useState({}),vals=_s2[0],setVals=_s2[1];
  var _s3=useState(""),note=_s3[0],setNote=_s3[1];
  var today=log.find(function(l){return l.date===todayK();});
  useEffect(function(){if(today){setVals(today.vals||{});setNote(today.note||"");}},[]);
  function save(){var entry={date:todayK(),vals:vals,note:note};var u=[entry].concat(log.filter(function(l){return l.date!==todayK();}));setLog(u);SV("skinDiary",u);}
  function setVal(k,v){var u=Object.assign({},vals);u[k]=v;setVals(u);}
  var last7=log.slice(0,7);
  return React.createElement(Cd,{style:{marginTop:"10px"}},
    React.createElement("h5",{style:{fontFamily:F.s,fontSize:"12px",fontWeight:"600",color:C.plum,margin:"0 0 6px"}},LANG_STORE==="en"?"\ud83e\uddd1 Skin & Hair Diary":"\ud83e\uddd1 Diario Pelle & Capelli"),
    React.createElement("p",{style:{fontSize:"9px",fontFamily:F.s,color:C.txtL,margin:"0 0 10px"}},LANG_STORE==="en"?"Track changes linked to cycle, diet and supplements":"Traccia i cambiamenti legati a ciclo, dieta e integratori"),
    React.createElement("div",{style:{display:"grid",gap:"6px",marginBottom:"8px"}},AREAS.map(function(a){return React.createElement("div",{key:a.k,style:{display:"flex",alignItems:"center",gap:"8px"}},
      React.createElement("span",{style:{fontSize:"14px",width:"20px",textAlign:"center"}},a.i),
      React.createElement("span",{style:{fontSize:"10px",fontFamily:F.s,color:C.txtM,width:"100px"}},a.l),
      React.createElement("div",{style:{display:"flex",gap:"3px",flex:1}},["0","1","2","3","4","5"].map(function(v){var n=parseInt(v);var selected=(vals[a.k]||0)===n;return React.createElement("button",{key:v,onClick:function(){setVal(a.k,n);},style:{flex:1,padding:"5px 0",borderRadius:"6px",border:selected?"none":"1px solid "+C.bdr,background:selected?(n===0?C.sage:n<=2?C.amber:C.rose):C.white,color:selected?C.white:C.txtL,fontSize:"10px",fontFamily:F.s,fontWeight:selected?"700":"400",cursor:"pointer"}},v);}))
    );})),
    React.createElement("textarea",{value:note,onChange:function(e){setNote(e.target.value);},placeholder:LANG_STORE==="en"?"Notes (new product, diet change...)":"Note (nuovo prodotto, cambio dieta...)",style:Object.assign({},iS,{height:"40px",resize:"none",marginBottom:"6px"})}),
    React.createElement("button",{onClick:save,style:{width:"100%",padding:"10px",borderRadius:"10px",border:"none",background:C.plum,color:C.white,fontSize:"11px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}},LANG_STORE==="en"?"Save Today":"Salva Oggi"),
    last7.length>1&&React.createElement("div",{style:{marginTop:"10px"}},
      React.createElement("h6",{style:{fontSize:"10px",fontFamily:F.s,color:C.txtL,margin:"0 0 6px"}},LANG_STORE==="en"?"7-Day Trend":"Trend 7 Giorni"),
      React.createElement("div",{style:{display:"grid",gap:"3px"}},AREAS.map(function(a){var vals7=last7.map(function(l){return(l.vals&&l.vals[a.k])||0;}).reverse();return React.createElement("div",{key:a.k,style:{display:"flex",alignItems:"center",gap:"6px"}},
        React.createElement("span",{style:{fontSize:"10px",width:"18px",textAlign:"center"}},a.i),
        React.createElement("div",{style:{display:"flex",gap:"2px",flex:1}},vals7.map(function(v,i){return React.createElement("div",{key:i,style:{flex:1,height:"12px",borderRadius:"3px",background:v===0?C.sageP:v<=2?C.amberP:C.roseP,position:"relative"}},React.createElement("div",{style:{position:"absolute",bottom:0,width:"100%",height:Math.max(v/5*12,2)+"px",borderRadius:"3px",background:v===0?C.sage:v<=2?C.amber:C.rose}}));}))
      );}))
    )
  );
}
/* ═══════ PHASE 14: EDUCATION ═══════ */
var PCOS_ENCYCLOPEDIA=[
{title:LANG_STORE==="en"?"What is PCOS?":"Cos'e la PCOS?",icon:"\ud83c\udf38",content:LANG_STORE==="en"?"Polycystic Ovary Syndrome affects 8-13% of women. It's a hormonal disorder involving insulin resistance, excess androgens, and irregular ovulation. It's NOT just about ovarian cysts — it's a metabolic and hormonal condition that affects the whole body.":"La Sindrome dell'Ovaio Policistico colpisce l'8-13% delle donne. E un disordine ormonale che coinvolge insulino-resistenza, eccesso di androgeni e ovulazione irregolare. NON si tratta solo di cisti ovariche — e una condizione metabolica e ormonale che coinvolge tutto il corpo."},
{title:LANG_STORE==="en"?"Types of PCOS":"Tipi di PCOS",icon:"\ud83d\udd2c",content:LANG_STORE==="en"?"Classic (insulin resistant + hyperandrogenic), Inflammatory (driven by chronic inflammation), Adrenal (excess DHEA-S), Post-pill (temporary after stopping birth control). Each type responds to different treatments.":"Classica (insulino-resistente + iperandrogena), Infiammatoria (guidata da infiammazione cronica), Surrenalica (eccesso DHEA-S), Post-pillola (temporanea dopo sospensione contraccettivo). Ogni tipo risponde a trattamenti diversi."},
{title:LANG_STORE==="en"?"Nutrition & PCOS":"Alimentazione e PCOS",icon:"\ud83e\udd57",content:LANG_STORE==="en"?"Low glycemic foods reduce insulin spikes. Prioritize: vegetables, legumes, whole grains, lean proteins, healthy fats. A protein-rich breakfast reduces insulin by up to 53%. Avoid: refined sugars, white flour, sugary drinks, trans fats. The Mediterranean diet is the gold standard for PCOS.":"I cibi a basso indice glicemico riducono i picchi insulinici. Privilegia: verdure, legumi, cereali integrali, proteine magre, grassi buoni. Una colazione ricca di proteine riduce l'insulina fino al 53%. Evita: zuccheri raffinati, farine bianche, bibite zuccherate, grassi trans. La dieta mediterranea e il gold standard per la PCOS."},
{title:LANG_STORE==="en"?"Exercise & PCOS":"Esercizio e PCOS",icon:"\ud83c\udfcb\ufe0f",content:LANG_STORE==="en"?"Strength training 3-4x/week builds muscle that improves insulin sensitivity. Walking 30min daily (especially post-meal) reduces blood sugar. Avoid overtraining — excess cortisol worsens PCOS. Follow your cycle: heavy lifting in follicular phase, gentle movement in luteal phase.":"Allenamento con pesi 3-4x/settimana costruisce muscolo che migliora la sensibilita insulinica. Camminare 30min al giorno (specialmente dopo i pasti) riduce la glicemia. Evita il sovrallenamento — il cortisolo in eccesso peggiora la PCOS. Segui il ciclo: carichi pesanti in fase follicolare, movimento dolce in fase luteale."},
{title:LANG_STORE==="en"?"Key Supplements":"Integratori Chiave",icon:"\ud83d\udc8a",content:LANG_STORE==="en"?"Inositol (myo + D-chiro 40:1): improves insulin sensitivity and ovulation. Vitamin D: often deficient in PCOS, supports metabolism. Omega-3: reduces inflammation. Magnesium: helps sleep, stress, insulin. Berberine: natural metformin alternative. NAC: antioxidant, helps with excess androgens. Always consult your doctor.":"Inositolo (mio + D-chiro 40:1): migliora sensibilita insulinica e ovulazione. Vitamina D: spesso carente nella PCOS, supporta il metabolismo. Omega-3: riduce l'infiammazione. Magnesio: aiuta sonno, stress, insulina. Berberina: alternativa naturale alla metformina. NAC: antiossidante, aiuta con eccesso di androgeni. Consulta sempre il medico."},
{title:LANG_STORE==="en"?"Intermittent Fasting":"Digiuno Intermittente",icon:"\u23f3",content:LANG_STORE==="en"?"14:10 or 16:8 protocols can improve insulin sensitivity and reduce inflammation. Start gentle (12:12) and build up. Break fast with protein+fat, not sugar. Don't fast if you have a history of eating disorders. Listen to your body — if stressed, eat.":"I protocolli 14:10 o 16:8 possono migliorare la sensibilita insulinica e ridurre l'infiammazione. Inizia gradualmente (12:12) e aumenta. Rompi il digiuno con proteine+grassi, non zuccheri. Non digiunare se hai una storia di disturbi alimentari. Ascolta il tuo corpo — se sei stressata, mangia."},
{title:LANG_STORE==="en"?"Stress & Cortisol":"Stress e Cortisolo",icon:"\ud83e\udde0",content:LANG_STORE==="en"?"Chronic stress raises cortisol → raises insulin → worsens PCOS. Prioritize: sleep 7-8h, breathing exercises, walks in nature, limiting caffeine, reducing screen time before bed. Yoga and meditation are clinically proven to lower cortisol in PCOS.":"Lo stress cronico alza il cortisolo → alza l'insulina → peggiora la PCOS. Priorita: dormire 7-8h, esercizi di respirazione, passeggiate nella natura, limitare caffeina, ridurre schermi prima di dormire. Yoga e meditazione sono clinicamente provati nel ridurre il cortisolo nella PCOS."},
{title:LANG_STORE==="en"?"Fertility & PCOS":"Fertilita e PCOS",icon:"\ud83c\udf1f",content:LANG_STORE==="en"?"PCOS is the #1 cause of anovulatory infertility but most women with PCOS can conceive with proper management. Track BBT and cycle for ovulation signs. Inositol improves ovulation rates. Maintain healthy weight. Work with a reproductive endocrinologist.":"La PCOS e la causa numero 1 di infertilita anovulatoria, ma la maggior parte delle donne con PCOS puo concepire con una gestione adeguata. Traccia la BBT e il ciclo per segni di ovulazione. L'inositolo migliora i tassi di ovulazione. Mantieni un peso sano. Lavora con un endocrinologo riproduttivo."},
{title:LANG_STORE==="en"?"Abdominal Fat":"Grasso Addominale",icon:"\ud83d\udca5",content:LANG_STORE==="en"?"PCOS makes it harder to lose belly fat due to insulin resistance and high androgens. Key strategies: strength training (builds muscle, boosts metabolism), post-meal walks (reduce glucose spikes), adequate sleep (reduces cortisol), reduce refined carbs, increase protein and fiber. Waist-to-hip ratio >0.85 indicates increased metabolic risk.":"La PCOS rende piu difficile perdere grasso addominale a causa dell'insulino-resistenza e degli androgeni alti. Strategie chiave: allenamento con pesi (costruisce muscolo, aumenta metabolismo), camminate post-pasto (riducono picchi glicemici), sonno adeguato (riduce cortisolo), ridurre carboidrati raffinati, aumentare proteine e fibre. Rapporto vita/fianchi >0.85 indica rischio metabolico aumentato."}
];
function PCOSEncyclopedia(){
  var _s=useState(null),open=_s[0],setOpen=_s[1];
  return React.createElement("div",{style:{display:"grid",gap:"8px"}},
    React.createElement(Cd,{style:{background:"linear-gradient(135deg,"+C.plumP+","+C.roseP+")"}},
      React.createElement("h4",{style:{fontFamily:F.p,fontSize:"16px",color:C.plum,margin:"0 0 4px"}},LANG_STORE==="en"?"\ud83d\udcda PCOS Encyclopedia":"\ud83d\udcda Enciclopedia PCOS"),
      React.createElement("p",{style:{fontSize:"10px",fontFamily:F.s,color:C.txtM,margin:0}},LANG_STORE==="en"?"Everything you need to know, based on clinical evidence":"Tutto quello che devi sapere, basato su evidenze cliniche")
    ),
    PCOS_ENCYCLOPEDIA.map(function(e,i){return React.createElement(Cd,{key:i,onClick:function(){setOpen(open===i?null:i);},style:{cursor:"pointer"}},
      React.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},
        React.createElement("div",{style:{display:"flex",alignItems:"center",gap:"10px"}},React.createElement("span",{style:{fontSize:"20px"}},e.icon),React.createElement("h5",{style:{fontFamily:F.s,fontSize:"12px",fontWeight:"600",color:C.txt,margin:0}},e.title)),
        React.createElement("span",{style:{fontSize:"12px",color:C.txtL,transition:"transform .2s",transform:open===i?"rotate(180deg)":"none"}},"\u25bc")
      ),
      open===i&&React.createElement("p",{style:{fontSize:"11px",fontFamily:F.s,color:C.txtM,margin:"10px 0 0",lineHeight:1.7,borderTop:"1px solid "+C.bdr,paddingTop:"10px"}},e.content)
    );})
  );
}
/* CYCLE-AWARE DAILY TIP */
function CycleTip(){
  var cp=getCyclePhaseNow();if(!cp)return null;
  var tips={
    0:[LANG_STORE==="en"?"Your body needs rest. Prioritize sleep and gentle movement. Iron-rich foods (lentils, spinach) help replenish.":"Il tuo corpo ha bisogno di riposo. Priorita al sonno e movimento dolce. Cibi ricchi di ferro (lenticchie, spinaci) aiutano.",LANG_STORE==="en"?"Magnesium can help with cramps. Try a warm turmeric latte before bed.":"Il magnesio puo aiutare con i crampi. Prova un latte alla curcuma caldo prima di dormire.",LANG_STORE==="en"?"Avoid intense workouts — your body is inflamed. Light yoga and stretching are perfect.":"Evita allenamenti intensi — il corpo e infiammato. Yoga leggero e stretching sono perfetti."],
    1:[LANG_STORE==="en"?"Estrogen is rising — energy is up! Best time for challenging workouts and new projects.":"L'estrogeno sale — energia in aumento! Momento migliore per allenamenti sfidanti e nuovi progetti.",LANG_STORE==="en"?"Your body handles carbs better now. Good time for whole grains and fruit post-workout.":"Il tuo corpo gestisce meglio i carboidrati ora. Buon momento per cereali integrali e frutta post-allenamento.",LANG_STORE==="en"?"Strength training now builds more muscle. Progressive overload is your friend this week!":"L'allenamento con pesi ora costruisce piu muscolo. Il sovraccarico progressivo e il tuo alleato questa settimana!"],
    2:[LANG_STORE==="en"?"Peak energy and strength! Try for personal records. Social energy is also highest.":"Picco di energia e forza! Prova per record personali. Anche l'energia sociale e al massimo.",LANG_STORE==="en"?"Hydrate extra — body temperature rises slightly around ovulation.":"Idratati di piu — la temperatura corporea sale leggermente intorno all'ovulazione.",LANG_STORE==="en"?"Include anti-inflammatory foods: salmon, turmeric, ginger, berries.":"Includi cibi anti-infiammatori: salmone, curcuma, zenzero, frutti di bosco."],
    3:[LANG_STORE==="en"?"Progesterone rises — you may feel more tired. Lower workout intensity, increase protein.":"Il progesterone sale — potresti sentirti piu stanca. Riduci l'intensita dell'allenamento, aumenta le proteine.",LANG_STORE==="en"?"Cravings? Add magnesium-rich foods (dark chocolate 85%, nuts, seeds) to curb sugar urges.":"Voglie? Aggiungi cibi ricchi di magnesio (cioccolato fondente 85%, noci, semi) per frenare la voglia di zucchero.",LANG_STORE==="en"?"PMS is common with PCOS. B6, magnesium and evening primrose oil can help.":"La PMS e comune con la PCOS. B6, magnesio e olio di enotera possono aiutare."]
  };
  var phaseTips=tips[cp.phase]||tips[1];
  var dayIdx=(cp.day-1)%phaseTips.length;
  return React.createElement(Cd,{style:{background:"linear-gradient(135deg,"+(CYCLE_PHASES[cp.phase].color||C.sage)+"15,"+C.white+")",borderLeft:"3px solid "+(CYCLE_PHASES[cp.phase].color||C.sage),marginBottom:"10px"}},
    React.createElement("div",{style:{display:"flex",alignItems:"flex-start",gap:"10px"}},
      React.createElement("span",{style:{fontSize:"18px"}},CYCLE_PHASES[cp.phase].icon),
      React.createElement("div",null,
        React.createElement("p",{style:{fontSize:"9px",fontFamily:F.s,fontWeight:"600",color:CYCLE_PHASES[cp.phase].color||C.sage,margin:"0 0 3px",textTransform:"uppercase"}},CYCLE_PHASES[cp.phase].name+" — "+(LANG_STORE==="en"?"Day ":"Giorno ")+cp.day),
        React.createElement("p",{style:{fontSize:"11px",fontFamily:F.s,color:C.txt,margin:0,lineHeight:1.5}},phaseTips[dayIdx])
      )
    )
  );
}

/* ═══════════ PCOS AI ASSISTANT (Rule-Based) ═══════════ */
var AI_KB=[
{k:["colazione","mattina","breakfast","prima colazione"],t:"Colazione PCOS-Friendly",r:"La colazione e il pasto piu importante nella PCOS. Dopo il digiuno notturno, il corpo ha bisogno di stabilita glicemica. Le regole d'oro: 1) Proteine al centro — uova (fino a 12/settimana), salmone, affettati magri (tacchino, bresaola), hummus, tofu. Senza proteine avrai montagne russe glicemiche. 2) Grassi buoni — frutta secca (mandorle, noci, pistacchi), burro di arachidi, avocado. 3) Carboidrati complessi e fibrosi — pane integrale di segale, avena, grano saraceno. 4) EVITA: yogurt magro (indice insulinico altissimo, piu del pane bianco!), cornetti, gallette di riso, cereali zuccherati, succhi di frutta. Alternative al latte vaccino: latte di mandorla, cocco, nocciola. Esempio perfetto: 2 uova strapazzate + pane di segale + avocado + mandorle + te verde."},
{k:["indice glicemico","glicemia","zucchero","zuccheri","spike","picco","picchi"],t:"Indice Glicemico e PCOS",r:"Nella PCOS l'insulina e la chiave di tutto. Piu la glicemia sale dopo un pasto, piu insulina viene prodotta = piu androgeni = piu sintomi. Le regole: 1) Mangia SEMPRE in quest'ordine: VERDURA (prima!) → PROTEINE → CARBOIDRATI (mai da soli). 2) Scegli carboidrati ad alto contenuto di fibre: quinoa, riso integrale, farro, legumi, grano saraceno, patate dolci. 3) Evita carboidrati raffinati: pane bianco, pasta non integrale, riso bianco, dolci, gallette di riso (IG altissimo!). 4) Abbina sempre un grasso buono (olio EVO, frutta secca) per rallentare l'assorbimento. 5) Frutta: si, ma con moderazione e MAI da sola — sempre con frutta secca o dopo un pasto."},
{k:["verdura","verdure","vegetali","ortaggi","insalata","fibre","fibra"],t:"Verdure nella PCOS",r:"Le verdure sono il tuo superpotere nella PCOS: fibra, antiossidanti, vitamine, indice glicemico e insulinico bassissimo. Devono essere il PRIMO alimento di ogni pasto — la fibra rallenta l'assorbimento degli zuccheri successivi. Top PCOS: broccoli, cavolfiori, zucchine, spinaci (crudi meglio), cavolo, rucola, sedano, peperoni, carciofi, finocchi, funghi. Attenzione a: carote (meglio crude, cotte raddoppiano l'IG), zucca (meglio al forno che bollita), barbabietola (meglio cruda a fettine). I pomodori e cetrioli hanno molta acqua e poca fibra: abbinali sempre a qualcosa di fibroso (sedano, rucola). Quantita: almeno 200-250g di verdure strutturate, 80-100g di insalata. Obiettivo: 2-3 porzioni di verdura al giorno."},
{k:["legumi","lenticch","ceci","fagioli","piselli","soia"],t:"Legumi e PCOS",r:"I legumi sono fantastici per la PCOS! Considerali come 'carboidrati proteici' — hanno un indice glicemico molto piu basso dei cereali, ottime proteine vegetali e tante fibre. Prevengono i picchi glicemici e danno sazietà a lungo. Regole: comprali secchi e biologici, ammollo 18-24 ore. Puoi consumarli 3-5 volte a settimana. 3 modi per un pasto equilibrato: 1) Come sostituto dei cereali (es. zuppa di lenticchie + verdure + olio EVO), 2) Come contorno proteico (ceci in insalata + verdure + pesce), 3) In crema (hummus come base proteica). Attenzione: piselli e fave hanno piu amidi — trattali come patate, non come verdura."},
{k:["latticin","latte","yogurt","formaggio","formaggi","dairy","calcio"],t:"Latticini e PCOS",r:"Scoperta importante: i latticini a basso contenuto di grassi hanno indice glicemico basso MA indice INSULINICO altissimo! Lo yogurt magro stimola l'insulina PIU del pane bianco. Perche? Il latte vaccino contiene IGF-1 e aminoacidi ramificati (BCAA) che fanno impennare l'insulina. Cosa fare: 1) Riduci latticini, soprattutto quelli 'light'. 2) Preferisci: latte di mandorla, cocco, nocciola, anacardi (evita latte di riso = IG alto). 3) Se vuoi yogurt: greco intero max 2 volte/settimana, mai quotidianamente. 4) I fiocchi di latte e il brie hanno indice insulinico piu basso. 5) Calcio? L'OMS ha ridotto le raccomandazioni. Prendi vitamina D, fai esercizio fisico, bevi acqua ricca di calcio (es. Sangemini, ~1L/giorno)."},
{k:["inositolo","myo-inositolo","d-chiro","integratore","integratori","supplemento","supplementi"],t:"Integratori per PCOS",r:"I piu importanti scientificamente: 1) MYO-INOSITOLO: il re degli integratori PCOS. Insulino-sensibilizzante, migliora ovulazione, riduce testosterone e HOMA-IR, regolarizza il ciclo. Dose: 2-4g/giorno, lontano dai pasti per miglior assorbimento. 2) VITAMINA D: carente nell'80% delle donne con PCOS. Target: 40-60 ng/mL. 3) OMEGA-3: anti-infiammatorio, migliora profilo lipidico. 4) MAGNESIO: riduce ansia, migliora sonno e insulino-sensibilità. 5) ZINCO: riduce testosterone e DHT, utile per acne e capelli. 6) NAC (N-Acetilcisteina): antiossidante, migliora ovulazione. 7) ACIDO FOLICO/METILFOLATO: essenziale per fertilità. Ricorda: gli integratori NON sostituiscono alimentazione e stile di vita. Consulta sempre il tuo endocrinologo."},
{k:["insulino","insulina","resistenza","homa","glicemia a digiuno","iperinsulin"],t:"Insulino-Resistenza e PCOS",r:"L'insulino-resistenza e il motore nascosto della PCOS. Il tuo corpo produce troppa insulina → piu androgeni → piu sintomi (acne, irsutismo, ciclo irregolare, difficolta a perdere peso). Come combatterla: 1) ALIMENTAZIONE: pasti completi (verdura+proteine+carboidrati complessi+grassi buoni), mai carboidrati da soli. 2) ORDINE DEI CIBI: verdura prima, proteine poi, carboidrati per ultimi. 3) ESERCIZIO: i pesi sono i migliori — il muscolo consuma glucosio anche a riposo. Anche una camminata di 15 min dopo i pasti abbassa la glicemia del 30%. 4) DIGIUNO INTERMITTENTE: migliora la sensibilità insulinica. 5) SONNO: dormire <7 ore peggiora l'insulino-resistenza del 40%. 6) Valori da monitorare: insulina basale (<10), HOMA-IR (<1.5), glicemia a digiuno (<90)."},
{k:["peso","dimagri","perdere","grasso","addominale","pancia","metabolismo","calorie"],t:"Perdita di Peso nella PCOS",r:"Nella PCOS perdere peso e piu difficile ma NON impossibile. Il problema non e solo 'mangiare meno' — devi spegnere i meccanismi che sostengono l'iperinsulinemia. Strategie efficaci: 1) DEFICIT MODERATO: non scendere sotto 1200-1300 kcal, il metabolismo si adatterebbe. 2) PRIORITA' PROTEINE: almeno 1.6-2g/kg per preservare muscolo. 3) PESI > CARDIO: il muscolo brucia grasso 24/7. Ogni kg di muscolo = ~50 kcal extra/giorno a riposo. 4) GRASSO ADDOMINALE: e il piu legato all'insulino-resistenza. Si riduce con pesi, IF, gestione cortisolo e sonno. 5) PAZIENZA: nella PCOS servono 8-12 settimane per vedere risultati. Il peso puo non cambiare ma la composizione corporea si (meno grasso, piu muscolo). Pesa te stessa max 1 volta a settimana, stessa ora, a digiuno."},
{k:["allena","eserciz","palestr","pesi","forza","squat","stacco","muscol","gym","workout"],t:"Allenamento e PCOS",r:"L'allenamento con i pesi e il MIGLIORE per la PCOS — meglio del cardio! Perche: il muscolo e un 'magazzino di glucosio' che migliora la sensibilità insulinica 24/7. Piano ideale: 3-4 sessioni/settimana di pesi (upper/lower/core), 30-45 min. Esercizi top: squat, stacco, hip thrust, pressa, affondi (gambe e glutei bruciano piu calorie). Aggiungi: 8000-10000 passi/giorno (attivita NEAT = brucia piu calorie del cardio intenso). EVITA: troppo HIIT/cardio intenso (alza il cortisolo → piu grasso addominale). Pilates e ottimo come complemento: meno ansia, core forte, postura migliore. Progressione: aumenta il peso o le reps ogni 1-2 settimane. Il tuo corpo si adatta — devi dargli stimoli nuovi."},
{k:["digiuno","fasting","intermittente","finestra","16:8","14:10","12:12"],t:"Digiuno Intermittente e PCOS",r:"Il digiuno intermittente (IF) e un ottimo alleato nella PCOS perche migliora la sensibilità insulinica, riduce l'infiammazione e attiva l'autofagia cellulare. Protocolli: 12:12 (principianti), 14:10 (ideale per PCOS), 16:8 (avanzato). Regole: 1) Colazione ABBONDANTE e proteica come primo pasto. 2) Cena LEGGERA e entro la finestra. 3) Durante il digiuno: acqua, te verde, tisane senza zucchero (niente latte!). 4) Il caffe ha un leggero effetto ipoglicemizzante — ok ma senza zucchero. 5) NON saltare pasti — riduci la finestra, non il numero di pasti. 6) Fase luteale: se hai molta fame pre-mestruale, e NORMALE. Puoi ridurre il digiuno a 12:12 in quei giorni. L'IF non e una dieta, e un ritmo alimentare."},
{k:["ciclo","mestrual","mestruazion","ovulaz","fase","follicol","lute","amenorrea","irregolar"],t:"Ciclo Mestruale e PCOS",r:"Il ciclo irregolare e il sintomo piu comune della PCOS, causato dall'eccesso di androgeni che impedisce ai follicoli di maturare. Le 4 fasi e cosa fare: 1) MESTRUALE (G1-5): riposo, ferro (spinaci, lenticchie, carne rossa), zenzero per crampi. Allenamento leggero. 2) FOLLICOLARE (G6-13): energia in salita! Proteine per follicoli, verdure crucifere. Aumenta intensità allenamento. 3) OVULATORIA (G14-16): picco di energia. Vai all-out con i pesi, fibre per metabolizzare estrogeni. 4) LUTEALE (G17-35+): prima meta ancora ok, seconda meta riduci. Carboidrati complessi per serotonina, magnesio, cannella. Fame aumentata = normale, prepara snack sani. Se non hai il ciclo: l'IF, l'inositolo e la perdita di peso possono ripristinarlo."},
{k:["acne","pelle","brufol","irsutismo","peli","capelli","caduta","androgen","testosterone","dht"],t:"Acne, Irsutismo e PCOS",r:"Acne e irsutismo nella PCOS sono causati dall'eccesso di androgeni (testosterone, DHT, DHEA-S). Strategie: 1) ALIMENTAZIONE anti-infiammatoria: riduci latticini (stimolano IGF-1 e androgeni), zuccheri raffinati, cibi processati. Aumenta omega-3, zinco, verdure crucifere (broccoli, cavolo — metabolizzano gli estrogeni). 2) INTEGRATORI: Zinco (riduce DHT), NAC, inositolo, the verde. 3) PESI: non aumentano il testosterone nelle donne — anzi, migliorando l'insulino-resistenza possono RIDURRE gli androgeni. 4) STRESS: il cortisolo cronico alza i DHEA-S surrenalici. Meditazione, yoga, sonno regolare. 5) Valori da controllare: testosterone totale, testosterone libero, DHEA-S, SHBG (piu e alto meglio e). Il myo-inositolo aumenta l'SHBG."},
{k:["fertili","gravid","concepimento","ovulazione","mamm","bambino","figli"],t:"PCOS e Fertilità",r:"La PCOS e la causa piu comune di infertilità femminile, ma NON significa che non puoi diventare mamma. L'anovulazione e il problema principale — i follicoli non maturano per l'eccesso di androgeni e insulina. Cosa fare: 1) Perdita di peso: anche solo il 5-10% migliora significativamente l'ovulazione. 2) Myo-inositolo: studi dimostrano che migliora significativamente il tasso di ovulazione e regolarizza il ciclo. 3) Metilfolato/acido folico: essenziale. 4) Alimentazione anti-infiammatoria e IF. 5) Farmaci: la metformina migliora l'insulino-sensibilità e puo ripristinare l'ovulazione. Il clomifene stimola l'ovulazione. 6) Approccio multidisciplinare: nutrizionista + ginecologo/a + eventualmente endocrinologo/a. La PCOS non e sempre un ostacolo a diventare mamme."},
{k:["stress","cortisolo","ansia","relax","meditazione","mentale","psicolog"],t:"Stress, Cortisolo e PCOS",r:"Il cortisolo (ormone dello stress) e un nemico silenzioso nella PCOS. Cortisolo alto → piu insulina → piu androgeni → piu grasso addominale → piu stress = un circolo vizioso. Come spezzarlo: 1) SONNO: 7-9 ore, regolare. Il cortisolo segue il ritmo circadiano. 2) CAMMINATE nella natura: 20-30 min abbassano il cortisolo del 25%. 3) RESPIRAZIONE: 5 min di box breathing (4s inspira, 4s trattieni, 4s espira, 4s trattieni) abbassano il cortisolo immediatamente. 4) LIMITA caffè a 1-2/giorno prima delle 14:00. 5) EVITA allenamenti troppo intensi la sera (alzano il cortisolo). 6) MAGNESIO prima di dormire. 7) Non sottovalutare la salute mentale: una psicologa puo aiutarti nel percorso. La PCOS non e solo fisica — ha un impatto emotivo importante."},
{k:["sonno","dorm","notturn","insonnia","sveglia","riposo"],t:"Sonno e PCOS",r:"Dormire bene e una MEDICINA per la PCOS. Meno di 7 ore: cortisolo +37%, insulino-resistenza peggiora del 40%, leptina diminuisce (piu fame), grelina aumenta (piu voglia di dolci). Regole: 1) 7-9 ore a notte, SEMPRE. 2) Orari regolari: vai a letto e svegliati alla stessa ora. 3) Buio totale: la melatonina si produce solo al buio. 4) Niente schermi 30 min prima di dormire. 5) Temperatura fresca (18-20°C). 6) Magnesio glicinato o bisglicinato prima di dormire. 7) Tisana camomilla o valeriana. 8) Evita caffeina dopo le 14:00 e alcol la sera. Il sonno profondo e quando il corpo ripara, gli ormoni si resettano e l'insulina si ricalibra."},
{k:["analisi","sangue","esami","ematici","valore","valori","prelievo","check","tiroide","tsh"],t:"Analisi del Sangue PCOS",r:"Esami fondamentali da fare almeno 1-2 volte/anno: 1) INSULINA BASALE: ideale <10 μU/mL. 2) HOMA-IR: <1.5 ottimo, >2.5 insulino-resistenza. 3) GLICEMIA A DIGIUNO: <90 mg/dL ideale, 100-125 pre-diabete. 4) TESTOSTERONE TOTALE: spesso elevato nella PCOS. 5) DHEA-S: androgeno surrenalico, elevato nel 25% delle PCOS. 6) SHBG: piu e alto meglio e — lega il testosterone libero. 7) TSH: 1-2.5 ideale (nella PCOS controllare sempre la tiroide). 8) VITAMINA D: target 40-60 ng/mL, carente nell'80% delle PCOS. 9) FERRITINA: >30 ideale, controllare se ciclo abbondante. 10) PROFILO LIPIDICO: colesterolo, trigliceridi. Porta questi valori al tuo endocrinologo e usa la sezione Analisi dell'app per monitorare i trend."},
{k:["motivazione","morale","difficile","mollare","sconforto","stanca","non ce la faccio","dura","fatica"],t:"Motivazione e PCOS",r:"Lo so, la PCOS puo essere frustrante. I risultati arrivano piu lentamente, il corpo sembra non rispondere, e ci sono giorni in cui vorresti mollare tutto. Ma ricorda: 1) Non sei sola — la PCOS colpisce 1 donna su 10. 2) Ogni piccolo gesto conta: quel bicchiere d'acqua, quella camminata, quella scelta alimentare. 3) I cambiamenti piu importanti non si vedono sulla bilancia — insulina che migliora, infiammazione che cala, energia che torna. 4) Inizia a piccoli passi, non tutto insieme. Chi ha avuto i risultati migliori ci ha messo 1-2 ANNI di percorso graduale. 5) Non e una 'dieta' — e il tuo nuovo stile di vita. Innamorati del percorso. 6) La PCOS si gestisce, non ti definisce. Tu sei molto piu dei tuoi sintomi. Continua, un giorno alla volta."},
{k:["acqua","idratazione","bere","bevande","te verde","tisana","caffe"],t:"Idratazione e PCOS",r:"L'acqua e l'unica bevanda con cui dissetarsi nella PCOS. Obiettivo: almeno 1.5-2L/giorno. Bevande consigliate: 1) ACQUA: preferibilmente ricca di calcio (es. Sangemini). 2) TE VERDE: anti-infiammatorio, antiossidante, leggero effetto termogenico. 2-3 tazze/giorno. 3) TISANE: zenzero (anti-nausea, anti-infiammatorio), cannella (migliora insulino-sensibilità), menta. 4) CAFFE: max 1-2 al giorno, senza zucchero, prima delle 14:00. Evita: succhi di frutta (solo zuccheri), bevande zuccherate, energy drink, latte vaccino (alto indice insulinico), bevande di riso (IG alto). L'idratazione migliora digestione, pelle, energia e aiuta il metabolismo."},
{k:["frutta secca","mandorl","noci","pistacch","semi","arachid","nocciole"],t:"Frutta Secca e PCOS",r:"La frutta secca e INDISPENSABILE nella PCOS — fornisce grassi buoni, proteine, fibre e minerali. Top: mandorle (le migliori per IG), noci (omega-3), pistacchi (proteine), noci pecan, anacardi, nocciole. Semi: chia (omega-3, fibre), zucca (zinco!), girasole, lino (fitoestrogeni), sesamo, canapa. Usi: 1) A colazione: una manciata con yogurt o porridge. 2) Come snack: 20-30g per spezzare la fame senza spike glicemici. 3) In crema: burro di mandorle o arachidi su pane integrale. 4) Nelle insalate: semi di zucca e girasole. Regola: comprale sfuse, non tostate e non salate. La frutta secca e il tuo migliore alleato anti-picco-glicemico."}
];
function findBestMatch(q){
  var ql=q.toLowerCase().replace(/[^a-zA-Zàèéìòù0-9\s]/g,"");
  var best=null;var bestScore=0;
  AI_KB.forEach(function(entry){
    var score=0;
    entry.k.forEach(function(keyword){
      if(ql.includes(keyword))score+=keyword.length;
    });
    if(score>bestScore){bestScore=score;best=entry;}
  });
  return bestScore>=3?best:null;
}
function PCOSAssistant({profile}){
  const[msgs,setMsgs]=useState([{from:"ai",text:"Ciao! Sono il tuo assistente PCOS. Posso aiutarti su alimentazione, allenamento, digiuno intermittente, integratori, ciclo mestruale, analisi del sangue e molto altro. Chiedimi quello che vuoi!",time:new Date().toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"})}]);
  const[input,setInput]=useState("");
  const[typing,setTyping]=useState(false);
  var chatRef=useRef(null);
  var mc=calcMacros(profile);
  var cp=getCyclePhaseNow();
  useEffect(function(){if(chatRef.current)chatRef.current.scrollTop=chatRef.current.scrollHeight;},[msgs]);
  function personalizeResp(text){
    var t=text;
    if(profile.name)t=t.replace(/NOME/g,profile.name);
    return t;
  }
  function buildContext(){
    var ctx=[];
    ctx.push("Il tuo target calorico e ~"+mc.target+" kcal/giorno.");
    ctx.push("Il tuo protocollo IF e "+profile.ifH+":"+(24-profile.ifH)+" (finestra "+profile.ifOpen+"-"+profile.ifClose+").");
    if(profile.weight&&profile.goalW)ctx.push("Peso attuale: "+profile.weight+"kg, obiettivo: "+profile.goalW+"kg ("+Math.max(0,(profile.weight-profile.goalW).toFixed(1))+"kg da perdere).");
    if(profile.allergies&&profile.allergies.length>0)ctx.push("Intolleranze: "+profile.allergies.join(", ")+".");
    if(cp)ctx.push("Sei in fase "+CYCLE_PHASES[cp.phase].name+" del ciclo (giorno "+cp.day+").");
    return ctx.join(" ");
  }
  function suggest(){
    var suggestions=["Cosa mangiare a colazione?","Come perdere grasso addominale?","Quali integratori prendere?","Come funziona il digiuno intermittente?","Quali analisi del sangue fare?","Consigli per il ciclo irregolare","Come gestire lo stress?","Quanta acqua devo bere?","Latticini si o no?","Sono senza motivazione..."];
    return suggestions;
  }
  function sendMsg(){
    if(!input.trim())return;
    var userMsg={from:"user",text:input.trim(),time:new Date().toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"})};
    var newMsgs=msgs.concat([userMsg]);
    setMsgs(newMsgs);
    setInput("");
    setTyping(true);
    setTimeout(function(){
      var match=findBestMatch(input);
      var reply;
      if(match){
        var context=buildContext();
        reply={from:"ai",text:"**"+match.t+"**\n\n"+personalizeResp(match.r)+"\n\n_In base al tuo profilo: "+context+"_",time:new Date().toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"})};
      }else{
        reply={from:"ai",text:"Non ho una risposta specifica su questo argomento, ma posso aiutarti su: alimentazione PCOS, indice glicemico, colazione, verdure, legumi, latticini, integratori (inositolo, vitamina D...), insulino-resistenza, perdita di peso, allenamento, digiuno intermittente, ciclo mestruale, fertilità, acne/irsutismo, stress/cortisolo, sonno, analisi del sangue, frutta secca, idratazione. Prova a riformulare la domanda o scegli un argomento qui sotto!",time:new Date().toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"})};
      }
      setMsgs(newMsgs.concat([reply]));
      setTyping(false);
    },800+Math.random()*700);
  }
  function renderText(text){
    var parts=text.split("\n");
    return parts.map(function(p,i){
      if(!p.trim())return null;
      var t=p;
      var isBold=t.startsWith("**")&&t.includes("**",2);
      var isItalic=t.startsWith("_")&&t.endsWith("_");
      if(isBold)return React.createElement("div",{key:i,style:{fontWeight:"700",fontSize:"13px",marginBottom:"6px",color:C.sageD}},t.replace(/\*\*/g,""));
      if(isItalic)return React.createElement("div",{key:i,style:{fontStyle:"italic",fontSize:"10px",marginTop:"6px",padding:"6px 8px",borderRadius:"6px",background:C.sageP,color:C.sageD}},t.replace(/_/g,""));
      return React.createElement("div",{key:i,style:{fontSize:"12px",lineHeight:1.6,marginBottom:"4px"}},t);
    });
  }
  return(<div style={{display:"flex",flexDirection:"column",height:"calc(100vh - 220px)",minHeight:"400px"}}>
    <SecH title="Assistente PCOS" sub="Basato sulle guide Lotus Flower PCOS 101"/>
    <div ref={chatRef} style={{flex:1,overflowY:"auto",display:"flex",flexDirection:"column",gap:"10px",padding:"4px 0",marginBottom:"10px"}}>
      {msgs.map(function(m,i){return(<div key={i} style={{display:"flex",justifyContent:m.from==="user"?"flex-end":"flex-start"}}><div style={{maxWidth:"85%",padding:"10px 14px",borderRadius:m.from==="user"?"14px 14px 4px 14px":"14px 14px 14px 4px",background:m.from==="user"?"linear-gradient(135deg,"+C.sage+","+C.sageD+")":C.white,color:m.from==="user"?C.white:C.txt,fontFamily:F.s,boxShadow:"0 1px 3px rgba(0,0,0,.08)",border:m.from==="ai"?"1px solid "+C.bdr:"none"}}>{m.from==="ai"?renderText(m.text):<span style={{fontSize:"12px",lineHeight:1.5}}>{m.text}</span>}<div style={{fontSize:"8px",color:m.from==="user"?"rgba(255,255,255,.6)":C.txtL,textAlign:"right",marginTop:"4px"}}>{m.time}</div></div></div>);})}
      {typing&&<div style={{display:"flex",justifyContent:"flex-start"}}><div style={{padding:"10px 18px",borderRadius:"14px 14px 14px 4px",background:C.white,border:"1px solid "+C.bdr}}><span style={{fontFamily:F.s,fontSize:"12px",color:C.txtL,animation:"pulse 1s infinite"}}>{t("stoPensando")}</span></div></div>}
    </div>
    {msgs.length<=2&&(<div style={{display:"flex",gap:"6px",flexWrap:"wrap",marginBottom:"10px"}}>{suggest().map(function(s,i){return(<button key={i} onClick={function(){setInput(s);}} style={{padding:"6px 10px",borderRadius:"20px",border:"1px solid "+C.sageL,background:C.sageP,color:C.sageD,fontSize:"10px",fontFamily:F.s,cursor:"pointer",whiteSpace:"nowrap"}}>{s}</button>);})}</div>)}
    <div style={{display:"flex",gap:"8px"}}><input value={input} onChange={function(e){setInput(e.target.value);}} onKeyDown={function(e){if(e.key==="Enter")sendMsg();}} placeholder={t("chiedimi")} style={Object.assign({},iS,{flex:1,padding:"12px",borderRadius:"20px"})}/><button onClick={sendMsg} disabled={!input.trim()||typing} style={{padding:"12px 18px",borderRadius:"20px",border:"none",background:!input.trim()?C.bdr:"linear-gradient(135deg,"+C.sage+","+C.sageD+")",color:C.white,fontSize:"14px",cursor:!input.trim()?"default":"pointer"}}>➤</button></div>
    <p style={{fontSize:"8px",fontFamily:F.s,color:C.txtL,textAlign:"center",margin:"6px 0 0"}}>Le risposte sono basate sulle guide Lotus Flower PCOS 101. Consulta sempre il tuo medico per decisioni cliniche.</p>
  </div>);
}


/* ═══════════ BENESSERE (Integratori + Sonno + Medical + Export + Photos) ═══════════ */
function Benessere(){
  const[sub,setSub]=useState("supps");
  return(<div>
    <SecH title={t("benessere")} sub={LANG_STORE==="en"?"Supplements, sleep, blood work, photos and export":"Integratori, sonno, analisi, export e progress photos"}/>
    <SubT tabs={[{k:"supps",l:t("integratori"),i:"💊"},{k:"sleep",l:t("sonno"),i:"😴"},{k:"medical",l:t("analisi"),i:"🩸"},{k:"photos",l:t("foto"),i:"📸"},{k:"export",l:t("exp"),i:"📁"},{k:"tips",l:t("tips"),i:"💡"}]} active={sub} onSel={setSub}/>
    {sub==="supps"&&<SuppTracker/>}
    {sub==="sleep"&&(<div style={{display:"grid",gap:"12px"}}><SleepTracker/><Info bg={C.plumP} bdr={C.plumL} color={C.plum}><strong>Perche il sonno conta nella PCOS:</strong> Dormire meno di 7 ore aumenta il cortisolo del 37%, peggiora l'insulino-resistenza e aumenta la fame il giorno dopo. Punta a 7-9 ore per notte.</Info></div>)}
    {sub==="medical"&&<MedicalDashboard/>}
    {sub==="photos"&&<ProgressPhotos/>}
    {sub==="export"&&<ExportData/>}
    {sub==="tips"&&(<div style={{display:"grid",gap:"10px"}}>
      {[{t:"Cortisolo e grasso addominale",d:"Lo stress cronico alza il cortisolo, che nella PCOS e gia elevato. Il cortisolo promuove l'accumulo di grasso viscerale. Meditazione, camminate e sonno di qualita lo riducono.",ic:"🧠",c:C.plum},
      {t:"Infiammazione cronica silente",d:"La PCOS e associata a infiammazione cronica di basso grado. Gli omega-3, la curcuma, le verdure crucifere e il te verde la combattono.",ic:"🔥",c:C.rose},
      {t:"Insulino-resistenza: il cuore della PCOS",d:"Il 70% delle donne PCOS ha insulino-resistenza. L'inositolo, l'esercizio fisico e mangiare le verdure PRIMA dei carboidrati migliorano la sensibilita insulinica.",ic:"📊",c:C.amber},
      {t:"Il circolo vizioso dello stress",d:"Stress → cortisolo alto → fame emotiva → zuccheri → picco insulinico → piu grasso → piu stress. Rompi il ciclo con attivita fisica e routine regolari.",ic:"🔄",c:C.berry},
      {t:"Vitamina D e PCOS",d:"L'80% delle donne PCOS e carente di vitamina D. Supplementare migliora ciclo mestruale, umore e sensibilita insulinica. Target: 40-60 ng/mL.",ic:"☀️",c:C.amber},
      {t:"Il potere dell'inositolo",d:"Il myo-inositolo (4g/giorno) + D-chiro-inositolo (rapporto 40:1) migliorano ovulazione, insulina, androgeni e qualita ovocitaria. E l'integratore #1 per la PCOS.",ic:"💊",c:C.sage}
      ].map(function(item,i){return(<Cd key={i} accent={item.c}><div style={{display:"flex",gap:"10px",alignItems:"flex-start"}}><span style={{fontSize:"20px",flexShrink:0}}>{item.ic}</span><div><h4 style={{margin:"0 0 3px",fontFamily:F.s,fontSize:"13px",fontWeight:"600",color:C.txt}}>{item.t}</h4><p style={{margin:0,fontSize:"11px",fontFamily:F.s,color:C.txtM,lineHeight:1.5}}>{item.d}</p></div></div></Cd>);})}
    </div>)}
  </div>);
}


/* ═══════════ APP PRINCIPALE ═══════════ */
function App(){
  const[user,setUser]=useState(null);
  const[authReady,setAuthReady]=useState(false);
  const[tab,setTab]=useState("home");
  const[profile,setProfile]=useState(function(){return LD("profile",DEF_PROF);});
  const[syncing,setSyncing]=useState(false);
  const[lastSync,setLastSync]=useState("");
  const[showShare,setShowShare]=useState(false);
  var scrollRef=useRef(null);

  /* Auth listener + redirect result */
  useEffect(function(){fbAuth.getRedirectResult().catch(function(){});var unsub=fbAuth.onAuthStateChanged(function(u){if(u){setUser(u);_syncUid=u.uid;syncFromCloud(u.uid).then(function(){setProfile(LD("profile",DEF_PROF));setAuthReady(true);}).catch(function(){setAuthReady(true);});}else{setUser(null);_syncUid=null;setAuthReady(true);}});return unsub;},[]);

  /* Auto-sync every 2 min */
  useEffect(function(){if(!user)return;var iv=setInterval(function(){syncToCloud(user.uid).catch(function(){});},120000);return function(){clearInterval(iv);};},[user]);

  useEffect(function(){if(scrollRef.current)scrollRef.current.scrollTop=0;},[tab]);
  useEffect(function(){SV("profile",profile);requestNotifPerm();},[profile]);

  function doSync(){if(!user)return;setSyncing(true);syncToCloud(user.uid).then(function(){setLastSync(new Date().toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"}));setSyncing(false);}).catch(function(){setSyncing(false);});}
  function doLogout(){_syncUid=null;SYNC_KEYS.forEach(function(k){localStorage.removeItem("pcos_"+k);});["fast_isOn","fast_start","fast_goal","pcos_onboarded"].forEach(function(k){localStorage.removeItem("pcos_"+k);});localStorage.removeItem("pcos_progressPhotos");fbAuth.signOut();setUser(null);}

  /* View mode for doctor */
  var viewUid=getViewUid();
  if(viewUid)return <DoctorView uid={viewUid}/>;

  /* Auth screen */
  if(!authReady)return(<div style={{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:C.bg}}><div style={{textAlign:"center"}}><div style={{fontSize:"40px",marginBottom:"10px",animation:"pulse 1.5s infinite"}}>🌸</div><p style={{fontFamily:F.s,fontSize:"14px",color:C.txtM}}>Caricamento...</p></div></div>);
  if(!user)return <AuthScreen onLogin={function(u){setUser(u);}}/>;

  /* Onboarding check */
  var onboarded=LD("pcos_onboarded",false)||!!profile.name;
  if(!onboarded)return <OnboardingWizard setProfile={setProfile}/>;

  var mc=calcMacros(profile);
  return(
    <div style={{fontFamily:F.s,background:"linear-gradient(180deg,"+C.bg+","+C.bgW+")",minHeight:"100vh",display:"flex",flexDirection:"column"}}>
      <div style={{background:C.white,borderBottom:"1px solid "+C.bdr,padding:"12px 16px 8px",position:"sticky",top:0,zIndex:100}}>
        <div style={{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"}}>
          <div style={{width:"34px",height:"34px",borderRadius:"10px",background:"linear-gradient(135deg,"+C.sage+","+C.rose+")",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"16px"}}>🌸</div>
          <div style={{flex:1}}><h1 style={{fontFamily:F.p,fontSize:"17px",fontWeight:"600",color:C.txt,margin:0}}>PCOS Daily</h1><p style={{fontSize:"9px",color:C.txtL,margin:"1px 0 0"}}>v5.1 ☁️ | ~{mc.target} kcal | IF {profile.ifH}:{24-profile.ifH}</p></div>
          <div style={{textAlign:"right"}}><div style={{fontSize:"12px",fontWeight:"700",color:C.sage,fontFamily:F.s}}>{profile.weight} kg</div><div style={{fontSize:"8px",color:C.txtL,fontFamily:F.s}}>goal {profile.goalW} kg</div></div>
        </div>
        <div style={{display:"flex",gap:"4px",alignItems:"center",marginBottom:"6px"}}>
          <button onClick={doSync} disabled={syncing} style={{padding:"4px 10px",borderRadius:"8px",border:"1px solid "+C.bdr,background:syncing?C.sageP:C.white,color:C.sageD,fontSize:"9px",fontFamily:F.s,fontWeight:"500",cursor:"pointer"}}>{syncing?"⏳ Sync...":"☁️ "+t("sync")}</button>
          {lastSync&&<span style={{fontSize:"8px",fontFamily:F.s,color:C.txtL}}>✓ {lastSync}</span>}
          <button onClick={function(){setShowShare(!showShare);}} style={{padding:"4px 10px",borderRadius:"8px",border:"1px solid "+C.bdr,background:C.white,color:C.plum,fontSize:"9px",fontFamily:F.s,fontWeight:"500",cursor:"pointer"}}>🔗 {t("medico")}</button>
          <LangToggle/>
          <ThemeToggle/>
          <div style={{flex:1}}/>
          <span style={{fontSize:"9px",fontFamily:F.s,color:C.txtL}}>{user.email?user.email.split("@")[0]:""}</span>
          <button onClick={doLogout} style={{padding:"4px 8px",borderRadius:"8px",border:"1px solid "+C.bdr,background:C.white,color:C.rose,fontSize:"9px",fontFamily:F.s,cursor:"pointer"}}>{t("esci")}</button>
        </div>
        {showShare&&(<Cd style={{marginBottom:"8px",padding:"12px",background:C.plumP,border:"1px solid "+C.plumL}}><h5 style={{fontFamily:F.s,fontSize:"11px",fontWeight:"600",color:C.plum,margin:"0 0 6px"}}>🔗 {t("condividiMedico")}</h5><p style={{fontSize:"10px",fontFamily:F.s,color:C.txtM,margin:"0 0 8px"}}>{LANG_STORE==="en"?"Your doctor will see a read-only dashboard with: profile, weight, blood work, workouts and fasting data.":"Il medico vedra una dashboard di sola lettura con: profilo, peso, analisi del sangue, allenamenti e digiuni."}</p><div style={{display:"flex",gap:"6px"}}><input readOnly value={generateShareLink(user.uid)} style={Object.assign({},iS,{fontSize:"10px",padding:"8px"})}/><button onClick={function(){navigator.clipboard.writeText(generateShareLink(user.uid));}} style={{padding:"8px 14px",borderRadius:"8px",border:"none",background:C.plum,color:C.white,fontSize:"10px",fontFamily:F.s,fontWeight:"600",cursor:"pointer",whiteSpace:"nowrap"}}>📋 {t("copiaLink")}</button></div></Cd>)}
        <div style={{display:"flex",gap:"2px",overflowX:"auto"}}>
          <NavTab label="Home" icon="🏠" active={tab==="home"} onClick={function(){setTab("home");}}/>
          <NavTab label={t("cibo")} icon="🥗" active={tab==="alimentazione"} onClick={function(){setTab("alimentazione");}}/>
          <NavTab label={t("gym")} icon="🏋️‍♀️" active={tab==="allenamento"} onClick={function(){setTab("allenamento");}}/>
          <NavTab label={t("digiuno")} icon="⏳" active={tab==="digiuno"} onClick={function(){setTab("digiuno");}}/>
          <NavTab label={t("ciclo")} icon="🩸" active={tab==="ciclo"} onClick={function(){setTab("ciclo");}}/>
          <NavTab label="Track" icon="📋" active={tab==="track"} onClick={function(){setTab("track");}}/>
          <NavTab label={t("garmin")} icon="⌚" active={tab==="garmin"} onClick={function(){setTab("garmin");}}/>
          <NavTab label={t("salute")} icon="💊" active={tab==="benessere"} onClick={function(){setTab("benessere");}}/>
          <NavTab label={t("ai")} icon="🤖" active={tab==="ai"} onClick={function(){setTab("ai");}}/>
          <NavTab label={LANG_STORE==="en"?"Wiki":"Wiki"} icon="📚" active={tab==="wiki"} onClick={function(){setTab("wiki");}}/>
        </div>
      </div>
      <div ref={scrollRef} style={{flex:1,padding:"18px 12px 32px",maxWidth:"640px",width:"100%",margin:"0 auto",boxSizing:"border-box"}}>
        <DailyQuote/>
        <CycleTip/>
        <WeeklyInsight profile={profile}/>
        {tab==="home"&&<><CycleTip/><HomeDashboard profile={profile} setTab={setTab}/></>}
        {tab==="alimentazione"&&<><Alimentazione profile={profile} setProfile={setProfile}/><MealIntelligence profile={profile}/></>}
        {tab==="allenamento"&&<><Allenamento/><CycleWorkoutSuggestions/></>}
        {tab==="digiuno"&&<Digiuno profile={profile}/>}
        {tab==="ciclo"&&<><CicloMestruale/><CyclePrediction/><SkinHairDiary/></>}
        {tab==="track"&&<SmartTracking/>}
        {tab==="garmin"&&<GarminSection profile={profile}/>}
        {tab==="benessere"&&<><Benessere/><SuppReminders/><BBTTracker/><AntiInflamScore/><BreathingTimer/><SleepTracker/><MonthlyReport profile={profile}/></>}
        {tab==="ai"&&<><PCOSAssistant profile={profile}/><ShareCard profile={profile}/></>}
        {tab==="wiki"&&<PCOSEncyclopedia/>}
      </div>
      <div style={{textAlign:"center",padding:"12px",borderTop:"1px solid "+C.bdr,background:C.white}}><p style={{fontSize:"9px",color:C.txtL,margin:0}}>PCOS Daily v5.1 | Cloud ☁️ | lotusflowerpcos.com | {t("consultaMedico")}</p></div>
    </div>
  );
}

const root=ReactDOM.createRoot(document.getElementById('root'));
root.render(React.createElement(App));
</script>
</body>
</html>