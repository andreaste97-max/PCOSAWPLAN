<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
  <title>PCOS Daily</title>
  <meta name="description" content="Strumento quotidiano per gestire la PCOS"/>
  <meta name="theme-color" content="#8B9E7E"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="default"/>
  <meta name="apple-mobile-web-app-title" content="PCOS Daily"/>
  <link rel="manifest" href="./manifest.json"/>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üå∏</text></svg>"/>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
  <style>
    *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
    body{font-family:'DM Sans',sans-serif;background:#FBF8F4;overscroll-behavior:none}
    input[type="date"],input[type="time"]{-webkit-appearance:none}
    ::-webkit-scrollbar{display:none}
    button{-webkit-appearance:none}
    @keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
    @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.2)}}
    @keyframes ripple{0%{box-shadow:0 0 0 0 rgba(139,158,126,.4)}100%{box-shadow:0 0 0 12px rgba(139,158,126,0)}}
  </style>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
</head>
<body>
<div id="root"></div>
<script>
// PWA Service Worker registration - force update
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('./sw.js').then(function(reg){
    reg.update();
  }).catch(function(){});
}
</script>
<script type="text/babel">
const{useState,useEffect,useRef,useCallback}=React;

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PCOS DAILY v2.0 ‚Äî FULL ROADMAP ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const C={bg:"#FBF8F4",bgW:"#F5EDE4",white:"#FFFFFF",sage:"#8B9E7E",sageD:"#6B7F5E",sageL:"#C5D4BC",sageP:"#E8F0E4",rose:"#C4918A",roseD:"#A67069",roseL:"#E8C5C0",roseP:"#FFF0ED",amber:"#D4A574",amberL:"#F0DCC8",amberP:"#FFF8F0",plum:"#7B6B8D",plumL:"#D8D0F0",plumP:"#F3F0FF",txt:"#3A3228",txtM:"#6B5E52",txtL:"#9B8E82",bdr:"#E8DFD6",berry:"#B5547A",berryL:"#F5D6E3",berryP:"#FFF0F6",blue:"#5B9BD5"};
const F={p:"'Playfair Display',serif",s:"'DM Sans',sans-serif"};

/* ‚îÄ‚îÄ‚îÄ STORAGE ‚îÄ‚îÄ‚îÄ */
function LD(k,fb){try{var d=localStorage.getItem("pcos_"+k);return d?JSON.parse(d):fb;}catch(e){return fb;}}
var _syncTimer=null;var _syncUid=null;
function SV(k,d){try{localStorage.setItem("pcos_"+k,JSON.stringify(d));}catch(e){}if(_syncUid){clearTimeout(_syncTimer);_syncTimer=setTimeout(function(){syncToCloud(_syncUid).catch(function(){});},3000);}}
function todayK(){return new Date().toISOString().slice(0,10);}
function fmtD(ds){if(!ds)return"--";return new Date(ds).toLocaleDateString("it-IT",{day:"numeric",month:"short"});}

/* ‚îÄ‚îÄ‚îÄ FIREBASE ‚îÄ‚îÄ‚îÄ */
var fbApp=firebase.initializeApp({apiKey:"AIzaSyAuzIEgBPNB7IM4ySF-GHeqn8GyFtkmQak",authDomain:"pcos-daily.firebaseapp.com",projectId:"pcos-daily",storageBucket:"pcos-daily.firebasestorage.app",messagingSenderId:"182447746696",appId:"1:182447746696:web:0e30e0bd1e94a232a9793d"});
var fbAuth=firebase.auth();
var fbDb=firebase.firestore();
var googleProvider=new firebase.auth.GoogleAuthProvider();

var SYNC_KEYS=["profile","weighins","workouts","daily","fasts","gymLogs","favRecipes","bloodwork","lastPeriod","cycleLen","fast_isOn","fast_start","fast_goal"];
function syncToCloud(uid){if(!uid)return Promise.resolve();var data={};SYNC_KEYS.forEach(function(k){var v=localStorage.getItem("pcos_"+k);if(v)data[k]=v;});var today=todayK();var dayKeys=["meals_","water_","supps_","sleep_"];dayKeys.forEach(function(prefix){for(var i=0;i<7;i++){var d=new Date();d.setDate(d.getDate()-i);var dk=d.toISOString().slice(0,10);var v=localStorage.getItem("pcos_"+prefix+dk);if(v)data[prefix+dk]=v;}});data.lastSync=new Date().toISOString();return fbDb.collection("users").doc(uid).set(data,{merge:true});}
function syncFromCloud(uid){if(!uid)return Promise.resolve();return fbDb.collection("users").doc(uid).get().then(function(doc){if(!doc.exists)return;var data=doc.data();Object.keys(data).forEach(function(k){if(k==="lastSync")return;localStorage.setItem("pcos_"+k,data[k]);});});}
function generateShareLink(uid){if(!uid)return"";return window.location.origin+window.location.pathname+"?view="+uid;}
function isViewMode(){return new URLSearchParams(window.location.search).get("view");}
function getViewUid(){return new URLSearchParams(window.location.search).get("view");}

/* ‚îÄ‚îÄ‚îÄ AUTH COMPONENT ‚îÄ‚îÄ‚îÄ */
function AuthScreen({onLogin}){
  const[mode,setMode]=useState("login");
  const[email,setEmail]=useState("");
  const[pass,setPass]=useState("");
  const[error,setError]=useState("");
  const[loading,setLoading]=useState(false);
  function doEmail(){setLoading(true);setError("");var fn=mode==="login"?fbAuth.signInWithEmailAndPassword.bind(fbAuth):fbAuth.createUserWithEmailAndPassword.bind(fbAuth);fn(email,pass).then(function(r){onLogin(r.user);}).catch(function(e){setError(e.code==="auth/user-not-found"?"Account non trovato":e.code==="auth/wrong-password"?"Password errata":e.code==="auth/email-already-in-use"?"Email gia registrata":e.code==="auth/weak-password"?"Password troppo corta (min 6)":e.message);setLoading(false);});}
  function doGoogle(){setLoading(true);setError("");fbAuth.signInWithPopup(googleProvider).then(function(r){onLogin(r.user);}).catch(function(e){if(e.code==="auth/popup-blocked"||e.code==="auth/popup-closed-by-user"||e.code==="auth/cancelled-popup-request"){fbAuth.signInWithRedirect(googleProvider);return;}setError(e.code==="auth/unauthorized-domain"?"Dominio non autorizzato in Firebase. Aggiungi questo dominio nelle impostazioni Authentication.":e.message);setLoading(false);});}
  return(<div style={{minHeight:"100vh",background:"linear-gradient(180deg,"+C.sageP+","+C.bg+")",display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"}}>
    <div style={{maxWidth:"380px",width:"100%"}}>
      <div style={{textAlign:"center",marginBottom:"30px"}}><div style={{fontSize:"48px",marginBottom:"8px"}}>üå∏</div><h1 style={{fontFamily:F.p,fontSize:"28px",fontWeight:"600",color:C.txt,margin:"0 0 4px"}}>PCOS Daily</h1><p style={{fontFamily:F.s,fontSize:"13px",color:C.txtL}}>Il tuo strumento quotidiano per gestire la PCOS</p></div>
      <Cd style={{padding:"24px"}}>
        <button onClick={doGoogle} disabled={loading} style={{width:"100%",padding:"13px",borderRadius:"12px",border:"1px solid "+C.bdr,background:C.white,color:C.txt,fontSize:"14px",fontFamily:F.s,fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",marginBottom:"16px"}}><svg width="18" height="18" viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/></svg>{loading?"Caricamento...":"Accedi con Google"}</button>
        <div style={{display:"flex",alignItems:"center",gap:"10px",margin:"12px 0"}}><div style={{flex:1,height:"1px",background:C.bdr}}/><span style={{fontSize:"11px",fontFamily:F.s,color:C.txtL}}>oppure</span><div style={{flex:1,height:"1px",background:C.bdr}}/></div>
        <div style={{display:"grid",gap:"8px"}}><input type="email" placeholder="Email" value={email} onChange={function(e){setEmail(e.target.value);}} style={Object.assign({},iS,{padding:"12px"})}/><input type="password" placeholder="Password" value={pass} onChange={function(e){setPass(e.target.value);}} onKeyDown={function(e){if(e.key==="Enter")doEmail();}} style={Object.assign({},iS,{padding:"12px"})}/></div>
        {error&&<p style={{fontSize:"11px",fontFamily:F.s,color:C.rose,margin:"8px 0 0",textAlign:"center"}}>{error}</p>}
        <button onClick={doEmail} disabled={loading||!email||!pass} style={{width:"100%",padding:"13px",borderRadius:"12px",border:"none",background:!email||!pass?C.bdr:"linear-gradient(135deg,"+C.sage+","+C.sageD+")",color:!email||!pass?C.txtL:C.white,fontSize:"14px",fontFamily:F.s,fontWeight:"600",cursor:!email||!pass?"default":"pointer",marginTop:"12px"}}>{loading?"Caricamento...":mode==="login"?"Accedi":"Registrati"}</button>
        <p style={{textAlign:"center",margin:"12px 0 0"}}><button onClick={function(){setMode(mode==="login"?"register":"login");setError("");}} style={{background:"none",border:"none",color:C.sage,fontSize:"12px",fontFamily:F.s,fontWeight:"600",cursor:"pointer",textDecoration:"underline"}}>{mode==="login"?"Non hai un account? Registrati":"Hai gia un account? Accedi"}</button></p>
      </Cd>
      <p style={{textAlign:"center",fontSize:"10px",fontFamily:F.s,color:C.txtL,marginTop:"16px"}}>I tuoi dati saranno sincronizzati in cloud e accessibili da ogni dispositivo.</p>
    </div>
  </div>);
}

/* ‚îÄ‚îÄ‚îÄ DOCTOR VIEW ‚îÄ‚îÄ‚îÄ */
function DoctorView({uid}){
  const[data,setData]=useState(null);
  const[loading,setLoading]=useState(true);
  useEffect(function(){fbDb.collection("users").doc(uid).get().then(function(doc){if(doc.exists){var d=doc.data();Object.keys(d).forEach(function(k){if(k!=="lastSync")localStorage.setItem("pcos_"+k,d[k]);});setData(d);}setLoading(false);}).catch(function(){setLoading(false);});},[uid]);
  if(loading)return(<div style={{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:C.bg}}><div style={{textAlign:"center"}}><div style={{fontSize:"40px",marginBottom:"10px"}}>üå∏</div><p style={{fontFamily:F.s,fontSize:"14px",color:C.txtM}}>Caricamento dati paziente...</p></div></div>);
  if(!data)return(<div style={{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:C.bg}}><Cd style={{maxWidth:"400px",textAlign:"center",padding:"30px"}}><div style={{fontSize:"40px",marginBottom:"10px"}}>‚ùå</div><h2 style={{fontFamily:F.p,fontSize:"18px",color:C.txt}}>Link non valido</h2><p style={{fontFamily:F.s,fontSize:"13px",color:C.txtM}}>Questo link di condivisione non esiste o √® stato rimosso.</p></Cd></div>);
  var profile=data.profile?JSON.parse(data.profile):DEF_PROF;
  var weighins=data.weighins?JSON.parse(data.weighins):[];
  var bloods=data.bloodwork?JSON.parse(data.bloodwork):[];
  var fasts=data.fasts?JSON.parse(data.fasts):[];
  var workouts=data.workouts?JSON.parse(data.workouts):[];
  var mc=calcMacros(profile);
  var latW=weighins.length>0?weighins[weighins.length-1]:null;
  return(<div style={{minHeight:"100vh",background:"linear-gradient(180deg,"+C.bg+","+C.bgW+")"}}>
    <div style={{background:C.white,borderBottom:"1px solid "+C.bdr,padding:"14px 16px"}}><div style={{display:"flex",alignItems:"center",gap:"10px",maxWidth:"640px",margin:"0 auto"}}><span style={{fontSize:"22px"}}>üå∏</span><div><h1 style={{fontFamily:F.p,fontSize:"17px",fontWeight:"600",color:C.txt,margin:0}}>PCOS Daily ‚Äî Vista Medico</h1><p style={{fontSize:"10px",color:C.txtL,fontFamily:F.s,margin:0}}>Dashboard di sola lettura | {profile.name||"Paziente"}</p></div></div></div>
    <div style={{maxWidth:"640px",margin:"0 auto",padding:"18px 12px"}}>
      <Cd accent={C.sage} style={{marginBottom:"12px",background:"linear-gradient(135deg,"+C.sageP+","+C.white+")"}}><h3 style={{fontFamily:F.p,fontSize:"16px",margin:"0 0 10px",color:C.sageD}}>Profilo Paziente</h3><div style={{display:"flex",gap:"6px",flexWrap:"wrap"}}><Pill color={C.sage}>{profile.age} anni</Pill><Pill color={C.sage}>{profile.height} cm</Pill><Pill color={C.sage}>{profile.weight} kg</Pill><Pill color={C.sage}>BF {profile.bf}%</Pill><Pill color={C.amber}>Target {mc.target} kcal</Pill><Pill color={C.plum}>IF {profile.ifH}:{24-profile.ifH}</Pill></div>{profile.allergies&&profile.allergies.length>0&&<div style={{display:"flex",gap:"4px",flexWrap:"wrap",marginTop:"6px"}}>{profile.allergies.map(function(a){return <Pill key={a} color={C.rose}>üö´ {a}</Pill>;})}</div>}</Cd>
      {latW&&<Cd accent={C.sage} style={{marginBottom:"12px"}}><h4 style={{fontFamily:F.s,fontSize:"13px",fontWeight:"600",color:C.sageD,margin:"0 0 8px"}}>Ultima Pesata ‚Äî {fmtD(latW.date)}</h4><div style={{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:"8px"}}>{[{l:"Peso",v:latW.weight+" kg"},{l:"Body Fat",v:latW.bf+"%"},{l:"Muscolo",v:latW.mm+"%"}].map(function(m,i){return<div key={i} style={{textAlign:"center",padding:"8px",borderRadius:"8px",background:C.bg}}><div style={{fontSize:"16px",fontWeight:"700",color:C.sage,fontFamily:F.s}}>{m.v}</div><div style={{fontSize:"9px",color:C.txtL,fontFamily:F.s}}>{m.l}</div></div>;})}</div></Cd>}
      {bloods.length>0&&<Cd accent={C.berry} style={{marginBottom:"12px"}}><h4 style={{fontFamily:F.s,fontSize:"13px",fontWeight:"600",color:C.berry,margin:"0 0 8px"}}>Ultime Analisi ‚Äî {fmtD(bloods[0].date)}</h4><div style={{display:"grid",gap:"4px"}}>{Object.keys(bloods[0]).filter(function(k){return k!=="date"&&bloods[0][k];}).map(function(k){return<div key={k} style={{display:"flex",justifyContent:"space-between",padding:"6px 8px",borderRadius:"6px",background:C.bg}}><span style={{fontSize:"11px",fontFamily:F.s,color:C.txt,textTransform:"capitalize"}}>{k}</span><span style={{fontSize:"11px",fontFamily:F.s,fontWeight:"600",color:C.plum}}>{bloods[0][k]}</span></div>;})}</div></Cd>}
      <Cd accent={C.plum} style={{marginBottom:"12px"}}><h4 style={{fontFamily:F.s,fontSize:"13px",fontWeight:"600",color:C.plum,margin:"0 0 8px"}}>Riepilogo Attivita</h4><div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"8px"}}><div style={{textAlign:"center",padding:"10px",borderRadius:"8px",background:C.bg}}><div style={{fontSize:"18px",fontWeight:"700",color:C.sage,fontFamily:F.s}}>{weighins.length}</div><div style={{fontSize:"9px",color:C.txtL,fontFamily:F.s}}>Pesate</div></div><div style={{textAlign:"center",padding:"10px",borderRadius:"8px",background:C.bg}}><div style={{fontSize:"18px",fontWeight:"700",color:C.rose,fontFamily:F.s}}>{workouts.length}</div><div style={{fontSize:"9px",color:C.txtL,fontFamily:F.s}}>Allenamenti</div></div><div style={{textAlign:"center",padding:"10px",borderRadius:"8px",background:C.bg}}><div style={{fontSize:"18px",fontWeight:"700",color:C.plum,fontFamily:F.s}}>{fasts.filter(function(f){return f.completed;}).length}</div><div style={{fontSize:"9px",color:C.txtL,fontFamily:F.s}}>Digiuni</div></div></div></Cd>
      {weighins.length>2&&<Cd style={{marginBottom:"12px"}}><h4 style={{fontFamily:F.p,fontSize:"14px",margin:"0 0 10px",color:C.txt}}>Andamento Peso</h4><div style={{display:"flex",alignItems:"flex-end",gap:"3px",height:"100px"}}>{weighins.slice(-12).map(function(w,i,arr){var mn=Math.min.apply(null,arr.map(function(x){return x.weight;}))-1;var mx=Math.max.apply(null,arr.map(function(x){return x.weight;}))+1;var h=((w.weight-mn)/(mx-mn))*100;var il=i===arr.length-1;return<div key={i} style={{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:"2px"}}><span style={{fontSize:"7px",fontFamily:F.s,color:il?C.sage:C.txtL,fontWeight:il?"700":"400"}}>{w.weight}</span><div style={{width:"100%",maxWidth:"24px",height:h+"%",borderRadius:"4px 4px 2px 2px",background:il?C.sage:C.sageL}}/><span style={{fontSize:"6px",fontFamily:F.s,color:C.txtL}}>{fmtD(w.date)}</span></div>;})}</div></Cd>}
      <div style={{textAlign:"center",padding:"20px"}}><p style={{fontSize:"10px",fontFamily:F.s,color:C.txtL}}>PCOS Daily v2.5 | Dashboard di sola lettura</p></div>
    </div>
  </div>);
}
/* ‚îÄ‚îÄ‚îÄ PROFILE ‚îÄ‚îÄ‚îÄ */
var DEF_PROF={name:"",age:27,height:168,weight:77,bf:29,goalW:68,goalBf:23,ifOpen:"10:00",ifClose:"20:00",ifH:14,stepsG:10000,waterG:8,workoutsG:4,allergies:[]};
function calcMacros(p){var bmr=447.6+(9.2*p.weight)+(3.1*p.height)-(4.3*p.age);var tdee=bmr*1.5;var target=Math.round(tdee-500);var prot=Math.round(p.weight*1.5);var fat=Math.round(target*0.35/9);var carb=Math.round((target-prot*4-fat*9)/4);return{bmr:Math.round(bmr),tdee:Math.round(tdee),target:target,prot:prot,fat:fat,carb:carb};}

/* ‚îÄ‚îÄ‚îÄ SUPPLEMENTS ‚îÄ‚îÄ‚îÄ */
var DEF_SUPPS=[
  {id:"inositolo",name:"Inositolo (myo + D-chiro)",time:"Mattina",note:"Migliora insulino-resistenza"},
  {id:"vitd",name:"Vitamina D3",time:"Pranzo",note:"Spesso carente nella PCOS"},
  {id:"omega3",name:"Omega-3 (EPA/DHA)",time:"Pranzo",note:"Anti-infiammatorio"},
  {id:"magnesio",name:"Magnesio",time:"Sera",note:"Riduce stress e crampi"},
  {id:"zinco",name:"Zinco",time:"Sera",note:"Supporta ovulazione"},
  {id:"nac",name:"NAC",time:"Mattina",note:"Antiossidante, fertilita"},
];


/* ‚îÄ‚îÄ‚îÄ QUOTES ‚îÄ‚îÄ‚îÄ */
const QUOTES=[
  {q:"La PCOS non ti definisce. Tu definisci come affrontarla, ogni giorno.",t:"mindset"},
  {q:"Ogni pasto equilibrato e un piccolo atto di cura verso il tuo corpo.",t:"food"},
  {q:"La verdura prima di tutto: riduce l'insulina fino al 48%.",t:"tip"},
  {q:"Non stai seguendo una dieta. Stai costruendo un nuovo rapporto con il tuo corpo.",t:"mindset"},
  {q:"Il resistance training non ti rende grossa: ti rende forte e brucia grasso anche a riposo.",t:"gym"},
  {q:"I tuoi progressi non si misurano solo sulla bilancia. Energia, umore, ciclo: tutto conta.",t:"mindset"},
  {q:"Il te verde a digiuno riduce l'insulina. Una tazza calda e un momento per te.",t:"tip"},
  {q:"L'olio EVO non e il nemico: stabilizza la glicemia e ti sazia piu a lungo.",t:"tip"},
  {q:"Ogni passo conta. 10.000 passi non sono un obbligo, sono un regalo al tuo metabolismo.",t:"gym"},
  {q:"Non confrontarti con chi non ha la PCOS. Il tuo percorso e unico e merita rispetto.",t:"mindset"},
  {q:"Dormire bene e potente quanto allenarsi: il cortisolo alto sabota la perdita di grasso.",t:"tip"},
  {q:"Le proteine a colazione riducono la fame per tutto il giorno.",t:"food"},
  {q:"Non serve essere perfette. Serve essere costanti, con gentilezza.",t:"mindset"},
  {q:"La cannella nel porridge non e solo buona: migliora la sensibilita insulinica.",t:"tip"},
  {q:"Hip Thrust e Squat: i tuoi migliori alleati contro il grasso addominale.",t:"gym"},
  {q:"Mangiare i carboidrati per ultimi non e una regola rigida: e una strategia che funziona.",t:"food"},
  {q:"Anche nei giorni difficili, ricorda: stai facendo qualcosa per te.",t:"mindset"},
  {q:"I legumi sono proteine vegetali potenti: ceci, lenticchie, fagioli. Alternali nel menu.",t:"food"},
  {q:"Lo stress cronico alza il cortisolo e peggiora la PCOS. Prenditi 10 minuti per respirare.",t:"tip"},
  {q:"Non esistono cibi proibiti, esistono scelte consapevoli.",t:"mindset"},
  {q:"L'acqua e fondamentale: 2 litri al giorno aiutano metabolismo e sazieta.",t:"tip"},
  {q:"Muoversi non e una punizione per quello che hai mangiato. E un premio per il tuo corpo.",t:"gym"},
  {q:"La PCOS e cronica ma gestibile. Ogni giorno migliore e un investimento sul tuo futuro.",t:"mindset"},
  {q:"Il salmone e ricco di omega-3 anti-infiammatori. Prova 2-3 volte a settimana.",t:"food"},
  {q:"La tua massa muscolare e il tuo miglior alleato: piu muscoli = piu calorie bruciate a riposo.",t:"gym"},
  {q:"Ascolta il tuo corpo. Se un giorno hai piu fame, non e un fallimento: e biologia.",t:"mindset"},
  {q:"I mirtilli hanno il piu basso indice glicemico tra la frutta. Perfetti per colazione.",t:"food"},
  {q:"Il digiuno intermittente non e soffrire la fame: e dare al corpo tempo di riparare.",t:"tip"},
  {q:"Celebra ogni piccolo traguardo: 1 kg perso, un ciclo arrivato, una settimana costante.",t:"mindset"},
  {q:"Le noci e le mandorle stabilizzano la glicemia: 15-20g al giorno sono il tuo snack ideale.",t:"food"},
  {q:"Oggi e un buon giorno per prenderti cura di te.",t:"mindset"},
];
function getDailyQuote(){var d=new Date();var i=(d.getFullYear()*366+d.getMonth()*31+d.getDate())%QUOTES.length;return QUOTES[i];}


/* ‚îÄ‚îÄ‚îÄ CYCLE PHASES ‚îÄ‚îÄ‚îÄ */
const CYCLE_PHASES=[
  {name:"Mestruale",days:"Giorni 1-5",color:C.rose,icon:"\u{1FA78}",hormones:"Estrogeni e progesterone bassi",symptoms:"Crampi, stanchezza, gonfiore, mal di testa",food:"Ferro (spinaci, lenticchie, carne rossa magra), cibi caldi, zenzero per i crampi, magnesio (cioccolato fondente 85%)",gym:"Attivita leggera: camminate, yoga dolce, stretching. Evita allenamenti intensi.",pcos:"Nella PCOS il flusso puo essere irregolare o assente. Non giudicarti: ogni ciclo che arriva e un segnale positivo."},
  {name:"Follicolare",days:"Giorni 6-13",color:C.sage,icon:"\u{1F331}",hormones:"Estrogeni in crescita, energia in aumento",symptoms:"Energia alta, umore positivo, pelle migliore",food:"Proteine per supportare i follicoli, verdure crucifere (broccoli, cavolfiore), cereali integrali",gym:"Fase MIGLIORE per allenarsi intensamente. Aumenta i carichi, prova nuovi esercizi.",pcos:"Nella PCOS questa fase puo essere prolungata. I follicoli faticano a maturare."},
  {name:"Ovulatoria",days:"Giorni 14-16",color:C.amber,icon:"\u{1F315}",hormones:"Picco di estrogeni e LH",symptoms:"Massima energia, libido alta, pelle luminosa",food:"Fibre per eliminare estrogeni in eccesso, verdure a foglia verde, zinco (semi di zucca), omega-3",gym:"Energia al MASSIMO. Allenamenti ad alta intensita, carichi pesanti, circuit training.",pcos:"L'ovulazione nella PCOS non e sempre presente. Nota muco cervicale e temperatura basale."},
  {name:"Luteale",days:"Giorni 17-28",color:C.plum,icon:"\u{1F319}",hormones:"Progesterone alto, poi calo pre-mestruale",symptoms:"SPM, gonfiore, voglia di dolce, ansia, ritenzione idrica",food:"Carboidrati complessi (per serotonina), magnesio, vitamina B6. Usa cannella e cioccolato fondente.",gym:"Riduci intensita gradualmente. Preferisci pilates, yoga, camminate.",pcos:"La fase luteale nella PCOS puo essere insufficiente (basso progesterone)."},
];

/* ‚îÄ‚îÄ‚îÄ MENU 7 GIORNI ‚îÄ‚îÄ‚îÄ */
const MENU=[
  {day:"Lunedi",col:{t:"Avocado Toast + Uovo",desc:"Pane di segale tostato (40g) + 1/2 avocado (60g) + 1 uovo in camicia + semi di chia (10g) + spinacini (30g)",kcal:510,p:22,c:42,f:28},pra:{t:"Pollo & Quinoa Mediterranea",desc:"Rucola e pomodori (200g) + olio EVO (10ml) \u2192 pollo grigliato (150g) \u2192 quinoa (60g cruda) al limone",kcal:555,p:42,c:48,f:18},cen:{t:"Salmone al Forno",desc:"Crema di zucchine e porri (250g) \u2192 salmone al forno (120g) con erbe \u2192 pane integrale (25g)",kcal:360,p:32,c:18,f:16},sn:{t:"10 mandorle (15g)",kcal:90}},
  {day:"Martedi",col:{t:"Porridge Proteico",desc:"Fiocchi d'avena larghi (40g) + burro di mandorle (15g) + mirtilli (80g) + semi canapa (10g) + cannella",kcal:480,p:18,c:52,f:22},pra:{t:"Lenticchie & Riso Integrale",desc:"Broccoli al vapore (250g) + curcuma \u2192 lenticchie rosse (70g crude) in umido \u2192 riso basmati integrale (50g crudo)",kcal:540,p:28,c:72,f:10},cen:{t:"Frittata Spinaci & Zucchine",desc:"Insalata verde e finocchi (200g) + olio EVO (8ml) \u2192 frittata (2 uova) con spinaci (100g) e zucchine (80g) \u2192 pane segale (30g)",kcal:370,p:24,c:22,f:20},sn:{t:"1 kiwi (80g)",kcal:45}},
  {day:"Mercoledi",col:{t:"Colazione Salata Completa",desc:"Fette Wasa (2, ~30g) + fiocchi di latte (100g) + fesa di tacchino (40g) + carote crude (80g) + 5 noci (15g)",kcal:490,p:32,c:38,f:20},pra:{t:"Merluzzo & Patate Dolci",desc:"Insalata pomodori e sedano (200g) + olio EVO (10ml) \u2192 merluzzo al forno (150g) con olive (15g) \u2192 patate dolci (120g) al rosmarino",kcal:530,p:36,c:50,f:16},cen:{t:"Ceci in Insalata",desc:"Minestrone di verdure (300ml) \u2192 ceci (50g secchi = ~120g cotti) in insalata con cipolla rossa e prezzemolo + olio EVO (8ml)",kcal:340,p:18,c:38,f:12},sn:{t:"Bastoncini sedano + hummus (30g)",kcal:75}},
  {day:"Giovedi",col:{t:"Budino di Chia Tropicale",desc:"Semi chia (25g) in latte di cocco (150ml) + cocco rape (10g) + lamponi (80g) + pistacchi (15g) + pane segale (30g) + tacchino (30g)",kcal:520,p:22,c:44,f:28},pra:{t:"Tacchino al Limone & Farro",desc:"Valeriana e carote julienne (200g) + olio EVO (10ml) \u2192 tacchino (150g) al limone \u2192 farro integrale (55g crudo)",kcal:545,p:40,c:52,f:16},cen:{t:"Zuppa Grano Saraceno & Sgombro",desc:"Zuppa grano saraceno (40g), porri e broccoli (200g) \u2192 sgombro al forno (100g) con pomodorini (80g)",kcal:360,p:26,c:30,f:14},sn:{t:"Mela verde (150g)",kcal:75}},
  {day:"Venerdi",col:{t:"Toast Salmone & Avocado",desc:"Pane integrale tostato (40g) + salmone affumicato (50g) + 1/2 avocado (60g) + semi sesamo (5g) + rucola (20g)",kcal:500,p:24,c:34,f:30},pra:{t:"Riso Venere & Seppie",desc:"Rucola e radicchio (200g) + olio EVO (10ml) \u2192 seppie (150g) con fagioli borlotti (50g secchi) \u2192 riso venere (50g crudo)",kcal:560,p:38,c:54,f:16},cen:{t:"Orata al Cartoccio",desc:"Cavoletti di Bruxelles saltati (200g) + olio EVO (5ml) \u2192 orata al cartoccio (150g) con erbe e limone",kcal:330,p:36,c:10,f:14},sn:{t:"Yogurt greco 0% (80g) + 3 noci",kcal:95}},
  {day:"Sabato",col:{t:"Omelette Ricca di Verdure",desc:"Omelette (2 uova + 1 albume) con zucchine (80g) e peperoni (60g) + pane segale (35g) + 1/4 avocado (35g)",kcal:510,p:28,c:32,f:26},pra:{t:"Polpette Merluzzo & Orzo",desc:"Spinacini (100g), noci (10g), mela verde (80g) \u2192 polpette merluzzo (150g) su crema porri \u2192 orzo (55g crudo)",kcal:555,p:36,c:56,f:18},cen:{t:"Vellutata Cannellini al Timo",desc:"Insalata verde (150g) \u2192 vellutata fagioli cannellini (60g secchi) con cipolle e crostini segale (20g) al timo",kcal:340,p:20,c:40,f:10},sn:{t:"Cioccolato fondente 85% (10g)",kcal:55}},
  {day:"Domenica",col:{t:"Pancake Proteici",desc:"Farina d'avena (35g) + 2 albumi + 1 uovo + frutti di bosco (100g) + burro arachidi (10g) + cannella",kcal:480,p:26,c:48,f:18},pra:{t:"Pollo & Patate in Insalata",desc:"Pomodori, cetrioli e rucola (200g) + olio EVO (10ml) \u2192 petto pollo al forno (150g) \u2192 patate novelle (100g) tiepide con aceto",kcal:550,p:42,c:48,f:16},cen:{t:"Crema di Zucca & Uova Sode",desc:"Crema zucca al forno (200g) con porri e crusca d'avena (8g) \u2192 2 uova sode \u2192 insalata verde (100g)",kcal:340,p:22,c:24,f:16},sn:{t:"Fiocchi di latte (60g) + pinoli",kcal:70}},
];


/* ‚îÄ‚îÄ‚îÄ IDEE PASTI ‚îÄ‚îÄ‚îÄ */
const IDEAS={
  colazione:{intro:"Pasto PRINCIPALE (~520 kcal) ore 10:00. Rapporto 2:1 proteine:carboidrati.",items:[
    {n:"Avocado Toast Proteico",d:"Pane segale tostato (40g) + 1/2 avocado (60g) + 1 uovo in camicia + semi sesamo (5g)",i:"\u{1F951}",kcal:"~510"},
    {n:"Toast Salmone & Fiocchi di Latte",d:"Fette Wasa (2x15g) + fiocchi di latte (100g) + salmone affumicato (40g) + pomodorini (50g)",i:"\u{1F41F}",kcal:"~470"},
    {n:"Omelette Verdure",d:"2 uova + 1 albume + zucchine (80g) e peperoni (60g) + pane integrale (35g) + 1/4 avocado (35g)",i:"\u{1F373}",kcal:"~510"},
    {n:"Porridge Power",d:"Avena fiocchi larghi (40g) + burro mandorle (15g) + mirtilli (80g) + semi canapa (10g) + cannella",i:"\u{1F963}",kcal:"~480"},
    {n:"Budino di Chia",d:"Semi chia (25g) in latte cocco (150ml) + lamponi (80g) + pistacchi (15g)",i:"\u{1F965}",kcal:"~460"},
    {n:"Pancake Proteici",d:"Farina avena (35g) + 2 albumi + 1 uovo + frutti di bosco (100g) + burro arachidi (10g)",i:"\u{1F95E}",kcal:"~480"},
  ]},
  pranzo:{intro:"Pasto equilibrato (~550 kcal) ore 14:00. Ordine: VERDURA \u2192 PROTEINE \u2192 CARBO.",items:[
    {n:"Bowl Mediterranea",d:"Rucola e pomodori (200g) + olio EVO (10ml) \u2192 pollo grigliato (150g) \u2192 quinoa (60g cruda)",i:"\u{1F957}",kcal:"~555"},
    {n:"Salmone & Riso Integrale",d:"Cavolfiore al vapore (250g) \u2192 salmone al forno (130g) \u2192 riso basmati integrale (50g crudo)",i:"\u{1F41F}",kcal:"~540"},
    {n:"Polpette Merluzzo & Porri",d:"Insalata (spinacini 100g, noci 10g, mela 80g) \u2192 polpette merluzzo (150g) \u2192 orzo (55g crudo)",i:"\u{1F41F}",kcal:"~555"},
    {n:"Riso Venere & Salmone",d:"Insalata mista (200g) \u2192 riso venere (50g crudo) con salmone (80g), olive (15g), capperi",i:"\u{1F35A}",kcal:"~530"},
    {n:"Tacchino & Farro",d:"Valeriana e carote (200g) + olio EVO (10ml) \u2192 tacchino (150g) al limone \u2192 farro integrale (55g crudo)",i:"\u{1F357}",kcal:"~545"},
  ]},
  cena:{intro:"Pasto LEGGERO (~350 kcal) entro le 19:30. Proteine + verdure, pochi carboidrati.",items:[
    {n:"Orata al Cartoccio",d:"Cavoletti (200g) saltati + olio EVO (5ml) \u2192 orata al cartoccio (150g) con erbe e limone",i:"\u{1F41F}",kcal:"~330"},
    {n:"Vellutata Cannellini",d:"Insalata verde (150g) \u2192 vellutata fagioli cannellini (60g secchi) con crostini segale (20g)",i:"\u{1F372}",kcal:"~340"},
    {n:"Salmone Yogurt & Spinaci",d:"Spinacini (150g) \u2192 salmone (120g) in salsa yogurt (60g) con pinoli (8g)",i:"\u{1F41F}",kcal:"~350"},
    {n:"Frittata Leggera",d:"Insalata verde (200g) + olio EVO (5ml) \u2192 frittata (2 uova) con spinaci (100g) e funghi (80g)",i:"\u{1F373}",kcal:"~330"},
    {n:"Tonno & Crema Avocado",d:"Insalata verde (200g) \u2192 tonno fresco scottato (120g) con crema avocado (40g) e lime",i:"\u{1F41F}",kcal:"~340"},
  ]},
};

/* ‚îÄ‚îÄ‚îÄ RICETTE ‚îÄ‚îÄ‚îÄ */
const RECIPES=[
  {n:"Salmone in salsa di yogurt e spinaci",cat:"Secondo",url:"https://www.lotusflowerpcos.com/salmone-in-salsa-di-yogurt-e-spinaci/",ing:"Salmone 150g + spinacini 125g + yogurt 60g + pinoli 10g",kcal:"~360",tag:"Omega-3"},
  {n:"Polpette di ceci con salsa di capperi",cat:"Secondo",url:"https://www.lotusflowerpcos.com/polpette-ceci-salsa-capperi/",ing:"Ceci secchi 60g + 1 uovo + crusca avena + capperi",kcal:"~280",tag:"Legumi"},
  {n:"Polpette di merluzzo con arancia e porri",cat:"Secondo",url:"https://www.lotusflowerpcos.com/polpette-di-merluzzo-arancia-crema-di-porri/",ing:"Merluzzo 125g + 1 uovo + porri 200g",kcal:"~300",tag:"Omega-3"},
  {n:"Riso venere con salmone e capperi",cat:"Primo",url:"https://www.lotusflowerpcos.com/riso-venere-salmone-affumicato-olive-capperi-limone/",ing:"Riso venere 60g + salmone 50g + olive 10g",kcal:"~380",tag:"Integrale"},
  {n:"Spaghetti integrali ragu di orata",cat:"Primo",url:"https://www.lotusflowerpcos.com/spaghetti-integrali-ragu-bianco-orata/",ing:"Spaghetti integrali 60g + orata 150g + sedano",kcal:"~420",tag:"Integrale"},
  {n:"Timballini quinoa con verdure",cat:"Primo",url:"https://www.lotusflowerpcos.com/timballini-di-quinoa-con-verdurine-e-curcuma/",ing:"Quinoa 60g + verdure miste 150g + curcuma",kcal:"~350",tag:"Anti-infiamm."},
  {n:"Tonno scottato con crema di avocado",cat:"Secondo",url:"https://www.lotusflowerpcos.com/tonno-scottato-con-crema-di-avocado/",ing:"Tonno fresco 130g + avocado 50g + lime",kcal:"~340",tag:"Omega-3"},
  {n:"Risotto integrale funghi e rosmarino",cat:"Primo",url:"https://www.lotusflowerpcos.com/risotto-integrale-leggero-funghi-rosmarino/",ing:"Riso integrale 60g + funghi misti 150g",kcal:"~350",tag:"Integrale"},
  {n:"Vellutata cannellini con crostini timo",cat:"Primo",url:"https://www.lotusflowerpcos.com/vellutata-fagioli-cannellini-cipolle-crostini-al-timo/",ing:"Cannellini secchi 60g + pane segale 25g",kcal:"~310",tag:"Legumi"},
  {n:"Zuppa farro ai funghi",cat:"Primo",url:"https://www.lotusflowerpcos.com/zuppa-farro-ai-funghi/",ing:"Farro 60g + funghi misti 200g",kcal:"~320",tag:"Integrale"},
  {n:"Polpettone pollo erbe provenzali",cat:"Secondo",url:"https://www.lotusflowerpcos.com/polpettone-pollo-umido-alle-erbe-provenzali/",ing:"Petto pollo 150g + crusca avena + pomodoro 200g",kcal:"~300",tag:"Proteine"},
  {n:"Insalata cavoletti mandorle pompelmo",cat:"Contorno",url:"https://www.lotusflowerpcos.com/insalata-cavoletti-brasati-mandorle-pompelmo-rosa/",ing:"Cavoletti 175g + pompelmo rosa + mandorle 10g",kcal:"~160",tag:"Fibre"},
  {n:"Grigliata verdure con chimichurri",cat:"Contorno",url:"https://www.lotusflowerpcos.com/grigliata-verdure-invernale-salsa-chimichurri/",ing:"Radicchio + finocchio + funghi 150g",kcal:"~120",tag:"Fibre"},
];

/* ‚îÄ‚îÄ‚îÄ CIBI ‚îÄ‚îÄ‚îÄ */
const FOODS=[
  {cat:"Verdure",items:["Broccoli","Cavolfiore","Zucchine","Spinaci","Rucola","Sedano","Finocchi","Funghi","Asparagi","Peperoni"],note:"PRIMA portata. 200-250g cotte, 80-100g crude.",ico:"\u{1F96C}"},
  {cat:"Proteine",items:["Pollo/tacchino 120-150g","Pesce 120-150g","2 uova (fino 12/sett)","Fiocchi di latte 100g","Legumi 50-70g secchi","Fesa tacchino 40-60g"],note:"Seconda portata. Target ~112g/giorno.",ico:"\u{1F969}"},
  {cat:"Carboidrati",items:["Avena 35-40g","Riso integrale 50-60g","Quinoa 50-60g","Farro 50-60g","Pane segale 30-40g","Fette Wasa 2-3"],note:"ULTIMA portata, mai soli. Grammi a crudo.",ico:"\u{1F33E}"},
  {cat:"Grassi buoni",items:["Olio EVO 10-15ml/pasto","Avocado mezzo (60g)","Mandorle/noci 15-20g","Semi chia/lino 10g","Burro arachidi 10-15g"],note:"Non eliminare mai. Target ~58g/giorno.",ico:"\u{1F951}"},
  {cat:"Frutta",items:["Mirtilli 80g","Fragole/lamponi 100g","Mela verde 150g","Kiwi 1 medio","Pompelmo mezzo"],note:"Sempre INTERA, mai frullata.",ico:"\u{1F353}"},
  {cat:"Bevande",items:["Te verde 2-3 tazze","Te menta piperita","Te cannella","Camomilla","Caffe max 2/giorno"],note:"Ok anche a digiuno (senza zucchero).",ico:"\u{1F375}"},
];


/* ‚îÄ‚îÄ‚îÄ GYM ‚îÄ‚îÄ‚îÄ */
const GYM={
  upper:{t:"Upper Body",ico:"\u{1F4AA}",why:"Piu massa muscolare = metabolismo basale alto = piu calorie bruciate a riposo.",ex:[
    {n:"Lat Pulldown",s:"3x12",r:"60s",nt:"Presa larga, squeeze scapole",vid:"lat+pulldown+tutorial"},
    {n:"Chest Press manubri",s:"3x12",r:"60s",nt:"3s eccentrica",vid:"chest+press+manubri"},
    {n:"Shoulder Press",s:"3x10",r:"60s",nt:"Schiena dritta",vid:"shoulder+press+tutorial"},
    {n:"Cable Row",s:"3x12",r:"60s",nt:"Gomiti al corpo",vid:"cable+row+tutorial"},
    {n:"Curl bicipiti",s:"2x15",r:"45s",nt:"Alternati",vid:"curl+bicipiti"},
    {n:"Tricep Pushdown",s:"2x15",r:"45s",nt:"Gomiti fermi",vid:"tricep+pushdown"},
    {n:"Face Pull",s:"3x15",r:"45s",nt:"Per postura",vid:"face+pull+tutorial"},
  ]},
  lower:{t:"Lower Body",ico:"\u{1F9B5}",why:"Muscoli grandi consumano piu glicogeno. Fondamentale per grasso addominale.",ex:[
    {n:"Squat bilanciere/goblet",s:"4x10",r:"90s",nt:"Parallelo, schiena neutra",vid:"squat+donna+tutorial"},
    {n:"Hip Thrust",s:"3x12",r:"75s",nt:"Pausa in alto, squeeze",vid:"hip+thrust+donna"},
    {n:"Leg Press 45",s:"3x12",r:"75s",nt:"Piedi alti per glutei",vid:"leg+press+tutorial"},
    {n:"Affondi camminati",s:"3x10/g",r:"60s",nt:"Passo lungo",vid:"affondi+camminati"},
    {n:"Leg Curl",s:"3x12",r:"60s",nt:"Eccentrica lenta",vid:"leg+curl+tutorial"},
    {n:"Calf Raise",s:"3x15",r:"45s",nt:"Pausa 2s basso",vid:"calf+raise"},
    {n:"Abductor",s:"3x15",r:"45s",nt:"Contrazione controllata",vid:"abductor+machine"},
  ]},
  core:{t:"Core & Addome",ico:"\u{1F3AF}",why:"Core forte migliora postura e riduce cortisolo. Non si dimagrisce localmente.",ex:[
    {n:"Plank",s:"3x30-45s",r:"45s",nt:"Corpo in linea",vid:"plank+corretto"},
    {n:"Dead Bug",s:"3x10/lato",r:"45s",nt:"Schiena piatta",vid:"dead+bug+esercizio"},
    {n:"Pallof Press",s:"3x10/lato",r:"45s",nt:"Anti-rotazione",vid:"pallof+press"},
    {n:"Crunch palla svizzera",s:"3x15",r:"45s",nt:"Non tirare collo",vid:"crunch+palla+svizzera"},
    {n:"Bird Dog",s:"3x10/lato",r:"30s",nt:"Stabilita",vid:"bird+dog+esercizio"},
    {n:"Russian Twist",s:"3x12/lato",r:"45s",nt:"Controllare",vid:"russian+twist"},
    {n:"Vacuum addominale",s:"3x10s",r:"30s",nt:"Trasverso",vid:"vacuum+addominale"},
  ]},
  sched:[
    {d:"Lunedi",w:"Upper Body",i:"Moderata"},
    {d:"Martedi",w:"Camminata + Stretching",i:"Leggera"},
    {d:"Mercoledi",w:"Lower Body",i:"Mod-Alta"},
    {d:"Giovedi",w:"Riposo attivo / Yoga",i:"Bassa"},
    {d:"Venerdi",w:"Core + Upper Body",i:"Moderata"},
    {d:"Sabato",w:"Lower Body + Camminata",i:"Moderata"},
    {d:"Domenica",w:"Riposo / Passeggiata",i:"Bassa"},
  ],
};

/* ‚îÄ‚îÄ‚îÄ GARMIN DEFAULTS ‚îÄ‚îÄ‚îÄ */
var DEF_W=[{date:"2025-01-06",weight:79.2,bf:30.5,mm:25.8,bm:2.5,bw:47.0},{date:"2025-01-13",weight:78.8,bf:30.2,mm:25.9,bm:2.5,bw:47.2},{date:"2025-01-20",weight:78.5,bf:30.0,mm:26.0,bm:2.5,bw:47.5},{date:"2025-01-27",weight:78.1,bf:29.7,mm:26.1,bm:2.6,bw:47.6},{date:"2025-02-03",weight:77.8,bf:29.5,mm:26.2,bm:2.6,bw:47.8},{date:"2025-02-10",weight:77.5,bf:29.3,mm:26.3,bm:2.6,bw:48.0},{date:"2025-02-17",weight:77.2,bf:29.1,mm:26.4,bm:2.6,bw:48.1},{date:"2025-02-21",weight:77.0,bf:29.0,mm:26.5,bm:2.6,bw:48.2}];
var DEF_WO=[];var DEF_DD={steps:0,rhr:0,stress:0,bb:0,vo2:0};

/* ‚îÄ‚îÄ‚îÄ SHOPPING LIST GENERATOR ‚îÄ‚îÄ‚îÄ */
function genShoppingList(dayIdxs){
  var cats={frutta:[],verdura:[],proteine:[],carboidrati:[],dispensa:[],latticini:[]};
  var verdK=["rucola","pomodor","spinac","zucchin","brocco","cavol","insalata","finocch","peperoni","sedano","porri","fungh","valeriana","carot","radicchio"];
  var protK=["pollo","salmone","merluzzo","tacchino","uov","tonno","orata","seppie","sgombro"];
  var carbK=["pane","riso","quinoa","farro","orzo","avena","wasa","patate","grano saraceno"];
  var fruttK=["mirtill","lamponi","fragol","mela","kiwi","pompelmo","frutti di bosco"];
  var lattK=["yogurt","fiocchi di latte","latte"];
  dayIdxs.forEach(function(di){
    var m=MENU[di];if(!m)return;
    [m.col,m.pra,m.cen].forEach(function(meal){
      var d=(meal.desc||"").toLowerCase();
      verdK.forEach(function(k){if(d.includes(k)&&cats.verdura.indexOf(k)<0)cats.verdura.push(k);});
      protK.forEach(function(k){if(d.includes(k)&&cats.proteine.indexOf(k)<0)cats.proteine.push(k);});
      carbK.forEach(function(k){if(d.includes(k)&&cats.carboidrati.indexOf(k)<0)cats.carboidrati.push(k);});
      fruttK.forEach(function(k){if(d.includes(k)&&cats.frutta.indexOf(k)<0)cats.frutta.push(k);});
      lattK.forEach(function(k){if(d.includes(k)&&cats.latticini.indexOf(k)<0)cats.latticini.push(k);});
    });
  });
  cats.dispensa=["olio EVO","semi di chia","semi canapa","semi sesamo","cannella","curcuma","mandorle","noci","pistacchi","burro di mandorle"];
  return cats;
}


/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê UI COMPONENTS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function fmt(ms){if(ms<=0)return{h:"00",m:"00",s:"00"};var ts=Math.floor(ms/1000);return{h:String(Math.floor(ts/3600)).padStart(2,"0"),m:String(Math.floor((ts%3600)/60)).padStart(2,"0"),s:String(ts%60).padStart(2,"0")};}

function Cd({children,style,accent}){return(<div style={{background:C.white,borderRadius:"14px",padding:"18px",border:"1px solid "+C.bdr,borderTop:accent?"3px solid "+accent:undefined,...style}}>{children}</div>);}
function Pill({children,color}){var c=color||C.sage;return(<span style={{display:"inline-block",padding:"3px 9px",borderRadius:"20px",fontSize:"10px",fontWeight:"500",fontFamily:F.s,background:c+"18",color:c}}>{children}</span>);}
function Bar({v,mx,color}){var c=color||C.sage;return(<div style={{height:"5px",borderRadius:"3px",background:C.bdr,width:"100%",overflow:"hidden"}}><div style={{height:"100%",borderRadius:"3px",background:c,width:Math.min((v/mx)*100,100)+"%",transition:"width .8s"}}/></div>);}
function Info({bg,bdr,color,children}){return(<Cd style={{background:bg,border:"1px solid "+bdr}}><div style={{fontSize:"12px",fontFamily:F.s,color:color,margin:0,lineHeight:1.6}}>{children}</div></Cd>);}
function MacroBar({p,c,f,kcal}){var tot=p+c+f;return(<div style={{marginTop:"8px"}}><div style={{display:"flex",height:"6px",borderRadius:"3px",overflow:"hidden",gap:"2px"}}><div style={{width:((p/tot)*100)+"%",background:C.rose,borderRadius:"3px"}}/><div style={{width:((c/tot)*100)+"%",background:C.amber,borderRadius:"3px"}}/><div style={{width:((f/tot)*100)+"%",background:C.sage,borderRadius:"3px"}}/></div><div style={{display:"flex",justifyContent:"space-between",marginTop:"4px",fontSize:"10px",fontFamily:F.s,color:C.txtL}}><span style={{color:C.rose}}>P {p}g</span><span style={{color:C.amber}}>C {c}g</span><span style={{color:C.sage}}>G {f}g</span><span style={{fontWeight:"600",color:C.txt}}>{kcal} kcal</span></div></div>);}
function SubT({tabs,active,onSel}){return(<div style={{display:"flex",gap:"4px",flexWrap:"wrap",marginBottom:"18px"}}>{tabs.map(function(t){return(<button key={t.k} onClick={function(){onSel(t.k);}} style={{padding:"6px 12px",borderRadius:"10px",border:active===t.k?"none":"1px solid "+C.bdr,background:active===t.k?C.sageP:C.white,color:active===t.k?C.sageD:C.txtM,fontWeight:active===t.k?"600":"400",fontSize:"11px",fontFamily:F.s,cursor:"pointer"}}>{t.i?t.i+" ":""}{t.l}</button>);})}</div>);}
function NavTab({label,icon,active,onClick}){return(<button onClick={onClick} style={{display:"flex",alignItems:"center",gap:"5px",padding:"10px 12px",borderRadius:"50px",border:"none",cursor:"pointer",fontSize:"11px",fontWeight:active?"600":"400",fontFamily:F.s,background:active?C.sage:"transparent",color:active?C.white:C.txtM,transition:"all .3s",whiteSpace:"nowrap"}}><span style={{fontSize:"14px"}}>{icon}</span><span>{label}</span></button>);}
function SecH({title,sub}){return(<div style={{marginBottom:"20px"}}><h2 style={{fontFamily:F.p,fontSize:"24px",fontWeight:"600",color:C.txt,margin:0}}>{title}</h2><p style={{fontFamily:F.s,fontSize:"12px",color:C.txtL,marginTop:"5px"}}>{sub}</p></div>);}
var iS={width:"100%",padding:"10px",borderRadius:"10px",border:"1px solid "+C.bdr,fontFamily:F.s,fontSize:"13px",boxSizing:"border-box",background:C.white};
var lS={fontSize:"10px",fontFamily:F.s,color:C.txtM,display:"block",marginBottom:"3px",fontWeight:"500"};


/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê WATER TRACKER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function WaterTracker(){
  const[glasses,setGlasses]=useState(function(){var d=LD("water_"+todayK(),0);return d;});
  var goal=LD("profile",DEF_PROF).waterG||8;
  useEffect(function(){SV("water_"+todayK(),glasses);},[glasses]);
  var pct=Math.min(Math.round((glasses/goal)*100),100);
  return(<Cd accent={C.blue} style={{marginBottom:"12px"}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"}}><div><h4 style={{fontFamily:F.s,fontSize:"13px",fontWeight:"600",color:C.blue,margin:0}}>üíß Acqua Oggi</h4><span style={{fontSize:"10px",fontFamily:F.s,color:C.txtL}}>{glasses}/{goal} bicchieri ({glasses*250}ml)</span></div><div style={{display:"flex",gap:"6px",alignItems:"center"}}><button onClick={function(){if(glasses>0)setGlasses(glasses-1);}} style={{width:"30px",height:"30px",borderRadius:"50%",border:"1px solid "+C.bdr,background:C.white,fontSize:"16px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:C.txtM}}>‚àí</button><span style={{fontFamily:F.s,fontSize:"22px",fontWeight:"700",color:C.blue,minWidth:"30px",textAlign:"center"}}>{glasses}</span><button onClick={function(){setGlasses(glasses+1);}} style={{width:"36px",height:"36px",borderRadius:"50%",border:"none",background:pct>=100?"linear-gradient(135deg,#4CAF50,#66BB6A)":"linear-gradient(135deg,"+C.blue+",#7BB3E0)",color:C.white,fontSize:"18px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"700",animation:pct>=100?"":"ripple 1.5s infinite"}}>+</button></div></div><Bar v={glasses} mx={goal} color={pct>=100?"#4CAF50":C.blue}/>{pct>=100&&<p style={{fontSize:"10px",fontFamily:F.s,color:"#4CAF50",marginTop:"6px",fontWeight:"600",textAlign:"center"}}>‚úÖ Obiettivo raggiunto!</p>}</Cd>);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MEAL CHECKLIST ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function MealChecklist(){
  var dk=todayK();
  const[checks,setChecks]=useState(function(){return LD("meals_"+dk,{col:false,pra:false,cen:false,sn:false});});
  useEffect(function(){SV("meals_"+dk,checks);},[checks]);
  var done=Object.values(checks).filter(Boolean).length;
  var meals=[{k:"col",l:"Colazione",t:"10:00",c:C.amber},{k:"pra",l:"Pranzo",t:"14:00",c:C.sage},{k:"cen",l:"Cena",t:"19:30",c:C.rose},{k:"sn",l:"Snack",t:"~16:30",c:C.plum}];
  return(<Cd accent={C.sage} style={{marginBottom:"12px"}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"}}><h4 style={{fontFamily:F.s,fontSize:"13px",fontWeight:"600",color:C.sage,margin:0}}>‚úÖ Pasti Oggi</h4><span style={{fontSize:"11px",fontFamily:F.s,fontWeight:"600",color:done===4?"#4CAF50":C.txtL}}>{done}/4</span></div><div style={{display:"flex",gap:"6px"}}>{meals.map(function(m){var ck=checks[m.k];return(<button key={m.k} onClick={function(){var u=Object.assign({},checks);u[m.k]=!u[m.k];setChecks(u);}} style={{flex:1,padding:"8px 4px",borderRadius:"10px",border:ck?"2px solid "+m.c:"1px solid "+C.bdr,background:ck?m.c+"15":C.white,cursor:"pointer",textAlign:"center",transition:"all .2s"}}><div style={{fontSize:"14px",marginBottom:"2px"}}>{ck?"‚úÖ":"‚¨ú"}</div><div style={{fontSize:"9px",fontFamily:F.s,fontWeight:"600",color:ck?m.c:C.txtL}}>{m.l}</div><div style={{fontSize:"8px",fontFamily:F.s,color:C.txtL}}>{m.t}</div></button>);})}</div><div style={{marginTop:"8px"}}><Bar v={done} mx={4} color={done===4?"#4CAF50":C.sage}/></div></Cd>);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SUPPLEMENT TRACKER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function SuppTracker(){
  var dk=todayK();
  const[supps,setSupps]=useState(function(){return LD("supps_"+dk,DEF_SUPPS.map(function(s){return{id:s.id,checked:false};}));});
  useEffect(function(){SV("supps_"+dk,supps);},[supps]);
  function toggle(id){setSupps(supps.map(function(s){return s.id===id?{id:s.id,checked:!s.checked}:s;}));}
  var done=supps.filter(function(s){return s.checked;}).length;
  var byTime={Mattina:[],Pranzo:[],Sera:[]};
  DEF_SUPPS.forEach(function(s){if(byTime[s.time])byTime[s.time].push(s);});
  return(<div style={{display:"grid",gap:"10px"}}><Cd accent={C.plum}><div style={{display:"flex",justifyContent:"space-between",marginBottom:"10px"}}><h4 style={{fontFamily:F.s,fontSize:"13px",fontWeight:"600",color:C.plum,margin:0}}>üíä Integratori Oggi</h4><span style={{fontSize:"11px",fontFamily:F.s,fontWeight:"600",color:done===DEF_SUPPS.length?"#4CAF50":C.txtL}}>{done}/{DEF_SUPPS.length}</span></div><Bar v={done} mx={DEF_SUPPS.length} color={C.plum}/></Cd>
  {Object.keys(byTime).map(function(time){return(<Cd key={time}><h5 style={{fontFamily:F.s,fontSize:"11px",fontWeight:"600",color:C.txtM,margin:"0 0 8px",textTransform:"uppercase",letterSpacing:".5px"}}>{time==="Mattina"?"‚òÄÔ∏è":time==="Pranzo"?"üå§Ô∏è":"üåô"} {time}</h5><div style={{display:"grid",gap:"6px"}}>{byTime[time].map(function(s){var st=supps.find(function(x){return x.id===s.id;});var ck=st?st.checked:false;return(<button key={s.id} onClick={function(){toggle(s.id);}} style={{display:"flex",gap:"10px",alignItems:"center",padding:"10px",borderRadius:"10px",border:ck?"2px solid "+C.plum:"1px solid "+C.bdr,background:ck?C.plumP:C.white,cursor:"pointer",textAlign:"left",width:"100%"}}><span style={{fontSize:"16px",flexShrink:0}}>{ck?"‚úÖ":"‚¨ú"}</span><div style={{flex:1}}><div style={{fontFamily:F.s,fontSize:"12px",fontWeight:"600",color:ck?C.plum:C.txt}}>{s.name}</div><div style={{fontFamily:F.s,fontSize:"10px",color:C.txtL}}>{s.note}</div></div></button>);})}</div></Cd>);})}</div>);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SLEEP TRACKER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function SleepTracker(){
  var dk=todayK();
  const[sleep,setSleep]=useState(function(){return LD("sleep_"+dk,{hours:0,quality:0,bedtime:"",waketime:""});});
  const[editing,setEditing]=useState(false);
  const[form,setForm]=useState(Object.assign({},sleep));
  function save(){var s={hours:parseFloat(form.hours)||0,quality:parseInt(form.quality)||0,bedtime:form.bedtime,waketime:form.waketime};setSleep(s);SV("sleep_"+dk,s);setEditing(false);}
  var qLabels=["","üò´ Pessima","üòï Scarsa","üòê Sufficiente","üôÇ Buona","üòä Ottima"];
  return(<Cd accent={C.plum} style={{marginBottom:"12px"}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"}}><h4 style={{fontFamily:F.s,fontSize:"13px",fontWeight:"600",color:C.plum,margin:0}}>üò¥ Sonno</h4>{!editing&&<button onClick={function(){setForm(Object.assign({},sleep));setEditing(true);}} style={{padding:"4px 12px",borderRadius:"8px",border:"none",background:C.plumP,color:C.plum,fontSize:"10px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}}>Modifica</button>}</div>{!editing?(<div>{sleep.hours>0?(<div style={{display:"flex",gap:"10px"}}><div style={{flex:1,textAlign:"center",padding:"10px",borderRadius:"10px",background:C.plumP}}><div style={{fontFamily:F.s,fontSize:"20px",fontWeight:"700",color:C.plum}}>{sleep.hours}h</div><div style={{fontSize:"9px",fontFamily:F.s,color:C.txtL}}>Durata</div></div><div style={{flex:1,textAlign:"center",padding:"10px",borderRadius:"10px",background:C.bg}}><div style={{fontFamily:F.s,fontSize:"14px",fontWeight:"600",color:C.txt}}>{qLabels[sleep.quality]||"--"}</div><div style={{fontSize:"9px",fontFamily:F.s,color:C.txtL}}>Qualita</div></div>{sleep.bedtime&&<div style={{flex:1,textAlign:"center",padding:"10px",borderRadius:"10px",background:C.bg}}><div style={{fontFamily:F.s,fontSize:"14px",fontWeight:"600",color:C.txt}}>{sleep.bedtime}</div><div style={{fontSize:"9px",fontFamily:F.s,color:C.txtL}}>A letto</div></div>}</div>):(<p style={{fontSize:"11px",fontFamily:F.s,color:C.txtL,textAlign:"center",padding:"8px"}}>Registra il sonno di stanotte</p>)}</div>):(<div style={{display:"grid",gap:"8px"}}><div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"8px"}}><div><label style={lS}>Ore dormite</label><input type="number" step="0.5" placeholder="7.5" value={form.hours} onChange={function(e){setForm(Object.assign({},form,{hours:e.target.value}));}} style={iS}/></div><div><label style={lS}>A letto</label><input type="time" value={form.bedtime} onChange={function(e){setForm(Object.assign({},form,{bedtime:e.target.value}));}} style={iS}/></div><div><label style={lS}>Sveglia</label><input type="time" value={form.waketime} onChange={function(e){setForm(Object.assign({},form,{waketime:e.target.value}));}} style={iS}/></div></div><div><label style={lS}>Qualita (1-5)</label><div style={{display:"flex",gap:"4px"}}>{[1,2,3,4,5].map(function(q){return(<button key={q} onClick={function(){setForm(Object.assign({},form,{quality:q}));}} style={{flex:1,padding:"8px",borderRadius:"10px",border:form.quality==q?"2px solid "+C.plum:"1px solid "+C.bdr,background:form.quality==q?C.plumP:C.white,fontSize:"12px",cursor:"pointer"}}>{qLabels[q].split(" ")[0]}</button>);})}</div></div><div style={{display:"flex",gap:"8px"}}><button onClick={save} style={{flex:1,padding:"10px",borderRadius:"10px",border:"none",background:C.plum,color:C.white,fontSize:"12px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}}>Salva</button><button onClick={function(){setEditing(false);}} style={{padding:"10px 16px",borderRadius:"10px",border:"1px solid "+C.bdr,background:C.white,color:C.txtM,fontSize:"12px",fontFamily:F.s,cursor:"pointer"}}>Annulla</button></div></div>)}</Cd>);
}


/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PROFILE EDITOR ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function ProfileEditor({profile,setProfile}){
  const[editing,setEditing]=useState(false);
  const[f,setF]=useState(Object.assign({},profile));
  var mc=calcMacros(profile);
  var allergies=["Lattosio","Glutine","Nichel","Uova","Pesce","Frutta secca","Soia"];
  function save(){var p=Object.assign({},f,{age:parseInt(f.age)||27,height:parseInt(f.height)||168,weight:parseFloat(f.weight)||77,bf:parseFloat(f.bf)||29,goalW:parseFloat(f.goalW)||68,goalBf:parseFloat(f.goalBf)||23,stepsG:parseInt(f.stepsG)||10000,waterG:parseInt(f.waterG)||8,workoutsG:parseInt(f.workoutsG)||4,ifH:parseInt(f.ifH)||14});setProfile(p);SV("profile",p);setEditing(false);}
  function toggleAllergy(a){var al=f.allergies||[];if(al.indexOf(a)>=0){setF(Object.assign({},f,{allergies:al.filter(function(x){return x!==a;})}));}else{setF(Object.assign({},f,{allergies:al.concat([a])}));}}
  if(!editing)return(
    <Cd accent={C.sage} style={{marginBottom:"16px",background:"linear-gradient(135deg,"+C.sageP+","+C.white+")"}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start"}}><div><h3 style={{fontFamily:F.p,fontSize:"16px",margin:"0 0 6px",color:C.sageD}}>Il Tuo Profilo</h3><div style={{display:"flex",gap:"6px",flexWrap:"wrap"}}>{profile.name&&<Pill color={C.berry}>{profile.name}</Pill>}<Pill color={C.sage}>{profile.age} anni</Pill><Pill color={C.sage}>{profile.height} cm</Pill><Pill color={C.sage}>{profile.weight} kg</Pill><Pill color={C.sage}>BF {profile.bf}%</Pill></div>{profile.allergies&&profile.allergies.length>0&&<div style={{display:"flex",gap:"4px",flexWrap:"wrap",marginTop:"6px"}}>{profile.allergies.map(function(a){return <Pill key={a} color={C.rose}>üö´ {a}</Pill>;})}</div>}</div><div style={{textAlign:"right"}}><div style={{fontFamily:F.s,fontSize:"22px",fontWeight:"700",color:C.sage}}>~{mc.target}</div><div style={{fontSize:"10px",fontFamily:F.s,color:C.txtL}}>kcal/giorno</div></div></div><div style={{display:"flex",gap:"10px",marginTop:"12px"}}>{[{l:"Proteine",v:mc.prot+"g",c:C.rose},{l:"Carboidrati",v:mc.carb+"g",c:C.amber},{l:"Grassi",v:mc.fat+"g",c:C.sage}].map(function(m,i){return(<div key={i} style={{flex:1,textAlign:"center",padding:"8px",borderRadius:"10px",background:C.white}}><div style={{fontSize:"14px",fontWeight:"700",color:m.c,fontFamily:F.s}}>{m.v}</div><div style={{fontSize:"9px",color:C.txtL,fontFamily:F.s}}>{m.l}</div></div>);})}</div><div style={{display:"flex",gap:"8px",marginTop:"10px"}}><div style={{flex:1,padding:"8px 10px",borderRadius:"8px",background:C.plumP}}><span style={{fontSize:"11px",fontFamily:F.s,color:C.plum,fontWeight:"500"}}>IF {profile.ifH}:{24-profile.ifH} | {profile.ifOpen}-{profile.ifClose}</span></div><button onClick={function(){setF(Object.assign({},profile));setEditing(true);}} style={{padding:"8px 14px",borderRadius:"8px",border:"none",background:C.sage,color:C.white,fontSize:"11px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}}>‚öôÔ∏è Modifica</button></div></Cd>
  );
  return(
    <Cd accent={C.sage} style={{marginBottom:"16px"}}><h3 style={{fontFamily:F.p,fontSize:"16px",margin:"0 0 14px",color:C.sageD}}>‚öôÔ∏è Modifica Profilo</h3><div style={{display:"grid",gap:"10px"}}>
      <div><label style={lS}>Nome</label><input value={f.name||""} onChange={function(e){setF(Object.assign({},f,{name:e.target.value}));}} placeholder="Il tuo nome" style={iS}/></div>
      <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"8px"}}><div><label style={lS}>Eta</label><input type="number" value={f.age} onChange={function(e){setF(Object.assign({},f,{age:e.target.value}));}} style={iS}/></div><div><label style={lS}>Altezza (cm)</label><input type="number" value={f.height} onChange={function(e){setF(Object.assign({},f,{height:e.target.value}));}} style={iS}/></div><div><label style={lS}>Peso (kg)</label><input type="number" step="0.1" value={f.weight} onChange={function(e){setF(Object.assign({},f,{weight:e.target.value}));}} style={iS}/></div></div>
      <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gap:"8px"}}><div><label style={lS}>BF%</label><input type="number" step="0.1" value={f.bf} onChange={function(e){setF(Object.assign({},f,{bf:e.target.value}));}} style={iS}/></div><div><label style={lS}>Obiettivo kg</label><input type="number" step="0.1" value={f.goalW} onChange={function(e){setF(Object.assign({},f,{goalW:e.target.value}));}} style={iS}/></div><div><label style={lS}>Obiettivo BF%</label><input type="number" step="0.1" value={f.goalBf} onChange={function(e){setF(Object.assign({},f,{goalBf:e.target.value}));}} style={iS}/></div><div><label style={lS}>IF ore</label><input type="number" value={f.ifH} onChange={function(e){setF(Object.assign({},f,{ifH:e.target.value}));}} style={iS}/></div></div>
      <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px"}}><div><label style={lS}>Finestra apre</label><input type="time" value={f.ifOpen} onChange={function(e){setF(Object.assign({},f,{ifOpen:e.target.value}));}} style={iS}/></div><div><label style={lS}>Finestra chiude</label><input type="time" value={f.ifClose} onChange={function(e){setF(Object.assign({},f,{ifClose:e.target.value}));}} style={iS}/></div></div>
      <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"8px"}}><div><label style={lS}>Passi/gg</label><input type="number" value={f.stepsG} onChange={function(e){setF(Object.assign({},f,{stepsG:e.target.value}));}} style={iS}/></div><div><label style={lS}>Bicchieri acqua</label><input type="number" value={f.waterG} onChange={function(e){setF(Object.assign({},f,{waterG:e.target.value}));}} style={iS}/></div><div><label style={lS}>Allenamenti/sett</label><input type="number" value={f.workoutsG} onChange={function(e){setF(Object.assign({},f,{workoutsG:e.target.value}));}} style={iS}/></div></div>
      <div><label style={lS}>üö´ Intolleranze / Allergie</label><div style={{display:"flex",gap:"4px",flexWrap:"wrap"}}>{allergies.map(function(a){var sel=(f.allergies||[]).indexOf(a)>=0;return(<button key={a} onClick={function(){toggleAllergy(a);}} style={{padding:"6px 12px",borderRadius:"10px",border:sel?"2px solid "+C.rose:"1px solid "+C.bdr,background:sel?C.roseP:C.white,color:sel?C.roseD:C.txtM,fontSize:"11px",fontFamily:F.s,fontWeight:sel?"600":"400",cursor:"pointer"}}>{sel?"üö´ ":""}{a}</button>);})}</div></div>
      <div style={{display:"flex",gap:"8px"}}><button onClick={save} style={{flex:1,padding:"12px",borderRadius:"12px",border:"none",background:C.sage,color:C.white,fontSize:"13px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}}>‚úÖ Salva Profilo</button><button onClick={function(){setEditing(false);}} style={{padding:"12px 18px",borderRadius:"12px",border:"1px solid "+C.bdr,background:C.white,color:C.txtM,fontSize:"13px",fontFamily:F.s,cursor:"pointer"}}>Annulla</button></div>
    </div></Cd>
  );
}


/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FASTING TIMER + HISTORY ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function FastingTimer({profile}){
  const[isOn,setIsOn]=useState(function(){return LD("fast_isOn",false);});
  const[start,setStart]=useState(function(){return LD("fast_start",null);});
  const[goal,setGoal]=useState(function(){return LD("fast_goal",profile.ifH||14);});
  const[el,setEl]=useState(function(){var s=LD("fast_start",null);return s?Date.now()-s:0;});
  const[history,setHistory]=useState(function(){return LD("fasts",[]);});
  var timerRef=useRef(null);
  var gMs=goal*3600000;
  var prog=start?Math.min((el/gMs)*100,100):0;
  var done=el>=gMs;
  var t=fmt(el);var tr=fmt(Math.max(gMs-el,0));
  useEffect(function(){SV("fast_isOn",isOn);SV("fast_start",start);SV("fast_goal",goal);},[isOn,start,goal]);
  useEffect(function(){if(isOn&&start){timerRef.current=setInterval(function(){var now=Date.now();var elapsed=now-start;setEl(elapsed);if(elapsed>=gMs&&elapsed-1000<gMs)sendNotif("üéâ Digiuno completato!","Hai completato "+goal+"h di digiuno. Bravissima!");var thirtyMin=gMs-30*60000;if(elapsed>=thirtyMin&&elapsed-1000<thirtyMin)sendNotif("‚è≥ 30 minuti al traguardo","Mancano solo 30 minuti per completare il digiuno!");},1000);}return function(){clearInterval(timerRef.current);};},[isOn,start]);
  var goFn=function(){var now=Date.now();setStart(now);setEl(0);setIsOn(true);};
  var stopFn=function(){setIsOn(false);clearInterval(timerRef.current);};
  var completeFn=function(){setIsOn(false);clearInterval(timerRef.current);var entry={date:todayK(),goal:goal,actual:Math.round(el/3600000*10)/10,completed:el>=gMs,startTime:new Date(start).toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"})};var h=[entry].concat(history).slice(0,50);setHistory(h);SV("fasts",h);setStart(null);setEl(0);};
  var resetFn=function(){setIsOn(false);setStart(null);setEl(0);clearInterval(timerRef.current);};
  var streak=0;for(var i=0;i<history.length;i++){if(history[i].completed)streak++;else break;}
  var bestStreak=0;var cur=0;history.forEach(function(h){if(h.completed){cur++;if(cur>bestStreak)bestStreak=cur;}else cur=0;});
  var totalDone=history.filter(function(h){return h.completed;}).length;
  var circ=2*Math.PI*88;var off=circ-(prog/100)*circ;
  var sL=start?new Date(start).toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"}):"--:--";
  var eL=start?new Date(start+gMs).toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"}):"--:--";
  return(<div style={{display:"grid",gap:"14px"}}>
    <Cd style={{textAlign:"center",padding:"24px 18px"}} accent={done?C.sage:C.plum}>
      <h3 style={{fontFamily:F.p,fontSize:"17px",margin:"0 0 4px",color:done?C.sage:C.txt}}>{done?"Digiuno completato! üéâ":isOn?"Digiuno in corso...":"Timer Digiuno"}</h3>
      <p style={{fontSize:"11px",fontFamily:F.s,color:C.txtL,margin:"0 0 14px"}}>{isOn?sL+" ‚Üí "+eL:"Finestra alimentare: "+profile.ifOpen+" - "+profile.ifClose}</p>
      {!isOn&&!start&&(<div style={{display:"flex",justifyContent:"center",gap:"6px",marginBottom:"16px"}}>{[12,14,16,18].map(function(h){return(<button key={h} onClick={function(){setGoal(h);}} style={{padding:"7px 16px",borderRadius:"10px",fontSize:"12px",fontFamily:F.s,fontWeight:"600",cursor:"pointer",border:goal===h?"none":"1px solid "+C.bdr,background:goal===h?C.plum:C.white,color:goal===h?C.white:C.txtM}}>{h+":"+(24-h)}{h===profile.ifH?" ‚òÖ":""}</button>);})}</div>)}
      <div style={{position:"relative",width:"190px",height:"190px",margin:"0 auto 14px"}}><svg width="190" height="190" style={{transform:"rotate(-90deg)"}}><circle cx="95" cy="95" r="88" fill="none" stroke={C.bdr} strokeWidth="7"/><circle cx="95" cy="95" r="88" fill="none" stroke={done?C.sage:C.plum} strokeWidth="7" strokeLinecap="round" strokeDasharray={circ} strokeDashoffset={off} style={{transition:"stroke-dashoffset 1s"}}/></svg><div style={{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"}}><div style={{fontFamily:F.s,fontSize:"30px",fontWeight:"700",color:C.txt}}>{t.h}<span style={{color:C.txtL,fontSize:"16px"}}>h </span>{t.m}<span style={{color:C.txtL,fontSize:"16px"}}>m</span></div><div style={{fontSize:"10px",fontFamily:F.s,color:C.txtL,marginTop:"3px"}}>{isOn?Math.round(prog)+"%":"Obiettivo: "+goal+"h"}</div></div></div>
      {isOn&&!done&&(<p style={{fontSize:"12px",fontFamily:F.s,color:C.plum,fontWeight:"600",margin:"0 0 12px"}}>Mancano {tr.h}h {tr.m}m {tr.s}s</p>)}
      {isOn&&(<div style={{display:"flex",gap:"4px",justifyContent:"center",marginBottom:"14px"}}>{[{l:"Digestione",h:4,c:C.amber},{l:"Chetosi",h:8,c:C.rose},{l:"Fat Burn",h:12,c:C.sage},{l:"Autofagia",h:16,c:C.plum}].map(function(ph,i){var starts=[0,4,8,12];var ac=el>=starts[i]*3600000&&el<ph.h*3600000;var dn=el>=ph.h*3600000;return(<div key={i} style={{flex:1,padding:"5px 3px",borderRadius:"8px",fontSize:"9px",fontFamily:F.s,fontWeight:"500",background:dn?ph.c+"20":ac?ph.c+"30":C.bdr+"60",color:dn||ac?ph.c:C.txtL,border:ac?"1.5px solid "+ph.c:"1.5px solid transparent"}}><div>{dn?"‚úì":ac?"‚óè":"-"}</div><div style={{marginTop:"1px"}}>{ph.l}</div></div>);})}</div>)}
      <div style={{display:"flex",gap:"8px",justifyContent:"center"}}>{!isOn&&!start&&<button onClick={goFn} style={{padding:"11px 28px",borderRadius:"12px",border:"none",background:"linear-gradient(135deg,"+C.plum+","+C.rose+")",color:C.white,fontSize:"14px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}}>Inizia Digiuno</button>}{isOn&&!done&&<button onClick={stopFn} style={{padding:"9px 20px",borderRadius:"12px",border:"1.5px solid "+C.rose,background:C.roseP,color:C.roseD,fontSize:"12px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}}>Pausa</button>}{!isOn&&start&&(<><button onClick={function(){setIsOn(true);}} style={{padding:"9px 20px",borderRadius:"12px",border:"none",background:C.plum,color:C.white,fontSize:"12px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}}>Riprendi</button><button onClick={function(){completeFn();}} style={{padding:"9px 20px",borderRadius:"12px",border:"1.5px solid "+C.bdr,background:C.white,color:C.txtM,fontSize:"12px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}}>Salva & Reset</button></>)}{isOn&&done&&<button onClick={completeFn} style={{padding:"9px 20px",borderRadius:"12px",border:"none",background:C.sage,color:C.white,fontSize:"12px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}}>‚úÖ Completa</button>}</div>
    </Cd>
    {/* STATS */}
    <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"8px"}}><Cd style={{textAlign:"center",padding:"12px"}}><div style={{fontFamily:F.s,fontSize:"22px",fontWeight:"700",color:C.sage}}>üî• {streak}</div><div style={{fontSize:"9px",fontFamily:F.s,color:C.txtL}}>Streak attuale</div></Cd><Cd style={{textAlign:"center",padding:"12px"}}><div style={{fontFamily:F.s,fontSize:"22px",fontWeight:"700",color:C.amber}}>üèÜ {bestStreak}</div><div style={{fontSize:"9px",fontFamily:F.s,color:C.txtL}}>Record streak</div></Cd><Cd style={{textAlign:"center",padding:"12px"}}><div style={{fontFamily:F.s,fontSize:"22px",fontWeight:"700",color:C.plum}}>{totalDone}</div><div style={{fontSize:"9px",fontFamily:F.s,color:C.txtL}}>Totali completati</div></Cd></div>
    {/* HISTORY */}
    {history.length>0&&<Cd><h4 style={{fontFamily:F.p,fontSize:"14px",margin:"0 0 10px",color:C.txt}}>Storico Digiuni</h4><div style={{display:"grid",gap:"6px"}}>{history.slice(0,10).map(function(h,i){return(<div key={i} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 10px",borderRadius:"8px",background:h.completed?C.sageP:C.roseP}}><div><span style={{fontFamily:F.s,fontSize:"12px",fontWeight:"600",color:C.txt}}>{fmtD(h.date)}</span><span style={{fontFamily:F.s,fontSize:"11px",color:C.txtM,marginLeft:"8px"}}>{h.startTime}</span></div><div style={{display:"flex",gap:"6px",alignItems:"center"}}><span style={{fontSize:"11px",fontFamily:F.s,color:C.txtM}}>{h.actual}h / {h.goal}h</span><span style={{fontSize:"14px"}}>{h.completed?"‚úÖ":"‚ùå"}</span></div></div>);})}</div></Cd>}
  </div>);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DAILY QUOTE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function DailyQuote(){
  var dq=getDailyQuote();
  var tagColors={mindset:C.plum,food:C.sage,tip:C.amber,gym:C.rose};
  var tagLabels={mindset:"Mindset",food:"Nutrizione",tip:"Consiglio",gym:"Fitness"};
  var tc=tagColors[dq.t]||C.sage;
  return(<Cd style={{marginBottom:"16px",background:"linear-gradient(135deg,"+tc+"10,"+C.white+")",borderLeft:"4px solid "+tc}}><div style={{display:"flex",gap:"10px",alignItems:"flex-start"}}><span style={{fontSize:"22px",flexShrink:0}}>üå∏</span><div style={{flex:1}}><p style={{margin:"0 0 6px",fontFamily:F.p,fontSize:"13px",fontStyle:"italic",color:C.txt,lineHeight:1.5}}>"{dq.q}"</p><Pill color={tc}>{tagLabels[dq.t]}</Pill></div></div></Cd>);
}


/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ALIMENTAZIONE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function Alimentazione({profile,setProfile}){
  const[sub,setSub]=useState("menu");
  const[meal,setMeal]=useState("colazione");
  const[selDay,setSelDay]=useState(function(){var d=new Date().getDay();return d===0?6:d-1;});
  const[filter,setFilter]=useState("tutti");
  const[favs,setFavs]=useState(function(){return LD("favRecipes",[]);});
  const[showList,setShowList]=useState(false);
  const[listChecks,setListChecks]=useState({});
  const[lockedDays,setLockedDays]=useState({});
  const[shuffled,setShuffled]=useState(null);
  var mc=calcMacros(profile);
  var allergyMap={"Lattosio":["latte","yogurt","fiocchi di latte","burro","panna"],"Glutine":["pane","farro","orzo","avena","spaghetti","wasa","crostini","crusca"],"Nichel":["cacao","cioccolato","pomodor","lenticch","spinac","avena","ceci","fagioli"],"Uova":["uov","frittata","omelette","albumi","pancake"],"Pesce":["salmone","merluzzo","tonno","orata","sgombro","seppie","pesce"],"Frutta secca":["mandorl","noci","pistacch","arachid","pinoli","noce"],"Soia":["soia","edamame","tofu"]};
  var allergySubs={"Lattosio":"yogurt vegetale / latte cocco / tofu","Glutine":"riso integrale / quinoa / grano saraceno / patate dolci","Nichel":"zucchine / carote / mele / riso / pollo","Uova":"tofu strapazzato / semi chia+acqua","Pesce":"pollo / tacchino / legumi / tofu","Frutta secca":"semi di zucca / semi di girasole / cocco","Soia":"alternative senza soia"};
  function checkAllergens(text){if(!profile.allergies||!profile.allergies.length)return[];var found=[];var lc=(text||"").toLowerCase();profile.allergies.forEach(function(a){var keys=allergyMap[a]||[];keys.forEach(function(k){if(lc.includes(k)&&found.indexOf(a)<0)found.push(a);});});return found;}
  var filtered=filter==="tutti"?RECIPES:filter==="preferiti"?RECIPES.filter(function(r){return favs.indexOf(r.n)>=0;}):RECIPES.filter(function(r){return r.cat.toLowerCase().includes(filter);});
  function toggleFav(name){var n;if(favs.indexOf(name)>=0)n=favs.filter(function(x){return x!==name;});else n=favs.concat([name]);setFavs(n);SV("favRecipes",n);}
  function shuffleMenu(){var cols=IDEAS.colazione.items.slice();var pras=IDEAS.pranzo.items.slice();var cens=IDEAS.cena.items.slice();function sh(a){for(var i=a.length-1;i>0;i--){var j=Math.floor(Math.random()*(i+1));var t=a[i];a[i]=a[j];a[j]=t;}return a;}sh(cols);sh(pras);sh(cens);var r=[];for(var i=0;i<7;i++){if(lockedDays[i]){r.push(shuffled?shuffled[i]:MENU[i]);}else{r.push({day:MENU[i].day,col:{t:cols[i%cols.length].n,desc:cols[i%cols.length].d,kcal:parseInt(cols[i%cols.length].kcal)||520,p:22,c:42,f:24},pra:{t:pras[i%pras.length].n,desc:pras[i%pras.length].d,kcal:parseInt(pras[i%pras.length].kcal)||550,p:38,c:50,f:18},cen:{t:cens[i%cens.length].n,desc:cens[i%cens.length].d,kcal:parseInt(cens[i%cens.length].kcal)||350,p:30,c:16,f:14},sn:MENU[i].sn});}}setShuffled(r);}
  var curMenu=shuffled||MENU;
  var shopList=genShoppingList([0,1,2,3,4,5,6]);
  return(<div>
    <SecH title="Alimentazione PCOS" sub={"~"+mc.target+" kcal/giorno | IF "+profile.ifH+":"+(24-profile.ifH)+" | Dosi in grammi"}/>
    <ProfileEditor profile={profile} setProfile={setProfile}/>
    <CycleCorrelationBanner/>
    <MealChecklist/>
    <WaterTracker/>
    <SubT tabs={[{k:"menu",l:"Menu IF",i:"üìÖ"},{k:"idee",l:"Idee Pasti",i:"üí°"},{k:"ricette",l:"Ricettario",i:"üë©‚Äçüç≥"},{k:"guida",l:"Cibi & Dosi",i:"üìã"},{k:"spesa",l:"Spesa",i:"üõí"},{k:"regole",l:"Regole"}]} active={sub} onSel={setSub}/>
    {sub==="menu"&&(<div>
      <Info bg={C.plumP} bdr={C.plumL} color={C.plum}><strong>IF {profile.ifH}:{24-profile.ifH} | Finestra {profile.ifOpen}-{profile.ifClose}</strong>: colazione ore {profile.ifOpen} | cena entro {profile.ifClose}</Info>
      <div style={{display:"flex",gap:"6px",margin:"12px 0"}}><button onClick={shuffleMenu} style={{flex:1,padding:"10px",borderRadius:"10px",border:"none",background:"linear-gradient(135deg,"+C.amber+","+C.rose+")",color:C.white,fontSize:"12px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}}>üîÑ Genera Menu Casuale</button>{shuffled&&<button onClick={function(){setShuffled(null);setLockedDays({});}} style={{padding:"10px 14px",borderRadius:"10px",border:"1px solid "+C.bdr,background:C.white,color:C.txtM,fontSize:"12px",fontFamily:F.s,cursor:"pointer"}}>‚Ü©Ô∏è Originale</button>}</div>
      <div style={{display:"flex",gap:"4px",margin:"10px 0"}}>{curMenu.map(function(d,i){return(<button key={i} onClick={function(){setSelDay(i);}} style={{flex:1,padding:"7px 2px",borderRadius:"10px",border:selDay===i?"none":"1px solid "+C.bdr,background:selDay===i?C.sage:C.white,color:selDay===i?C.white:C.txtM,fontWeight:"600",fontSize:"11px",fontFamily:F.s,cursor:"pointer",position:"relative"}}>{d.day.slice(0,3)}{shuffled&&lockedDays[i]&&<span style={{position:"absolute",top:"-6px",right:"-2px",fontSize:"10px"}}>üîí</span>}</button>);})}</div>
      {shuffled&&<div style={{display:"flex",justifyContent:"flex-end",marginBottom:"8px"}}><button onClick={function(){var u=Object.assign({},lockedDays);if(u[selDay])delete u[selDay];else u[selDay]=true;setLockedDays(u);}} style={{padding:"4px 10px",borderRadius:"8px",border:"1px solid "+C.bdr,background:lockedDays[selDay]?C.sageP:C.white,color:lockedDays[selDay]?C.sageD:C.txtM,fontSize:"10px",fontFamily:F.s,cursor:"pointer"}}>{lockedDays[selDay]?"üîí Bloccato":"üîì Blocca questo giorno"}</button></div>}
      {[{k:"col",l:"Colazione | ore "+profile.ifOpen,c:C.amber,port:"~520 kcal"},{k:"pra",l:"Pranzo | ore 14:00",c:C.sage,port:"~550 kcal"},{k:"cen",l:"Cena | ore 19:30",c:C.rose,port:"~350 kcal"}].map(function(m,i){var d=curMenu[selDay][m.k];var allergens=checkAllergens(d.desc);return(<Cd key={i} accent={m.c} style={{marginBottom:"10px"}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"6px"}}><h4 style={{fontFamily:F.s,fontSize:"13px",fontWeight:"600",color:m.c,margin:0}}>{m.l}</h4><span style={{fontSize:"10px",fontFamily:F.s,color:C.txtL}}>{m.port}</span></div><h5 style={{fontFamily:F.s,fontSize:"14px",fontWeight:"600",color:C.txt,margin:"0 0 4px"}}>{d.t}</h5><p style={{fontSize:"12px",fontFamily:F.s,color:C.txtM,margin:"0 0 4px",lineHeight:1.6}}>{d.desc}</p>{allergens.length>0&&(<div style={{padding:"6px 8px",borderRadius:"8px",background:C.roseP,border:"1px solid "+C.roseL,marginTop:"4px"}}><div style={{display:"flex",gap:"4px",flexWrap:"wrap",marginBottom:"3px"}}>{allergens.map(function(a){return <Pill key={a} color={C.rose}>‚ö†Ô∏è {a}</Pill>;})}</div><div style={{fontSize:"9px",fontFamily:F.s,color:C.roseD}}>{allergens.map(function(a){return "Sostituisci con: "+allergySubs[a];}).join(" | ")}</div></div>)}{d.p&&<MacroBar p={d.p} c={d.c} f={d.f} kcal={d.kcal}/>}</Cd>);})}
      <Cd style={{padding:"14px",opacity:0.7}}><div style={{display:"flex",justifyContent:"space-between"}}><span style={{fontSize:"12px",fontFamily:F.s,color:C.txtM}}>Snack (opz.): {curMenu[selDay].sn.t}</span><span style={{fontSize:"11px",fontFamily:F.s,color:C.txtL}}>{curMenu[selDay].sn.kcal} kcal</span></div></Cd>
      <Cd style={{marginTop:"10px",background:C.sageP,border:"1px solid "+C.sageL}}><div style={{display:"flex",justifyContent:"space-between"}}><span style={{fontFamily:F.s,fontSize:"13px",fontWeight:"600",color:C.sageD}}>Totale giornata</span><span style={{fontFamily:F.s,fontSize:"13px",fontWeight:"700",color:C.sageD}}>~{curMenu[selDay].col.kcal+curMenu[selDay].pra.kcal+curMenu[selDay].cen.kcal} kcal</span></div>{curMenu[selDay].col.p&&<MacroBar p={curMenu[selDay].col.p+curMenu[selDay].pra.p+curMenu[selDay].cen.p} c={curMenu[selDay].col.c+curMenu[selDay].pra.c+curMenu[selDay].cen.c} f={curMenu[selDay].col.f+curMenu[selDay].pra.f+curMenu[selDay].cen.f} kcal={curMenu[selDay].col.kcal+curMenu[selDay].pra.kcal+curMenu[selDay].cen.kcal}/>}</Cd>
    </div>)}
    {sub==="idee"&&(<div><div style={{display:"flex",gap:"5px",marginBottom:"14px"}}>{["colazione","pranzo","cena"].map(function(k){var labels={colazione:"Col ~520",pranzo:"Pra ~550",cena:"Cen ~350"};return<button key={k} onClick={function(){setMeal(k);}} style={{flex:1,padding:"9px 4px",borderRadius:"12px",border:meal===k?"none":"1px solid "+C.bdr,background:meal===k?C.rose:C.white,color:meal===k?C.white:C.txtM,fontWeight:meal===k?"600":"400",fontSize:"12px",fontFamily:F.s,cursor:"pointer"}}>{labels[k]}</button>;})}</div><Info bg={C.roseP} bdr={C.roseL} color={C.roseD}>{IDEAS[meal].intro}</Info><div style={{display:"grid",gap:"8px",marginTop:"10px"}}>{IDEAS[meal].items.map(function(it,i){return(<Cd key={i} style={{padding:"14px"}}><div style={{display:"flex",gap:"8px",alignItems:"flex-start"}}><span style={{fontSize:"20px",flexShrink:0}}>{it.i}</span><div style={{flex:1}}><div style={{display:"flex",justifyContent:"space-between",marginBottom:"2px"}}><h5 style={{margin:0,fontFamily:F.s,fontSize:"13px",fontWeight:"600",color:C.txt}}>{it.n}</h5><Pill color={C.rose}>{it.kcal}</Pill></div><p style={{margin:0,fontSize:"11px",fontFamily:F.s,color:C.txtM,lineHeight:1.5}}>{it.d}</p></div></div></Cd>);})}</div></div>)}
    {sub==="ricette"&&(<div><Info bg={C.amberL} bdr={C.amber} color={C.txt}>Ricette da <strong>lotusflowerpcos.com</strong>. Tocca ‚ù§Ô∏è per salvare nei preferiti.</Info><div style={{display:"flex",gap:"4px",flexWrap:"wrap",margin:"10px 0"}}>{["tutti","primo","secondo","contorno","preferiti"].map(function(flt){return<button key={flt} onClick={function(){setFilter(flt);}} style={{padding:"4px 10px",borderRadius:"8px",border:filter===flt?"none":"1px solid "+C.bdr,background:filter===flt?flt==="preferiti"?C.roseP:C.sage:C.white,color:filter===flt?flt==="preferiti"?C.roseD:C.white:C.txtM,fontSize:"10px",fontFamily:F.s,fontWeight:"500",cursor:"pointer",textTransform:"capitalize"}}>{flt==="preferiti"?"‚ù§Ô∏è Preferiti":flt}</button>;})}</div><div style={{display:"grid",gap:"8px"}}>{filtered.length===0&&<p style={{fontSize:"12px",fontFamily:F.s,color:C.txtL,textAlign:"center",padding:"20px"}}>Nessuna ricetta nei preferiti. Tocca ‚ù§Ô∏è per aggiungerne!</p>}{filtered.map(function(r,i){var isFav=favs.indexOf(r.n)>=0;return(<Cd key={i} style={{padding:"14px"}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start"}}><a href={r.url} target="_blank" rel="noopener noreferrer" style={{textDecoration:"none",flex:1}}><h5 style={{margin:"0 0 3px",fontFamily:F.s,fontSize:"12px",fontWeight:"600",color:C.txt}}>{r.n}</h5><p style={{margin:"0 0 5px",fontSize:"10px",fontFamily:F.s,color:C.txtL}}>{r.ing}</p><div style={{display:"flex",gap:"4px"}}><Pill color={C.rose}>{r.kcal}</Pill><Pill color={C.sage}>{r.tag}</Pill></div></a><button onClick={function(){toggleFav(r.n);}} style={{background:"none",border:"none",fontSize:"18px",cursor:"pointer",padding:"4px",flexShrink:0}}>{isFav?"‚ù§Ô∏è":"ü§ç"}</button></div></Cd>);})}</div></div>)}
    {sub==="guida"&&(<div style={{display:"grid",gap:"10px"}}><Info bg={C.amberL} bdr={C.amber} color={C.txt}>Dosi calibrate su <strong>~{mc.target} kcal/giorno</strong>. Grammature a CRUDO.</Info>{FOODS.map(function(f,i){var accents=[C.sage,C.rose,C.amber,C.sage,C.rose,C.amber];return(<Cd key={i} accent={accents[i%6]}><h3 style={{fontFamily:F.p,fontSize:"15px",margin:"0 0 6px",color:C.txt}}>{f.ico} {f.cat}</h3><div style={{display:"flex",flexWrap:"wrap",gap:"4px",marginBottom:"8px"}}>{f.items.map(function(it,j){return<span key={j} style={{padding:"4px 9px",borderRadius:"8px",background:C.bgW,fontSize:"11px",fontFamily:F.s,color:C.txt}}>{it}</span>;})}</div><p style={{fontSize:"10px",fontFamily:F.s,color:C.txtL,margin:0,fontStyle:"italic"}}>{f.note}</p></Cd>);})}
    </div>)}
    {sub==="spesa"&&(<div style={{display:"grid",gap:"10px"}}><Info bg={C.sageP} bdr={C.sageL} color={C.sageD}>Lista della spesa generata automaticamente dal menu settimanale. Spunta quello che hai gia!</Info>{Object.keys(shopList).map(function(cat){var items=shopList[cat];if(items.length===0)return null;var icons={frutta:"üçé",verdura:"ü•¨",proteine:"ü•©",carboidrati:"üåæ",dispensa:"üè™",latticini:"üßÄ"};return(<Cd key={cat}><h4 style={{fontFamily:F.s,fontSize:"13px",fontWeight:"600",color:C.txt,margin:"0 0 8px",textTransform:"capitalize"}}>{icons[cat]||"üì¶"} {cat}</h4><div style={{display:"grid",gap:"4px"}}>{items.map(function(item,i){var ck=listChecks[cat+"_"+i];return(<button key={i} onClick={function(){var u=Object.assign({},listChecks);u[cat+"_"+i]=!ck;setListChecks(u);}} style={{display:"flex",gap:"8px",alignItems:"center",padding:"8px 10px",borderRadius:"8px",border:"none",background:ck?C.sageP:C.bg,cursor:"pointer",width:"100%",textAlign:"left"}}><span style={{fontSize:"14px"}}>{ck?"‚úÖ":"‚¨ú"}</span><span style={{fontFamily:F.s,fontSize:"12px",color:ck?C.txtL:C.txt,textDecoration:ck?"line-through":"none",textTransform:"capitalize"}}>{item}</span></button>);})}</div></Cd>);})}</div>)}
    {sub==="regole"&&(<div style={{display:"grid",gap:"8px"}}>{[{i:"1",t:"Verdura PRIMA (200-250g)",d:"Riduce il picco glicemico fino al 48%."},{i:"2",t:"Proteine 120-150g a pasto",d:"Target giornaliero ~"+mc.prot+"g."},{i:"3",t:"Carboidrati 50-60g crudi, per ultimi",d:"Sempre integrali, mai da soli."},{i:"4",t:"Colazione ore "+profile.ifOpen+" = pasto principale",d:"~520 kcal. Riduce insulina del 53%."},{i:"5",t:"Cena leggera entro le "+profile.ifClose,d:"~350 kcal. Proteine + verdure."},{i:"6",t:"IF "+profile.ifH+":"+(24-profile.ifH)+": finestra "+profile.ifOpen+"-"+profile.ifClose,d:"Te verde e camomilla ok a digiuno."},{i:"7",t:"Grassi buoni 10-15ml olio EVO/pasto",d:"Target ~"+mc.fat+"g/giorno."},{i:"8",t:"No zuccheri nascosti",d:"Sciroppo glucosio e maltodestrine = insulino-resistenza."}].map(function(r,i){return(<Cd key={i}><div style={{display:"flex",gap:"10px"}}><span style={{width:"24px",height:"24px",borderRadius:"50%",background:C.sage,color:C.white,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",fontWeight:"700",fontFamily:F.s,flexShrink:0}}>{r.i}</span><div><h4 style={{margin:"0 0 2px",fontFamily:F.s,fontSize:"13px",fontWeight:"600",color:C.txt}}>{r.t}</h4><p style={{margin:0,fontSize:"11px",fontFamily:F.s,color:C.txtM}}>{r.d}</p></div></div></Cd>);})}
    </div>)}
  </div>);
}


/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ALLENAMENTO ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function Allenamento(){
  const[sub,setSub]=useState("sched");
  const[logs,setLogs]=useState(function(){return LD("gymLogs",{});});
  const[showLog,setShowLog]=useState(null);
  const[logForm,setLogForm]=useState({weight:"",reps:""});
  function saveLog(exName){if(!logForm.weight&&!logForm.reps)return;var k=exName.replace(/[^a-zA-Z]/g,"");var entries=logs[k]||[];var entry={date:todayK(),weight:parseFloat(logForm.weight)||0,reps:parseInt(logForm.reps)||0};entries=[entry].concat(entries).slice(0,20);var u=Object.assign({},logs);u[k]=entries;setLogs(u);SV("gymLogs",u);setShowLog(null);setLogForm({weight:"",reps:""});}
  function getLastLog(exName){var k=exName.replace(/[^a-zA-Z]/g,"");var entries=logs[k]||[];return entries.length>0?entries[0]:null;}
  return(<div>
    <SecH title="Allenamento" sub="Sala pesi per perdere grasso e aumentare massa muscolare"/>
    <CycleGymBanner/>
    <SubT tabs={[{k:"sched",l:"Scheda",i:"üìÖ"},{k:"upper",l:"Upper",i:"üí™"},{k:"lower",l:"Lower",i:"ü¶µ"},{k:"core",l:"Core",i:"üéØ"},{k:"progress",l:"Progressi",i:"üìà"}]} active={sub} onSel={setSub}/>
    {sub==="sched"&&(<div><Info bg={C.sageP} bdr={C.sageL} color={C.sageD}>Con deficit calorico, il resistance training preserva massa muscolare e accelera la perdita di grasso addominale.</Info><div style={{display:"grid",gap:"7px",marginTop:"10px"}}>{GYM.sched.map(function(d,i){var iColor=d.i==="Bassa"?C.sage:d.i==="Leggera"?C.amber:C.rose;return(<Cd key={i} style={{padding:"13px"}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}><div><h4 style={{margin:"0 0 2px",fontFamily:F.s,fontSize:"12px",fontWeight:"600",color:C.txt}}>{d.d}</h4><p style={{margin:0,fontSize:"11px",fontFamily:F.s,color:C.txtM}}>{d.w}</p></div><Pill color={iColor}>{d.i}</Pill></div></Cd>);})}</div></div>)}
    {(sub==="upper"||sub==="lower"||sub==="core")&&(<div><Info bg={C.roseP} bdr={C.roseL} color={C.roseD}>{GYM[sub].ico} {GYM[sub].why}</Info><div style={{display:"grid",gap:"7px",marginTop:"10px"}}>{GYM[sub].ex.map(function(e,i){var lastLog=getLastLog(e.n);return(<Cd key={i} style={{padding:"13px"}}><div style={{display:"flex",justifyContent:"space-between",gap:"8px"}}><div style={{flex:1}}><div style={{display:"flex",alignItems:"center",gap:"5px",marginBottom:"2px"}}><span style={{fontFamily:F.s,fontSize:"9px",color:C.white,background:C.sage,borderRadius:"6px",padding:"2px 6px",fontWeight:"600"}}>{i+1}</span><h5 style={{margin:0,fontFamily:F.s,fontSize:"12px",fontWeight:"600",color:C.txt}}>{e.n}</h5></div><p style={{margin:0,fontSize:"10px",fontFamily:F.s,color:C.txtL,fontStyle:"italic"}}>{e.nt}</p>{lastLog&&<div style={{marginTop:"4px"}}><Pill color={C.amber}>Ultimo: {lastLog.weight}kg x{lastLog.reps} ({fmtD(lastLog.date)})</Pill></div>}</div><div style={{textAlign:"right",flexShrink:0}}><div style={{fontFamily:F.s,fontSize:"12px",fontWeight:"700",color:C.sage}}>{e.s}</div><div style={{fontFamily:F.s,fontSize:"9px",color:C.txtL}}>Rest {e.r}</div><div style={{display:"flex",gap:"4px",marginTop:"6px"}}><a href={"https://www.youtube.com/results?search_query="+e.vid} target="_blank" rel="noopener noreferrer" style={{padding:"3px 7px",borderRadius:"6px",background:C.roseP,fontSize:"9px",fontFamily:F.s,color:C.roseD,textDecoration:"none",fontWeight:"500"}}>üé¨ Video</a><button onClick={function(){setShowLog(showLog===e.n?null:e.n);setLogForm({weight:"",reps:""});}} style={{padding:"3px 7px",borderRadius:"6px",border:"none",background:C.sageP,fontSize:"9px",fontFamily:F.s,color:C.sageD,cursor:"pointer",fontWeight:"500"}}>üìä Log</button></div></div></div>{showLog===e.n&&(<div style={{marginTop:"10px",padding:"10px",borderRadius:"10px",background:C.bg,display:"flex",gap:"6px",alignItems:"flex-end"}}><div style={{flex:1}}><label style={lS}>Peso (kg)</label><input type="number" step="0.5" placeholder="20" value={logForm.weight} onChange={function(ev){setLogForm(Object.assign({},logForm,{weight:ev.target.value}));}} style={Object.assign({},iS,{padding:"8px"})}/></div><div style={{flex:1}}><label style={lS}>Reps</label><input type="number" placeholder="12" value={logForm.reps} onChange={function(ev){setLogForm(Object.assign({},logForm,{reps:ev.target.value}));}} style={Object.assign({},iS,{padding:"8px"})}/></div><button onClick={function(){saveLog(e.n);}} style={{padding:"8px 12px",borderRadius:"8px",border:"none",background:C.sage,color:C.white,fontSize:"11px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}}>‚úì</button></div>)}</Cd>);})}</div></div>)}
    {sub==="progress"&&(<div style={{display:"grid",gap:"10px"}}><Info bg={C.amberP} bdr={C.amberL} color={C.amber}>üìà Progressive overload: quando riesci a fare tutte le reps con buona forma, aumenta il peso del 5-10%.</Info>{Object.keys(logs).filter(function(k){return logs[k].length>1;}).map(function(k){var entries=logs[k].slice().reverse();var exName=entries[0]?k:"";var first=entries[0];var last=entries[entries.length-1];var diff=last.weight-first.weight;return(<Cd key={k}><h4 style={{fontFamily:F.s,fontSize:"13px",fontWeight:"600",color:C.txt,margin:"0 0 8px",textTransform:"capitalize"}}>{k}</h4><div style={{display:"flex",gap:"3px",alignItems:"flex-end",height:"60px",marginBottom:"6px"}}>{entries.slice(-8).map(function(e,i){var mx=Math.max.apply(null,entries.map(function(x){return x.weight||1;}));var h=((e.weight||1)/mx)*100;return(<div key={i} style={{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:"2px"}}><span style={{fontSize:"7px",fontFamily:F.s,color:C.txtL}}>{e.weight}</span><div style={{width:"100%",maxWidth:"20px",height:h+"%",borderRadius:"3px",background:i===entries.length-1?C.sage:C.sageL}}/></div>);})}</div><div style={{display:"flex",gap:"10px"}}><span style={{fontSize:"10px",fontFamily:F.s,color:C.txtL}}>Prima: {first.weight}kg x{first.reps}</span><span style={{fontSize:"10px",fontFamily:F.s,color:C.txtL}}>‚Üí</span><span style={{fontSize:"10px",fontFamily:F.s,color:diff>0?C.sage:C.txt,fontWeight:"600"}}>Ora: {last.weight}kg x{last.reps} {diff>0?"(+"+diff+"kg) üí™":""}</span></div></Cd>);})}{Object.keys(logs).filter(function(k){return logs[k].length>1;}).length===0&&<Cd style={{textAlign:"center",padding:"30px"}}><p style={{fontSize:"13px",fontFamily:F.s,color:C.txtL}}>Registra i carichi negli esercizi per vedere i tuoi progressi qui!</p></Cd>}</div>)}
  </div>);
}


/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DIGIUNO ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function Digiuno({profile}){
  const[sub,setSub]=useState("timer");
  return(<div>
    <SecH title="Digiuno Intermittente" sub={"IF "+profile.ifH+":"+(24-profile.ifH)+" | Finestra "+profile.ifOpen+"-"+profile.ifClose}/>
    <SubT tabs={[{k:"timer",l:"Timer",i:"‚è±Ô∏è"},{k:"info",l:"Info",i:"üî¨"},{k:"rules",l:"Regole",i:"üìè"}]} active={sub} onSel={setSub}/>
    {sub==="timer"&&<FastingTimer profile={profile}/>}
    {sub==="info"&&(<div style={{display:"grid",gap:"12px"}}><Cd accent={C.sage}><h3 style={{fontFamily:F.p,fontSize:"15px",margin:"0 0 8px",color:C.sage}}>Benefici</h3>{["Migliora sensibilita insulinica","Riduce infiammazione cronica","Favorisce autofagia cellulare","Con deficit ~500 kcal: ~0.5 kg/settimana"].map(function(b,i){return<div key={i} style={{display:"flex",gap:"6px",alignItems:"center",marginBottom:"5px"}}><span style={{width:"4px",height:"4px",borderRadius:"50%",background:C.sage,flexShrink:0}}/><span style={{fontSize:"12px",fontFamily:F.s,color:C.txt}}>{b}</span></div>;})}</Cd><Cd accent={C.rose}><h3 style={{fontFamily:F.p,fontSize:"15px",margin:"0 0 8px",color:C.rose}}>Attenzione nella PCOS</h3>{["NON saltare la colazione: riduce insulina del 53%","Puo innescare cicli restrizione/abbuffata","Colazione proteica piu importante del digiuno lungo"].map(function(w,i){return<div key={i} style={{display:"flex",gap:"6px",alignItems:"flex-start",marginBottom:"6px"}}><span style={{fontSize:"12px",flexShrink:0}}>‚ö†Ô∏è</span><span style={{fontSize:"11px",fontFamily:F.s,color:C.txt,lineHeight:1.5}}>{w}</span></div>;})}</Cd></div>)}
    {sub==="rules"&&(<div style={{display:"grid",gap:"10px"}}>{[{t:"Colazione abbondante ore "+profile.ifOpen+" (~520 kcal)",d:"Pasto principale con proteine."},{t:"Pranzo ore 14:00 (~550 kcal)",d:"Equilibrato. Ordine: verdura, proteine, carbo."},{t:"Cena leggera entro "+profile.ifClose+" (~350 kcal)",d:"Proteine + verdure, pochissimi carboidrati."},{t:"Digiuno "+profile.ifClose+" ‚Üí "+profile.ifOpen+" ("+profile.ifH+"h)",d:"Te verde, camomilla, acqua. Zero calorie."},{t:"Se hai fame a digiuno",d:"Un te caldo senza zucchero sazia. Il te verde riduce insulina a digiuno."}].map(function(r,i){return<Cd key={i}><h4 style={{margin:"0 0 2px",fontFamily:F.s,fontSize:"13px",fontWeight:"600",color:C.txt}}>{r.t}</h4><p style={{margin:0,fontSize:"11px",fontFamily:F.s,color:C.txtM,lineHeight:1.5}}>{r.d}</p></Cd>;})}<Cd style={{background:C.plumP,border:"1px solid "+C.plumL}}><h4 style={{margin:"0 0 6px",fontFamily:F.s,fontSize:"12px",fontWeight:"600",color:C.plum}}>La tua giornata tipo</h4>{[{t:profile.ifOpen,e:"Colazione abbondante (~520 kcal)",c:C.amber},{t:"14:00",e:"Pranzo equilibrato (~550 kcal)",c:C.sage},{t:"16:30",e:"Snack opzionale (~80 kcal)",c:C.txtM},{t:"19:30",e:"Cena leggera (~350 kcal)",c:C.rose},{t:profile.ifClose+"‚Üí"+profile.ifOpen,e:"DIGIUNO (te, acqua, camomilla)",c:C.plum}].map(function(x,i){return<div key={i} style={{display:"flex",gap:"8px",alignItems:"center",padding:"3px 0"}}><span style={{fontFamily:F.s,fontSize:"10px",fontWeight:"700",color:x.c,minWidth:"85px"}}>{x.t}</span><span style={{fontSize:"11px",fontFamily:F.s,color:C.txt}}>{x.e}</span></div>;})}</Cd></div>)}
  </div>);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CICLO MESTRUALE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function CicloMestruale(){
  const[sub,setSub]=useState("tracker");
  const[lastPeriod,setLastPeriod]=useState(function(){return LD("lastPeriod","");});
  const[cycleLen,setCycleLen]=useState(function(){return LD("cycleLen",35);});
  const[showResult,setShowResult]=useState(false);
  var today=new Date();var lpDate=lastPeriod?new Date(lastPeriod):null;
  var dayOfCycle=lpDate?Math.floor((today-lpDate)/86400000)+1:null;
  var nextPeriod=lpDate?new Date(lpDate.getTime()+cycleLen*86400000):null;
  var daysToNext=nextPeriod?Math.max(0,Math.floor((nextPeriod-today)/86400000)):null;
  var currentPhase=null;
  if(dayOfCycle){if(dayOfCycle<=5)currentPhase=0;else if(dayOfCycle<=Math.floor(cycleLen*0.46))currentPhase=1;else if(dayOfCycle<=Math.floor(cycleLen*0.57))currentPhase=2;else currentPhase=3;}
  function formatDate(d){if(!d)return"--";return d.toLocaleDateString("it-IT",{day:"numeric",month:"short"});}
  useEffect(function(){if(lastPeriod)SV("lastPeriod",lastPeriod);SV("cycleLen",cycleLen);},[lastPeriod,cycleLen]);
  return(<div>
    <SecH title="Ciclo Mestruale" sub="Tracker, fasi e consigli PCOS-specifici"/>
    <SubT tabs={[{k:"tracker",l:"Tracker",i:"üìÖ"},{k:"fasi",l:"Fasi",i:"üåô"},{k:"pcos",l:"PCOS & Ciclo",i:"ü©∫"}]} active={sub} onSel={setSub}/>
    {sub==="tracker"&&(<div style={{display:"grid",gap:"12px"}}>
      <Cd accent={C.berry}><h3 style={{fontFamily:F.p,fontSize:"15px",margin:"0 0 12px",color:C.berry}}>Inserisci i tuoi dati</h3><div style={{marginBottom:"10px"}}><label style={lS}>Primo giorno dell'ultimo ciclo</label><input type="date" value={lastPeriod} onChange={function(e){setLastPeriod(e.target.value);setShowResult(false);}} style={iS}/></div><div style={{marginBottom:"12px"}}><label style={lS}>Durata media del ciclo (giorni)</label><div style={{display:"flex",gap:"4px"}}>{[28,30,32,35,40,45].map(function(d){return(<button key={d} onClick={function(){setCycleLen(d);setShowResult(false);}} style={{flex:1,padding:"8px 4px",borderRadius:"10px",fontSize:"12px",fontFamily:F.s,fontWeight:"600",cursor:"pointer",border:cycleLen===d?"none":"1px solid "+C.bdr,background:cycleLen===d?C.berry:C.white,color:cycleLen===d?C.white:C.txtM}}>{d}</button>);})}</div><p style={{fontSize:"9px",fontFamily:F.s,color:C.txtL,margin:"4px 0 0"}}>Nella PCOS i cicli sono spesso 35-45 giorni o irregolari</p></div>{lastPeriod&&(<button onClick={function(){setShowResult(true);}} style={{width:"100%",padding:"12px",borderRadius:"12px",border:"none",background:"linear-gradient(135deg,"+C.berry+","+C.rose+")",color:C.white,fontSize:"14px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}}>Calcola</button>)}</Cd>
      {showResult&&dayOfCycle&&(<><Cd accent={CYCLE_PHASES[currentPhase].color} style={{background:CYCLE_PHASES[currentPhase].color+"08"}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"}}><div><span style={{fontSize:"28px"}}>{CYCLE_PHASES[currentPhase].icon}</span><h3 style={{fontFamily:F.p,fontSize:"18px",margin:"4px 0 0",color:C.txt}}>Fase {CYCLE_PHASES[currentPhase].name}</h3></div><div style={{textAlign:"right"}}><div style={{fontFamily:F.s,fontSize:"28px",fontWeight:"700",color:CYCLE_PHASES[currentPhase].color}}>G{dayOfCycle}</div><div style={{fontSize:"9px",fontFamily:F.s,color:C.txtL}}>del ciclo</div></div></div><Bar v={dayOfCycle} mx={cycleLen} color={CYCLE_PHASES[currentPhase].color}/><div style={{display:"flex",gap:"8px",marginTop:"10px"}}><div style={{flex:1,padding:"8px",borderRadius:"8px",background:C.white,textAlign:"center"}}><div style={{fontSize:"14px",fontWeight:"700",color:C.berry,fontFamily:F.s}}>{formatDate(nextPeriod)}</div><div style={{fontSize:"9px",color:C.txtL,fontFamily:F.s}}>Prossimo ciclo</div></div><div style={{flex:1,padding:"8px",borderRadius:"8px",background:C.white,textAlign:"center"}}><div style={{fontSize:"14px",fontWeight:"700",color:C.plum,fontFamily:F.s}}>{daysToNext}gg</div><div style={{fontSize:"9px",color:C.txtL,fontFamily:F.s}}>Mancano</div></div></div></Cd>
      <Cd><h4 style={{fontFamily:F.s,fontSize:"13px",fontWeight:"600",margin:"0 0 8px",color:CYCLE_PHASES[currentPhase].color}}>Consigli per questa fase</h4>{[{l:"Alimentazione",v:CYCLE_PHASES[currentPhase].food,ic:"ü•ó"},{l:"Allenamento",v:CYCLE_PHASES[currentPhase].gym,ic:"üèãÔ∏è"},{l:"Note PCOS",v:CYCLE_PHASES[currentPhase].pcos,ic:"ü©∫"}].map(function(tip,i){return(<div key={i} style={{display:"flex",gap:"8px",marginBottom:"10px",alignItems:"flex-start"}}><span style={{fontSize:"16px",flexShrink:0}}>{tip.ic}</span><div><div style={{fontSize:"10px",fontWeight:"600",fontFamily:F.s,color:C.txt,marginBottom:"2px"}}>{tip.l}</div><div style={{fontSize:"11px",fontFamily:F.s,color:C.txtM,lineHeight:1.5}}>{tip.v}</div></div></div>);})}</Cd></>)}
    </div>)}
    {sub==="fasi"&&(<div style={{display:"grid",gap:"10px"}}>{CYCLE_PHASES.map(function(ph,i){return(<Cd key={i} accent={ph.color}><div style={{display:"flex",gap:"10px",alignItems:"center",marginBottom:"8px"}}><span style={{fontSize:"24px"}}>{ph.icon}</span><div><h3 style={{fontFamily:F.p,fontSize:"15px",margin:0,color:C.txt}}>Fase {ph.name}</h3><span style={{fontSize:"10px",fontFamily:F.s,color:C.txtL}}>{ph.days}</span></div></div><div style={{fontSize:"10px",fontFamily:F.s,color:C.txtM,marginBottom:"4px"}}><strong>Ormoni:</strong> {ph.hormones}</div><div style={{fontSize:"10px",fontFamily:F.s,color:C.txtM,marginBottom:"4px"}}><strong>Alimentazione:</strong> {ph.food}</div><div style={{fontSize:"10px",fontFamily:F.s,color:C.txtM,marginBottom:"4px"}}><strong>Allenamento:</strong> {ph.gym}</div><div style={{padding:"6px 8px",borderRadius:"8px",background:ph.color+"10",marginTop:"6px"}}><div style={{fontSize:"10px",fontFamily:F.s,color:ph.color,fontWeight:"500"}}>{ph.pcos}</div></div></Cd>);})}</div>)}
    {sub==="pcos"&&(<div style={{display:"grid",gap:"10px"}}><Info bg={C.berryP} bdr={C.berryL} color={C.berry}><strong>Nella PCOS il ciclo e spesso irregolare</strong>: oligomenorrea (cicli lunghi 35-90 giorni) o amenorrea (assenza di ciclo).</Info>{[{t:"Perche il ciclo e irregolare",d:"L'eccesso di androgeni e l'iperinsulinemia interferiscono con la maturazione dei follicoli.",ic:"üî¨"},{t:"La fase luteale insufficiente",d:"Nella PCOS il corpo luteo puo produrre poco progesterone, accorciando la fase luteale.",ic:"üåô"},{t:"SPM amplificata nella PCOS",d:"Gonfiore, voglia di dolce, ansia sono piu intense. La fame emotiva colpisce 1 donna PCOS su 3.",ic:"üíõ"},{t:"Cosa migliora il ciclo",d:"Perdita del 5-10% del peso, esercizio regolare, alimentazione anti-infiammatoria e gestione dello stress.",ic:"üå±"},{t:"Quando preoccuparsi",d:"Assenza di ciclo per oltre 3 mesi, sanguinamento abbondante, dolore pelvico forte. Consulta il ginecologo.",ic:"ü©∫"}].map(function(item,i){return(<Cd key={i}><div style={{display:"flex",gap:"10px",alignItems:"flex-start"}}><span style={{fontSize:"20px",flexShrink:0}}>{item.ic}</span><div><h4 style={{margin:"0 0 3px",fontFamily:F.s,fontSize:"13px",fontWeight:"600",color:C.txt}}>{item.t}</h4><p style={{margin:0,fontSize:"11px",fontFamily:F.s,color:C.txtM,lineHeight:1.5}}>{item.d}</p></div></div></Cd>);})}</div>)}
  </div>);
}


/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê GARMIN TRACKER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function GarminSection({profile}){
  const[sub,setSub]=useState("dash");
  const[weighins,setWeighins]=useState(function(){return LD("weighins",DEF_W);});
  const[workouts,setWorkouts]=useState(function(){return LD("workouts",DEF_WO);});
  const[daily,setDaily]=useState(function(){return LD("daily",DEF_DD);});
  const[showAW,setShowAW]=useState(false);
  const[showAT,setShowAT]=useState(false);
  const[wF,setWF]=useState({date:todayK(),weight:"",bf:"",mm:"",bm:"",bw:""});
  const[tF,setTF]=useState({date:todayK(),type:"Strength",duration:"",calories:"",hr:""});
  const[dF,setDF]=useState(Object.assign({},daily));
  const[em,setEM]=useState(false);
  const[chartMode,setChartMode]=useState("weight");
  var lat=weighins.length>0?weighins[weighins.length-1]:null;
  var bmi=lat?(lat.weight/(profile.height/100*profile.height/100)).toFixed(1):"--";
  var last8=weighins.slice(-8);
  function addW(){if(!wF.weight)return;var e={date:wF.date,weight:parseFloat(wF.weight),bf:parseFloat(wF.bf)||0,mm:parseFloat(wF.mm)||0,bm:parseFloat(wF.bm)||0,bw:parseFloat(wF.bw)||0};var u=weighins.concat([e]).sort(function(a,b){return a.date.localeCompare(b.date);});setWeighins(u);SV("weighins",u);setWF({date:todayK(),weight:"",bf:"",mm:"",bm:"",bw:""});setShowAW(false);}
  function delW(i){var u=weighins.filter(function(_,j){return j!==i;});setWeighins(u);SV("weighins",u);}
  function addT(){if(!tF.duration)return;var e={date:tF.date,type:tF.type,duration:parseInt(tF.duration)||0,calories:parseInt(tF.calories)||0,hr:parseInt(tF.hr)||0};var u=workouts.concat([e]).sort(function(a,b){return b.date.localeCompare(a.date);});setWorkouts(u);SV("workouts",u);setTF({date:todayK(),type:"Strength",duration:"",calories:"",hr:""});setShowAT(false);}
  function delT(i){var u=workouts.filter(function(_,j){return j!==i;});setWorkouts(u);SV("workouts",u);}
  function savD(){var d={steps:parseInt(dF.steps)||0,rhr:parseInt(dF.rhr)||0,stress:parseInt(dF.stress)||0,bb:parseInt(dF.bb)||0,vo2:parseInt(dF.vo2)||0};setDaily(d);SV("daily",d);setEM(false);}
  var tcMap={Strength:C.sage,Camminata:C.amber,Yoga:C.plum,Cardio:C.rose,HIIT:C.berry,Riposo:C.txtL};
  function chartData(mode){var d=weighins.slice(-12);return d.map(function(w){if(mode==="weight")return{v:w.weight,label:fmtD(w.date)};if(mode==="bf")return{v:w.bf,label:fmtD(w.date)};if(mode==="mm")return{v:w.mm,label:fmtD(w.date)};if(mode==="bw")return{v:w.bw,label:fmtD(w.date)};return{v:0,label:""};});}
  var cd=chartData(chartMode);
  var chartColors={weight:C.sage,bf:C.rose,mm:C.amber,bw:C.blue};
  return(<div>
    <SecH title="Garmin Tracker" sub="Forerunner 570 + Index S2 | Inserimento manuale"/>
    <SubT tabs={[{k:"dash",l:"Dashboard",i:"üìä"},{k:"charts",l:"Grafici",i:"üìà"},{k:"peso",l:"Pesate",i:"‚öñÔ∏è"},{k:"workout",l:"Allenamenti",i:"‚åö"},{k:"daily",l:"Oggi",i:"‚ù§Ô∏è"}]} active={sub} onSel={setSub}/>
    {sub==="dash"&&(<div style={{display:"grid",gap:"10px"}}>
      <Cd accent={C.sage} style={{background:"linear-gradient(135deg,"+C.sageP+","+C.white+")"}}><h3 style={{fontFamily:F.p,fontSize:"15px",margin:"0 0 10px",color:C.sageD}}>Stato Attuale</h3><div style={{display:"grid",gap:"8px",gridTemplateColumns:"1fr 1fr 1fr"}}>{[{l:"Peso",v:lat?lat.weight+" kg":"--",c:C.sage},{l:"BMI",v:bmi,c:C.amber},{l:"Body Fat",v:lat?lat.bf+"%":"--",c:C.rose}].map(function(m,i){return(<div key={i} style={{textAlign:"center",padding:"10px 4px",borderRadius:"10px",background:C.white}}><div style={{fontFamily:F.s,fontSize:"18px",fontWeight:"700",color:m.c}}>{m.v}</div><div style={{fontSize:"9px",color:C.txtL,fontFamily:F.s}}>{m.l}</div></div>);})}</div><div style={{display:"grid",gap:"8px",gridTemplateColumns:"1fr 1fr 1fr",marginTop:"8px"}}>{[{l:"Muscolo",v:lat?lat.mm+"%":"--",c:C.sage},{l:"Ossa",v:lat?lat.bm+" kg":"--",c:C.amber},{l:"Acqua",v:lat?lat.bw+"%":"--",c:C.blue}].map(function(m,i){return(<div key={i} style={{textAlign:"center",padding:"10px 4px",borderRadius:"10px",background:C.white}}><div style={{fontFamily:F.s,fontSize:"16px",fontWeight:"700",color:m.c}}>{m.v}</div><div style={{fontSize:"9px",color:C.txtL,fontFamily:F.s}}>{m.l}</div></div>);})}</div></Cd>
      <div style={{display:"grid",gap:"8px",gridTemplateColumns:"1fr 1fr"}}>{[{l:"Passi",v:daily.steps?daily.steps.toLocaleString():"‚Äî",s:"/"+profile.stepsG.toLocaleString(),c:C.sage,b:true,bv:daily.steps||0,bm:profile.stepsG},{l:"FC Riposo",v:daily.rhr?daily.rhr+" bpm":"‚Äî",c:C.rose},{l:"Body Battery",v:daily.bb?daily.bb+"%":"‚Äî",c:C.sage,b:true,bv:daily.bb||0,bm:100},{l:"Stress",v:daily.stress?String(daily.stress):"‚Äî",s:daily.stress<30?"Basso":daily.stress<60?"Medio":"Alto",c:C.amber}].map(function(m,i){return(<Cd key={i} style={{padding:"12px"}}><span style={{fontSize:"9px",fontFamily:F.s,color:C.txtL,textTransform:"uppercase"}}>{m.l}</span><div style={{fontFamily:F.s,fontSize:"18px",fontWeight:"700",color:m.c||C.txt}}>{m.v}</div>{m.s&&<div style={{fontSize:"9px",fontFamily:F.s,color:C.txtL}}>{m.s}</div>}{m.b&&<div style={{marginTop:"5px"}}><Bar v={m.bv} mx={m.bm} color={m.c||C.sage}/></div>}</Cd>);})}</div>
      <Cd><h4 style={{fontFamily:F.p,fontSize:"14px",margin:"0 0 10px",color:C.txt}}>Andamento Peso (Ob: ~{profile.goalW} kg)</h4><div style={{display:"flex",alignItems:"flex-end",gap:"3px",height:"100px"}}>{last8.map(function(w,i){var mn=Math.min.apply(null,last8.map(function(x){return x.weight;}))-1;var mx=Math.max.apply(null,last8.map(function(x){return x.weight;}))+1;var h=((w.weight-mn)/(mx-mn))*100;var il=i===last8.length-1;return(<div key={i} style={{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:"2px"}}><span style={{fontSize:"8px",fontFamily:F.s,color:il?C.sage:C.txtL,fontWeight:il?"700":"400"}}>{w.weight}</span><div style={{width:"100%",maxWidth:"26px",height:h+"%",borderRadius:"5px 5px 2px 2px",background:il?C.sage:C.sageL}}/><span style={{fontSize:"7px",fontFamily:F.s,color:C.txtL}}>{fmtD(w.date)}</span></div>);})}</div></Cd>
    </div>)}
    {sub==="charts"&&(<div style={{display:"grid",gap:"10px"}}>
      <div style={{display:"flex",gap:"4px"}}>{[{k:"weight",l:"Peso"},{k:"bf",l:"Body Fat %"},{k:"mm",l:"Muscolo %"},{k:"bw",l:"Acqua %"}].map(function(m){return(<button key={m.k} onClick={function(){setChartMode(m.k);}} style={{flex:1,padding:"8px 4px",borderRadius:"10px",border:chartMode===m.k?"none":"1px solid "+C.bdr,background:chartMode===m.k?chartColors[m.k]:C.white,color:chartMode===m.k?C.white:C.txtM,fontSize:"10px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}}>{m.l}</button>);})}</div>
      <Cd><h4 style={{fontFamily:F.p,fontSize:"14px",margin:"0 0 12px",color:C.txt}}>üìà {chartMode==="weight"?"Peso":chartMode==="bf"?"Body Fat %":chartMode==="mm"?"Massa Muscolare %":"Acqua %"}</h4>{cd.length>1?(<div style={{position:"relative",height:"140px",display:"flex",alignItems:"flex-end",gap:"4px"}}>{cd.map(function(pt,i){var vals=cd.map(function(x){return x.v;});var mn=Math.min.apply(null,vals)-1;var mx=Math.max.apply(null,vals)+1;var h=((pt.v-mn)/(mx-mn))*100;var il=i===cd.length-1;return(<div key={i} style={{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:"2px",height:"100%",justifyContent:"flex-end"}}><span style={{fontSize:"8px",fontFamily:F.s,color:il?chartColors[chartMode]:C.txtL,fontWeight:il?"700":"400"}}>{pt.v}</span><div style={{width:"100%",maxWidth:"30px",height:h+"%",borderRadius:"5px 5px 2px 2px",background:il?chartColors[chartMode]:chartColors[chartMode]+"60",transition:"height .5s"}}/><span style={{fontSize:"7px",fontFamily:F.s,color:C.txtL}}>{pt.label}</span></div>);})}</div>):(<p style={{fontSize:"12px",fontFamily:F.s,color:C.txtL,textAlign:"center",padding:"20px"}}>Inserisci almeno 2 pesate per vedere il grafico</p>)}</Cd>
      {cd.length>1&&<Cd style={{background:C.sageP,border:"1px solid "+C.sageL}}><div style={{display:"flex",justifyContent:"space-between"}}><span style={{fontSize:"11px",fontFamily:F.s,color:C.sageD}}>Prima: {cd[0].v} | Ora: {cd[cd.length-1].v}</span><span style={{fontSize:"11px",fontFamily:F.s,fontWeight:"700",color:cd[cd.length-1].v<cd[0].v?C.sage:C.rose}}>{chartMode==="weight"||chartMode==="bf"?(cd[cd.length-1].v<cd[0].v?"‚Üì":"‚Üë"):(cd[cd.length-1].v>cd[0].v?"‚Üë":"‚Üì")} {Math.abs(cd[cd.length-1].v-cd[0].v).toFixed(1)}</span></div></Cd>}
    </div>)}
    {sub==="peso"&&(<div style={{display:"grid",gap:"10px"}}>
      <button onClick={function(){setShowAW(!showAW);}} style={{width:"100%",padding:"12px",borderRadius:"12px",border:"none",background:showAW?C.roseP:"linear-gradient(135deg,"+C.sage+","+C.sageD+")",color:showAW?C.roseD:C.white,fontSize:"13px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}}>{showAW?"‚úï Chiudi":"‚ûï Nuova Pesata"}</button>
      {showAW&&(<Cd accent={C.sage}><h4 style={{fontFamily:F.s,fontSize:"13px",fontWeight:"600",margin:"0 0 10px",color:C.sageD}}>Registra pesata dalla bilancia Garmin</h4><div style={{display:"grid",gap:"8px"}}><div><label style={lS}>Data</label><input type="date" value={wF.date} onChange={function(e){setWF(Object.assign({},wF,{date:e.target.value}));}} style={iS}/></div><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px"}}><div><label style={lS}>Peso (kg) *</label><input type="number" step="0.1" placeholder="77.0" value={wF.weight} onChange={function(e){setWF(Object.assign({},wF,{weight:e.target.value}));}} style={iS}/></div><div><label style={lS}>Body Fat %</label><input type="number" step="0.1" placeholder="29.0" value={wF.bf} onChange={function(e){setWF(Object.assign({},wF,{bf:e.target.value}));}} style={iS}/></div></div><div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"8px"}}><div><label style={lS}>Muscolo %</label><input type="number" step="0.1" value={wF.mm} onChange={function(e){setWF(Object.assign({},wF,{mm:e.target.value}));}} style={iS}/></div><div><label style={lS}>Ossa kg</label><input type="number" step="0.1" value={wF.bm} onChange={function(e){setWF(Object.assign({},wF,{bm:e.target.value}));}} style={iS}/></div><div><label style={lS}>Acqua %</label><input type="number" step="0.1" value={wF.bw} onChange={function(e){setWF(Object.assign({},wF,{bw:e.target.value}));}} style={iS}/></div></div><button onClick={addW} style={{width:"100%",padding:"11px",borderRadius:"12px",border:"none",background:C.sage,color:C.white,fontSize:"13px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}}>Salva Pesata</button></div></Cd>)}
      <Cd><h4 style={{fontFamily:F.p,fontSize:"14px",margin:"0 0 10px",color:C.txt}}>Storico Pesate ({weighins.length})</h4>{weighins.length===0&&<p style={{fontSize:"12px",fontFamily:F.s,color:C.txtL}}>Nessuna pesata</p>}<div style={{display:"grid",gap:"6px"}}>{weighins.slice().reverse().map(function(w,i){var ri=weighins.length-1-i;return(<div key={i} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 12px",borderRadius:"10px",background:i===0?C.sageP:C.bg}}><div><span style={{fontFamily:F.s,fontSize:"12px",fontWeight:"600",color:C.txt}}>{fmtD(w.date)}</span><span style={{fontFamily:F.s,fontSize:"12px",color:C.txtM,marginLeft:"8px"}}>{w.weight} kg</span></div><div style={{display:"flex",gap:"6px",alignItems:"center"}}>{w.bf>0&&<Pill color={C.rose}>BF {w.bf}%</Pill>}{w.mm>0&&<Pill color={C.sage}>MM {w.mm}%</Pill>}<button onClick={function(){delW(ri);}} style={{background:"none",border:"none",color:C.txtL,cursor:"pointer",fontSize:"14px",padding:"2px 4px"}}>‚úï</button></div></div>);})}</div></Cd>
    </div>)}
    {sub==="workout"&&(<div style={{display:"grid",gap:"10px"}}>
      <button onClick={function(){setShowAT(!showAT);}} style={{width:"100%",padding:"12px",borderRadius:"12px",border:"none",background:showAT?C.roseP:"linear-gradient(135deg,"+C.rose+","+C.roseD+")",color:showAT?C.roseD:C.white,fontSize:"13px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}}>{showAT?"‚úï Chiudi":"‚ûï Registra Allenamento"}</button>
      {showAT&&(<Cd accent={C.rose}><div style={{display:"grid",gap:"8px"}}><div><label style={lS}>Data</label><input type="date" value={tF.date} onChange={function(e){setTF(Object.assign({},tF,{date:e.target.value}));}} style={iS}/></div><div><label style={lS}>Tipo</label><div style={{display:"flex",gap:"4px",flexWrap:"wrap"}}>{["Strength","Camminata","Yoga","Cardio","HIIT","Riposo"].map(function(t){return<button key={t} onClick={function(){setTF(Object.assign({},tF,{type:t}));}} style={{padding:"7px 12px",borderRadius:"10px",border:tF.type===t?"none":"1px solid "+C.bdr,background:tF.type===t?C.rose:C.white,color:tF.type===t?C.white:C.txtM,fontSize:"11px",fontFamily:F.s,fontWeight:"500",cursor:"pointer"}}>{t}</button>;})}</div></div><div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"8px"}}><div><label style={lS}>Durata (min) *</label><input type="number" placeholder="55" value={tF.duration} onChange={function(e){setTF(Object.assign({},tF,{duration:e.target.value}));}} style={iS}/></div><div><label style={lS}>Calorie</label><input type="number" placeholder="380" value={tF.calories} onChange={function(e){setTF(Object.assign({},tF,{calories:e.target.value}));}} style={iS}/></div><div><label style={lS}>FC media</label><input type="number" placeholder="128" value={tF.hr} onChange={function(e){setTF(Object.assign({},tF,{hr:e.target.value}));}} style={iS}/></div></div><button onClick={addT} style={{width:"100%",padding:"11px",borderRadius:"12px",border:"none",background:C.rose,color:C.white,fontSize:"13px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}}>Salva</button></div></Cd>)}
      {workouts.length===0&&<Info bg={C.roseP} bdr={C.roseL} color={C.roseD}>Nessun allenamento registrato.</Info>}
      <div style={{display:"grid",gap:"6px"}}>{workouts.slice(0,14).map(function(w,i){return(<Cd key={i} style={{padding:"13px"}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}><div><div style={{display:"flex",gap:"6px",alignItems:"center",marginBottom:"2px"}}><span style={{fontFamily:F.s,fontSize:"12px",fontWeight:"600",color:C.txt}}>{fmtD(w.date)}</span><Pill color={tcMap[w.type]||C.sage}>{w.type}</Pill></div><div style={{display:"flex",gap:"10px"}}>{w.duration>0&&<span style={{fontSize:"11px",fontFamily:F.s,color:C.txtM}}>{w.duration} min</span>}{w.calories>0&&<span style={{fontSize:"11px",fontFamily:F.s,color:C.txtM}}>{w.calories} kcal</span>}{w.hr>0&&<span style={{fontSize:"11px",fontFamily:F.s,color:C.txtM}}>FC {w.hr}</span>}</div></div><button onClick={function(){delT(i);}} style={{background:"none",border:"none",color:C.txtL,cursor:"pointer",fontSize:"14px"}}> ‚úï</button></div></Cd>);})}</div>
    </div>)}
    {sub==="daily"&&(<div style={{display:"grid",gap:"10px"}}>
      <Info bg={C.sageP} bdr={C.sageL} color={C.sageD}>Inserisci i dati di <strong>oggi</strong> dal tuo Garmin Connect.</Info>
      <Cd accent={C.sage}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"}}><h4 style={{fontFamily:F.s,fontSize:"14px",fontWeight:"600",margin:0,color:C.txt}}>Dati Giornalieri</h4>{!em&&<button onClick={function(){setDF(Object.assign({},daily));setEM(true);}} style={{padding:"6px 14px",borderRadius:"10px",border:"none",background:C.sage,color:C.white,fontSize:"11px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}}>Modifica</button>}</div>
      {!em?(<div style={{display:"grid",gap:"8px",gridTemplateColumns:"1fr 1fr"}}>{[{l:"Passi",v:daily.steps?daily.steps.toLocaleString():"‚Äî",ic:"üö∂",c:C.sage},{l:"FC Riposo",v:daily.rhr?daily.rhr+" bpm":"‚Äî",ic:"‚ù§Ô∏è",c:C.rose},{l:"Stress",v:daily.stress?String(daily.stress):"‚Äî",ic:"üß†",c:C.amber},{l:"Body Battery",v:daily.bb?daily.bb+"%":"‚Äî",ic:"üîã",c:C.sage},{l:"VO2 Max",v:daily.vo2?String(daily.vo2):"‚Äî",ic:"ü´Å",c:C.plum}].map(function(m,i){return(<div key={i} style={{display:"flex",gap:"8px",alignItems:"center",padding:"10px",borderRadius:"10px",background:C.bg}}><span style={{fontSize:"18px"}}>{m.ic}</span><div><div style={{fontSize:"15px",fontWeight:"700",color:m.c,fontFamily:F.s}}>{m.v}</div><div style={{fontSize:"9px",color:C.txtL,fontFamily:F.s}}>{m.l}</div></div></div>);})}</div>):(<div style={{display:"grid",gap:"8px"}}><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px"}}><div><label style={lS}>Passi</label><input type="number" value={dF.steps} onChange={function(e){setDF(Object.assign({},dF,{steps:e.target.value}));}} style={iS}/></div><div><label style={lS}>FC Riposo</label><input type="number" value={dF.rhr} onChange={function(e){setDF(Object.assign({},dF,{rhr:e.target.value}));}} style={iS}/></div></div><div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"8px"}}><div><label style={lS}>Stress</label><input type="number" value={dF.stress} onChange={function(e){setDF(Object.assign({},dF,{stress:e.target.value}));}} style={iS}/></div><div><label style={lS}>Body Battery %</label><input type="number" value={dF.bb} onChange={function(e){setDF(Object.assign({},dF,{bb:e.target.value}));}} style={iS}/></div><div><label style={lS}>VO2 Max</label><input type="number" value={dF.vo2} onChange={function(e){setDF(Object.assign({},dF,{vo2:e.target.value}));}} style={iS}/></div></div><div style={{display:"flex",gap:"8px"}}><button onClick={savD} style={{flex:1,padding:"11px",borderRadius:"12px",border:"none",background:C.sage,color:C.white,fontSize:"13px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}}>Salva</button><button onClick={function(){setEM(false);}} style={{padding:"11px 16px",borderRadius:"12px",border:"1px solid "+C.bdr,background:C.white,color:C.txtM,fontSize:"13px",fontFamily:F.s,cursor:"pointer"}}>Annulla</button></div></div>)}</Cd>
    </div>)}
  </div>);
}




/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê NOTIFICHE BROWSER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function requestNotifPerm(){if("Notification" in window&&Notification.permission==="default")Notification.requestPermission();}
function sendNotif(title,body){if("Notification" in window&&Notification.permission==="granted")new Notification(title,{body:body,icon:"data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üå∏</text></svg>"});}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PROGRESS PHOTOS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function ProgressPhotos(){
  const[photos,setPhotos]=useState(function(){return LD("progressPhotos",[]);});
  const[compare,setCompare]=useState(false);
  const[sliderPos,setSliderPos]=useState(50);
  const[selA,setSelA]=useState(0);
  const[selB,setSelB]=useState(null);
  var fileRef=useRef(null);
  function addPhoto(e){var file=e.target.files[0];if(!file)return;var reader=new FileReader();reader.onload=function(ev){var entry={date:todayK(),data:ev.target.result,note:""};var u=[entry].concat(photos).slice(0,20);setPhotos(u);SV("progressPhotos",u);};reader.readAsDataURL(file);}
  function delPhoto(i){var u=photos.filter(function(_,j){return j!==i;});setPhotos(u);SV("progressPhotos",u);}
  useEffect(function(){if(photos.length>=2&&selB===null)setSelB(photos.length-1);},[photos]);
  return(<div style={{display:"grid",gap:"12px"}}>
    <input ref={fileRef} type="file" accept="image/*" capture="environment" onChange={addPhoto} style={{display:"none"}}/>
    <button onClick={function(){fileRef.current.click();}} style={{width:"100%",padding:"14px",borderRadius:"12px",border:"2px dashed "+C.sage,background:C.sageP,color:C.sageD,fontSize:"13px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}}>üì∏ Aggiungi Progress Photo</button>
    {photos.length>=2&&(<div><button onClick={function(){setCompare(!compare);}} style={{width:"100%",padding:"10px",borderRadius:"10px",border:"none",background:compare?C.roseP:"linear-gradient(135deg,"+C.plum+","+C.rose+")",color:compare?C.roseD:C.white,fontSize:"12px",fontFamily:F.s,fontWeight:"600",cursor:"pointer",marginBottom:"10px"}}>{compare?"‚úï Chiudi confronto":"üîÄ Confronta Before/After"}</button>
    {compare&&(<Cd accent={C.plum}><div style={{display:"flex",gap:"6px",marginBottom:"10px"}}><div style={{flex:1}}><label style={lS}>Prima</label><select value={selA} onChange={function(e){setSelA(parseInt(e.target.value));}} style={Object.assign({},iS,{fontSize:"11px"})}>{photos.map(function(p,i){return<option key={i} value={i}>{fmtD(p.date)}</option>;})}</select></div><div style={{flex:1}}><label style={lS}>Dopo</label><select value={selB||0} onChange={function(e){setSelB(parseInt(e.target.value));}} style={Object.assign({},iS,{fontSize:"11px"})}>{photos.map(function(p,i){return<option key={i} value={i}>{fmtD(p.date)}</option>;})}</select></div></div>
    <div style={{position:"relative",width:"100%",height:"300px",borderRadius:"12px",overflow:"hidden",touchAction:"none"}} onPointerMove={function(e){var rect=e.currentTarget.getBoundingClientRect();var x=Math.max(0,Math.min(100,((e.clientX-rect.left)/rect.width)*100));setSliderPos(x);}} onTouchMove={function(e){var rect=e.currentTarget.getBoundingClientRect();var t=e.touches[0];var x=Math.max(0,Math.min(100,((t.clientX-rect.left)/rect.width)*100));setSliderPos(x);}}>
      <img src={photos[selB||0].data} style={{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover"}}/>
      <div style={{position:"absolute",top:0,left:0,width:sliderPos+"%",height:"100%",overflow:"hidden"}}><img src={photos[selA].data} style={{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover",minWidth:100/sliderPos*100+"%"}}/></div>
      <div style={{position:"absolute",top:0,left:sliderPos+"%",width:"3px",height:"100%",background:C.white,boxShadow:"0 0 8px rgba(0,0,0,.5)",transform:"translateX(-50%)",zIndex:2}}><div style={{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-50%)",width:"30px",height:"30px",borderRadius:"50%",background:C.white,boxShadow:"0 2px 8px rgba(0,0,0,.3)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px"}}>‚Üî</div></div>
      <div style={{position:"absolute",top:"8px",left:"8px",padding:"3px 8px",borderRadius:"6px",background:"rgba(0,0,0,.6)",color:C.white,fontSize:"9px",fontFamily:F.s,zIndex:3}}>PRIMA ‚Äî {fmtD(photos[selA].date)}</div>
      <div style={{position:"absolute",top:"8px",right:"8px",padding:"3px 8px",borderRadius:"6px",background:"rgba(0,0,0,.6)",color:C.white,fontSize:"9px",fontFamily:F.s,zIndex:3}}>DOPO ‚Äî {fmtD(photos[selB||0].date)}</div>
    </div></Cd>)}</div>)}
    {photos.length===0&&<Info bg={C.plumP} bdr={C.plumL} color={C.plum}>Scatta una foto al mese per vedere i tuoi progressi nel tempo! Le foto restano solo sul tuo dispositivo.</Info>}
    <div style={{display:"grid",gap:"8px",gridTemplateColumns:"repeat(3,1fr)"}}>{photos.map(function(p,i){return(<div key={i} style={{position:"relative",borderRadius:"10px",overflow:"hidden",aspectRatio:"3/4"}}><img src={p.data} style={{width:"100%",height:"100%",objectFit:"cover"}}/><div style={{position:"absolute",bottom:0,left:0,right:0,background:"linear-gradient(transparent,rgba(0,0,0,.7))",padding:"4px 6px"}}><span style={{fontSize:"9px",fontFamily:F.s,color:C.white}}>{fmtD(p.date)}</span></div><button onClick={function(){delPhoto(i);}} style={{position:"absolute",top:"4px",right:"4px",width:"20px",height:"20px",borderRadius:"50%",border:"none",background:"rgba(0,0,0,.5)",color:C.white,fontSize:"11px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"}}>‚úï</button></div>);})}</div>
  </div>);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CYCLE CORRELATION ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function getCyclePhaseNow(){
  var lp=LD("lastPeriod","");var cl=LD("cycleLen",35);
  if(!lp)return null;
  var d=Math.floor((new Date()-new Date(lp))/86400000)+1;
  if(d<=5)return{phase:0,day:d};
  if(d<=Math.floor(cl*0.46))return{phase:1,day:d};
  if(d<=Math.floor(cl*0.57))return{phase:2,day:d};
  return{phase:3,day:d};
}
var CYCLE_FOOD_TIPS=[
  ["Ferro: spinaci, lenticchie, carne rossa magra. Zenzero per crampi. Cioccolato fondente 85% per magnesio.","Cibi caldi e confortanti. Evita caffeina (peggiora i crampi). Te allo zenzero."],
  ["Proteine per supportare follicoli. Verdure crucifere (broccoli, cavolfiore). Cereali integrali per energia.","Fase ideale per provare nuove ricette! Energia alta = cucina creativa."],
  ["Fibre per metabolizzare estrogeni in eccesso. Zinco (semi di zucca). Omega-3 (salmone).","Riduci sale e cibi gonfianti. Focus su anti-infiammatori."],
  ["Carboidrati complessi per serotonina. Magnesio. Cannella. Cioccolato fondente per voglia di dolce.","La fame pre-mestruale e normale nella PCOS. Prepara snack sani in anticipo."]
];
var CYCLE_GYM_TIPS=[
  ["Yoga dolce, stretching, camminate leggere. Max 30 min. Ascolta il corpo.","Se ti senti bene, una sessione leggera va bene. Ma zero sensi di colpa se riposi."],
  ["MASSIMA intensita! Aumenta carichi, prova record personali. Forza e resistenza al top.","Approfitta di questa finestra per progressive overload. Gli estrogeni proteggono i muscoli."],
  ["Energia al massimo. HIIT, circuit training, carichi pesanti. Vai all-out!","Finestra breve (2-3 giorni): sfruttala per gli allenamenti piu intensi della settimana."],
  ["Prima meta: ancora buona energia, intensita moderata. Seconda meta: riduci, preferisci pilates e camminate.","Se ti senti gonfia, non pesarti. La ritenzione idrica maschera i progressi reali."]
];

function CycleCorrelationBanner(){
  var cp=getCyclePhaseNow();
  if(!cp)return null;
  var ph=CYCLE_PHASES[cp.phase];
  return(<Cd style={{marginBottom:"12px",background:ph.color+"08",border:"1px solid "+ph.color+"30"}}><div style={{display:"flex",gap:"8px",alignItems:"center",marginBottom:"6px"}}><span style={{fontSize:"20px"}}>{ph.icon}</span><div><span style={{fontFamily:F.s,fontSize:"12px",fontWeight:"600",color:ph.color}}>Fase {ph.name} (G{cp.day})</span></div></div><div style={{fontSize:"11px",fontFamily:F.s,color:C.txtM,lineHeight:1.5}}>{CYCLE_FOOD_TIPS[cp.phase][0]}</div></Cd>);
}
function CycleGymBanner(){
  var cp=getCyclePhaseNow();
  if(!cp)return null;
  var ph=CYCLE_PHASES[cp.phase];
  return(<Cd style={{marginBottom:"12px",background:ph.color+"08",border:"1px solid "+ph.color+"30"}}><div style={{display:"flex",gap:"8px",alignItems:"center",marginBottom:"6px"}}><span style={{fontSize:"20px"}}>{ph.icon}</span><span style={{fontFamily:F.s,fontSize:"12px",fontWeight:"600",color:ph.color}}>Fase {ph.name} ‚Äî Allenamento</span></div><div style={{fontSize:"11px",fontFamily:F.s,color:C.txtM,lineHeight:1.5}}>{CYCLE_GYM_TIPS[cp.phase][0]}</div><div style={{fontSize:"10px",fontFamily:F.s,color:ph.color,marginTop:"4px",fontStyle:"italic"}}>{CYCLE_GYM_TIPS[cp.phase][1]}</div></Cd>);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê WEEKLY INSIGHT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function WeeklyInsight({profile}){
  var today=new Date();var dow=today.getDay();
  var mc=calcMacros(profile);
  var weighins=LD("weighins",DEF_W);
  var fasts=LD("fasts",[]);
  var workouts=LD("workouts",DEF_WO);
  var last=weighins.length>0?weighins[weighins.length-1]:null;
  var prev=weighins.length>1?weighins[weighins.length-2]:null;
  var weightDiff=last&&prev?(last.weight-prev.weight).toFixed(1):null;
  var bfDiff=last&&prev&&last.bf&&prev.bf?(last.bf-prev.bf).toFixed(1):null;
  var fastsThisWeek=fasts.filter(function(f){var fd=new Date(f.date);return(today-fd)<7*86400000;});
  var fastsDone=fastsThisWeek.filter(function(f){return f.completed;}).length;
  var workoutsThisWeek=workouts.filter(function(w){var wd=new Date(w.date);return(today-wd)<7*86400000;});
  var cp=getCyclePhaseNow();
  var msgs=[];
  if(weightDiff&&weightDiff<0)msgs.push("üí™ Hai perso "+Math.abs(weightDiff)+"kg dall'ultima pesata!");
  else if(weightDiff&&weightDiff>0)msgs.push("üìä +"+weightDiff+"kg ‚Äî potrebbe essere ritenzione idrica"+(cp&&cp.phase===3?" (fase luteale!)":"")+". Non mollare.");
  if(fastsDone>=5)msgs.push("üî• "+fastsDone+" digiuni completati questa settimana! Streak fantastica.");
  else if(fastsDone>=3)msgs.push("‚è≥ "+fastsDone+" digiuni completati. Buon ritmo, punta a 5+!");
  if(workoutsThisWeek.length>=4)msgs.push("üèãÔ∏è "+workoutsThisWeek.length+" allenamenti! Stai costruendo massa muscolare.");
  else if(workoutsThisWeek.length>=2)msgs.push("üèãÔ∏è "+workoutsThisWeek.length+" allenamenti. Prova ad aggiungerne uno in piu!");
  if(last&&last.weight>profile.goalW){var remaining=(last.weight-profile.goalW).toFixed(1);var weeks=Math.round(remaining/0.5);msgs.push("üéØ Ti mancano ~"+remaining+"kg al tuo obiettivo. A 0.5kg/sett = ~"+weeks+" settimane.");}
  if(cp)msgs.push(CYCLE_PHASES[cp.phase].icon+" Sei in fase "+CYCLE_PHASES[cp.phase].name+": "+CYCLE_PHASES[cp.phase].gym.split(".")[0]+".");
  if(msgs.length===0)msgs.push("üå∏ Questa settimana e un foglio bianco. Inizia col piede giusto!");
  return(<Cd accent={C.sage} style={{marginBottom:"16px",background:"linear-gradient(135deg,"+C.sageP+","+C.white+")"}}><div style={{display:"flex",gap:"8px",alignItems:"center",marginBottom:"10px"}}><span style={{fontSize:"20px"}}>üìã</span><h4 style={{fontFamily:F.p,fontSize:"14px",fontWeight:"600",color:C.sageD,margin:0}}>Insight Settimanale</h4></div><div style={{display:"grid",gap:"6px"}}>{msgs.map(function(m,i){return(<div key={i} style={{fontSize:"12px",fontFamily:F.s,color:C.txt,lineHeight:1.5,padding:"6px 8px",borderRadius:"8px",background:C.white}}>{m}</div>);})}</div></Cd>);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê EXPORT CSV ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function ExportData(){
  function exportCSV(name,headers,rows){var csv=headers.join(";")+"\n";rows.forEach(function(r){csv+=r.join(";")+"\n";});var blob=new Blob(["\uFEFF"+csv],{type:"text/csv;charset=utf-8;"});var url=URL.createObjectURL(blob);var a=document.createElement("a");a.href=url;a.download=name+".csv";a.click();URL.revokeObjectURL(url);}
  function expWeight(){var w=LD("weighins",DEF_W);exportCSV("pcos_pesate",["Data","Peso_kg","BodyFat_%","Muscolo_%","Ossa_kg","Acqua_%"],w.map(function(r){return[r.date,r.weight,r.bf,r.mm,r.bm,r.bw];}));}
  function expWorkouts(){var w=LD("workouts",[]);exportCSV("pcos_allenamenti",["Data","Tipo","Durata_min","Calorie","FC_media"],w.map(function(r){return[r.date,r.type,r.duration,r.calories,r.hr];}));}
  function expFasts(){var f=LD("fasts",[]);exportCSV("pcos_digiuni",["Data","Obiettivo_h","Effettivo_h","Completato","Inizio"],f.map(function(r){return[r.date,r.goal,r.actual,r.completed?"Si":"No",r.startTime||""];}));}
  function expGym(){var logs=LD("gymLogs",{});var rows=[];Object.keys(logs).forEach(function(k){logs[k].forEach(function(e){rows.push([e.date,k,e.weight,e.reps]);});});exportCSV("pcos_carichi",["Data","Esercizio","Peso_kg","Reps"],rows);}
  function expAll(){expWeight();setTimeout(expWorkouts,500);setTimeout(expFasts,1000);setTimeout(expGym,1500);}
  return(<div style={{display:"grid",gap:"10px"}}>
    <Info bg={C.sageP} bdr={C.sageL} color={C.sageD}>üìÅ Esporta i tuoi dati in formato CSV per condividerli con il tuo nutrizionista, endocrinologo o ginecologo.</Info>
    {[{l:"üìä Storico Pesate",d:"Peso, BF%, muscolo, ossa, acqua",fn:expWeight,c:C.sage},
    {l:"üèãÔ∏è Allenamenti",d:"Tipo, durata, calorie, FC media",fn:expWorkouts,c:C.rose},
    {l:"‚è≥ Digiuni",d:"Obiettivo, effettivo, completamento",fn:expFasts,c:C.plum},
    {l:"üí™ Carichi Palestra",d:"Esercizio, peso, reps per data",fn:expGym,c:C.amber}
    ].map(function(ex,i){return(<button key={i} onClick={ex.fn} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"14px",borderRadius:"12px",border:"1px solid "+C.bdr,background:C.white,cursor:"pointer",textAlign:"left"}}><div><div style={{fontFamily:F.s,fontSize:"13px",fontWeight:"600",color:C.txt}}>{ex.l}</div><div style={{fontFamily:F.s,fontSize:"10px",color:C.txtL}}>{ex.d}</div></div><span style={{padding:"6px 12px",borderRadius:"8px",background:ex.c,color:C.white,fontSize:"11px",fontFamily:F.s,fontWeight:"600"}}>CSV ‚Üì</span></button>);})}
    <button onClick={expAll} style={{width:"100%",padding:"14px",borderRadius:"12px",border:"none",background:"linear-gradient(135deg,"+C.sage+","+C.plum+")",color:C.white,fontSize:"14px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}}>üì¶ Scarica TUTTO (4 file CSV)</button>
  </div>);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MEDICAL DASHBOARD ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function MedicalDashboard(){
  const[bloods,setBloods]=useState(function(){return LD("bloodwork",[]);});
  const[showAdd,setShowAdd]=useState(false);
  const[form,setForm]=useState({date:todayK(),insulina:"",homaIR:"",testosterone:"",dheas:"",tsh:"",vitD:"",ferritina:"",glicemia:""});
  var markers=[
    {k:"insulina",l:"Insulina basale",u:"ŒºU/mL",range:"2-25",ideal:"<10",warn:"Nella PCOS spesso elevata. <10 = ottimo"},
    {k:"homaIR",l:"HOMA-IR",u:"",range:"0.5-2.5",ideal:"<1.5",warn:"Indice di insulino-resistenza. >2.5 = resistenza"},
    {k:"testosterone",l:"Testosterone totale",u:"ng/dL",range:"15-70",ideal:"<50",warn:"Spesso elevato nella PCOS. Causa acne e irsutismo"},
    {k:"dheas",l:"DHEA-S",u:"Œºg/dL",range:"35-430",ideal:"<300",warn:"Androgeno surrenalico. Elevato nel 25% delle PCOS"},
    {k:"tsh",l:"TSH",u:"ŒºUI/mL",range:"0.4-4.0",ideal:"1-2.5",warn:"Tiroide. Nella PCOS controllare sempre la funzione tiroidea"},
    {k:"vitD",l:"Vitamina D",u:"ng/mL",range:"30-100",ideal:">40",warn:"Carente nell'80% delle PCOS. Target 40-60"},
    {k:"ferritina",l:"Ferritina",u:"ng/mL",range:"12-150",ideal:">30",warn:"Depositi di ferro. Controllare se ciclo abbondante"},
    {k:"glicemia",l:"Glicemia a digiuno",u:"mg/dL",range:"70-100",ideal:"<90",warn:"Pre-diabete se 100-125. Diabete se >126"},
  ];
  function addBlood(){var entry={date:form.date};markers.forEach(function(m){if(form[m.k])entry[m.k]=parseFloat(form[m.k]);});var u=[entry].concat(bloods).slice(0,20);setBloods(u);SV("bloodwork",u);setShowAdd(false);setForm({date:todayK(),insulina:"",homaIR:"",testosterone:"",dheas:"",tsh:"",vitD:"",ferritina:"",glicemia:""});}
  function delBlood(i){var u=bloods.filter(function(_,j){return j!==i;});setBloods(u);SV("bloodwork",u);}
  var latest=bloods.length>0?bloods[0]:null;
  return(<div style={{display:"grid",gap:"12px"}}>
    <Info bg={C.berryP} bdr={C.berryL} color={C.berry}><strong>Dashboard Medica PCOS.</strong> Inserisci i valori delle tue analisi del sangue per monitorare l'andamento nel tempo. Porta questi dati al tuo medico.</Info>
    <button onClick={function(){setShowAdd(!showAdd);}} style={{width:"100%",padding:"12px",borderRadius:"12px",border:"none",background:showAdd?C.roseP:"linear-gradient(135deg,"+C.berry+","+C.rose+")",color:showAdd?C.roseD:C.white,fontSize:"13px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}}>{showAdd?"‚úï Chiudi":"ü©∏ Inserisci Analisi del Sangue"}</button>
    {showAdd&&(<Cd accent={C.berry}><div style={{display:"grid",gap:"8px"}}><div><label style={lS}>Data analisi</label><input type="date" value={form.date} onChange={function(e){setForm(Object.assign({},form,{date:e.target.value}));}} style={iS}/></div><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px"}}>{markers.map(function(m){return(<div key={m.k}><label style={lS}>{m.l} ({m.u||m.range})</label><input type="number" step="0.1" placeholder={m.ideal} value={form[m.k]} onChange={function(e){var u=Object.assign({},form);u[m.k]=e.target.value;setForm(u);}} style={iS}/></div>);})}</div><button onClick={addBlood} style={{width:"100%",padding:"11px",borderRadius:"12px",border:"none",background:C.berry,color:C.white,fontSize:"13px",fontFamily:F.s,fontWeight:"600",cursor:"pointer"}}>Salva Analisi</button></div></Cd>)}
    {latest&&(<Cd accent={C.plum}><h4 style={{fontFamily:F.p,fontSize:"14px",margin:"0 0 10px",color:C.txt}}>Ultimo Prelievo ‚Äî {fmtD(latest.date)}</h4><div style={{display:"grid",gap:"6px"}}>{markers.map(function(m){var v=latest[m.k];if(!v)return null;var numV=parseFloat(v);var idealParts=m.ideal.replace(/[<>]/g,"").trim();var idealNum=parseFloat(idealParts);var isGood=m.ideal.startsWith("<")?numV<idealNum:m.ideal.startsWith(">")?numV>idealNum:numV>=idealNum*0.8&&numV<=idealNum*1.2;return(<div key={m.k} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px",borderRadius:"8px",background:isGood?C.sageP:C.roseP}}><div><div style={{fontFamily:F.s,fontSize:"12px",fontWeight:"600",color:C.txt}}>{m.l}</div><div style={{fontFamily:F.s,fontSize:"9px",color:C.txtL}}>Range: {m.range} | Ideale: {m.ideal}</div></div><div style={{textAlign:"right"}}><div style={{fontFamily:F.s,fontSize:"16px",fontWeight:"700",color:isGood?C.sage:C.rose}}>{v} <span style={{fontSize:"10px",fontWeight:"400"}}>{m.u}</span></div><span style={{fontSize:"10px"}}>{isGood?"‚úÖ":"‚ö†Ô∏è"}</span></div></div>);})}</div></Cd>)}
    {bloods.length>1&&(<Cd><h4 style={{fontFamily:F.p,fontSize:"14px",margin:"0 0 10px",color:C.txt}}>üìà Trend Valori</h4>{markers.filter(function(m){return bloods.filter(function(b){return b[m.k];}).length>1;}).slice(0,4).map(function(m){var vals=bloods.filter(function(b){return b[m.k];}).slice(0,8).reverse();return(<div key={m.k} style={{marginBottom:"12px"}}><span style={{fontSize:"11px",fontFamily:F.s,fontWeight:"600",color:C.txt}}>{m.l}</span><div style={{display:"flex",alignItems:"flex-end",gap:"3px",height:"50px",marginTop:"4px"}}>{vals.map(function(v,i){var allV=vals.map(function(x){return x[m.k];});var mn=Math.min.apply(null,allV)-1;var mx=Math.max.apply(null,allV)+1;var h=((v[m.k]-mn)/(mx-mn))*100;var il=i===vals.length-1;return(<div key={i} style={{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:"1px"}}><span style={{fontSize:"7px",fontFamily:F.s,color:il?C.plum:C.txtL}}>{v[m.k]}</span><div style={{width:"100%",maxWidth:"20px",height:Math.max(h,5)+"%",borderRadius:"3px",background:il?C.plum:C.plumL}}/></div>);})}</div></div>);})}</Cd>)}
    {bloods.length>0&&(<Cd><h4 style={{fontFamily:F.p,fontSize:"13px",margin:"0 0 8px",color:C.txt}}>Storico Analisi</h4><div style={{display:"grid",gap:"4px"}}>{bloods.map(function(b,i){var count=markers.filter(function(m){return b[m.k];}).length;return(<div key={i} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 10px",borderRadius:"8px",background:C.bg}}><span style={{fontSize:"12px",fontFamily:F.s,fontWeight:"600",color:C.txt}}>{fmtD(b.date)}</span><div style={{display:"flex",gap:"6px",alignItems:"center"}}><Pill color={C.plum}>{count} valori</Pill><button onClick={function(){delBlood(i);}} style={{background:"none",border:"none",color:C.txtL,cursor:"pointer",fontSize:"12px"}}>‚úï</button></div></div>);})}</div></Cd>)}
  </div>);
}


/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PCOS AI ASSISTANT (Rule-Based) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
var AI_KB=[
{k:["colazione","mattina","breakfast","prima colazione"],t:"Colazione PCOS-Friendly",r:"La colazione e il pasto piu importante nella PCOS. Dopo il digiuno notturno, il corpo ha bisogno di stabilita glicemica. Le regole d'oro: 1) Proteine al centro ‚Äî uova (fino a 12/settimana), salmone, affettati magri (tacchino, bresaola), hummus, tofu. Senza proteine avrai montagne russe glicemiche. 2) Grassi buoni ‚Äî frutta secca (mandorle, noci, pistacchi), burro di arachidi, avocado. 3) Carboidrati complessi e fibrosi ‚Äî pane integrale di segale, avena, grano saraceno. 4) EVITA: yogurt magro (indice insulinico altissimo, piu del pane bianco!), cornetti, gallette di riso, cereali zuccherati, succhi di frutta. Alternative al latte vaccino: latte di mandorla, cocco, nocciola. Esempio perfetto: 2 uova strapazzate + pane di segale + avocado + mandorle + te verde."},
{k:["indice glicemico","glicemia","zucchero","zuccheri","spike","picco","picchi"],t:"Indice Glicemico e PCOS",r:"Nella PCOS l'insulina e la chiave di tutto. Piu la glicemia sale dopo un pasto, piu insulina viene prodotta = piu androgeni = piu sintomi. Le regole: 1) Mangia SEMPRE in quest'ordine: VERDURA (prima!) ‚Üí PROTEINE ‚Üí CARBOIDRATI (mai da soli). 2) Scegli carboidrati ad alto contenuto di fibre: quinoa, riso integrale, farro, legumi, grano saraceno, patate dolci. 3) Evita carboidrati raffinati: pane bianco, pasta non integrale, riso bianco, dolci, gallette di riso (IG altissimo!). 4) Abbina sempre un grasso buono (olio EVO, frutta secca) per rallentare l'assorbimento. 5) Frutta: si, ma con moderazione e MAI da sola ‚Äî sempre con frutta secca o dopo un pasto."},
{k:["verdura","verdure","vegetali","ortaggi","insalata","fibre","fibra"],t:"Verdure nella PCOS",r:"Le verdure sono il tuo superpotere nella PCOS: fibra, antiossidanti, vitamine, indice glicemico e insulinico bassissimo. Devono essere il PRIMO alimento di ogni pasto ‚Äî la fibra rallenta l'assorbimento degli zuccheri successivi. Top PCOS: broccoli, cavolfiori, zucchine, spinaci (crudi meglio), cavolo, rucola, sedano, peperoni, carciofi, finocchi, funghi. Attenzione a: carote (meglio crude, cotte raddoppiano l'IG), zucca (meglio al forno che bollita), barbabietola (meglio cruda a fettine). I pomodori e cetrioli hanno molta acqua e poca fibra: abbinali sempre a qualcosa di fibroso (sedano, rucola). Quantita: almeno 200-250g di verdure strutturate, 80-100g di insalata. Obiettivo: 2-3 porzioni di verdura al giorno."},
{k:["legumi","lenticch","ceci","fagioli","piselli","soia"],t:"Legumi e PCOS",r:"I legumi sono fantastici per la PCOS! Considerali come 'carboidrati proteici' ‚Äî hanno un indice glicemico molto piu basso dei cereali, ottime proteine vegetali e tante fibre. Prevengono i picchi glicemici e danno saziet√† a lungo. Regole: comprali secchi e biologici, ammollo 18-24 ore. Puoi consumarli 3-5 volte a settimana. 3 modi per un pasto equilibrato: 1) Come sostituto dei cereali (es. zuppa di lenticchie + verdure + olio EVO), 2) Come contorno proteico (ceci in insalata + verdure + pesce), 3) In crema (hummus come base proteica). Attenzione: piselli e fave hanno piu amidi ‚Äî trattali come patate, non come verdura."},
{k:["latticin","latte","yogurt","formaggio","formaggi","dairy","calcio"],t:"Latticini e PCOS",r:"Scoperta importante: i latticini a basso contenuto di grassi hanno indice glicemico basso MA indice INSULINICO altissimo! Lo yogurt magro stimola l'insulina PIU del pane bianco. Perche? Il latte vaccino contiene IGF-1 e aminoacidi ramificati (BCAA) che fanno impennare l'insulina. Cosa fare: 1) Riduci latticini, soprattutto quelli 'light'. 2) Preferisci: latte di mandorla, cocco, nocciola, anacardi (evita latte di riso = IG alto). 3) Se vuoi yogurt: greco intero max 2 volte/settimana, mai quotidianamente. 4) I fiocchi di latte e il brie hanno indice insulinico piu basso. 5) Calcio? L'OMS ha ridotto le raccomandazioni. Prendi vitamina D, fai esercizio fisico, bevi acqua ricca di calcio (es. Sangemini, ~1L/giorno)."},
{k:["inositolo","myo-inositolo","d-chiro","integratore","integratori","supplemento","supplementi"],t:"Integratori per PCOS",r:"I piu importanti scientificamente: 1) MYO-INOSITOLO: il re degli integratori PCOS. Insulino-sensibilizzante, migliora ovulazione, riduce testosterone e HOMA-IR, regolarizza il ciclo. Dose: 2-4g/giorno, lontano dai pasti per miglior assorbimento. 2) VITAMINA D: carente nell'80% delle donne con PCOS. Target: 40-60 ng/mL. 3) OMEGA-3: anti-infiammatorio, migliora profilo lipidico. 4) MAGNESIO: riduce ansia, migliora sonno e insulino-sensibilit√†. 5) ZINCO: riduce testosterone e DHT, utile per acne e capelli. 6) NAC (N-Acetilcisteina): antiossidante, migliora ovulazione. 7) ACIDO FOLICO/METILFOLATO: essenziale per fertilit√†. Ricorda: gli integratori NON sostituiscono alimentazione e stile di vita. Consulta sempre il tuo endocrinologo."},
{k:["insulino","insulina","resistenza","homa","glicemia a digiuno","iperinsulin"],t:"Insulino-Resistenza e PCOS",r:"L'insulino-resistenza e il motore nascosto della PCOS. Il tuo corpo produce troppa insulina ‚Üí piu androgeni ‚Üí piu sintomi (acne, irsutismo, ciclo irregolare, difficolta a perdere peso). Come combatterla: 1) ALIMENTAZIONE: pasti completi (verdura+proteine+carboidrati complessi+grassi buoni), mai carboidrati da soli. 2) ORDINE DEI CIBI: verdura prima, proteine poi, carboidrati per ultimi. 3) ESERCIZIO: i pesi sono i migliori ‚Äî il muscolo consuma glucosio anche a riposo. Anche una camminata di 15 min dopo i pasti abbassa la glicemia del 30%. 4) DIGIUNO INTERMITTENTE: migliora la sensibilit√† insulinica. 5) SONNO: dormire <7 ore peggiora l'insulino-resistenza del 40%. 6) Valori da monitorare: insulina basale (<10), HOMA-IR (<1.5), glicemia a digiuno (<90)."},
{k:["peso","dimagri","perdere","grasso","addominale","pancia","metabolismo","calorie"],t:"Perdita di Peso nella PCOS",r:"Nella PCOS perdere peso e piu difficile ma NON impossibile. Il problema non e solo 'mangiare meno' ‚Äî devi spegnere i meccanismi che sostengono l'iperinsulinemia. Strategie efficaci: 1) DEFICIT MODERATO: non scendere sotto 1200-1300 kcal, il metabolismo si adatterebbe. 2) PRIORITA' PROTEINE: almeno 1.6-2g/kg per preservare muscolo. 3) PESI > CARDIO: il muscolo brucia grasso 24/7. Ogni kg di muscolo = ~50 kcal extra/giorno a riposo. 4) GRASSO ADDOMINALE: e il piu legato all'insulino-resistenza. Si riduce con pesi, IF, gestione cortisolo e sonno. 5) PAZIENZA: nella PCOS servono 8-12 settimane per vedere risultati. Il peso puo non cambiare ma la composizione corporea si (meno grasso, piu muscolo). Pesa te stessa max 1 volta a settimana, stessa ora, a digiuno."},
{k:["allena","eserciz","palestr","pesi","forza","squat","stacco","muscol","gym","workout"],t:"Allenamento e PCOS",r:"L'allenamento con i pesi e il MIGLIORE per la PCOS ‚Äî meglio del cardio! Perche: il muscolo e un 'magazzino di glucosio' che migliora la sensibilit√† insulinica 24/7. Piano ideale: 3-4 sessioni/settimana di pesi (upper/lower/core), 30-45 min. Esercizi top: squat, stacco, hip thrust, pressa, affondi (gambe e glutei bruciano piu calorie). Aggiungi: 8000-10000 passi/giorno (attivita NEAT = brucia piu calorie del cardio intenso). EVITA: troppo HIIT/cardio intenso (alza il cortisolo ‚Üí piu grasso addominale). Pilates e ottimo come complemento: meno ansia, core forte, postura migliore. Progressione: aumenta il peso o le reps ogni 1-2 settimane. Il tuo corpo si adatta ‚Äî devi dargli stimoli nuovi."},
{k:["digiuno","fasting","intermittente","finestra","16:8","14:10","12:12"],t:"Digiuno Intermittente e PCOS",r:"Il digiuno intermittente (IF) e un ottimo alleato nella PCOS perche migliora la sensibilit√† insulinica, riduce l'infiammazione e attiva l'autofagia cellulare. Protocolli: 12:12 (principianti), 14:10 (ideale per PCOS), 16:8 (avanzato). Regole: 1) Colazione ABBONDANTE e proteica come primo pasto. 2) Cena LEGGERA e entro la finestra. 3) Durante il digiuno: acqua, te verde, tisane senza zucchero (niente latte!). 4) Il caffe ha un leggero effetto ipoglicemizzante ‚Äî ok ma senza zucchero. 5) NON saltare pasti ‚Äî riduci la finestra, non il numero di pasti. 6) Fase luteale: se hai molta fame pre-mestruale, e NORMALE. Puoi ridurre il digiuno a 12:12 in quei giorni. L'IF non e una dieta, e un ritmo alimentare."},
{k:["ciclo","mestrual","mestruazion","ovulaz","fase","follicol","lute","amenorrea","irregolar"],t:"Ciclo Mestruale e PCOS",r:"Il ciclo irregolare e il sintomo piu comune della PCOS, causato dall'eccesso di androgeni che impedisce ai follicoli di maturare. Le 4 fasi e cosa fare: 1) MESTRUALE (G1-5): riposo, ferro (spinaci, lenticchie, carne rossa), zenzero per crampi. Allenamento leggero. 2) FOLLICOLARE (G6-13): energia in salita! Proteine per follicoli, verdure crucifere. Aumenta intensit√† allenamento. 3) OVULATORIA (G14-16): picco di energia. Vai all-out con i pesi, fibre per metabolizzare estrogeni. 4) LUTEALE (G17-35+): prima meta ancora ok, seconda meta riduci. Carboidrati complessi per serotonina, magnesio, cannella. Fame aumentata = normale, prepara snack sani. Se non hai il ciclo: l'IF, l'inositolo e la perdita di peso possono ripristinarlo."},
{k:["acne","pelle","brufol","irsutismo","peli","capelli","caduta","androgen","testosterone","dht"],t:"Acne, Irsutismo e PCOS",r:"Acne e irsutismo nella PCOS sono causati dall'eccesso di androgeni (testosterone, DHT, DHEA-S). Strategie: 1) ALIMENTAZIONE anti-infiammatoria: riduci latticini (stimolano IGF-1 e androgeni), zuccheri raffinati, cibi processati. Aumenta omega-3, zinco, verdure crucifere (broccoli, cavolo ‚Äî metabolizzano gli estrogeni). 2) INTEGRATORI: Zinco (riduce DHT), NAC, inositolo, the verde. 3) PESI: non aumentano il testosterone nelle donne ‚Äî anzi, migliorando l'insulino-resistenza possono RIDURRE gli androgeni. 4) STRESS: il cortisolo cronico alza i DHEA-S surrenalici. Meditazione, yoga, sonno regolare. 5) Valori da controllare: testosterone totale, testosterone libero, DHEA-S, SHBG (piu e alto meglio e). Il myo-inositolo aumenta l'SHBG."},
{k:["fertili","gravid","concepimento","ovulazione","mamm","bambino","figli"],t:"PCOS e Fertilit√†",r:"La PCOS e la causa piu comune di infertilit√† femminile, ma NON significa che non puoi diventare mamma. L'anovulazione e il problema principale ‚Äî i follicoli non maturano per l'eccesso di androgeni e insulina. Cosa fare: 1) Perdita di peso: anche solo il 5-10% migliora significativamente l'ovulazione. 2) Myo-inositolo: studi dimostrano che migliora significativamente il tasso di ovulazione e regolarizza il ciclo. 3) Metilfolato/acido folico: essenziale. 4) Alimentazione anti-infiammatoria e IF. 5) Farmaci: la metformina migliora l'insulino-sensibilit√† e puo ripristinare l'ovulazione. Il clomifene stimola l'ovulazione. 6) Approccio multidisciplinare: nutrizionista + ginecologo/a + eventualmente endocrinologo/a. La PCOS non e sempre un ostacolo a diventare mamme."},
{k:["stress","cortisolo","ansia","relax","meditazione","mentale","psicolog"],t:"Stress, Cortisolo e PCOS",r:"Il cortisolo (ormone dello stress) e un nemico silenzioso nella PCOS. Cortisolo alto ‚Üí piu insulina ‚Üí piu androgeni ‚Üí piu grasso addominale ‚Üí piu stress = un circolo vizioso. Come spezzarlo: 1) SONNO: 7-9 ore, regolare. Il cortisolo segue il ritmo circadiano. 2) CAMMINATE nella natura: 20-30 min abbassano il cortisolo del 25%. 3) RESPIRAZIONE: 5 min di box breathing (4s inspira, 4s trattieni, 4s espira, 4s trattieni) abbassano il cortisolo immediatamente. 4) LIMITA caff√® a 1-2/giorno prima delle 14:00. 5) EVITA allenamenti troppo intensi la sera (alzano il cortisolo). 6) MAGNESIO prima di dormire. 7) Non sottovalutare la salute mentale: una psicologa puo aiutarti nel percorso. La PCOS non e solo fisica ‚Äî ha un impatto emotivo importante."},
{k:["sonno","dorm","notturn","insonnia","sveglia","riposo"],t:"Sonno e PCOS",r:"Dormire bene e una MEDICINA per la PCOS. Meno di 7 ore: cortisolo +37%, insulino-resistenza peggiora del 40%, leptina diminuisce (piu fame), grelina aumenta (piu voglia di dolci). Regole: 1) 7-9 ore a notte, SEMPRE. 2) Orari regolari: vai a letto e svegliati alla stessa ora. 3) Buio totale: la melatonina si produce solo al buio. 4) Niente schermi 30 min prima di dormire. 5) Temperatura fresca (18-20¬∞C). 6) Magnesio glicinato o bisglicinato prima di dormire. 7) Tisana camomilla o valeriana. 8) Evita caffeina dopo le 14:00 e alcol la sera. Il sonno profondo e quando il corpo ripara, gli ormoni si resettano e l'insulina si ricalibra."},
{k:["analisi","sangue","esami","ematici","valore","valori","prelievo","check","tiroide","tsh"],t:"Analisi del Sangue PCOS",r:"Esami fondamentali da fare almeno 1-2 volte/anno: 1) INSULINA BASALE: ideale <10 ŒºU/mL. 2) HOMA-IR: <1.5 ottimo, >2.5 insulino-resistenza. 3) GLICEMIA A DIGIUNO: <90 mg/dL ideale, 100-125 pre-diabete. 4) TESTOSTERONE TOTALE: spesso elevato nella PCOS. 5) DHEA-S: androgeno surrenalico, elevato nel 25% delle PCOS. 6) SHBG: piu e alto meglio e ‚Äî lega il testosterone libero. 7) TSH: 1-2.5 ideale (nella PCOS controllare sempre la tiroide). 8) VITAMINA D: target 40-60 ng/mL, carente nell'80% delle PCOS. 9) FERRITINA: >30 ideale, controllare se ciclo abbondante. 10) PROFILO LIPIDICO: colesterolo, trigliceridi. Porta questi valori al tuo endocrinologo e usa la sezione Analisi dell'app per monitorare i trend."},
{k:["motivazione","morale","difficile","mollare","sconforto","stanca","non ce la faccio","dura","fatica"],t:"Motivazione e PCOS",r:"Lo so, la PCOS puo essere frustrante. I risultati arrivano piu lentamente, il corpo sembra non rispondere, e ci sono giorni in cui vorresti mollare tutto. Ma ricorda: 1) Non sei sola ‚Äî la PCOS colpisce 1 donna su 10. 2) Ogni piccolo gesto conta: quel bicchiere d'acqua, quella camminata, quella scelta alimentare. 3) I cambiamenti piu importanti non si vedono sulla bilancia ‚Äî insulina che migliora, infiammazione che cala, energia che torna. 4) Inizia a piccoli passi, non tutto insieme. Chi ha avuto i risultati migliori ci ha messo 1-2 ANNI di percorso graduale. 5) Non e una 'dieta' ‚Äî e il tuo nuovo stile di vita. Innamorati del percorso. 6) La PCOS si gestisce, non ti definisce. Tu sei molto piu dei tuoi sintomi. Continua, un giorno alla volta."},
{k:["acqua","idratazione","bere","bevande","te verde","tisana","caffe"],t:"Idratazione e PCOS",r:"L'acqua e l'unica bevanda con cui dissetarsi nella PCOS. Obiettivo: almeno 1.5-2L/giorno. Bevande consigliate: 1) ACQUA: preferibilmente ricca di calcio (es. Sangemini). 2) TE VERDE: anti-infiammatorio, antiossidante, leggero effetto termogenico. 2-3 tazze/giorno. 3) TISANE: zenzero (anti-nausea, anti-infiammatorio), cannella (migliora insulino-sensibilit√†), menta. 4) CAFFE: max 1-2 al giorno, senza zucchero, prima delle 14:00. Evita: succhi di frutta (solo zuccheri), bevande zuccherate, energy drink, latte vaccino (alto indice insulinico), bevande di riso (IG alto). L'idratazione migliora digestione, pelle, energia e aiuta il metabolismo."},
{k:["frutta secca","mandorl","noci","pistacch","semi","arachid","nocciole"],t:"Frutta Secca e PCOS",r:"La frutta secca e INDISPENSABILE nella PCOS ‚Äî fornisce grassi buoni, proteine, fibre e minerali. Top: mandorle (le migliori per IG), noci (omega-3), pistacchi (proteine), noci pecan, anacardi, nocciole. Semi: chia (omega-3, fibre), zucca (zinco!), girasole, lino (fitoestrogeni), sesamo, canapa. Usi: 1) A colazione: una manciata con yogurt o porridge. 2) Come snack: 20-30g per spezzare la fame senza spike glicemici. 3) In crema: burro di mandorle o arachidi su pane integrale. 4) Nelle insalate: semi di zucca e girasole. Regola: comprale sfuse, non tostate e non salate. La frutta secca e il tuo migliore alleato anti-picco-glicemico."}
];
function findBestMatch(q){
  var ql=q.toLowerCase().replace(/[^a-zA-Z√†√®√©√¨√≤√π0-9\s]/g,"");
  var best=null;var bestScore=0;
  AI_KB.forEach(function(entry){
    var score=0;
    entry.k.forEach(function(keyword){
      if(ql.includes(keyword))score+=keyword.length;
    });
    if(score>bestScore){bestScore=score;best=entry;}
  });
  return bestScore>=3?best:null;
}
function PCOSAssistant({profile}){
  const[msgs,setMsgs]=useState([{from:"ai",text:"Ciao! Sono il tuo assistente PCOS. Posso aiutarti su alimentazione, allenamento, digiuno intermittente, integratori, ciclo mestruale, analisi del sangue e molto altro. Chiedimi quello che vuoi!",time:new Date().toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"})}]);
  const[input,setInput]=useState("");
  const[typing,setTyping]=useState(false);
  var chatRef=useRef(null);
  var mc=calcMacros(profile);
  var cp=getCyclePhaseNow();
  useEffect(function(){if(chatRef.current)chatRef.current.scrollTop=chatRef.current.scrollHeight;},[msgs]);
  function personalizeResp(text){
    var t=text;
    if(profile.name)t=t.replace(/NOME/g,profile.name);
    return t;
  }
  function buildContext(){
    var ctx=[];
    ctx.push("Il tuo target calorico e ~"+mc.target+" kcal/giorno.");
    ctx.push("Il tuo protocollo IF e "+profile.ifH+":"+(24-profile.ifH)+" (finestra "+profile.ifOpen+"-"+profile.ifClose+").");
    if(profile.weight&&profile.goalW)ctx.push("Peso attuale: "+profile.weight+"kg, obiettivo: "+profile.goalW+"kg ("+Math.max(0,(profile.weight-profile.goalW).toFixed(1))+"kg da perdere).");
    if(profile.allergies&&profile.allergies.length>0)ctx.push("Intolleranze: "+profile.allergies.join(", ")+".");
    if(cp)ctx.push("Sei in fase "+CYCLE_PHASES[cp.phase].name+" del ciclo (giorno "+cp.day+").");
    return ctx.join(" ");
  }
  function suggest(){
    var suggestions=["Cosa mangiare a colazione?","Come perdere grasso addominale?","Quali integratori prendere?","Come funziona il digiuno intermittente?","Quali analisi del sangue fare?","Consigli per il ciclo irregolare","Come gestire lo stress?","Quanta acqua devo bere?","Latticini si o no?","Sono senza motivazione..."];
    return suggestions;
  }
  function sendMsg(){
    if(!input.trim())return;
    var userMsg={from:"user",text:input.trim(),time:new Date().toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"})};
    var newMsgs=msgs.concat([userMsg]);
    setMsgs(newMsgs);
    setInput("");
    setTyping(true);
    setTimeout(function(){
      var match=findBestMatch(input);
      var reply;
      if(match){
        var context=buildContext();
        reply={from:"ai",text:"**"+match.t+"**\n\n"+personalizeResp(match.r)+"\n\n_In base al tuo profilo: "+context+"_",time:new Date().toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"})};
      }else{
        reply={from:"ai",text:"Non ho una risposta specifica su questo argomento, ma posso aiutarti su: alimentazione PCOS, indice glicemico, colazione, verdure, legumi, latticini, integratori (inositolo, vitamina D...), insulino-resistenza, perdita di peso, allenamento, digiuno intermittente, ciclo mestruale, fertilit√†, acne/irsutismo, stress/cortisolo, sonno, analisi del sangue, frutta secca, idratazione. Prova a riformulare la domanda o scegli un argomento qui sotto!",time:new Date().toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"})};
      }
      setMsgs(newMsgs.concat([reply]));
      setTyping(false);
    },800+Math.random()*700);
  }
  function renderText(text){
    var parts=text.split("\n");
    return parts.map(function(p,i){
      if(!p.trim())return null;
      var t=p;
      var isBold=t.startsWith("**")&&t.includes("**",2);
      var isItalic=t.startsWith("_")&&t.endsWith("_");
      if(isBold)return React.createElement("div",{key:i,style:{fontWeight:"700",fontSize:"13px",marginBottom:"6px",color:C.sageD}},t.replace(/\*\*/g,""));
      if(isItalic)return React.createElement("div",{key:i,style:{fontStyle:"italic",fontSize:"10px",marginTop:"6px",padding:"6px 8px",borderRadius:"6px",background:C.sageP,color:C.sageD}},t.replace(/_/g,""));
      return React.createElement("div",{key:i,style:{fontSize:"12px",lineHeight:1.6,marginBottom:"4px"}},t);
    });
  }
  return(<div style={{display:"flex",flexDirection:"column",height:"calc(100vh - 220px)",minHeight:"400px"}}>
    <SecH title="Assistente PCOS" sub="Basato sulle guide Lotus Flower PCOS 101"/>
    <div ref={chatRef} style={{flex:1,overflowY:"auto",display:"flex",flexDirection:"column",gap:"10px",padding:"4px 0",marginBottom:"10px"}}>
      {msgs.map(function(m,i){return(<div key={i} style={{display:"flex",justifyContent:m.from==="user"?"flex-end":"flex-start"}}><div style={{maxWidth:"85%",padding:"10px 14px",borderRadius:m.from==="user"?"14px 14px 4px 14px":"14px 14px 14px 4px",background:m.from==="user"?"linear-gradient(135deg,"+C.sage+","+C.sageD+")":C.white,color:m.from==="user"?C.white:C.txt,fontFamily:F.s,boxShadow:"0 1px 3px rgba(0,0,0,.08)",border:m.from==="ai"?"1px solid "+C.bdr:"none"}}>{m.from==="ai"?renderText(m.text):<span style={{fontSize:"12px",lineHeight:1.5}}>{m.text}</span>}<div style={{fontSize:"8px",color:m.from==="user"?"rgba(255,255,255,.6)":C.txtL,textAlign:"right",marginTop:"4px"}}>{m.time}</div></div></div>);})}
      {typing&&<div style={{display:"flex",justifyContent:"flex-start"}}><div style={{padding:"10px 18px",borderRadius:"14px 14px 14px 4px",background:C.white,border:"1px solid "+C.bdr}}><span style={{fontFamily:F.s,fontSize:"12px",color:C.txtL,animation:"pulse 1s infinite"}}>Sto pensando...</span></div></div>}
    </div>
    {msgs.length<=2&&(<div style={{display:"flex",gap:"6px",flexWrap:"wrap",marginBottom:"10px"}}>{suggest().map(function(s,i){return(<button key={i} onClick={function(){setInput(s);}} style={{padding:"6px 10px",borderRadius:"20px",border:"1px solid "+C.sageL,background:C.sageP,color:C.sageD,fontSize:"10px",fontFamily:F.s,cursor:"pointer",whiteSpace:"nowrap"}}>{s}</button>);})}</div>)}
    <div style={{display:"flex",gap:"8px"}}><input value={input} onChange={function(e){setInput(e.target.value);}} onKeyDown={function(e){if(e.key==="Enter")sendMsg();}} placeholder="Chiedimi qualcosa sulla PCOS..." style={Object.assign({},iS,{flex:1,padding:"12px",borderRadius:"20px"})}/><button onClick={sendMsg} disabled={!input.trim()||typing} style={{padding:"12px 18px",borderRadius:"20px",border:"none",background:!input.trim()?C.bdr:"linear-gradient(135deg,"+C.sage+","+C.sageD+")",color:C.white,fontSize:"14px",cursor:!input.trim()?"default":"pointer"}}>‚û§</button></div>
    <p style={{fontSize:"8px",fontFamily:F.s,color:C.txtL,textAlign:"center",margin:"6px 0 0"}}>Le risposte sono basate sulle guide Lotus Flower PCOS 101. Consulta sempre il tuo medico per decisioni cliniche.</p>
  </div>);
}


/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê BENESSERE (Integratori + Sonno + Medical + Export + Photos) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function Benessere(){
  const[sub,setSub]=useState("supps");
  return(<div>
    <SecH title="Benessere PCOS" sub="Integratori, sonno, analisi, export e progress photos"/>
    <SubT tabs={[{k:"supps",l:"Integratori",i:"üíä"},{k:"sleep",l:"Sonno",i:"üò¥"},{k:"medical",l:"Analisi",i:"ü©∏"},{k:"photos",l:"Foto",i:"üì∏"},{k:"export",l:"Export",i:"üìÅ"},{k:"tips",l:"Tips",i:"üí°"}]} active={sub} onSel={setSub}/>
    {sub==="supps"&&<SuppTracker/>}
    {sub==="sleep"&&(<div style={{display:"grid",gap:"12px"}}><SleepTracker/><Info bg={C.plumP} bdr={C.plumL} color={C.plum}><strong>Perche il sonno conta nella PCOS:</strong> Dormire meno di 7 ore aumenta il cortisolo del 37%, peggiora l'insulino-resistenza e aumenta la fame il giorno dopo. Punta a 7-9 ore per notte.</Info></div>)}
    {sub==="medical"&&<MedicalDashboard/>}
    {sub==="photos"&&<ProgressPhotos/>}
    {sub==="export"&&<ExportData/>}
    {sub==="tips"&&(<div style={{display:"grid",gap:"10px"}}>
      {[{t:"Cortisolo e grasso addominale",d:"Lo stress cronico alza il cortisolo, che nella PCOS e gia elevato. Il cortisolo promuove l'accumulo di grasso viscerale. Meditazione, camminate e sonno di qualita lo riducono.",ic:"üß†",c:C.plum},
      {t:"Infiammazione cronica silente",d:"La PCOS e associata a infiammazione cronica di basso grado. Gli omega-3, la curcuma, le verdure crucifere e il te verde la combattono.",ic:"üî•",c:C.rose},
      {t:"Insulino-resistenza: il cuore della PCOS",d:"Il 70% delle donne PCOS ha insulino-resistenza. L'inositolo, l'esercizio fisico e mangiare le verdure PRIMA dei carboidrati migliorano la sensibilita insulinica.",ic:"üìä",c:C.amber},
      {t:"Il circolo vizioso dello stress",d:"Stress ‚Üí cortisolo alto ‚Üí fame emotiva ‚Üí zuccheri ‚Üí picco insulinico ‚Üí piu grasso ‚Üí piu stress. Rompi il ciclo con attivita fisica e routine regolari.",ic:"üîÑ",c:C.berry},
      {t:"Vitamina D e PCOS",d:"L'80% delle donne PCOS e carente di vitamina D. Supplementare migliora ciclo mestruale, umore e sensibilita insulinica. Target: 40-60 ng/mL.",ic:"‚òÄÔ∏è",c:C.amber},
      {t:"Il potere dell'inositolo",d:"Il myo-inositolo (4g/giorno) + D-chiro-inositolo (rapporto 40:1) migliorano ovulazione, insulina, androgeni e qualita ovocitaria. E l'integratore #1 per la PCOS.",ic:"üíä",c:C.sage}
      ].map(function(item,i){return(<Cd key={i} accent={item.c}><div style={{display:"flex",gap:"10px",alignItems:"flex-start"}}><span style={{fontSize:"20px",flexShrink:0}}>{item.ic}</span><div><h4 style={{margin:"0 0 3px",fontFamily:F.s,fontSize:"13px",fontWeight:"600",color:C.txt}}>{item.t}</h4><p style={{margin:0,fontSize:"11px",fontFamily:F.s,color:C.txtM,lineHeight:1.5}}>{item.d}</p></div></div></Cd>);})}
    </div>)}
  </div>);
}


/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê APP PRINCIPALE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function App(){
  const[user,setUser]=useState(null);
  const[authReady,setAuthReady]=useState(false);
  const[tab,setTab]=useState("alimentazione");
  const[profile,setProfile]=useState(function(){return LD("profile",DEF_PROF);});
  const[syncing,setSyncing]=useState(false);
  const[lastSync,setLastSync]=useState("");
  const[showShare,setShowShare]=useState(false);
  var scrollRef=useRef(null);

  /* Auth listener + redirect result */
  useEffect(function(){fbAuth.getRedirectResult().catch(function(){});var unsub=fbAuth.onAuthStateChanged(function(u){if(u){setUser(u);_syncUid=u.uid;syncFromCloud(u.uid).then(function(){setProfile(LD("profile",DEF_PROF));setAuthReady(true);}).catch(function(){setAuthReady(true);});}else{setUser(null);_syncUid=null;setAuthReady(true);}});return unsub;},[]);

  /* Auto-sync every 2 min */
  useEffect(function(){if(!user)return;var iv=setInterval(function(){syncToCloud(user.uid).catch(function(){});},120000);return function(){clearInterval(iv);};},[user]);

  useEffect(function(){if(scrollRef.current)scrollRef.current.scrollTop=0;},[tab]);
  useEffect(function(){SV("profile",profile);requestNotifPerm();},[profile]);

  function doSync(){if(!user)return;setSyncing(true);syncToCloud(user.uid).then(function(){setLastSync(new Date().toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"}));setSyncing(false);}).catch(function(){setSyncing(false);});}
  function doLogout(){_syncUid=null;fbAuth.signOut();setUser(null);}

  /* View mode for doctor */
  var viewUid=getViewUid();
  if(viewUid)return <DoctorView uid={viewUid}/>;

  /* Auth screen */
  if(!authReady)return(<div style={{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:C.bg}}><div style={{textAlign:"center"}}><div style={{fontSize:"40px",marginBottom:"10px",animation:"pulse 1.5s infinite"}}>üå∏</div><p style={{fontFamily:F.s,fontSize:"14px",color:C.txtM}}>Caricamento...</p></div></div>);
  if(!user)return <AuthScreen onLogin={function(u){setUser(u);}}/>;

  var mc=calcMacros(profile);
  return(
    <div style={{fontFamily:F.s,background:"linear-gradient(180deg,"+C.bg+","+C.bgW+")",minHeight:"100vh",display:"flex",flexDirection:"column"}}>
      <div style={{background:C.white,borderBottom:"1px solid "+C.bdr,padding:"12px 16px 8px",position:"sticky",top:0,zIndex:100}}>
        <div style={{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"}}>
          <div style={{width:"34px",height:"34px",borderRadius:"10px",background:"linear-gradient(135deg,"+C.sage+","+C.rose+")",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"16px"}}>üå∏</div>
          <div style={{flex:1}}><h1 style={{fontFamily:F.p,fontSize:"17px",fontWeight:"600",color:C.txt,margin:0}}>PCOS Daily</h1><p style={{fontSize:"9px",color:C.txtL,margin:"1px 0 0"}}>v3.0 ‚òÅÔ∏è | ~{mc.target} kcal | IF {profile.ifH}:{24-profile.ifH}</p></div>
          <div style={{textAlign:"right"}}><div style={{fontSize:"12px",fontWeight:"700",color:C.sage,fontFamily:F.s}}>{profile.weight} kg</div><div style={{fontSize:"8px",color:C.txtL,fontFamily:F.s}}>goal {profile.goalW} kg</div></div>
        </div>
        <div style={{display:"flex",gap:"4px",alignItems:"center",marginBottom:"6px"}}>
          <button onClick={doSync} disabled={syncing} style={{padding:"4px 10px",borderRadius:"8px",border:"1px solid "+C.bdr,background:syncing?C.sageP:C.white,color:C.sageD,fontSize:"9px",fontFamily:F.s,fontWeight:"500",cursor:"pointer"}}>{syncing?"‚è≥ Sync...":"‚òÅÔ∏è Sync"}</button>
          {lastSync&&<span style={{fontSize:"8px",fontFamily:F.s,color:C.txtL}}>‚úì {lastSync}</span>}
          <button onClick={function(){setShowShare(!showShare);}} style={{padding:"4px 10px",borderRadius:"8px",border:"1px solid "+C.bdr,background:C.white,color:C.plum,fontSize:"9px",fontFamily:F.s,fontWeight:"500",cursor:"pointer"}}>üîó Medico</button>
          <div style={{flex:1}}/>
          <span style={{fontSize:"9px",fontFamily:F.s,color:C.txtL}}>{user.email?user.email.split("@")[0]:""}</span>
          <button onClick={doLogout} style={{padding:"4px 8px",borderRadius:"8px",border:"1px solid "+C.bdr,background:C.white,color:C.rose,fontSize:"9px",fontFamily:F.s,cursor:"pointer"}}>Esci</button>
        </div>
        {showShare&&(<Cd style={{marginBottom:"8px",padding:"12px",background:C.plumP,border:"1px solid "+C.plumL}}><h5 style={{fontFamily:F.s,fontSize:"11px",fontWeight:"600",color:C.plum,margin:"0 0 6px"}}>üîó Condividi con il tuo medico</h5><p style={{fontSize:"10px",fontFamily:F.s,color:C.txtM,margin:"0 0 8px"}}>Il medico vedra una dashboard di sola lettura con: profilo, peso, analisi del sangue, allenamenti e digiuni.</p><div style={{display:"flex",gap:"6px"}}><input readOnly value={generateShareLink(user.uid)} style={Object.assign({},iS,{fontSize:"10px",padding:"8px"})}/><button onClick={function(){navigator.clipboard.writeText(generateShareLink(user.uid));}} style={{padding:"8px 14px",borderRadius:"8px",border:"none",background:C.plum,color:C.white,fontSize:"10px",fontFamily:F.s,fontWeight:"600",cursor:"pointer",whiteSpace:"nowrap"}}>üìã Copia</button></div></Cd>)}
        <div style={{display:"flex",gap:"2px",overflowX:"auto"}}>
          <NavTab label="Cibo" icon="ü•ó" active={tab==="alimentazione"} onClick={function(){setTab("alimentazione");}}/>
          <NavTab label="Gym" icon="üèãÔ∏è‚Äç‚ôÄÔ∏è" active={tab==="allenamento"} onClick={function(){setTab("allenamento");}}/>
          <NavTab label="Digiuno" icon="‚è≥" active={tab==="digiuno"} onClick={function(){setTab("digiuno");}}/>
          <NavTab label="Ciclo" icon="ü©∏" active={tab==="ciclo"} onClick={function(){setTab("ciclo");}}/>
          <NavTab label="Garmin" icon="‚åö" active={tab==="garmin"} onClick={function(){setTab("garmin");}}/>
          <NavTab label="Salute" icon="üíä" active={tab==="benessere"} onClick={function(){setTab("benessere");}}/>
          <NavTab label="AI" icon="ü§ñ" active={tab==="ai"} onClick={function(){setTab("ai");}}/>
        </div>
      </div>
      <div ref={scrollRef} style={{flex:1,padding:"18px 12px 32px",maxWidth:"640px",width:"100%",margin:"0 auto",boxSizing:"border-box"}}>
        <DailyQuote/>
        <WeeklyInsight profile={profile}/>
        {tab==="alimentazione"&&<Alimentazione profile={profile} setProfile={setProfile}/>}
        {tab==="allenamento"&&<Allenamento/>}
        {tab==="digiuno"&&<Digiuno profile={profile}/>}
        {tab==="ciclo"&&<CicloMestruale/>}
        {tab==="garmin"&&<GarminSection profile={profile}/>}
        {tab==="benessere"&&<Benessere/>}
        {tab==="ai"&&<PCOSAssistant profile={profile}/>}
      </div>
      <div style={{textAlign:"center",padding:"12px",borderTop:"1px solid "+C.bdr,background:C.white}}><p style={{fontSize:"9px",color:C.txtL,margin:0}}>PCOS Daily v3.0 | Cloud ‚òÅÔ∏è | lotusflowerpcos.com | Consulta sempre il tuo medico</p></div>
    </div>
  );
}

const root=ReactDOM.createRoot(document.getElementById('root'));
root.render(React.createElement(App));
</script>
</body>
</html>